<!doctype html>
<!--[if IE 8]>
<html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en" class="no-js">
<!--<![endif]-->








    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <script type="text/javascript" src="/assets/js/viewport-min-width.js?v1547319779866581049"></script>
        <meta name="description"
              content="Official Phalcon Documentation">
        <meta name="keywords" content="php, phalcon, phalcon php, php framework, faster php framework, php extension, next generation framework, docs, documentation">
        <meta name="author" href="/humans.txt">
        <meta name="generator" content="Phalcon Team - Jekyll - Netlify">

        <link href="http://0.0.0.0:4000/3.2/en/db-models-behaviors.html" rel="canonical">
        <title>Phalcon Framework Documentation</title>

        <!-- Twitter -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@zephirlang">
        <meta name="twitter:creator" content="@zephirlang">
        <meta name="twitter:title" content="Phalcon Framework Documentation">
        <meta name="twitter:description" content="Official Phalcon Documentation">
        <meta name="twitter:image" content="https://assets.phalconphp.com/phalcon/logo.png">

        <!-- Facebook -->
        <meta property="og:url" content="http://0.0.0.0:4000">
        <meta property="og:title" content="Phalcon Framework Documentation">
        <meta property="og:description" content="Official Phalcon Documentation">
        <meta property="og:type" content="website">
        <meta property="og:image" content="https://assets.phalconphp.com/phalcon/logo.png">

        <meta name="msapplication-TileColor" content="#FFFFFF">
        <meta name="msapplication-square70x70logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-70x70.png">
        <meta name="msapplication-TileImage"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-144x144.png">
        <meta name="msapplication-square150x150logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-150x150.png">
        <meta name="msapplication-wide310x150logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-310x150.png">
        <meta name="msapplication-square310x310logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-310x310.png">

        <link rel="apple-touch-icon"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon.png">

        <link rel="apple-touch-icon-precomposed"
              sizes="57x57"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-57x57.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="60x60"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-60x60.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="72x72"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="76x76"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-76x76.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="114x114"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-114x114.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="120x120"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-120x120.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="144x144"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-144x144.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="152x152"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-152x152.png">

        <link rel="icon"
              type="image/png"
              sizes="16x16"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-16x16.png">
        <link rel="icon"
              type="image/png"
              sizes="32x32"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-32x32.png">
        <link rel="icon"
              type="image/png"
              sizes="96x96"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-96x96.png">
        <link rel="icon"
              type="image/png"
              sizes="128x128"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-128x128.png">
        <link rel="icon"
              type="image/png"
              sizes="196x196"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-196x196.png">
        <link rel="shortcut icon"
              type="image/png"
              href="https://assets.phalconphp.com/phalcon/favicon.ico"/>

        <link rel="alternate"
              type="application/rss+xml"
              title=" - "
              href="http://0.0.0.0:4000/feed.xml">

        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css"
              integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE="
              crossorigin="anonymous" />
        <link rel="stylesheet" href="/assets/css/monokai.css?v1547319779866581049" />
        <link rel="stylesheet" href="/assets/css/style.css?v1547319779866581049" />

        <script defer src="https://use.fontawesome.com/releases/v5.6.1/js/all.js"
                integrity="sha384-R5JkiUweZpJjELPWqttAYmYM1P3SNEJRM6ecTQF05pFFtxmCO+Y1CiUhvuDzgSVZ"
                crossorigin="anonymous"></script>
        
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90300500-6"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-90300500-6');
    </script>

    </head>


<body onclick="o2.allNavSlideUp()">
    <header class="header-image-doc">
        <div class="container">
            <div class="header-wrapper">
                <div class="clearfix">
                    <div class="row">
                        <div class="col-md-2 col-sm-3  col-xs-8">
                            <div class="header-image__logo-wrapper">
                                <a href="/3.2/en">
                                    <img class="logo-img" src="/assets/images/header_logo.svg" alt="logo">
                                </a>
                            </div>
                        </div>
                        <div class="col-md-10 col-sm-9 top-menu">

                            <div class="nav-icon" onclick="o2.showMobileMenu();">
                                <div class="nav-line"></div>
                                <div class="nav-line"></div>
                                <div class="nav-line"></div>
                            </div>
                            <nav class="header-nav">
                                <ul>
                                    <li class="nav-item" onclick="o2.toggleState(this, event);">
                                        <div class="nav-item_selected">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                 alt="">
                                            <span class="caret"></span>
                                        </div>
                                        <div class="nav-item__list" onclick="event.stopPropagation();">
                                            
                                                <a href="/3.2/en/db-models-behaviors" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                         alt="English (US)">
                                                    English (US)
                                                </a>
                                            
                                        </div>
                                    </li>

                                        <li class="nav-item" onclick="o2.toggleState(this, event);">
                                            <div class="nav-item__selected custom-select__version">
                                                Version 3.2
                                                <span class="caret"></span>
                                            </div>
                                            <div class="nav-item__list" onclick="event.stopPropagation();">
                                                
                                                <a href="/3.4/en/db-models-behaviors" class="custom-select__list-item">
                                                    <span>3.4</span>
                                                </a>
                                                
                                                <a href="/3.3/en/db-models-behaviors" class="custom-select__list-item">
                                                    <span>3.3</span>
                                                </a>
                                                
                                                <a href="/3.2/en/db-models-behaviors" class="custom-select__list-item">
                                                    <span>3.2</span>
                                                </a>
                                                
                                                <a href="/3.1/en/db-models-behaviors" class="custom-select__list-item">
                                                    <span>3.1</span>
                                                </a>
                                                
                                                <a href="/4.0/en/db-models-behaviors" class="custom-select__list-item">
                                                    <span>4.0</span>
                                                </a>
                                                
                                            </div>
                                        </li>

                                    <li class="nav-item" onclick="o2.toggleState(this, event);">
                                        <div class="nav-item_selected">
                                            Community
                                            <span class="caret"></span>
                                        </div>
                                        <div class="nav-item__list">
                                            <a href="https://phalcon.link/forum" class="custom-select__list-item" target="_blank">
                                                Forum
                                            </a>
                                            <a href="https://phalcon.link/blog" class="custom-select__list-item" target="_blank">
                                                Blog
                                            </a>
                                            <a href="https://phalcon.link/resources" class="custom-select__list-item" target="_blank">
                                                Resources
                                            </a>
                                            <div class="nav-item__divider"></div>
                                            <a href="https://phalcon.link/f" class="custom-select__list-item" target="_blank">
                                                Facebook
                                            </a>
                                            <a href="https://phalcon.link/t" class="custom-select__list-item" target="_blank">
                                                Twitter
                                            </a>
                                            <a href="https://phalcon.link/gab" class="custom-select__list-item" target="_blank">
                                                Gab.ai
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/about">
                                            About
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/sponsors">
                                            Sponsors
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/fund">
                                            Support Us
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/download">
                                            Download
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>

                        <div class="header-nav-mobile">
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this, event)">
                                    <img class="lang-image"
                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                         alt="">
                                    <span class="caret"></span>
                                </div>

                                <ul style="display:none;" class="clearfix" onclick="event.stopPropagation();">
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.2/en/db-models-behaviors">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                 alt="English (US)">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                </ul>

                            </div>
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this,event)">
                                    Version 3.2
                                    <span class="caret"></span>
                                </div>

                                <ul style="display:none;" class="clearfix" onclick="event.stopPropagation();">
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.4/en/db-models-behaviors">
                                            <span>3.4</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.3/en/db-models-behaviors">
                                            <span>3.3</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.2/en/db-models-behaviors">
                                            <span>3.2</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.1/en/db-models-behaviors">
                                            <span>3.1</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/4.0/en/db-models-behaviors">
                                            <span>4.0</span>
                                        </a>
                                    </li>
                                    
                                </ul>

                            </div>
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this, event)">
                                    
                                    <span class="caret"></span>
                                </div>
                                <ul style="display:none;">
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/forum" target="_blank">
                                            Forum
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/blog" target="_blank">
                                            Blog
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/resources" target="_blank">
                                            Resources
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/f" target="_blank">
                                            Facebook
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/t" target="_blank">
                                            Twitter
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/gab" target="_blank">
                                            Gab.ai
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/about">
                                    About
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/sponsors">
                                    Sponsors
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/fund">
                                    Support Us
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/download">
                                    Download
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>


    <div class="container-fluid article-page-wrap">
        <div class="row">
            <div>
                <div class="col-md-2 sidebar hidden-xs">
                    <div class="sidebar--spacer">&nbsp;</div>
                </div>
                <div class="m-t-md m-b-lg" id="articles">
                    <div class="article-content">
                        <p><a name="overview"></a></p>
<h1 id="model-behaviors">Model Behaviors</h1>
<p>Behaviors are shared constructs that several models may adopt in order to re-use code. The ORM provides an API to implement behaviors in your models. Also, you can use the events and callbacks as seen before as an alternative to implement Behaviors with more freedom.</p>

<p>A behavior must be added in the model initializer, a model can have zero or more behaviors:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Model;
use Phalcon\Mvc\Model\Behavior\Timestampable;

class Users extends Model
{
    public $id;

    public $name;

    public $created_at;

    public function initialize()
    {
        $this-&gt;addBehavior(
            new Timestampable(
                [
                    'beforeCreate' =&gt; [
                        'field'  =&gt; 'created_at',
                        'format' =&gt; 'Y-m-d',
                    ]
                ]
            )
        );
    }
}
</code></pre>

<p>The following built-in behaviors are provided by the framework:</p>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Timestampable</td>
      <td>Allows to automatically update a model’s attribute saving the datetime when a record is created or updated</td>
    </tr>
    <tr>
      <td>SoftDelete</td>
      <td>Instead of permanently delete a record it marks the record as deleted changing the value of a flag column</td>
    </tr>
  </tbody>
</table>

<p><a name="timestampable"></a></p>
<h2 id="timestampable">Timestampable</h2>
<p>This behavior receives an array of options, the first level key must be an event name indicating when the column must be assigned:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Model\Behavior\Timestampable;

public function initialize()
{
    $this-&gt;addBehavior(
        new Timestampable(
            [
                'beforeCreate' =&gt; [
                    'field'  =&gt; 'created_at',
                    'format' =&gt; 'Y-m-d',
                ]
            ]
        )
    );
}
</code></pre>

<p>Each event can have its own options, <code>field</code> is the name of the column that must be updated, if <code>format</code> is a string it will be used
as format of the PHP’s function <a href="http://php.net/manual/en/function.date.php">date</a>, format can also be an anonymous function providing you the free to generate any kind timestamp:</p>

<pre><code class="language-php">&lt;?php

use DateTime;
use DateTimeZone;
use Phalcon\Mvc\Model\Behavior\Timestampable;

public function initialize()
{
    $this-&gt;addBehavior(
        new Timestampable(
            [
                'beforeCreate' =&gt; [
                    'field'  =&gt; 'created_at',
                    'format' =&gt; function () {
                        $datetime = new Datetime(
                            new DateTimeZone('Europe/Stockholm')
                        );

                        return $datetime-&gt;format('Y-m-d H:i:sP');
                    }
                ]
            ]
        )
    );
}
</code></pre>

<p>If the option <code>format</code> is omitted a timestamp using the PHP’s function <a href="http://php.net/manual/en/function.time.php">time</a>, will be used.</p>

<p><a name="softdelete"></a></p>
<h2 id="softdelete">SoftDelete</h2>
<p>This behavior can be used as follows:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Model;
use Phalcon\Mvc\Model\Behavior\SoftDelete;

class Users extends Model
{
    const DELETED     = 'D';
    const NOT_DELETED = 'N';

    public $id;
    public $name;
    public $status;

    public function initialize()
    {
        $this-&gt;addBehavior(
            new SoftDelete(
                [
                    'field' =&gt; 'status',
                    'value' =&gt; Users::DELETED,
                ]
            )
        );
    }
}
</code></pre>

<p>This behavior accepts two options: <code>field</code> and <code>value</code>, <code>field</code> determines what field must be updated and <code>value</code> the value to be deleted. Let’s pretend the table <code>users</code> has the following data:</p>

<pre><code class="language-sql">mysql&gt; select * from users;
+----+---------+--------+
| id | name    | status |
+----+---------+--------+
|  1 | Lana    | N      |
|  2 | Brandon | N      |
+----+---------+--------+
2 rows in set (0.00 sec)
</code></pre>

<p>If we delete any of the two records the status will be updated instead of delete the record:</p>

<pre><code class="language-php">&lt;?php

Users::findFirst(2)-&gt;delete();
</code></pre>

<p>The operation will result in the following data in the table:</p>

<pre><code class="language-sql">mysql&gt; select * from users;
+----+---------+--------+
| id | name    | status |
+----+---------+--------+
|  1 | Lana    | N      |
|  2 | Brandon | D      |
+----+---------+--------+
2 rows in set (0.01 sec)
</code></pre>

<p>Note that you need to specify the deleted condition in your queries to effectively ignore them as deleted records, this behavior doesn’t support that.</p>

<p><a name="create-your-own-behaviors"></a></p>
<h2 id="creating-your-own-behaviors">Creating your own behaviors</h2>
<p>The ORM provides an API to create your own behaviors. A behavior must be a class implementing the <a href="api/Phalcon_Mvc_Model_BehaviorInterface">Phalcon\Mvc\Model\BehaviorInterface</a>. Also, <a href="api/Phalcon_Mvc_Model_Behavior">Phalcon\Mvc\Model\Behavior</a> provides most of the methods needed to ease the implementation of behaviors.</p>

<p>The following behavior is an example, it implements the Blameable behavior which helps identify the user that is performed operations over a model:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Model\Behavior;
use Phalcon\Mvc\Model\BehaviorInterface;

class Blameable extends Behavior implements BehaviorInterface
{
    public function notify($eventType, $model)
    {
        switch ($eventType) {

            case 'afterCreate':
            case 'afterDelete':
            case 'afterUpdate':

                $userName = // ... get the current user from session

                // Store in a log the username, event type and primary key
                file_put_contents(
                    'logs/blamable-log.txt',
                    $userName . ' ' . $eventType . ' ' . $model-&gt;id
                );

                break;

            default:
                /* ignore the rest of events */
        }
    }
}
</code></pre>

<p>The former is a very simple behavior, but it illustrates how to create a behavior, now let’s add this behavior to a model:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Model;

class Profiles extends Model
{
    public function initialize()
    {
        $this-&gt;addBehavior(
            new Blameable()
        );
    }
}
</code></pre>

<p>A behavior is also capable of intercepting missing methods on your models:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Tag;
use Phalcon\Mvc\Model\Behavior;
use Phalcon\Mvc\Model\BehaviorInterface;

class Sluggable extends Behavior implements BehaviorInterface
{
    public function missingMethod($model, $method, $arguments = [])
    {
        // If the method is 'getSlug' convert the title
        if ($method === 'getSlug') {
            return Tag::friendlyTitle($model-&gt;title);
        }
    }
}
</code></pre>

<p>Call that method on a model that implements Sluggable returns a SEO friendly title:</p>

<pre><code class="language-php">&lt;?php

$title = $post-&gt;getSlug();
</code></pre>

<p><a name="traits-as-behaviors"></a></p>
<h2 id="using-traits-as-behaviors">Using Traits as behaviors</h2>
<p>You can use <a href="http://php.net/manual/en/language.oop5.traits.php">Traits</a> to re-use code in your classes, this is another way to implement custom behaviors. The following trait implements a simple version of the Timestampable behavior:</p>

<pre><code class="language-php">&lt;?php

trait MyTimestampable
{
    public function beforeCreate()
    {
        $this-&gt;created_at = date('r');
    }

    public function beforeUpdate()
    {
        $this-&gt;updated_at = date('r');
    }
}
</code></pre>

<p>Then you can use it in your model as follows:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Model;

class Products extends Model
{
    use MyTimestampable;
}
</code></pre>

                    </div>
                </div>
            </div>
        </div>
    </div>

<footer>
    <div class="container">
        <div class="footer-wrapper clearfix">

            <div class="footer-link-container">
                <a class="footer-link" href="/">
                    <img class="footer-logo-img" src="/assets/images/footer_logo.svg" alt="logo">
                </a>
                <a class="footer-link" href="https://phalcon.link/about" target="_blank">
                    About
                </a>
                <a class="footer-link" href="https://phalcon.link/sponsors" target="_blank">
                    Sponsors
                </a>
                <a class="footer-link" href="https://phalcon.link/fund" target="_blank">
                    Support Us
                </a>
                <a class="footer-link" href="https://phalcon.link/download" target="_blank">
                    Download
                </a>
                <a class="footer-link" href="https://license.phalconphp.com/" target="_blank">
                    License New BSD
                </a>
            </div>

            <div class="footer-copyright">
                <a href="https://odva.pro/" target="_blank" class="o2-link">
                    <span>Development by</span> <img src="/assets/images/logo-o2.svg" alt="logo o2">
                </a>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript" src="/assets/js/main.min.js?v1547319779866581049"></script>
<script type="text/javascript" src="/assets/js/highlight/highlight.pack.js?v1547319779866581049"></script>
<script type="application/javascript">hljs.initHighlightingOnLoad();</script>
<script type="application/javascript">hljs.initHighlightingOnLoad();</script>
</body>
</html>
