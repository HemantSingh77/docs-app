<!doctype html>
<!--[if IE 8]>
<html lang="ja-jp" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="ja-jp" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="ja-jp" class="no-js">
<!--<![endif]-->








    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <script type="text/javascript" src="/assets/js/viewport-min-width.js?v1547266080100021829"></script>
        <meta name="description"
              content="Official Phalcon Documentation">
        <meta name="keywords" content="php, phalcon, phalcon php, php framework, faster php framework, php extension, next generation framework, docs, documentation">
        <meta name="author" href="/humans.txt">
        <meta name="generator" content="Phalcon Team - Jekyll - Netlify">

        <link href="https://phalcon-docs4.netlify.com/3.4/ja-jp/tutorial-invo.html" rel="canonical">
        <title>Phalcon Framework Documentation</title>

        <!-- Twitter -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@zephirlang">
        <meta name="twitter:creator" content="@zephirlang">
        <meta name="twitter:title" content="Phalcon Framework Documentation">
        <meta name="twitter:description" content="Official Phalcon Documentation">
        <meta name="twitter:image" content="https://assets.phalconphp.com/phalcon/logo.png">

        <!-- Facebook -->
        <meta property="og:url" content="https://phalcon-docs4.netlify.com">
        <meta property="og:title" content="Phalcon Framework Documentation">
        <meta property="og:description" content="Official Phalcon Documentation">
        <meta property="og:type" content="website">
        <meta property="og:image" content="https://assets.phalconphp.com/phalcon/logo.png">

        <meta name="msapplication-TileColor" content="#FFFFFF">
        <meta name="msapplication-square70x70logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-70x70.png">
        <meta name="msapplication-TileImage"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-144x144.png">
        <meta name="msapplication-square150x150logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-150x150.png">
        <meta name="msapplication-wide310x150logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-310x150.png">
        <meta name="msapplication-square310x310logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-310x310.png">

        <link rel="apple-touch-icon"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon.png">

        <link rel="apple-touch-icon-precomposed"
              sizes="57x57"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-57x57.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="60x60"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-60x60.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="72x72"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="76x76"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-76x76.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="114x114"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-114x114.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="120x120"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-120x120.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="144x144"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-144x144.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="152x152"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-152x152.png">

        <link rel="icon"
              type="image/png"
              sizes="16x16"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-16x16.png">
        <link rel="icon"
              type="image/png"
              sizes="32x32"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-32x32.png">
        <link rel="icon"
              type="image/png"
              sizes="96x96"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-96x96.png">
        <link rel="icon"
              type="image/png"
              sizes="128x128"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-128x128.png">
        <link rel="icon"
              type="image/png"
              sizes="196x196"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-196x196.png">
        <link rel="shortcut icon"
              type="image/png"
              href="https://assets.phalconphp.com/phalcon/favicon.ico"/>

        <link rel="alternate"
              type="application/rss+xml"
              title=" - "
              href="https://phalcon-docs4.netlify.com/feed.xml">

        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css"
              integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE="
              crossorigin="anonymous" />
        <link rel="stylesheet" href="/assets/css/monokai.css?v1547266080100021829" />
        <link rel="stylesheet" href="/assets/css/style.css?v1547266080100021829" />

        <script defer src="https://use.fontawesome.com/releases/v5.6.1/js/all.js"
                integrity="sha384-R5JkiUweZpJjELPWqttAYmYM1P3SNEJRM6ecTQF05pFFtxmCO+Y1CiUhvuDzgSVZ"
                crossorigin="anonymous"></script>
        
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90300500-6"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-90300500-6');
    </script>

    </head>


<body onclick="o2.allNavSlideUp()">
    <header class="header-image-doc">
        <div class="container">
            <div class="header-wrapper">
                <div class="clearfix">
                    <div class="row">
                        <div class="col-md-2 col-sm-3  col-xs-8">
                            <div class="header-image__logo-wrapper">
                                <a href="/3.4/ja-jp">
                                    <img class="logo-img" src="/assets/images/header_logo.svg" alt="logo">
                                </a>
                            </div>
                        </div>
                        <div class="col-md-10 col-sm-9 top-menu">

                            <div class="nav-icon" onclick="o2.showMobileMenu();">
                                <div class="nav-line"></div>
                                <div class="nav-line"></div>
                                <div class="nav-line"></div>
                            </div>
                            <nav class="header-nav">
                                <ul>
                                    <li class="nav-item" onclick="o2.toggleState(this, event);">
                                        <div class="nav-item_selected">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ja.png"
                                                 alt="">
                                            <span class="caret"></span>
                                        </div>
                                        <div class="nav-item__list" onclick="event.stopPropagation();">
                                            
                                                <a href="/3.4/en/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                         alt="English (US)">
                                                    English (US)
                                                </a>
                                            
                                                <a href="/3.4/cs-cz/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/cs.png"
                                                         alt="Czech">
                                                    Czech
                                                </a>
                                            
                                                <a href="/3.4/de-de/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/de.png"
                                                         alt="German">
                                                    German
                                                </a>
                                            
                                                <a href="/3.4/es-es/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                         alt="Spanish">
                                                    Spanish
                                                </a>
                                            
                                                <a href="/3.4/fa-ir/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fa.png"
                                                         alt="Persian">
                                                    Persian
                                                </a>
                                            
                                                <a href="/3.4/fr-fr/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fr.png"
                                                         alt="French">
                                                    French
                                                </a>
                                            
                                                <a href="/3.4/id-id/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/id.png"
                                                         alt="Indonesian">
                                                    Indonesian
                                                </a>
                                            
                                                <a href="/3.4/it-it/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/it.png"
                                                         alt="Italian">
                                                    Italian
                                                </a>
                                            
                                                <a href="/3.4/ja-jp/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ja.png"
                                                         alt="Japanese">
                                                    Japanese
                                                </a>
                                            
                                                <a href="/3.4/pl-pl/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/pl.png"
                                                         alt="Polish">
                                                    Polish
                                                </a>
                                            
                                                <a href="/3.4/ru-ru/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ru.png"
                                                         alt="Russian">
                                                    Russian
                                                </a>
                                            
                                                <a href="/3.4/tr-tr/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/tr.png"
                                                         alt="Turkish">
                                                    Turkish
                                                </a>
                                            
                                                <a href="/3.4/uk-ua/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/uk.png"
                                                         alt="Ukrainian">
                                                    Ukrainian
                                                </a>
                                            
                                                <a href="/3.4/zh-cn/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                                         alt="Chinese Simplified">
                                                    Chinese Simplified
                                                </a>
                                            
                                        </div>
                                    </li>

                                        <li class="nav-item" onclick="o2.toggleState(this, event);">
                                            <div class="nav-item__selected custom-select__version">
                                                 3.4
                                                <span class="caret"></span>
                                            </div>
                                            <div class="nav-item__list" onclick="event.stopPropagation();">
                                                
                                                <a href="/3.4/ja-jp/tutorial-invo" class="custom-select__list-item">
                                                    <span>3.4</span>
                                                </a>
                                                
                                                <a href="/3.3/ja-jp/tutorial-invo" class="custom-select__list-item">
                                                    <span>3.3</span>
                                                </a>
                                                
                                                <a href="/3.2/ja-jp/tutorial-invo" class="custom-select__list-item">
                                                    <span>3.2</span>
                                                </a>
                                                
                                                <a href="/3.1/ja-jp/tutorial-invo" class="custom-select__list-item">
                                                    <span>3.1</span>
                                                </a>
                                                
                                                <a href="/4.0/ja-jp/tutorial-invo" class="custom-select__list-item">
                                                    <span>4.0</span>
                                                </a>
                                                
                                            </div>
                                        </li>

                                    <li class="nav-item" onclick="o2.toggleState(this, event);">
                                        <div class="nav-item_selected">
                                            
                                            <span class="caret"></span>
                                        </div>
                                        <div class="nav-item__list">
                                            <a href="https://phalcon.link/forum" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/blog" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/resources" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <div class="nav-item__divider"></div>
                                            <a href="https://phalcon.link/f" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/t" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/gab" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/about">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/sponsors">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/fund">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/download">
                                            
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>

                        <div class="header-nav-mobile">
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this, event)">
                                    <img class="lang-image"
                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ja.png"
                                         alt="">
                                    <span class="caret"></span>
                                </div>

                                <ul style="display:none;" class="clearfix" onclick="event.stopPropagation();">
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/en/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                 alt="English (US)">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/cs-cz/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/cs.png"
                                                 alt="Czech">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/de-de/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/de.png"
                                                 alt="German">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/es-es/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                 alt="Spanish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/fa-ir/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fa.png"
                                                 alt="Persian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/fr-fr/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fr.png"
                                                 alt="French">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/id-id/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/id.png"
                                                 alt="Indonesian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/it-it/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/it.png"
                                                 alt="Italian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/ja-jp/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ja.png"
                                                 alt="Japanese">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/pl-pl/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/pl.png"
                                                 alt="Polish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/ru-ru/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ru.png"
                                                 alt="Russian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/tr-tr/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/tr.png"
                                                 alt="Turkish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/uk-ua/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/uk.png"
                                                 alt="Ukrainian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/zh-cn/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                                 alt="Chinese Simplified">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                </ul>

                            </div>
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this,event)">
                                     3.4
                                    <span class="caret"></span>
                                </div>

                                <ul style="display:none;" class="clearfix" onclick="event.stopPropagation();">
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.4/ja-jp/tutorial-invo">
                                            <span>3.4</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.3/ja-jp/tutorial-invo">
                                            <span>3.3</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.2/ja-jp/tutorial-invo">
                                            <span>3.2</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.1/ja-jp/tutorial-invo">
                                            <span>3.1</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/4.0/ja-jp/tutorial-invo">
                                            <span>4.0</span>
                                        </a>
                                    </li>
                                    
                                </ul>

                            </div>
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this, event)">
                                    
                                    <span class="caret"></span>
                                </div>
                                <ul style="display:none;">
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/forum" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/blog" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/resources" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/f" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/t" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/gab" target="_blank">
                                            
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/about">
                                    
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/sponsors">
                                    
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/fund">
                                    
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/download">
                                    
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>


    <div class="container-fluid article-page-wrap">
        <div class="row">
            <div>
                <div class="col-md-2 sidebar hidden-xs">
                    <div class="sidebar--spacer">&nbsp;</div>
                </div>
                <div class="m-t-md m-b-lg" id="articles">
                    <div class="article-content">
                        







                        <section class="documentation-section">
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-md-8 col-lg-9 parse-content">
                                        <div>
                                            <a class="article-content-edit-link pull-right"
                                               href="https://crowdin.com/project/phalcon-documentation/ja-jp">
                                                
                                            </a>
                                            <br>
                                        </div>
                                        <p><a name="overview"></a></p>

<h1 id="チュートリアル-invo">チュートリアル: INVO</h1>

<p>この第2のチュートリアルでは、より完全なアプリケーションを例にして説明し、Phalconを使用した開発について理解を深めます。 INVOは、私達が制作したサンプルアプリケーションの1つです。 INVOは小さなWebサイトで、ユーザーは請求書を作成したり、顧客や製品を管理したりといったタスクを行うことができます。 コードは <a href="https://github.com/phalcon/invo">Github</a> からcloneすることができます。</p>

<p>INVOはクライアントサイドフレームワークである <a href="http://getbootstrap.com/">Bootstrap</a> を使用して作られています。 アプリケーションは実際の請求書を生成しませんが、フレームワークの働きを理解するサンプルにはなります。</p>

<p><a name="structure"></a></p>

<h2 id="プロジェクトの構成">プロジェクトの構成</h2>

<p>ドキュメントルートでプロジェクトをcloneすると、次のような構造が表示されます:</p>

<pre><code class="language-bash">invo/
    app/
        config/
        controllers/
        forms/
        library/
        logs/
        models/
        plugins/
        views/
    cache/
        volt/
    docs/
    public/
        css/
        fonts/
        js/
    schemas/
</code></pre>

<p>As you know, Phalcon does not impose a particular file structure for application development. This project has a simple MVC structure and a public document root.</p>

<p>ブラウザで <code>http://localhost/invo</code> にアクセスしてアプリケーションを開くと、以下のように表示されるでしょう:</p>

<p><img src="/assets/images/content/tutorial-invo-1.png" alt="" /></p>

<p>アプリケーションは2つの部分に分かれています: フロント／バックエンド。 フロントエンドは公開されている部分で、訪問者はINVOの概要を知ったり、連絡先情報をリクエストする事ができます。 バックエンドは管理用の領域で、登録ユーザーが製品や顧客情報の管理ができます。</p>

<p><a name="routing"></a></p>

<h2 id="ルーティング">ルーティング</h2>

<p>INVO uses the standard route that is built-in with the <a href="/3.4/en/routing">Router</a> component. これらのルートは、 <code>/:controller/:action/:params</code> というパターンにマッチします。 これは、URIの最初の部分がコントローラー、2番めの部分がアクション、残りがパラメーターになる、ということを意味しています。</p>

<p><code>/session/register</code> というルートでは、<code>SessionController</code> コントローラの <code>registerAction</code> アクションが実行されます。</p>

<p><a name="configuration"></a></p>

<h2 id="設定">設定</h2>

<p>INVOにはアプリケーション内で、一般的なパラメーターをセットする設定ファイルがあります。 このファイルは <code>app/config/config.ini</code> にあり、アプリケーションのブートストラップ (<code>public/index.php</code>) の最初の数行で読み込まれています:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Config\Adapter\Ini as ConfigIni;

// ...

// 設定の読み込み
$config = new ConfigIni(
    APP_PATH . 'app/config/config.ini'
);

</code></pre>

<p><a href="/3.4/en/config">Phalcon Config</a> (<a href="api/Phalcon_Config">Phalcon\Config</a>) allows us to manipulate the file in an object-oriented way. In this example, we’re using an ini file for configuration but Phalcon has <a href="/3.4/en/config">adapters</a> for other file types as well. 構成ファイルには、次の設定が含まれています:</p>

<pre><code class="language-ini">[database]
host     = localhost
username = root
password = secret
name     = invo

[application]
controllersDir = app/controllers/
modelsDir      = app/models/
viewsDir       = app/views/
pluginsDir     = app/plugins/
formsDir       = app/forms/
libraryDir     = app/library/
baseUri        = /invo/
</code></pre>

<p>Phalconには、あらかじめ定義された設定規則はありません。 セクションは必要に応じてオプションを整理するのに役立ちます。 このファイルには、2つのセクションが使用されます: <code>application</code>と<code>database</code>。</p>

<p><a name="autoloaders"></a></p>

<h2 id="オートローダー">オートローダー</h2>

<p>ブートストラップ(<code>public/index.php</code>)に記述されている2番目の部分はオートローダーです:</p>

<pre><code class="language-php">&lt;?php

/**
 * オートローダーの設定
 */
require APP_PATH . 'app/config/loader.php';
</code></pre>

<p>オートローダーは、アプリケーションが最終的に必要とするクラスを探すディレクトリーのセットを登録します。</p>

<pre><code class="language-php">&lt;?php

$loader = new Phalcon\Loader();

// 設定ファイルからディレクトリの設定を取得して登録
$loader-&gt;registerDirs(
    [
        APP_PATH . $config-&gt;application-&gt;controllersDir,
        APP_PATH . $config-&gt;application-&gt;pluginsDir,
        APP_PATH . $config-&gt;application-&gt;libraryDir,
        APP_PATH . $config-&gt;application-&gt;modelsDir,
        APP_PATH . $config-&gt;application-&gt;formsDir,
    ]
);

$loader-&gt;register();
</code></pre>

<p>上記のコードは、設定ファイルで定義されたディレクトリを登録していることに注意してください。 viewsDirにはHTMLファイルとPHPファイルが含まれますが、クラスは含まれていないためviewsDirディレクトリだけは登録しません。 また、APP_PATHという定数を使っていることに注意してください。 この定数はブートストラップ(<code>public/index.php</code>)で定義されているもので、プロジェクトのルートパスを参照することができます。</p>

<pre><code class="language-php">&lt;?php

// ...

define(
    'APP_PATH',
    realpath('..') . '/'
);
</code></pre>

<p><a name="services"></a></p>

<h2 id="サービスの登録">サービスの登録</h2>

<p>Another file that is required in the bootstrap is (<code>app/config/services.php</code>). This file allows us to organize the services that INVO uses.</p>

<pre><code class="language-php">&lt;?php

/**
 * アプリケーションのサービスを登録
 */
require APP_PATH . 'app/config/services.php';
</code></pre>

<p>サービス登録は、必要なコンポーネントを遅延ロードするためのクロージャによって実現されます。</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Url as UrlProvider;

// ...

/**
 * URLコンポーネントはアプリケーションにおける全てのURLを生成するに使われる
 */
$di-&gt;set(
    'url',
    function () use ($config) {
        $url = new UrlProvider();

        $url-&gt;setBaseUri(
            $config-&gt;application-&gt;baseUri
        );

        return $url;
    }
);
</code></pre>

<p>後でこのファイルについてより詳しく説明します。</p>

<p><a name="handling-requests"></a></p>

<h2 id="リクエストの処理">リクエストの処理</h2>

<p>If we skip to the end of the file (<code>public/index.php</code>), the request is finally handled by <a href="api/Phalcon_Mvc_Application">Phalcon\Mvc\Application</a> which initializes and executes all that is necessary to make the application run:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Application;

// ...

$application = new Application($di);

$response = $application-&gt;handle();

$response-&gt;send();
</code></pre>

<p><a name="dependency-injection"></a></p>

<h2 id="依存性の注入">依存性の注入</h2>

<p>上記コード例の1行目を見てください。 Application クラスのコンストラクタは、<code>$di</code> 変数を引数として受け取っています。 この変数の目的は何でしょう？ Phalconは高度に分割されたフレームワークなので、全てが協調して動作するための接着剤の役割を果たすコンポーネントが必要です。 That component is <a href="api/Phalcon_Di">Phalcon\Di</a>. これはサービスコンテナで、依存性の注入（Dependency Injection）や、アプリケーションに必要なコンポーネントの初期化も実行します。</p>

<p>コンテナにサービスを登録するには、様々な方法があります。 INVOでは、ほとんどのサービスは無名関数/クロージャーを使って登録されています。 このおかげで、オブジェクトは必要になるまでインスタンス化されないので、アプリケーションに必要なリソースが節約できます。</p>

<p>For instance, in the following excerpt the session service is registered. The anonymous function will only be called when the application requires access to the session data:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Session\Adapter\Files as Session;

// ...

// コンポーネントがsessionサービスを最初に要求した時にセッションを開始する
$di-&gt;set(
    'session',
    function () {
        $session = new Session();

        $session-&gt;start();

        return $session;
    }
);
</code></pre>

<p>これでアダプタを変更して、初期化処理を追加する等が自由に行えるようになりました。 サービスは “session” という名前で登録されていることに注意してください。 これは、フレームワークがサービスコンテナ内のアクティブなサービスを識別できるようにする規約です。</p>

<p>リクエストは多数のサービスを利用する可能性があり、それらを1つずつ登録するのは面倒な作業です。 For that reason, the framework provides a variant of <a href="api/Phalcon_Di">Phalcon\Di</a> called <a href="api/Phalcon_Di_FactoryDefault">Phalcon\Di\FactoryDefault</a> whose task is to register all services providing a full-stack framework.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Di\FactoryDefault;

// ...

// FactoryDefault Dependency Injectorは、フルスタックフレームワークを提供するのに
// 最適なサービスを、自動的に登録します
$di = new FactoryDefault();
</code></pre>

<p>FactoryDefault はフレームワークが標準的に提供しているコンポーネントサービスのほぼ全てを登録します。 サービスの定義をオーバーライドする必要がある場合は、上記のように<code>session</code>や<code>url</code>を再設定することができます。 以上が、<code>$di</code> 変数が存在する理由です。</p>

<p><a name="log-in"></a></p>

<h2 id="アプリケーションへのログイン">アプリケーションへのログイン</h2>

<p><code>ログイン</code>機能によって、私たちはバックエンドコントローラの作業に取りかかることができます。 バックエンドとフロントエンドのコントローラーの分割は、あくまで論理上のものです。 全てのコントローラーは、同じディレクトリ (<code>app/controllers/</code>) に含まれています。</p>

<p>To enter the system, users must have a valid username and password. Users are stored in the table <code>users</code> in the database <code>invo</code>.</p>

<p>セッションを開始する前に、アプリケーションがデータベースに接続できるよう設定する必要があります。 接続情報を持った <code>db</code> という名前のサービスが、サービスコンテナ内で用意されます。 オートローダーと同様、サービスを設定するための情報は設定ファイルから取得します:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Db\Adapter\Pdo\Mysql as DbAdapter;

// ...

// 設定ファイルに定義されたパラメーターに基いてデータベース接続が作成される
$di-&gt;set(
    'db',
    function () use ($config) {
        return new DbAdapter(
            [
                'host'     =&gt; $config-&gt;database-&gt;host,
                'username' =&gt; $config-&gt;database-&gt;username,
                'password' =&gt; $config-&gt;database-&gt;password,
                'dbname'   =&gt; $config-&gt;database-&gt;name,
            ]
        );
    }
);
</code></pre>

<p>Here, we return an instance of the MySQL connection adapter. If needed, you could do extra actions such as adding a logger, a profiler or change the adapter, setting it up as you want.</p>

<p>The following simple form (<code>app/views/session/index.volt</code>) requests the login information. We’ve removed some HTML code to make the example more concise:</p>

<pre><code class="language-twig">
{{ form('session/start') }}
    &lt;fieldset&gt;
        &lt;div&gt;
            &lt;label for='email'&gt;
                Username/Email
            &lt;/label&gt;

            &lt;div&gt;
                {{ text_field('email') }}
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;div&gt;
            &lt;label for='password'&gt;
                Password
            &lt;/label&gt;

            &lt;div&gt;
                {{ password_field('password') }}
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;div&gt;
            {{ submit_button('Login') }}
        &lt;/div&gt;
    &lt;/fieldset&gt;
{{ endForm() }}

</code></pre>

<p>Instead of using raw PHP as the previous tutorial, we started to use <a href="/3.4/en/volt">Volt</a>. これは、Jinja_に触発された組み込みのテンプレートエンジンで、テンプレートを作成するためのよりシンプルで使いやすい構文を提供します。 Voltに精通するのに時間はかかりません。</p>

<p><code>SessionController::startAction</code>関数 (<code>app/controllers/SessionController.php</code>) が、フォームに入力されたデータのバリデーションを行います。これには、データベース内の有効なユーザーかの確認も含まれます:</p>

<pre><code class="language-php">&lt;?php

class SessionController extends ControllerBase
{
    // ...

    private function _registerSession($user)
    {
        $this-&gt;session-&gt;set(
            'auth',
            [
                'id'   =&gt; $user-&gt;id,
                'name' =&gt; $user-&gt;name,
            ]
        );
    }

    /**
     * このアクションはユーザーを認証しアプリケーションにログインさせる
     */
    public function startAction()
    {
        if ($this-&gt;request-&gt;isPost()) {
            // POSTで送信された変数を受け取る
            $email    = $this-&gt;request-&gt;getPost('email');
            $password = $this-&gt;request-&gt;getPost('password');

            // データベースからユーザーを検索
            $user = Users::findFirst(
                [
                    "(email = :email: OR username = :email:) AND password = :password: AND active = 'Y'",
                    'bind' =&gt; [
                        'email'    =&gt; $email,
                        'password' =&gt; sha1($password),
                    ]
                ]
            );

            if ($user !== false) {
                $this-&gt;_registerSession($user);

                $this-&gt;flash-&gt;success(
                    'Welcome ' . $user-&gt;name
                );

                // ユーザーが有効なら、'invoices' コントローラーに転送する
                return $this-&gt;dispatcher-&gt;forward(
                    [
                        'controller' =&gt; 'invoices',
                        'action'     =&gt; 'index',
                    ]
                );
            }

            $this-&gt;flash-&gt;error(
                'Wrong email/password'
            );
        }

        // ログインフォームへ再度転送
        return $this-&gt;dispatcher-&gt;forward(
            [
                'controller' =&gt; 'session',
                'action'     =&gt; 'index',
            ]
        );
    }
}
</code></pre>

<p>For the sake of simplicity, we have used <a href="http://php.net/manual/en/function.sha1.php">sha1</a> to store the password hashes in the database, however, this algorithm is not recommended in real applications, use <a href="/3.4/en/security">bcrypt</a> instead.</p>

<p>コントローラー内で <code>$this-&gt;flash</code>、<code>$this-&gt;request</code>、<code>$this-&gt;session</code> のようなpublic属性へのアクセスに注目してください。 これらは、サービスコンテナであらかじめ定義したサービスです (<code>app/config/services.php</code>)。 初めてアクセスされると、コントローラの一部として注入されます。 これらのサービスは<code>共有</code>されているため、これらのオブジェクトをどこから呼び出しても、常に同じインスタンスにアクセスすることになります。 例えば、ここで<code>session</code>サービスを呼び出して、ユーザーを識別する情報を<code>auth</code>という変数に保存しています:</p>

<pre><code class="language-php">&lt;?php

$this-&gt;session-&gt;set(
    'auth',
    [
        'id'   =&gt; $user-&gt;id,
        'name' =&gt; $user-&gt;name,
    ]
);
</code></pre>

<p>このセクションのもう1つの重要な側面は、ユーザーが有効なものとして検証される方法です。まず、リクエストが<code>POST</code>メソッドを使用して行われたかどうかを検証します:</p>

<pre><code class="language-php">&lt;?php

if ($this-&gt;request-&gt;isPost()) {
    // ...
}
</code></pre>

<p>次に、フォームからパラメータを受け取ります:</p>

<pre><code class="language-php">&lt;?php

$email    = $this-&gt;request-&gt;getPost('email');
$password = $this-&gt;request-&gt;getPost('password');
</code></pre>

<p>ここで、同じユーザー名または電子メールとパスワードを持つユーザーが1人いるかどうかを確認する必要があります。</p>

<pre><code class="language-php">&lt;?php

$user = Users::findFirst(
    [
        "(email = :email: OR username = :email:) AND password = :password: AND active = 'Y'",
        'bind' =&gt; [
            'email'    =&gt; $email,
            'password' =&gt; sha1($password),
        ]
    ]
);
</code></pre>

<p>‘バインドパラメータ’を使う事で、プレースホルダ<code>:email:</code>と<code>:password:</code>を値が存在すべき場所に設置する事で、パラメータ<code>bind</code>の値が’バインド’されます。 これにより、SQLインジェクションのリスクがなくても、これらのカラムの値が安全に置き換えられます。</p>

<p>ユーザーが有効な場合、セッションに登録し、ダッシュボードに転送します:</p>

<pre><code class="language-php">&lt;?php

if ($user !== false) {
    $this-&gt;_registerSession($user);

    $this-&gt;flash-&gt;success(
        'Welcome ' . $user-&gt;name
    );

    return $this-&gt;dispatcher-&gt;forward(
        [
            'controller' =&gt; 'invoices',
            'action'     =&gt; 'index',
        ]
    );
}
</code></pre>

<p>ユーザーが存在しない場合は、フォームが表示されているアクションにユーザーを再度戻します:</p>

<pre><code class="language-php">&lt;?php

return $this-&gt;dispatcher-&gt;forward(
    [
        'controller' =&gt; 'session',
        'action'     =&gt; 'index',
    ]
);
</code></pre>

<p><a name="securing-backend"></a></p>

<h2 id="バックエンドのセキュリティ保護">バックエンドのセキュリティ保護</h2>

<p>バックエンドは登録されたユーザーだけがアクセスできるプライベートな領域です。 したがって、登録されたユーザーだけがそれらのコントローラーにアクセスできるようチェックする必要があります。 たとえば、ログインせずに products コントローラー (プライベート領域) にアクセスしようとすると、以下のように表示されるはずです:</p>

<p><img src="/assets/images/content/tutorial-invo-2.png" alt="" /></p>

<p>コントローラー・アクションにアクセスしようとしたときにはいつでも、アプリケーションは現在のロール (セッションに含まれる) が、アクセス権を持っているか確認します。アクセス権がない場合は、上のようなメッセージを表示し、インデックスページに遷移させます。</p>

<p>次に、アプリケーションがこの動きをどのように実現しているか見ていきましょう。 The first thing to know is that there is a component called <a href="/3.4/en/dispatcher">Dispatcher</a>. It is informed about the route found by the <a href="/3.4/en/routing">Routing</a> component. 次に、適切なコントローラーを読み込んで、対応するアクションのメソッドを実行します。</p>

<p>通常、フレームワークはディスパッチャを自動的に作成します。 今回は、要求されたアクションを実行する前に、認証を行い、ユーザーがアクセスできるか否かチェックする必要があります。 これを実現するため、ブートストラップの中に関数を用意して、ディスパッチャを置き換えています:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Dispatcher;

// ...

/**
 * MVCディスパッチャー
 */
$di-&gt;set(
    'dispatcher',
    function () {
        // ...

        $dispatcher = new Dispatcher();

        return $dispatcher;
    }
);
</code></pre>

<p>これで、アプリケーションで使用されるディスパッチャを完全に制御できるようになりました。 フレーワークの多くのコンポーネントはイベントを発火するので、内部の処理の流れを変更することができます。 As the Dependency Injector component acts as glue for components, a new component called <a href="/3.4/en/events">EventsManager</a> allows us to intercept the events produced by a component, routing the events to listeners.</p>

<p><a name="events-manager"></a></p>

<h3 id="イベント管理">イベント管理</h3>

<p>The <a href="/3.4/en/events">EventsManager</a> allows us to attach listeners to a particular type of event. 今、私達が取り組んでいるイベントのタイプは ‘dispatch’ です。 以下のコードは、ディスパッチャによって生成される全てのイベントをフィルタリングしています:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Dispatcher;
use Phalcon\Events\Manager as EventsManager;

$di-&gt;set(
    'dispatcher',
    function () {
        // イベントマネージャを作成する
        $eventsManager = new EventsManager();

        // Securityプラグインを使用して、ディスパッチャが生成するイベントを監視する
        $eventsManager-&gt;attach(
            'dispatch:beforeExecuteRoute',
            new SecurityPlugin()
        );

        // NotFoundPluginを使用して例外や未発見の例外を処理する
        $eventsManager-&gt;attach(
            'dispatch:beforeException',
            new NotFoundPlugin()
        );

        $dispatcher = new Dispatcher();

        // イベントマネージャーをディスパッチャにアサインする
        $dispatcher-&gt;setEventsManager($eventsManager);

        return $dispatcher;
    }
);
</code></pre>

<p><code>beforeExecuteRoute</code>というイベントが発生すると、次のプラグインが通知されます。</p>

<pre><code class="language-php">&lt;?php

/**
 * ユーザーがSecurityPluginを使用して特定のアクションにアクセスすることを許可されているかどうかを確認します
 */
$eventsManager-&gt;attach(
    'dispatch:beforeExecuteRoute',
    new SecurityPlugin()
);
</code></pre>

<p><code>beforeException</code>がトリガされると、他のプラグインに通知されます:</p>

<pre><code class="language-php">&lt;?php

/**
 * NotFoundPluginを使用して例外や未発見の例外を処理する
 */
$eventsManager-&gt;attach(
    'dispatch:beforeException',
    new NotFoundPlugin()
);
</code></pre>

<p>SecurityPluginは (<code>app/plugins/SecurityPlugin.php</code>) にあるクラスです。 このクラスは<code>beforeExecuteRoute</code>メソッドを実装しています。 これは、ディスパッチャーが生成するイベントの1つと同じ名前です:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Events\Event;
use Phalcon\Mvc\User\Plugin;
use Phalcon\Mvc\Dispatcher;

class SecurityPlugin extends Plugin
{
    // ...

    public function beforeExecuteRoute(Event $event, Dispatcher $dispatcher)
    {
        // ...
    }
}
</code></pre>

<p>フックイベントは常に2つの引数を取ります。第1引数はイベントが生成されたコンテキストの情報(<code>$event</code>) で、第2引数はイベントを生成したオブジェクト自身 (<code>$dispatcher</code>) です。 It is not mandatory that plugins extend the class <a href="api/Phalcon_Mvc_User_Plugin">Phalcon\Mvc\User\Plugin</a>, but by doing this they gain easier access to the services available in the application.</p>

<p>Now, we’re verifying the role in the current session, checking if the user has access using the ACL list. If the user does not have access we redirect to the home screen as explained before:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Acl;
use Phalcon\Events\Event;
use Phalcon\Mvc\User\Plugin;
use Phalcon\Mvc\Dispatcher;

class SecurityPlugin extends Plugin
{
    // ...

    public function beforeExecuteRoute(Event $event, Dispatcher $dispatcher)
    {
        // ロールを定義するため、セッションに'auth'変数があるかチェックする
        $auth = $this-&gt;session-&gt;get('auth');

        if (!$auth) {
            $role = 'Guests';
        } else {
            $role = 'Users';
        }

        // ディスパッチャからアクティブなコントローラー名とアクション名を取得する
        $controller = $dispatcher-&gt;getControllerName();
        $action     = $dispatcher-&gt;getActionName();

        // ACLリストを取得
        $acl = $this-&gt;getAcl();

        // ロールがコントローラー (又はリソース) にアクセス可能かチェックする
        $allowed = $acl-&gt;isAllowed($role, $controller, $action);

        if (!$allowed) {
            // アクセス権が無い場合、indexコントローラーに転送する
            $this-&gt;flash-&gt;error(
                "You don't have access to this module"
            );

            $dispatcher-&gt;forward(
                [
                    'controller' =&gt; 'index',
                    'action'     =&gt; 'index',
                ]
            );

            // 'false'を返し、ディスパッチャーに現在の処理を停止させる
            return false;
        }
    }
}
</code></pre>

<p><a name="acl"></a></p>

<h3 id="aclリストの提供">ACLリストの提供</h3>

<p>上の例では、<code>$this-&gt;getAcl()</code>メソッドでACLを取得しました。 このメソッドもプラグインに実装されています。 ここでは、アクセス制御リスト (ACL) をどのように作ったか、ステップバイステップで解説します:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Acl;
use Phalcon\Acl\Role;
use Phalcon\Acl\Adapter\Memory as AclList;

// ACLオブジェクトを作る
$acl = new AclList();

// デフォルトの挙動はDENY（拒否）
$acl-&gt;setDefaultAction(
    Acl::DENY
);

// 2つのロールを登録する
// ユーザーは登録済みユーザー、ゲストは未登録ユーザー
$roles = [
    'users'  =&gt; new Role('Users'),
    'guests' =&gt; new Role('Guests'),
];

foreach ($roles as $role) {
    $acl-&gt;addRole($role);
}
</code></pre>

<p>Now, we define the resources for each area respectively. Controller names are resources and their actions are accesses for the resources:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Acl\Resource;

// ...

// プライベートエリアのリソース (バックエンド)
$privateResources = [
    'companies'    =&gt; ['index', 'search', 'new', 'edit', 'save', 'create', 'delete'],
    'products'     =&gt; ['index', 'search', 'new', 'edit', 'save', 'create', 'delete'],
    'producttypes' =&gt; ['index', 'search', 'new', 'edit', 'save', 'create', 'delete'],
    'invoices'     =&gt; ['index', 'profile'],
];

foreach ($privateResources as $resourceName =&gt; $actions) {
    $acl-&gt;addResource(
        new Resource($resourceName),
        $actions
    );
}



// 公開エリアのリソース (フロントエンド)
$publicResources = [
    'index'    =&gt; ['index'],
    'about'    =&gt; ['index'],
    'register' =&gt; ['index'],
    'errors'   =&gt; ['show404', 'show500'],
    'session'  =&gt; ['index', 'register', 'start', 'end'],
    'contact'  =&gt; ['index', 'send'],
];

foreach ($publicResources as $resourceName =&gt; $actions) {
    $acl-&gt;addResource(
        new Resource($resourceName),
        $actions
    );
}
</code></pre>

<p>いま、ACLは既存のコントローラーと関連するアクションの情報を知っている状態になっています。 <code>Users</code>ロールはバックエンドとフロントエンド双方の全てのリソースにアクセスできます。 <code>Guests</code>ロールは公開エリアにだけアクセスできます:</p>

<pre><code class="language-php">&lt;?php

// 公開エリアのアクセス権をユーザーとゲストの双方に与える
foreach ($roles as $role) {
    foreach ($publicResources as $resource =&gt; $actions) {
        $acl-&gt;allow(
            $role-&gt;getName(),
            $resource,
            '*'
        );
    }
}

// ユーザーにだけ、プライベートエリアへのアクセス権を与える
foreach ($privateResources as $resource =&gt; $actions) {
    foreach ($actions as $action) {
        $acl-&gt;allow(
            'Users',
            $resource,
            $action
        );
    }
}
</code></pre>

<p><a name="working-with-crud"></a></p>

<h2 id="crudを使用した作業">CRUDを使用した作業</h2>

<p>バックエンドは一般的に、ユーザーがデータを操作できるようなフォームを提供します。 INVOの説明を続けると、今はCRUDの作成に取り組んでいます。Phalconにとっては、フォーム、バリデーション、ページネーターなどを利用する事で簡単に実装できる一般的な事例です。</p>

<p>INVO (企業、製品、製品の種類) のデータを操作するほとんどのオプションは、基本的で一般的な<a href="http://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> (Create, Read, Update, Delete) を使用して構築されます。 各CRUDには、次のファイルが含まれています:</p>

<pre><code class="language-bash">invo/
    app/
        controllers/
            ProductsController.php
        models/
            Products.php
        forms/
            ProductsForm.php
        views/
            products/
                edit.volt
                index.volt
                new.volt
                search.volt
</code></pre>

<p>各コントローラーは、次のようなアクションを持っています:</p>

<pre><code class="language-php">&lt;?php

class ProductsController extends ControllerBase
{
    /**
     * 開始アクション。'search' ビューを表示
     */
    public function indexAction()
    {
        // ...
    }

    /**
     * 'index'から送信された検索条件に基づいて'search'を実行
     * 結果のページネーターを返す
     */
    public function searchAction()
    {
        // ...
    }

    /**
     * 'new' productを作成するビューを表示
     */
    public function newAction()
    {
        // ...
    }

    /**
     * 既存のproductを 'edit' するビューを表示
     */
    public function editAction()
    {
        // ...
    }

    /**
     * 'new' アクションで入力されたデータに基づいてproductを作成
     */
    public function createAction()
    {
        // ...
    }

    /**
     * 'edit' アクションで入力されたデータに基づいてproductを更新
     */
    public function saveAction()
    {
        // ...
    }

    /**
     * 既存のproductを削除
     */
    public function deleteAction($id)
    {
        // ...
    }
}
</code></pre>

<p><a name="search-form"></a></p>

<h2 id="検索フォーム">検索フォーム</h2>

<p>すべてのCRUDは検索フォームから始まります。 このフォームは、テーブル (products) にある各フィールドを表示し、任意のフィールドの検索条件をユーザーが作成できるようにします。 <code>products</code>テーブルは<code>products_types</code>テーブルとのリレーションを持っています。 今回はフィールドでの検索を簡単に実装するために、テーブルのレコードを事前に取得しておきます:</p>

<pre><code class="language-php">&lt;?php

/**
 * 開始アクション。'search' ビューを表示
 */
public function indexAction()
{
    $this-&gt;persistent-&gt;searchParams = null;

    $this-&gt;view-&gt;form = new ProductsForm();
}
</code></pre>

<p>An instance of the <code>ProductsForm</code> form (<code>app/forms/ProductsForm.php</code>) is passed to the view. This form defines the fields that are visible to the user:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Forms\Form;
use Phalcon\Forms\Element\Text;
use Phalcon\Forms\Element\Hidden;
use Phalcon\Forms\Element\Select;
use Phalcon\Validation\Validator\Email;
use Phalcon\Validation\Validator\PresenceOf;
use Phalcon\Validation\Validator\Numericality;

class ProductsForm extends Form
{
    /**
     * productsフォームの初期化
     */
    public function initialize($entity = null, $options = [])
    {
        if (!isset($options['edit'])) {
            $element = new Text('id');
            $element-&gt;setLabel('Id');
            $this-&gt;add($element);
        } else {
            $this-&gt;add(new Hidden('id'));
        }

        $name = new Text('name');
        $name-&gt;setLabel('Name');
        $name-&gt;setFilters(
            [
                'striptags',
                'string',
            ]
        );
        $name-&gt;addValidators(
            [
                new PresenceOf(
                    [
                        'message' =&gt; 'Name is required',
                    ]
                )
            ]
        );
        $this-&gt;add($name);

        $type = new Select(
            'profilesId',
            ProductTypes::find(),
            [
                'using'      =&gt; [
                    'id',
                    'name',
                ],
                'useEmpty'   =&gt; true,
                'emptyText'  =&gt; '...',
                'emptyValue' =&gt; '',
            ]
        );

        $this-&gt;add($type);

        $price = new Text('price');
        $price-&gt;setLabel('Price');
        $price-&gt;setFilters(
            [
                'float',
            ]
        );
        $price-&gt;addValidators(
            [
                new PresenceOf(
                    [
                        'message' =&gt; 'Price is required',
                    ]
                ),
                new Numericality(
                    [
                        'message' =&gt; 'Price is required',
                    ]
                ),
            ]
        );
        $this-&gt;add($price);
    }
}
</code></pre>

<p>The form is declared using an object-oriented scheme based on the elements provided by the <a href="/3.4/en/forms">forms</a> component. すべてのエレメントは、ほぼ同じ構造をしています:</p>

<pre><code class="language-php">&lt;?php

// 要素を作成
$name = new Text('name');

// ラベルを設定
$name-&gt;setLabel('Name');

// 要素を検証する前にフィルタを適用
$name-&gt;setFilters(
    [
        'striptags',
        'string',
    ]
);

// バリデーションを適用
$name-&gt;addValidators(
    [
        new PresenceOf(
            [
                'message' =&gt; 'Name is required',
            ]
        )
    ]
);

// フォームに要素を追加
$this-&gt;add($name);
</code></pre>

<p>他の要素もフォームで使用されます:</p>

<pre><code class="language-php">&lt;?php

// 非表示項目をフォームに追加
$this-&gt;add(
    new Hidden('id')
);

// ...

$productTypes = ProductTypes::find();

// フォームにHTMLのSELECT （リスト）を追加
// 'product_types' のデータで埋める
$type = new Select(
    'profilesId',
    $productTypes,
    [
        'using'      =&gt; [
            'id',
            'name',
        ],
        'useEmpty'   =&gt; true,
        'emptyText'  =&gt; '...',
        'emptyValue' =&gt; '',
    ]
);
</code></pre>

<p><code>ProductTypes::find()</code>には、<code>Phalcon\Tag::select()</code>を使用してSELECTタグを埋めるために必要なデータが含まれています。 フォームがビューに渡されると、レンダリングしてユーザーに表示することができます:</p>

<pre><code class="language-twig">
{{ form('products/search') }}

    &lt;h2&gt;
        Search products
    &lt;/h2&gt;

    &lt;fieldset&gt;

        {% for element in form %}
            &lt;div class='control-group'&gt;
                {{ element.label(['class': 'control-label']) }}

                &lt;div class='controls'&gt;
                    {{ element }}
                &lt;/div&gt;
            &lt;/div&gt;
        {% endfor %}



        &lt;div class='control-group'&gt;
            {{ submit_button('Search', 'class': 'btn btn-primary') }}
        &lt;/div&gt;

    &lt;/fieldset&gt;

{{ endForm() }}

</code></pre>

<p>次の HTML が生成されます:</p>

<pre><code class="language-html">&lt;form action='/invo/products/search' method='post'&gt;

    &lt;h2&gt;
        Search products
    &lt;/h2&gt;

    &lt;fieldset&gt;

        &lt;div class='control-group'&gt;
            &lt;label for='id' class='control-label'&gt;Id&lt;/label&gt;

            &lt;div class='controls'&gt;
                &lt;input type='text' id='id' name='id' /&gt;
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class='control-group'&gt;
            &lt;label for='name' class='control-label'&gt;Name&lt;/label&gt;

            &lt;div class='controls'&gt;
                &lt;input type='text' id='name' name='name' /&gt;
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class='control-group'&gt;
            &lt;label for='profilesId' class='control-label'&gt;profilesId&lt;/label&gt;

            &lt;div class='controls'&gt;
                &lt;select id='profilesId' name='profilesId'&gt;
                    &lt;option value=''&gt;...&lt;/option&gt;
                    &lt;option value='1'&gt;Vegetables&lt;/option&gt;
                    &lt;option value='2'&gt;Fruits&lt;/option&gt;
                &lt;/select&gt;
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class='control-group'&gt;
            &lt;label for='price' class='control-label'&gt;Price&lt;/label&gt;

            &lt;div class='controls'&gt;
                &lt;input type='text' id='price' name='price' /&gt;
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class='control-group'&gt;
            &lt;input type='submit' value='Search' class='btn btn-primary' /&gt;
        &lt;/div&gt;

    &lt;/fieldset&gt;

&lt;/form&gt;
</code></pre>

<p>フォームが送信されると、<code>search</code>アクションは、ユーザーが入力したデータに基づいて検索を実行するコントローラーの中で実行されます。</p>

<p><a name="performing-searches"></a></p>

<h2 id="検索の実行">検索の実行</h2>

<p><code>search</code>アクションには2つの動作があります。 POSTでアクセスすると、フォームから送信されたデータに基づいて検索が実行されますが、GETでアクセスするとページネーション内のページに移動します。 To differentiate HTTP methods, we check it using the <a href="/3.4/en/request">Request</a> component:</p>

<pre><code class="language-php">&lt;?php

/**
 * 'index' から送信された検索条件に基づいて 'search' を実行
 * 結果のページネーターを返す
 */
public function searchAction()
{
    if ($this-&gt;request-&gt;isPost()) {
        // クエリ条件を作成する
    } else {
        // 既存の条件を使用してページ切り替え
    }

    // ...
}
</code></pre>

<p>With the help of <a href="api/Phalcon_Mvc_Model_Criteria">Phalcon\Mvc\Model\Criteria</a>, we can create the search conditions intelligently based on the data types and values sent from the form:</p>

<pre><code class="language-php">&lt;?php

$query = Criteria::fromInput(
    $this-&gt;di,
    'Products',
    $this-&gt;request-&gt;getPost()
);
</code></pre>

<p>このメソッドは、どの値が ‘‘（空の文字列）およびnullであるかを検証し、それらを考慮して検索条件を作成します。</p>

<ul>
  <li>フィールドのデータ型がテキストまたは同様のもの（char、varchar、textなど）の場合、SQLの<code>like</code>演算子を使用して結果をフィルタリングします。</li>
  <li>データ型がテキストでない場合、演算子<code>=</code>が使用されます。</li>
</ul>

<p>Additionally, <code>Criteria</code> ignores all the <code>$_POST</code> variables that do not match any field in the table. Values are automatically escaped using <code>bound parameters</code>.</p>

<p>ここでは、生成されたパラメータをコントローラのセッションバッグに格納します:</p>

<pre><code class="language-php">&lt;?php

$this-&gt;persistent-&gt;searchParams = $query-&gt;getParams();
</code></pre>

<p>セッションバッグはリクエスト間で値を維持する、セッションサービスを利用したコントローラの特殊な変数です。 When accessed, this attribute injects a <a href="api/Phalcon_Session_Bag">Phalcon\Session\Bag</a> instance that is independent in each controller.</p>

<p>次に、生成されたパラメータに基づいてクエリを実行します:</p>

<pre><code class="language-php">&lt;?php

$products = Products::find($parameters);

if (count($products) === 0) {
    $this-&gt;flash-&gt;notice(
        'The search did not found any products'
    );

    return $this-&gt;dispatcher-&gt;forward(
        [
            'controller' =&gt; 'products',
            'action'     =&gt; 'index',
        ]
    );
}
</code></pre>

<p>If the search doesn’t return any product, we forward the user to the index action again. Let’s pretend the search returned results, then we create a paginator to navigate easily through them:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Paginator\Adapter\Model as Paginator;

// ...

$paginator = new Paginator(
    [
        'data'  =&gt; $products,   // ページネーション用データ
        'limit' =&gt; 5,           // ページ内行数
        'page'  =&gt; $numberPage, // 現在のページ
    ]
);

// paginatorの現在のページを取得
$page = $paginator-&gt;getPaginate();
</code></pre>

<p>最後に、返されたページを渡して表示します:</p>

<pre><code class="language-php">&lt;?php

$this-&gt;view-&gt;page = $page;
</code></pre>

<p>ビュー (<code>app/views/products/search.volt</code>) では、現在のページに対応する結果を取得し、取得した全ての行が表示されます。</p>

<pre><code class="language-twig">
{% for product in page.items %}
    {% if loop.first %}
        &lt;table&gt;
            &lt;thead&gt;
                &lt;tr&gt;
                    &lt;th&gt;Id&lt;/th&gt;
                    &lt;th&gt;Product Type&lt;/th&gt;
                    &lt;th&gt;Name&lt;/th&gt;
                    &lt;th&gt;Price&lt;/th&gt;
                    &lt;th&gt;Active&lt;/th&gt;
                &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
    {% endif %}

    &lt;tr&gt;
        &lt;td&gt;
            {{ product.id }}
        &lt;/td&gt;

        &lt;td&gt;
            {{ product.getProductTypes().name }}
        &lt;/td&gt;

        &lt;td&gt;
            {{ product.name }}
        &lt;/td&gt;

        &lt;td&gt;
            {{ '%.2f'|format(product.price) }}
        &lt;/td&gt;

        &lt;td&gt;
            {{ product.getActiveDetail() }}
        &lt;/td&gt;

        &lt;td width='7%'&gt;
            {{ link_to('products/edit/' ~ product.id, 'Edit') }}
        &lt;/td&gt;

        &lt;td width='7%'&gt;
            {{ link_to('products/delete/' ~ product.id, 'Delete') }}
        &lt;/td&gt;
    &lt;/tr&gt;

    {% if loop.last %}
            &lt;/tbody&gt;
            &lt;tbody&gt;
                &lt;tr&gt;
                    &lt;td colspan='7'&gt;
                        &lt;div&gt;
                            {{ link_to('products/search', 'First') }}
                            {{ link_to('products/search?page=' ~ page.before, 'Previous') }}
                            {{ link_to('products/search?page=' ~ page.next, 'Next') }}
                            {{ link_to('products/search?page=' ~ page.last, 'Last') }}
                            &lt;span class='help-inline'&gt;{{ page.current }} of {{ page.total_pages }}&lt;/span&gt;
                        &lt;/div&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
            &lt;/tbody&gt;
        &lt;/table&gt;
    {% endif %}
{% else %}
    No products are recorded
{% endfor %}

</code></pre>

<p>上記の例には、細かい部分で価値あることがたくさんあります。 まず第一に、現在のページ内のアクティブなアイテムは、Voltの<code>for</code>を使用して取得されます。 VoltはPHPの<code>foreach</code>を使うための、より簡単な構文を提供します。</p>

<pre><code class="language-twig">
{% for product in page.items %}

</code></pre>

<p>PHPで同じ事は:</p>

<pre><code class="language-php">&lt;?php foreach ($page-&gt;items as $product) { ?&gt;
</code></pre>

<p><code>for</code>ブロック全体は以下を提供します:</p>

<pre><code class="language-twig">
{% for product in page.items %}
    {% if loop.first %}
        Executed before the first product in the loop
    {% endif %}

    Executed for every product of page.items

    {% if loop.last %}
        Executed after the last product is loop
    {% endif %}
{% else %}
    Executed if page.items does not have any products
{% endfor %}

</code></pre>

<p>Now you can go back to the view and find out what every block is doing. Every field in <code>product</code> is printed accordingly:</p>

<pre><code class="language-twig">
&lt;tr&gt;
    &lt;td&gt;
        {{ product.id }}
    &lt;/td&gt;

    &lt;td&gt;
        {{ product.productTypes.name }}
    &lt;/td&gt;

    &lt;td&gt;
        {{ product.name }}
    &lt;/td&gt;

    &lt;td&gt;
        {{ '%.2f'|format(product.price) }}
    &lt;/td&gt;

    &lt;td&gt;
        {{ product.getActiveDetail() }}
    &lt;/td&gt;

    &lt;td width='7%'&gt;
        {{ link_to('products/edit/' ~ product.id, 'Edit') }}
    &lt;/td&gt;

    &lt;td width='7%'&gt;
        {{ link_to('products/delete/' ~ product.id, 'Delete') }}
    &lt;/td&gt;
&lt;/tr&gt;

</code></pre>

<p><code>product.id</code>を使用する前に見たように、PHPの場合ではこうなります: <code>$product-&gt;id</code>。<code>product.name</code>の場合も同様です。 他のフィールドは異なる方法でレンダリングされます。たとえば、<code>product.productTypes.name</code>に注目しましょう。 この部分を理解するには、Productsモデル (<code>app/models/Products.php</code>) を確認する必要があります。</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Model;

/**
 * Products
 */
class Products extends Model
{
    // ...

    /**
     * Products初期処理
     */
    public function initialize()
    {
        $this-&gt;belongsTo(
            'product_types_id',
            'ProductTypes',
            'id',
            [
                'reusable' =&gt; true,
            ]
        );
    }

    // ...
}
</code></pre>

<p>モデルは<code>initialize()</code>というメソッドを持つことができます。このメソッドはリクエストごとに1回呼び出され、ORMを使用してモデルを初期化します。 この場合、 ‘Products’は、このモデルが ‘ProductTypes’と呼ばれる別のモデルと1対多の関係を持つことを定義することによって初期化されます。</p>

<pre><code class="language-php">&lt;?php

$this-&gt;belongsTo(
    'product_types_id',
    'ProductTypes',
    'id',
    [
        'reusable' =&gt; true,
    ]
);
</code></pre>

<p>つまり、<code>Products</code>の属性<code>product_types_id</code>は、<code>ProductTypes</code>モデルの<code>id</code>属性と、1対多の関係をもっています。 この関係を定義することによって、以下を使用してproductのタイプ名にアクセスできます:</p>

<pre><code class="language-twig">
&lt;td&gt;{{ product.productTypes.name }}&lt;/td&gt;

</code></pre>

<p>フィールド<code>price</code>は、Voltのフィルタを使用してフォーマットされて出力されています。</p>

<pre><code class="language-twig">
&lt;td&gt;{{ '%.2f'|format(product.price) }}&lt;/td&gt;

</code></pre>

<p>素のPHPでは、次のようになります:</p>

<pre><code class="language-php">&lt;?php echo sprintf('%.2f', $product-&gt;price) ?&gt;
</code></pre>

<p>productがアクティブかどうかを表示するには、モデルに実装されているヘルパーを使用します。</p>

<pre><code class="language-php">
&lt;td&gt;{{ product.getActiveDetail() }}&lt;/td&gt;

</code></pre>

<p>このメソッドはモデルに定義されています。</p>

<p><a name="creating-updating-records"></a></p>

<h2 id="レコードの登録と更新">レコードの登録と更新</h2>

<p>CRUDがレコードを作成し更新する方法を見てみましょう。 <code>new</code>および<code>edit</code>ビューからユーザーが入力したデータは<code>create</code>および<code>save</code>アクションに送られ、それぞれproductsの<code>作成</code>および<code>更新</code>の処理を実行します。</p>

<p>作成の場合、送信されたデータを取得し、新しい<code>Products</code>インスタンスに割り当てます:</p>

<pre><code class="language-php">&lt;?php

/**
 * 'new' アクションで入力されたデータに基づいてproductを作成
 */
public function createAction()
{
    if (!$this-&gt;request-&gt;isPost()) {
        return $this-&gt;dispatcher-&gt;forward(
            [
                'controller' =&gt; 'products',
                'action'     =&gt; 'index',
            ]
        );
    }

    $form = new ProductsForm();

    $product = new Products();

    $product-&gt;id               = $this-&gt;request-&gt;getPost('id', 'int');
    $product-&gt;product_types_id = $this-&gt;request-&gt;getPost('product_types_id', 'int');
    $product-&gt;name             = $this-&gt;request-&gt;getPost('name', 'striptags');
    $product-&gt;price            = $this-&gt;request-&gt;getPost('price', 'double');
    $product-&gt;active           = $this-&gt;request-&gt;getPost('active');

    // ...
}
</code></pre>

<p>Productsフォームで定義したフィルタを覚えていますか？ データは、オブジェクト<code>$product</code>に割り当てられる前にフィルタリングされます。 このフィルタリングはオプションです。 ORMはまた、入力データをエスケープし、列の種類に応じて追加の変換を実行します:</p>

<pre><code class="language-php">&lt;?php

// ...

$name = new Text('name');

$name-&gt;setLabel('Name');

// nameをフィルタ
$name-&gt;setFilters(
    [
        'striptags',
        'string',
    ]
);

// nameのバリデーション
$name-&gt;addValidators(
    [
        new PresenceOf(
            [
                'message' =&gt; 'Name is required',
            ]
        )
    ]
);

$this-&gt;add($name);
</code></pre>

<p>保存すると、データが<code>ProductsForm</code>フォーム (<code>app/forms/ProductsForm.php</code>)の形式で実装されたビジネスルールとバリデーションに沿っているかどうかがわかります。</p>

<pre><code class="language-php">&lt;?php

// ...

$form = new ProductsForm();

$product = new Products();

// 入力内容をバリデーション
$data = $this-&gt;request-&gt;getPost();

if (!$form-&gt;isValid($data, $product)) {
    $messages = $form-&gt;getMessages();

    foreach ($messages as $message) {
        $this-&gt;flash-&gt;error($message);
    }

    return $this-&gt;dispatcher-&gt;forward(
        [
            'controller' =&gt; 'products',
            'action'     =&gt; 'new',
        ]
    );
}
</code></pre>

<p>最後に、フォームからバリデーションメッセージが返されない場合は、productインスタンスを保存できます:</p>

<pre><code class="language-php">&lt;?php

// ...

if ($product-&gt;save() === false) {
    $messages = $product-&gt;getMessages();

    foreach ($messages as $message) {
        $this-&gt;flash-&gt;error($message);
    }

    return $this-&gt;dispatcher-&gt;forward(
        [
            'controller' =&gt; 'products',
            'action'     =&gt; 'new',
        ]
    );
}

$form-&gt;clear();

$this-&gt;flash-&gt;success(
    'Product was created successfully'
);

return $this-&gt;dispatcher-&gt;forward(
    [
        'controller' =&gt; 'products',
        'action'     =&gt; 'index',
    ]
);
</code></pre>

<p>さて、productを更新する場合は、まず編集されたレコードに現在あるデータをユーザーに表示する必要があります:</p>

<pre><code class="language-php">&lt;?php

/**
 * IDに紐づいたproductを編集
 */
public function editAction($id)
{
    if (!$this-&gt;request-&gt;isPost()) {
        $product = Products::findFirstById($id);

        if (!$product) {
            $this-&gt;flash-&gt;error(
                'Product was not found'
            );

            return $this-&gt;dispatcher-&gt;forward(
                [
                    'controller' =&gt; 'products',
                    'action'     =&gt; 'index',
                ]
            );
        }

        $this-&gt;view-&gt;form = new ProductsForm(
            $product,
            [
                'edit' =&gt; true,
            ]
        );
    }
}
</code></pre>

<p>見つかったデータは、最初のパラメータとしてモデルを渡すことによってフォームにバインドされます。 これにより、ユーザーは任意の値を変更し、<code>save</code>アクションを使用してデータベースを更新することができます:</p>

<pre><code class="language-php">&lt;?php

/**
 * 'edit' アクションで入力されたデータに基づいてproductを更新
 */
public function saveAction()
{
    if (!$this-&gt;request-&gt;isPost()) {
        return $this-&gt;dispatcher-&gt;forward(
            [
                'controller' =&gt; 'products',
                'action'     =&gt; 'index',
            ]
        );
    }

    $id = $this-&gt;request-&gt;getPost('id', 'int');

    $product = Products::findFirstById($id);

    if (!$product) {
        $this-&gt;flash-&gt;error(
            'Product does not exist'
        );

        return $this-&gt;dispatcher-&gt;forward(
            [
                'controller' =&gt; 'products',
                'action'     =&gt; 'index',
            ]
        );
    }

    $form = new ProductsForm();

    $data = $this-&gt;request-&gt;getPost();

    if (!$form-&gt;isValid($data, $product)) {
        $messages = $form-&gt;getMessages();

        foreach ($messages as $message) {
            $this-&gt;flash-&gt;error($message);
        }

        return $this-&gt;dispatcher-&gt;forward(
            [
                'controller' =&gt; 'products',
                'action'     =&gt; 'new',
            ]
        );
    }

    if ($product-&gt;save() === false) {
        $messages = $product-&gt;getMessages();

        foreach ($messages as $message) {
            $this-&gt;flash-&gt;error($message);
        }

        return $this-&gt;dispatcher-&gt;forward(
            [
                'controller' =&gt; 'products',
                'action'     =&gt; 'new',
            ]
        );
    }

    $form-&gt;clear();

    $this-&gt;flash-&gt;success(
        'Product was updated successfully'
    );

    return $this-&gt;dispatcher-&gt;forward(
        [
            'controller' =&gt; 'products',
            'action'     =&gt; 'index',
        ]
    );
}
</code></pre>

<p><a name="user-components"></a></p>

<h2 id="ユーザーコンポーネント">ユーザーコンポーネント</h2>

<p>アプリケーションのすべてのUI要素とビジュアルスタイルは、主に<a href="http://getbootstrap.com/">Bootstrap</a>を使って実装されています。 アプリケーションの状態に応じてナビゲーションバーなどの一部の要素が変更されます。 たとえば、ユーザーがアプリケーションにログインしている場合、右上隅にある<code>Log in / Sign Up</code>リンクは<code>Log out</code>に変わります。</p>

<p>アプリケーションのこの部分は、コンポーネント<code>Elements</code> (<code>app/library/Elements.php</code>) で実装されています。</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\User\Component;

class Elements extends Component
{
    public function getMenu()
    {
        // ...
    }

    public function getTabs()
    {
        // ...
    }
}
</code></pre>

<p>This class extends the <a href="api/Phalcon_Mvc_User_Component">Phalcon\Mvc\User\Component</a>. このクラスを使ってコンポーネントを拡張することは必須ではありませんが、アプリケーションのサービスへのアクセスをスムーズにするのに役立ちます。 ここでは、最初のユーザーコンポーネントをサービスコンテナに登録します:</p>

<pre><code class="language-php">&lt;?php

// ユーザーコンポーネントを登録
$di-&gt;set(
    'elements',
    function () {
        return new Elements();
    }
);
</code></pre>

<p>ビュー内のコントローラ、プラグイン、コンポーネントとして、このコンポーネントは、コンテナに登録されているサービスにアクセスし、登録したサービスと同じ名前の属性にアクセスするだけでアクセスできます。</p>

<pre><code class="language-twig">
&lt;div class='navbar navbar-fixed-top'&gt;
    &lt;div class='navbar-inner'&gt;
        &lt;div class='container'&gt;
            &lt;a class='btn btn-navbar' data-toggle='collapse' data-target='.nav-collapse'&gt;
                &lt;span class='icon-bar'&gt;&lt;/span&gt;
                &lt;span class='icon-bar'&gt;&lt;/span&gt;
                &lt;span class='icon-bar'&gt;&lt;/span&gt;
            &lt;/a&gt;

            &lt;a class='brand' href='#'&gt;INVO&lt;/a&gt;

            {{ elements.getMenu() }}
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;div class='container'&gt;
    {{ content() }}

    &lt;hr&gt;

    &lt;footer&gt;
        &lt;p&gt;&amp;copy; Company 2017&lt;/p&gt;
    &lt;/footer&gt;
&lt;/div&gt;

</code></pre>

<p>重要な部分は次の箇所です:</p>

<pre><code class="language-twig">
{{ elements.getMenu() }}

</code></pre>

<p><a name="dynamic-titles"></a></p>

<h2 id="タイトルの動的な変更">タイトルの動的な変更</h2>

<p>When you browse between one option and another will see that the title changes dynamically indicating where we are currently working. This is achieved in each controller initializer:</p>

<pre><code class="language-php">&lt;?php

class ProductsController extends ControllerBase
{
    public function initialize()
    {
        // ページタイトルを指定
        $this-&gt;tag-&gt;setTitle(
            'Manage your product types'
        );

        parent::initialize();
    }

    // ...
}
</code></pre>

<p><code>parent::initialize()</code>メソッドも呼び出され、タイトルにデータを追加します:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Controller;

class ControllerBase extends Controller
{
    protected function initialize()
    {
        // タイトルの前にアプリケーション名を追加
        $this-&gt;tag-&gt;prependTitle('INVO | ');
    }

    // ...
}
</code></pre>

<p>最後に、メインビュー (app/views/index.volt) でタイトルを出力:</p>

<pre><code class="language-php">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;?php echo $this-&gt;tag-&gt;getTitle(); ?&gt;
    &lt;/head&gt;

    &lt;!-- ... --&gt;
&lt;/html&gt;
</code></pre>

                                    </div>
                                    <div class="col-md-4 col-lg-3 col-sm-12 support-column-margin">
                                        <div class="topic-search">
    <form class="bd-search d-flex align-items-center">
        <input type="search"
               class="form-control"
               id="docs-search"
               placeholder=""
               aria-label=""
               autocomplete="off"
               data-siteurl="https://phalcon-docs4.netlify.com"
               data-docs-version="3.4">
        <button class="btn btn-link bd-search-docs-toggle d-md-none p-0 ml-3"
                type="button"
                data-toggle="collapse"
                data-target="#bd-docs-nav"
                aria-controls="bd-docs-nav"
                aria-expanded="false"
                aria-label="Toggle docs navigation">
            <svg xmlns="http://www.w3.org/2000/svg"
                 viewbox="0 0 30 30"
                 width="30"
                 height="30"
                 focusable="false">
                <title>Menu</title>
                <path stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-miterlimit="10"
                      d="M4 7h22M4 15h22M4 23h22"></path>
            </svg>
        </button>
    </form>
</div>
                                        <div class="topic-categories">
    
</div>

                                        <div class="article-menu">
    <ul>
        
        
    </ul>
</div>
                                    </div>
                                </div>
                            </div>
                        </section>

                    </div>
                </div>
            </div>
        </div>
    </div>

<footer>
    <div class="container">
        <div class="footer-wrapper clearfix">

            <div class="footer-link-container">
                <a class="footer-link" href="/">
                    <img class="footer-logo-img" src="/assets/images/footer_logo.svg" alt="logo">
                </a>
                <a class="footer-link" href="https://phalcon.link/about" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://phalcon.link/sponsors" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://phalcon.link/fund" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://phalcon.link/download" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://license.phalconphp.com/" target="_blank">
                     New BSD
                </a>
            </div>

            <div class="footer-copyright">
                <a href="https://odva.pro/" target="_blank" class="o2-link">
                    <span></span> <img src="/assets/images/logo-o2.svg" alt="logo o2">
                </a>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript" src="/assets/js/main.min.js?v1547266080100021829"></script>
<script type="text/javascript" src="/assets/js/highlight/highlight.pack.js?v1547266080100021829"></script>
<script type="application/javascript">hljs.initHighlightingOnLoad();</script>
<script type="application/javascript">hljs.initHighlightingOnLoad();</script>
</body>
</html>
