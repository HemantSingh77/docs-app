<!doctype html>
<!--[if IE 8]>
<html lang="uk-ua" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="uk-ua" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="uk-ua" class="no-js">
<!--<![endif]-->








    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <script type="text/javascript" src="/assets/js/viewport-min-width.js?v1547319779866581049"></script>
        <meta name="description"
              content="Official Phalcon Documentation">
        <meta name="keywords" content="php, phalcon, phalcon php, php framework, faster php framework, php extension, next generation framework, docs, documentation">
        <meta name="author" href="/humans.txt">
        <meta name="generator" content="Phalcon Team - Jekyll - Netlify">

        <link href="https://phalcon-docs4.netlify.com/3.4/uk-ua/db-layer.html" rel="canonical">
        <title>Phalcon Framework Documentation</title>

        <!-- Twitter -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@zephirlang">
        <meta name="twitter:creator" content="@zephirlang">
        <meta name="twitter:title" content="Phalcon Framework Documentation">
        <meta name="twitter:description" content="Official Phalcon Documentation">
        <meta name="twitter:image" content="https://assets.phalconphp.com/phalcon/logo.png">

        <!-- Facebook -->
        <meta property="og:url" content="https://phalcon-docs4.netlify.com">
        <meta property="og:title" content="Phalcon Framework Documentation">
        <meta property="og:description" content="Official Phalcon Documentation">
        <meta property="og:type" content="website">
        <meta property="og:image" content="https://assets.phalconphp.com/phalcon/logo.png">

        <meta name="msapplication-TileColor" content="#FFFFFF">
        <meta name="msapplication-square70x70logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-70x70.png">
        <meta name="msapplication-TileImage"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-144x144.png">
        <meta name="msapplication-square150x150logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-150x150.png">
        <meta name="msapplication-wide310x150logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-310x150.png">
        <meta name="msapplication-square310x310logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-310x310.png">

        <link rel="apple-touch-icon"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon.png">

        <link rel="apple-touch-icon-precomposed"
              sizes="57x57"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-57x57.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="60x60"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-60x60.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="72x72"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="76x76"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-76x76.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="114x114"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-114x114.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="120x120"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-120x120.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="144x144"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-144x144.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="152x152"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-152x152.png">

        <link rel="icon"
              type="image/png"
              sizes="16x16"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-16x16.png">
        <link rel="icon"
              type="image/png"
              sizes="32x32"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-32x32.png">
        <link rel="icon"
              type="image/png"
              sizes="96x96"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-96x96.png">
        <link rel="icon"
              type="image/png"
              sizes="128x128"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-128x128.png">
        <link rel="icon"
              type="image/png"
              sizes="196x196"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-196x196.png">
        <link rel="shortcut icon"
              type="image/png"
              href="https://assets.phalconphp.com/phalcon/favicon.ico"/>

        <link rel="alternate"
              type="application/rss+xml"
              title=" - "
              href="https://phalcon-docs4.netlify.com/feed.xml">

        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css"
              integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE="
              crossorigin="anonymous" />
        <link rel="stylesheet" href="/assets/css/monokai.css?v1547319779866581049" />
        <link rel="stylesheet" href="/assets/css/style.css?v1547319779866581049" />

        <script defer src="https://use.fontawesome.com/releases/v5.6.1/js/all.js"
                integrity="sha384-R5JkiUweZpJjELPWqttAYmYM1P3SNEJRM6ecTQF05pFFtxmCO+Y1CiUhvuDzgSVZ"
                crossorigin="anonymous"></script>
        
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90300500-6"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-90300500-6');
    </script>

    </head>


<body onclick="o2.allNavSlideUp()">
    <header class="header-image-doc">
        <div class="container">
            <div class="header-wrapper">
                <div class="clearfix">
                    <div class="row">
                        <div class="col-md-2 col-sm-3  col-xs-8">
                            <div class="header-image__logo-wrapper">
                                <a href="/3.4/uk-ua">
                                    <img class="logo-img" src="/assets/images/header_logo.svg" alt="logo">
                                </a>
                            </div>
                        </div>
                        <div class="col-md-10 col-sm-9 top-menu">

                            <div class="nav-icon" onclick="o2.showMobileMenu();">
                                <div class="nav-line"></div>
                                <div class="nav-line"></div>
                                <div class="nav-line"></div>
                            </div>
                            <nav class="header-nav">
                                <ul>
                                    <li class="nav-item" onclick="o2.toggleState(this, event);">
                                        <div class="nav-item_selected">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/uk.png"
                                                 alt="">
                                            <span class="caret"></span>
                                        </div>
                                        <div class="nav-item__list" onclick="event.stopPropagation();">
                                            
                                                <a href="/3.4/en/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                         alt="English (US)">
                                                    English (US)
                                                </a>
                                            
                                                <a href="/3.4/cs-cz/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/cs.png"
                                                         alt="Czech">
                                                    Czech
                                                </a>
                                            
                                                <a href="/3.4/de-de/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/de.png"
                                                         alt="German">
                                                    German
                                                </a>
                                            
                                                <a href="/3.4/es-es/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                         alt="Spanish">
                                                    Spanish
                                                </a>
                                            
                                                <a href="/3.4/fa-ir/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fa.png"
                                                         alt="Persian">
                                                    Persian
                                                </a>
                                            
                                                <a href="/3.4/fr-fr/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fr.png"
                                                         alt="French">
                                                    French
                                                </a>
                                            
                                                <a href="/3.4/id-id/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/id.png"
                                                         alt="Indonesian">
                                                    Indonesian
                                                </a>
                                            
                                                <a href="/3.4/it-it/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/it.png"
                                                         alt="Italian">
                                                    Italian
                                                </a>
                                            
                                                <a href="/3.4/ja-jp/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ja.png"
                                                         alt="Japanese">
                                                    Japanese
                                                </a>
                                            
                                                <a href="/3.4/pl-pl/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/pl.png"
                                                         alt="Polish">
                                                    Polish
                                                </a>
                                            
                                                <a href="/3.4/ru-ru/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ru.png"
                                                         alt="Russian">
                                                    Russian
                                                </a>
                                            
                                                <a href="/3.4/tr-tr/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/tr.png"
                                                         alt="Turkish">
                                                    Turkish
                                                </a>
                                            
                                                <a href="/3.4/uk-ua/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/uk.png"
                                                         alt="Ukrainian">
                                                    Ukrainian
                                                </a>
                                            
                                                <a href="/3.4/zh-cn/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                                         alt="Chinese Simplified">
                                                    Chinese Simplified
                                                </a>
                                            
                                        </div>
                                    </li>

                                        <li class="nav-item" onclick="o2.toggleState(this, event);">
                                            <div class="nav-item__selected custom-select__version">
                                                Version 3.4
                                                <span class="caret"></span>
                                            </div>
                                            <div class="nav-item__list" onclick="event.stopPropagation();">
                                                
                                                <a href="/3.4/uk-ua/db-layer" class="custom-select__list-item">
                                                    <span>3.4</span>
                                                </a>
                                                
                                                <a href="/3.3/uk-ua/db-layer" class="custom-select__list-item">
                                                    <span>3.3</span>
                                                </a>
                                                
                                                <a href="/3.2/uk-ua/db-layer" class="custom-select__list-item">
                                                    <span>3.2</span>
                                                </a>
                                                
                                                <a href="/3.1/uk-ua/db-layer" class="custom-select__list-item">
                                                    <span>3.1</span>
                                                </a>
                                                
                                                <a href="/4.0/uk-ua/db-layer" class="custom-select__list-item">
                                                    <span>4.0</span>
                                                </a>
                                                
                                            </div>
                                        </li>

                                    <li class="nav-item" onclick="o2.toggleState(this, event);">
                                        <div class="nav-item_selected">
                                            Community
                                            <span class="caret"></span>
                                        </div>
                                        <div class="nav-item__list">
                                            <a href="https://phalcon.link/forum" class="custom-select__list-item" target="_blank">
                                                Forum
                                            </a>
                                            <a href="https://phalcon.link/blog" class="custom-select__list-item" target="_blank">
                                                Blog
                                            </a>
                                            <a href="https://phalcon.link/resources" class="custom-select__list-item" target="_blank">
                                                Resources
                                            </a>
                                            <div class="nav-item__divider"></div>
                                            <a href="https://phalcon.link/f" class="custom-select__list-item" target="_blank">
                                                Facebook
                                            </a>
                                            <a href="https://phalcon.link/t" class="custom-select__list-item" target="_blank">
                                                Twitter
                                            </a>
                                            <a href="https://phalcon.link/gab" class="custom-select__list-item" target="_blank">
                                                Gab.ai
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/about">
                                            About
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/sponsors">
                                            Sponsors
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/fund">
                                            Support Us
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/download">
                                            Download
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>

                        <div class="header-nav-mobile">
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this, event)">
                                    <img class="lang-image"
                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/uk.png"
                                         alt="">
                                    <span class="caret"></span>
                                </div>

                                <ul style="display:none;" class="clearfix" onclick="event.stopPropagation();">
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/en/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                 alt="English (US)">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/cs-cz/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/cs.png"
                                                 alt="Czech">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/de-de/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/de.png"
                                                 alt="German">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/es-es/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                 alt="Spanish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/fa-ir/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fa.png"
                                                 alt="Persian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/fr-fr/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fr.png"
                                                 alt="French">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/id-id/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/id.png"
                                                 alt="Indonesian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/it-it/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/it.png"
                                                 alt="Italian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/ja-jp/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ja.png"
                                                 alt="Japanese">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/pl-pl/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/pl.png"
                                                 alt="Polish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/ru-ru/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ru.png"
                                                 alt="Russian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/tr-tr/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/tr.png"
                                                 alt="Turkish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/uk-ua/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/uk.png"
                                                 alt="Ukrainian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/zh-cn/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                                 alt="Chinese Simplified">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                </ul>

                            </div>
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this,event)">
                                    Version 3.4
                                    <span class="caret"></span>
                                </div>

                                <ul style="display:none;" class="clearfix" onclick="event.stopPropagation();">
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.4/uk-ua/db-layer">
                                            <span>3.4</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.3/uk-ua/db-layer">
                                            <span>3.3</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.2/uk-ua/db-layer">
                                            <span>3.2</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.1/uk-ua/db-layer">
                                            <span>3.1</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/4.0/uk-ua/db-layer">
                                            <span>4.0</span>
                                        </a>
                                    </li>
                                    
                                </ul>

                            </div>
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this, event)">
                                    
                                    <span class="caret"></span>
                                </div>
                                <ul style="display:none;">
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/forum" target="_blank">
                                            Forum
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/blog" target="_blank">
                                            Blog
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/resources" target="_blank">
                                            Resources
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/f" target="_blank">
                                            Facebook
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/t" target="_blank">
                                            Twitter
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/gab" target="_blank">
                                            Gab.ai
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/about">
                                    About
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/sponsors">
                                    Sponsors
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/fund">
                                    Support Us
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/download">
                                    Download
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>


    <div class="container-fluid article-page-wrap">
        <div class="row">
            <div>
                <div class="col-md-2 sidebar hidden-xs">
                    <div class="sidebar--spacer">&nbsp;</div>
                </div>
                <div class="m-t-md m-b-lg" id="articles">
                    <div class="article-content">
                        <p><a name="overview"></a></p>

<h1 id="database-abstraction-layer">Database Abstraction Layer</h1>

<p><a href="api/Phalcon_Db">Phalcon\Db</a> is the component behind <a href="api/Phalcon_Mvc_Model">Phalcon\Mvc\Model</a> that powers the model layer in the framework. It consists of an independent high-level abstraction layer for database systems completely written in C.</p>

<p>This component allows for a lower level database manipulation than using traditional models.</p>

<p><a name="adapters"></a></p>

<h2 id="database-adapters">Database Adapters</h2>

<p>This component makes use of adapters to encapsulate specific database system details. Phalcon uses PDO to connect to databases. The following database engines are supported:</p>

<table>
  <thead>
    <tr>
      <th>Class</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="api/Phalcon_Db_Adapter_Pdo_Mysql">Phalcon\Db\Adapter\Pdo\Mysql</a></td>
      <td>Is the world’s most used relational database management system (RDBMS) that runs as a server providing multi-user access to a number of databases</td>
    </tr>
    <tr>
      <td><a href="api/Phalcon_Db_Adapter_Pdo_Postgresql">Phalcon\Db\Adapter\Pdo\Postgresql</a></td>
      <td>PostgreSQL is a powerful, open source relational database system. It has more than 15 years of active development and a proven architecture that has earned it a strong reputation for reliability, data integrity, and correctness.</td>
    </tr>
    <tr>
      <td><a href="api/Phalcon_Db_Adapter_Pdo_Sqlite">Phalcon\Db\Adapter\Pdo\Sqlite</a></td>
      <td>SQLite is a software library that implements a self-contained, serverless, zero-configuration, transactional SQL database engine</td>
    </tr>
  </tbody>
</table>

<p><a name="adapters-factory"></a></p>

<h3 id="factory">Factory</h3>

<p><a name="factory"></a></p>

<p>Loads PDO Adapter class using <code>adapter</code> option. For example:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Db\Adapter\Pdo\Factory;

$options = [
    'host'     =&gt; 'localhost',
    'dbname'   =&gt; 'blog',
    'port'     =&gt; 3306,
    'username' =&gt; 'sigma',
    'password' =&gt; 'secret',
    'adapter'  =&gt; 'mysql',
];

$db = Factory::load($options);
</code></pre>

<p><a name="adapters-custom"></a></p>

<h3 id="implementing-your-own-adapters">Implementing your own adapters</h3>

<p>The <a href="api/Phalcon_Db_AdapterInterface">Phalcon\Db\AdapterInterface</a> interface must be implemented in order to create your own database adapters or extend the existing ones.</p>

<p><a name="dialects"></a></p>

<h2 id="database-dialects">Database Dialects</h2>

<p>Phalcon encapsulates the specific details of each database engine in dialects. Those provide common functions and SQL generator to the adapters.</p>

<table>
  <thead>
    <tr>
      <th>Class</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="api/Phalcon_Db_Dialect_Mysql">Phalcon\Db\Dialect\Mysql</a></td>
      <td>SQL specific dialect for MySQL database system</td>
    </tr>
    <tr>
      <td><a href="api/Phalcon_Db_Dialect_Postgresql">Phalcon\Db\Dialect\Postgresql</a></td>
      <td>SQL specific dialect for PostgreSQL database system</td>
    </tr>
    <tr>
      <td><a href="api/Phalcon_Db_Dialect_Sqlite">Phalcon\Db\Dialect\Sqlite</a></td>
      <td>SQL specific dialect for SQLite database system</td>
    </tr>
  </tbody>
</table>

<p><a name="dialects-custom"></a></p>

<h3 id="implementing-your-own-dialects">Implementing your own dialects</h3>

<p>The <a href="api/Phalcon_Db_DialectInterface">Phalcon\Db\DialectInterface</a> interface must be implemented in order to create your own database dialects or extend the existing ones. You can also enhance your current dialect by adding more commands/methods that PHQL will understand.</p>

<p>For instance when using the MySQL adapter, you might want to allow PHQL to recognize the <code>MATCH ... AGAINST ...</code> syntax. We associate that syntax with <code>MATCH_AGAINST</code></p>

<p>We instantiate the dialect. We add the custom function so that PHQL understands what to do when it finds it during the parsing process. In the example below, we register a new custom function called <code>MATCH_AGAINST</code>. After that all we have to do is add the customized dialect object to our connection.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Db\Dialect\MySQL as SqlDialect;
use Phalcon\Db\Adapter\Pdo\MySQL as Connection;

$dialect = new SqlDialect();

$dialect-&gt;registerCustomFunction(
    'MATCH_AGAINST',
    function($dialect, $expression) {
        $arguments = $expression['arguments'];
        return sprintf(
            " MATCH (%s) AGAINST (%)",
            $dialect-&gt;getSqlExpression($arguments[0]),
            $dialect-&gt;getSqlExpression($arguments[1])
         );
    }
);

$connection = new Connection(
    [
        "host"          =&gt; "localhost",
        "username"      =&gt; "root",
        "password"      =&gt; "",
        "dbname"        =&gt; "test",
        "dialectClass"  =&gt; $dialect
    ]
);
</code></pre>

<p>We can now use this new function in PHQL, which in turn will translate it to the proper SQL syntax:</p>

<pre><code class="language-php">$phql = "
  SELECT *
  FROM   Posts
  WHERE  MATCH_AGAINST(title, :pattern:)";

$posts = $modelsManager-&gt;executeQuery($phql, ['pattern' =&gt; $pattern]);
</code></pre>

<p><a name="connection"></a></p>

<h2 id="connecting-to-databases">Connecting to Databases</h2>

<p>To create a connection it’s necessary instantiate the adapter class. It only requires an array with the connection parameters. The example below shows how to create a connection passing both required and optional parameters:</p>

<h5 id="mysql-required-elements">MySQL Required elements</h5>

<pre><code class="language-php">&lt;?php

$config = [
    'host'     =&gt; '127.0.0.1',
    'username' =&gt; 'mike',
    'password' =&gt; 'sigma',
    'dbname'   =&gt; 'test_db',
];
</code></pre>

<h5 id="mysql-optional">MySQL Optional</h5>

<pre><code class="language-php">$config['persistent'] = false;
</code></pre>

<h5 id="mysql-create-a-connection">MySQL Create a connection</h5>

<pre><code class="language-php">$connection = new \Phalcon\Db\Adapter\Pdo\Mysql($config);
</code></pre>

<h5 id="postgresql-required-elements">PostgreSQL Required elements</h5>

<pre><code class="language-php">&lt;?php

$config = [
    'host'     =&gt; 'localhost',
    'username' =&gt; 'postgres',
    'password' =&gt; 'secret1',
    'dbname'   =&gt; 'template',
];
</code></pre>

<h5 id="postgresql-optional">PostgreSQL Optional</h5>

<pre><code class="language-php">$config['schema'] = 'public';
</code></pre>

<h5 id="postgresql-create-a-connection">PostgreSQL Create a connection</h5>

<pre><code class="language-php">$connection = new \Phalcon\Db\Adapter\Pdo\Postgresql($config);
</code></pre>

<h5 id="sqlite-required-elements">SQLite Required elements</h5>

<pre><code class="language-php">&lt;?php

$config = [
    'dbname' =&gt; '/path/to/database.db',
];
</code></pre>

<h5 id="sqlite-create-a-connection">SQLite Create a connection</h5>

<pre><code class="language-php">$connection = new \Phalcon\Db\Adapter\Pdo\Sqlite($config);
</code></pre>

<p><a name="options"></a></p>

<h2 id="setting-up-additional-pdo-options">Setting up additional PDO options</h2>

<p>You can set PDO options at connection time by passing the parameters <code>options</code>:</p>

<pre><code class="language-php">&lt;?php

$connection = new \Phalcon\Db\Adapter\Pdo\Mysql(
    [
        'host'     =&gt; 'localhost',
        'username' =&gt; 'root',
        'password' =&gt; 'sigma',
        'dbname'   =&gt; 'test_db',
        'options'  =&gt; [
            PDO::MYSQL_ATTR_INIT_COMMAND =&gt; "SET NAMES 'UTF8'",
            PDO::ATTR_CASE               =&gt; PDO::CASE_LOWER,
        ]
    ]
);
</code></pre>

<p><a name="connection-factory"></a></p>

<h2 id="connecting-using-factory">Connecting using Factory</h2>

<p>You can also use a simple <code>ini</code> file to configure/connect your <code>db</code> service to your database.</p>

<pre><code class="language-ini">[database]
host = TEST_DB_MYSQL_HOST
username = TEST_DB_MYSQL_USER
password = TEST_DB_MYSQL_PASSWD
dbname = TEST_DB_MYSQL_NAME
port = TEST_DB_MYSQL_PORT
charset = TEST_DB_MYSQL_CHARSET
adapter = mysql
</code></pre>

<pre><code class="language-php">&lt;?php

use Phalcon\Config\Adapter\Ini;
use Phalcon\Di;
use Phalcon\Db\Adapter\Pdo\Factory;

$di = new Di();
$config = new Ini('config.ini');

$di-&gt;set('config', $config);

$di-&gt;set(
    'db', 
    function () {
        return Factory::load($this-&gt;config-&gt;database);
    }
);
</code></pre>

<p>The above will return the correct database instance and also has the advantage that you can change the connection credentials or even the database adapter without changing a single line of code in your application.</p>

<p><a name="finding-rows"></a></p>

<h2 id="finding-rows">Finding Rows</h2>

<p><a href="api/Phalcon_Db">Phalcon\Db</a> provides several methods to query rows from tables. The specific SQL syntax of the target database engine is required in this case:</p>

<pre><code class="language-php">&lt;?php

$sql = 'SELECT id, name FROM robots ORDER BY name';

// Send a SQL statement to the database system
$result = $connection-&gt;query($sql);

// Print each robot name
while ($robot = $result-&gt;fetch()) {
   echo $robot['name'];
}

// Get all rows in an array
$robots = $connection-&gt;fetchAll($sql);
foreach ($robots as $robot) {
   echo $robot['name'];
}

// Get only the first row
$robot = $connection-&gt;fetchOne($sql);
</code></pre>

<p>By default these calls create arrays with both associative and numeric indexes. You can change this behavior by using <code>Phalcon\Db\Result::setFetchMode()</code>. This method receives a constant, defining which kind of index is required.</p>

<table>
  <thead>
    <tr>
      <th>Constant</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Phalcon\Db::FETCH_NUM</code></td>
      <td>Return an array with numeric indexes</td>
    </tr>
    <tr>
      <td><code>Phalcon\Db::FETCH_ASSOC</code></td>
      <td>Return an array with associative indexes</td>
    </tr>
    <tr>
      <td><code>Phalcon\Db::FETCH_BOTH</code></td>
      <td>Return an array with both associative and numeric indexes</td>
    </tr>
    <tr>
      <td><code>Phalcon\Db::FETCH_OBJ</code></td>
      <td>Return an object instead of an array</td>
    </tr>
  </tbody>
</table>

<pre><code class="language-php">&lt;?php

$sql = 'SELECT id, name FROM robots ORDER BY name';
$result = $connection-&gt;query($sql);

$result-&gt;setFetchMode(Phalcon\Db::FETCH_NUM);
while ($robot = $result-&gt;fetch()) {
   echo $robot[0];
}
</code></pre>

<p>The <code>Phalcon\Db::query()</code> returns an instance of <a href="api/Phalcon_Db_Result_Pdo">Phalcon\Db\Result\Pdo</a>. These objects encapsulate all the functionality related to the returned resultset i.e. traversing, seeking specific records, count etc.</p>

<pre><code class="language-php">&lt;?php

$sql = 'SELECT id, name FROM robots';
$result = $connection-&gt;query($sql);

// Traverse the resultset
while ($robot = $result-&gt;fetch()) {
   echo $robot['name'];
}

// Seek to the third row
$result-&gt;seek(2);
$robot = $result-&gt;fetch();

// Count the resultset
echo $result-&gt;numRows();
</code></pre>

<p><a name="binding-parameters"></a></p>

<h2 id="binding-parameters">Binding Parameters</h2>

<p>Bound parameters is also supported in <a href="api/Phalcon_Db">Phalcon\Db</a>. Although there is a minimal performance impact by using bound parameters, you are encouraged to use this methodology so as to eliminate the possibility of your code being subject to SQL injection attacks. Both string and positional placeholders are supported. Binding parameters can simply be achieved as follows:</p>

<pre><code class="language-php">&lt;?php

// Binding with numeric placeholders
$sql    = 'SELECT * FROM robots WHERE name = ? ORDER BY name';
$result = $connection-&gt;query(
    $sql,
    [
        'Wall-E',
    ]
);

// Binding with named placeholders
$sql     = 'INSERT INTO `robots`(name`, year) VALUES (:name, :year)';
$success = $connection-&gt;query(
    $sql,
    [
        'name' =&gt; 'Astro Boy',
        'year' =&gt; 1952,
    ]
);
</code></pre>

<p>When using numeric placeholders, you will need to define them as integers i.e. 1 or 2. In this case ‘1’ or ‘2’ are considered strings and not numbers, so the placeholder could not be successfully replaced. With any adapter data are automatically escaped using <a href="http://www.php.net/manual/en/pdo.quote.php">PDO Quote</a>.</p>

<p>This function takes into account the connection charset, so its recommended to define the correct charset in the connection parameters or in your database server configuration, as a wrong charset will produce undesired effects when storing or retrieving data.</p>

<p>Also, you can pass your parameters directly to the <code>execute</code> or <code>query</code> methods. In this case bound parameters are directly passed to PDO:</p>

<pre><code class="language-php">&lt;?php

// Binding with PDO placeholders
$sql    = 'SELECT * FROM robots WHERE name = ? ORDER BY name';
$result = $connection-&gt;query(
    $sql,
    [
        1 =&gt; 'Wall-E',
    ]
);
</code></pre>

<p><a name="typed-placeholders"></a></p>

<h2 id="typed-placeholders">Typed placeholders</h2>

<p>Placeholders allowed you to bind parameters to avoid SQL injections:</p>

<pre><code class="language-php">&lt;?php

$phql = "SELECT * FROM Store\Robots WHERE id &gt; :id:";

$robots = $this-&gt;modelsManager-&gt;executeQuery($phql, ['id' =&gt; 100]);
</code></pre>

<p>However, some database systems require additional actions when using placeholders such as specifying the type of the bound parameter:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Db\Column;

// ...

$phql = "SELECT * FROM Store\Robots LIMIT :number:";
$robots = $this-&gt;modelsManager-&gt;executeQuery(
    $phql,
    ['number' =&gt; 10],
    Column::BIND_PARAM_INT
);
</code></pre>

<p>You can use typed placeholders in your parameters, instead of specifying the bind type in <code>executeQuery()</code>:</p>

<pre><code class="language-php">&lt;?php

$phql = "SELECT * FROM Store\Robots LIMIT {number:int}";
$robots = $this-&gt;modelsManager-&gt;executeQuery(
    $phql,
    ['number' =&gt; 10]
);

$phql = "SELECT * FROM Store\Robots WHERE name &lt;&gt; {name:str}";
$robots = $this-&gt;modelsManager-&gt;executeQuery(
    $phql,
    ['name' =&gt; $name]
);
</code></pre>

<p>You can also omit the type if you don’t need to specify it:</p>

<pre><code class="language-php">&lt;?php

$phql = "SELECT * FROM Store\Robots WHERE name &lt;&gt; {name}";
$robots = $this-&gt;modelsManager-&gt;executeQuery(
    $phql,
    ['name' =&gt; $name]
);
</code></pre>

<p>Typed placeholders are also more powerful, since we can now bind a static array without having to pass each element independently as a placeholder:</p>

<pre><code class="language-php">&lt;?php

$phql = "SELECT * FROM Store\Robots WHERE id IN ({ids:array})";
$robots = $this-&gt;modelsManager-&gt;executeQuery(
    $phql,
    ['ids' =&gt; [1, 2, 3, 4]]
);
</code></pre>

<p>The following types are available:</p>

<table>
  <thead>
    <tr>
      <th>Bind Type</th>
      <th>Bind Type Constant</th>
      <th>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>str</td>
      <td><code>Column::BIND_PARAM_STR</code></td>
      <td><code>{name:str}</code></td>
    </tr>
    <tr>
      <td>int</td>
      <td><code>Column::BIND_PARAM_INT</code></td>
      <td><code>{number:int}</code></td>
    </tr>
    <tr>
      <td>double</td>
      <td><code>Column::BIND_PARAM_DECIMAL</code></td>
      <td><code>{price:double}</code></td>
    </tr>
    <tr>
      <td>bool</td>
      <td><code>Column::BIND_PARAM_BOOL</code></td>
      <td><code>{enabled:bool}</code></td>
    </tr>
    <tr>
      <td>blob</td>
      <td><code>Column::BIND_PARAM_BLOB</code></td>
      <td><code>{image:blob}</code></td>
    </tr>
    <tr>
      <td>null</td>
      <td><code>Column::BIND_PARAM_NULL</code></td>
      <td><code>{exists:null}</code></td>
    </tr>
    <tr>
      <td>array</td>
      <td>Array of <code>Column::BIND_PARAM_STR</code></td>
      <td><code>{codes:array}</code></td>
    </tr>
    <tr>
      <td>array-str</td>
      <td>Array of <code>Column::BIND_PARAM_STR</code></td>
      <td><code>{names:array-str}</code></td>
    </tr>
    <tr>
      <td>array-int</td>
      <td>Array of <code>Column::BIND_PARAM_INT</code></td>
      <td><code>{flags:array-int}</code></td>
    </tr>
  </tbody>
</table>

<p><a name="cast-bound-parameter-values"></a></p>

<h2 id="cast-bound-parameters-values">Cast bound parameters values</h2>

<p>By default, bound parameters aren’t casted in the PHP userland to the specified bind types, this option allows you to make Phalcon cast values before bind them with PDO. A classic situation when this problem raises is passing a string in a <code>LIMIT</code>/<code>OFFSET</code> placeholder:</p>

<pre><code class="language-php">&lt;?php

$number = '100';
$robots = $modelsManager-&gt;executeQuery(
    'SELECT * FROM Some\Robots LIMIT {number:int}',
    ['number' =&gt; $number]
);
</code></pre>

<p>This causes the following exception:</p>

<pre><code>Fatal error: Uncaught exception 'PDOException' with message 'SQLSTATE[42000]:
Syntax error or access violation: 1064 You have an error in your SQL syntax;
check the manual that corresponds to your MySQL server version for the right
syntax to use near ''100'' at line 1' in /Users/scott/demo.php:78
</code></pre>

<p>This happens because 100 is a string variable. It is easily fixable by casting the value to integer first:</p>

<pre><code class="language-php">&lt;?php

$number = '100';
$robots = $modelsManager-&gt;executeQuery(
    'SELECT * FROM Some\Robots LIMIT {number:int}',
    ['number' =&gt; (int) $number]
);
</code></pre>

<p>However this solution requires that the developer pays special attention about how bound parameters are passed and their types. To make this task easier and avoid unexpected exceptions you can instruct Phalcon to do this casting for you:</p>

<pre><code class="language-php">&lt;?php

\Phalcon\Db::setup(['forceCasting' =&gt; true]);
</code></pre>

<p>The following actions are performed according to the bind type specified:</p>

<table>
  <thead>
    <tr>
      <th>Bind Type</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Column::BIND_PARAM_STR</td>
      <td>Cast the value as a native PHP string</td>
    </tr>
    <tr>
      <td>Column::BIND_PARAM_INT</td>
      <td>Cast the value as a native PHP integer</td>
    </tr>
    <tr>
      <td>Column::BIND_PARAM_BOOL</td>
      <td>Cast the value as a native PHP boolean</td>
    </tr>
    <tr>
      <td>Column::BIND_PARAM_DECIMAL</td>
      <td>Cast the value as a native PHP double</td>
    </tr>
  </tbody>
</table>

<p><a name="cast-on-hydrate"></a></p>

<h2 id="cast-on-hydrate">Cast on Hydrate</h2>

<p>Values returned from the database system are always represented as string values by PDO, no matter if the value belongs to a numerical or boolean type column. This happens because some column types cannot be represented with its corresponding PHP native types due to their size limitations. For instance, a <code>BIGINT</code> in MySQL can store large integer numbers that cannot be represented as a 32bit integer in PHP. Because of that, PDO and the ORM by default, make the safe decision of leaving all values as strings.</p>

<p>You can set up the ORM to automatically cast those types considered safe to their corresponding PHP native types:</p>

<pre><code class="language-php">&lt;?php

\Phalcon\Mvc\Model::setup(['castOnHydrate' =&gt; true]);
</code></pre>

<p>This way you can use strict operators or make assumptions about the type of variables:</p>

<pre><code class="language-php">&lt;?php

$robot = Robots::findFirst();
if (11 === $robot-&gt;id) {
    echo $robot-&gt;name;
}
</code></pre>

<p><a name="crud"></a></p>

<h2 id="insertingupdatingdeleting-rows">Inserting/Updating/Deleting Rows</h2>

<p>To insert, update or delete rows, you can use raw SQL or use the preset functions provided by the class:</p>

<pre><code class="language-php">&lt;?php

// Inserting data with a raw SQL statement
$sql     = 'INSERT INTO `robots`(`name`, `year`) VALUES ('Astro Boy', 1952)';
$success = $connection-&gt;execute($sql);

// With placeholders
$sql     = 'INSERT INTO `robots`(`name`, `year`) VALUES (?, ?)';
$success = $connection-&gt;execute(
    $sql,
    [
        'Astro Boy',
        1952,
    ]
);

// Generating dynamically the necessary SQL
$success = $connection-&gt;insert(
    'robots',
    [
        'Astro Boy',
        1952,
    ],
    [
        'name',
        'year',
    ],
);

// Generating dynamically the necessary SQL (another syntax)
$success = $connection-&gt;insertAsDict(
    'robots',
    [
        'name' =&gt; 'Astro Boy',
        'year' =&gt; 1952,
    ]
);

// Updating data with a raw SQL statement
$sql     = 'UPDATE `robots` SET `name` = 'Astro boy' WHERE `id` = 101';
$success = $connection-&gt;execute($sql);

// With placeholders
$sql     = 'UPDATE `robots` SET `name` = ? WHERE `id` = ?';
$success = $connection-&gt;execute(
    $sql,
    [
        'Astro Boy',
        101,
    ]
);

// Generating dynamically the necessary SQL
$success = $connection-&gt;update(
    'robots',
    [
        'name',
    ],
    [
        'New Astro Boy',
    ],
    'id = 101' // Warning! In this case values are not escaped
);

// Generating dynamically the necessary SQL (another syntax)
$success = $connection-&gt;updateAsDict(
    'robots',
    [
        'name' =&gt; 'New Astro Boy',
    ],
    'id = 101' // Warning! In this case values are not escaped
);

// With escaping conditions
$success = $connection-&gt;update(
    'robots',
    [
        'name',
    ],
    [
        'New Astro Boy',
    ],
    [
        'conditions' =&gt; 'id = ?',
        'bind'       =&gt; [101],
        'bindTypes'  =&gt; [PDO::PARAM_INT], // Optional parameter
    ]
);
$success = $connection-&gt;updateAsDict(
    'robots',
    [
        'name' =&gt; 'New Astro Boy',
    ],
    [
        'conditions' =&gt; 'id = ?',
        'bind'       =&gt; [101],
        'bindTypes'  =&gt; [PDO::PARAM_INT], // Optional parameter
    ]
);

// Deleting data with a raw SQL statement
$sql     = 'DELETE `robots` WHERE `id` = 101';
$success = $connection-&gt;execute($sql);

// With placeholders
$sql     = 'DELETE `robots` WHERE `id` = ?';
$success = $connection-&gt;execute($sql, [101]);

// Generating dynamically the necessary SQL
$success = $connection-&gt;delete(
    'robots',
    'id = ?',
    [
        101,
    ]
);
</code></pre>

<p><a name="transactions"></a></p>

<h2 id="transactions-and-nested-transactions">Transactions and Nested Transactions</h2>

<p>Working with transactions is supported as it is with PDO. Perform data manipulation inside transactions often increase the performance on most database systems:</p>

<pre><code class="language-php">&lt;?php

try {
    // Start a transaction
    $connection-&gt;begin();

    // Execute some SQL statements
    $connection-&gt;execute('DELETE `robots` WHERE `id` = 101');
    $connection-&gt;execute('DELETE `robots` WHERE `id` = 102');
    $connection-&gt;execute('DELETE `robots` WHERE `id` = 103');

    // Commit if everything goes well
    $connection-&gt;commit();
} catch (Exception $e) {
    // An exception has occurred rollback the transaction
    $connection-&gt;rollback();
}
</code></pre>

<p>In addition to standard transactions, <a href="api/Phalcon_Db">Phalcon\Db</a> provides built-in support for <a href="http://en.wikipedia.org/wiki/Nested_transaction">nested transactions</a> (if the database system used supports them). When you call begin() for a second time a nested transaction is created:</p>

<pre><code class="language-php">&lt;?php

try {
    // Start a transaction
    $connection-&gt;begin();

    // Execute some SQL statements
    $connection-&gt;execute('DELETE `robots` WHERE `id` = 101');

    try {
        // Start a nested transaction
        $connection-&gt;begin();

        // Execute these SQL statements into the nested transaction
        $connection-&gt;execute('DELETE `robots` WHERE `id` = 102');
        $connection-&gt;execute('DELETE `robots` WHERE `id` = 103');

        // Create a save point
        $connection-&gt;commit();
    } catch (Exception $e) {
        // An error has occurred, release the nested transaction
        $connection-&gt;rollback();
    }

    // Continue, executing more SQL statements
    $connection-&gt;execute('DELETE `robots` WHERE `id` = 104');

    // Commit if everything goes well
    $connection-&gt;commit();
} catch (Exception $e) {
    // An exception has occurred rollback the transaction
    $connection-&gt;rollback();
}
</code></pre>

<p><a name="events"></a></p>

<h2 id="database-events">Database Events</h2>

<p><a href="api/Phalcon_Db">Phalcon\Db</a> is able to send events to a <a href="/3.4/en/events">EventsManager</a> if it’s present. Some events when returning boolean false could stop the active operation. The following events are supported:</p>

<table>
  <thead>
    <tr>
      <th>Event Name</th>
      <th>Triggered</th>
      <th style="text-align: center">Can stop operation?</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>afterConnect</code></td>
      <td>After a successfully connection to a database system</td>
      <td style="text-align: center">No</td>
    </tr>
    <tr>
      <td><code>beforeQuery</code></td>
      <td>Before send a SQL statement to the database system</td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td><code>afterQuery</code></td>
      <td>After send a SQL statement to database system</td>
      <td style="text-align: center">No</td>
    </tr>
    <tr>
      <td><code>beforeDisconnect</code></td>
      <td>Before close a temporal database connection</td>
      <td style="text-align: center">No</td>
    </tr>
    <tr>
      <td><code>beginTransaction</code></td>
      <td>Before a transaction is going to be started</td>
      <td style="text-align: center">No</td>
    </tr>
    <tr>
      <td><code>rollbackTransaction</code></td>
      <td>Before a transaction is rollbacked</td>
      <td style="text-align: center">No</td>
    </tr>
    <tr>
      <td><code>commitTransaction</code></td>
      <td>Before a transaction is committed</td>
      <td style="text-align: center">No</td>
    </tr>
  </tbody>
</table>

<p>Bind an EventsManager to a connection is simple, <a href="api/Phalcon_Db">Phalcon\Db</a> will trigger the events with the type <code>db</code>:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Events\Manager as EventsManager;
use Phalcon\Db\Adapter\Pdo\Mysql as Connection;

$eventsManager = new EventsManager();

// Listen all the database events
$eventsManager-&gt;attach('db', $dbListener);

$connection = new Connection(
    [
        'host'     =&gt; 'localhost',
        'username' =&gt; 'root',
        'password' =&gt; 'secret',
        'dbname'   =&gt; 'invo',
    ]
);

// Assign the eventsManager to the db adapter instance
$connection-&gt;setEventsManager($eventsManager);
</code></pre>

<p>Stop SQL operations are very useful if for example you want to implement some last-resource SQL injector checker:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Events\Event;

$eventsManager-&gt;attach(
    'db:beforeQuery',
    function (Event $event, $connection) {
        $sql = $connection-&gt;getSQLStatement();

        // Check for malicious words in SQL statements
        if (preg_match('/DROP|ALTER/i', $sql)) {
            // DROP/ALTER operations aren't allowed in the application,
            // this must be a SQL injection!
            return false;
        }

        // It's OK
        return true;
    }
);
</code></pre>

<p><a name="profiling"></a></p>

<h2 id="profiling-sql-statements">Profiling SQL Statements</h2>

<p><a href="api/Phalcon_Db">Phalcon\Db</a> includes a profiling component called <a href="api/Phalcon_Db_Profiler">Phalcon\Db\Profiler</a>, that is used to analyze the performance of database operations so as to diagnose performance problems and discover bottlenecks.</p>

<p>Database profiling is really easy With <a href="api/Phalcon_Db_Profiler">Phalcon\Db\Profiler</a>:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Events\Event;
use Phalcon\Events\Manager as EventsManager;
use Phalcon\Db\Profiler as DbProfiler;

$eventsManager = new EventsManager();

$profiler = new DbProfiler();

// Listen all the database events
$eventsManager-&gt;attach(
    'db',
    function (Event $event, $connection) use ($profiler) {
        if ($event-&gt;getType() === 'beforeQuery') {
            $sql = $connection-&gt;getSQLStatement();

            // Start a profile with the active connection
            $profiler-&gt;startProfile($sql);
        }

        if ($event-&gt;getType() === 'afterQuery') {
            // Stop the active profile
            $profiler-&gt;stopProfile();
        }
    }
);

// Assign the events manager to the connection
$connection-&gt;setEventsManager($eventsManager);

$sql = 'SELECT buyer_name, quantity, product_name '
     . 'FROM buyers '
     . 'LEFT JOIN products ON buyers.pid = products.id';

// Execute a SQL statement
$connection-&gt;query($sql);

// Get the last profile in the profiler
$profile = $profiler-&gt;getLastProfile();

echo 'SQL Statement: ', $profile-&gt;getSQLStatement(), "\n";
echo 'Start Time: ', $profile-&gt;getInitialTime(), "\n";
echo 'Final Time: ', $profile-&gt;getFinalTime(), "\n";
echo 'Total Elapsed Time: ', $profile-&gt;getTotalElapsedSeconds(), "\n";
</code></pre>

<p>You can also create your own profile class based on <a href="api/Phalcon_Db_Profiler">Phalcon\Db\Profiler</a> to record real time statistics of the statements sent to the database system:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Events\Manager as EventsManager;
use Phalcon\Db\Profiler as Profiler;
use Phalcon\Db\Profiler\Item as Item;

class DbProfiler extends Profiler
{
    /**
     * Executed before the SQL statement will sent to the db server
     */
    public function beforeStartProfile(Item $profile)
    {
        echo $profile-&gt;getSQLStatement();
    }

    /**
     * Executed after the SQL statement was sent to the db server
     */
    public function afterEndProfile(Item $profile)
    {
        echo $profile-&gt;getTotalElapsedSeconds();
    }
}

// Create an Events Manager
$eventsManager = new EventsManager();

// Create a listener
$dbProfiler = new DbProfiler();

// Attach the listener listening for all database events
$eventsManager-&gt;attach('db', $dbProfiler);
</code></pre>

<p><a name="logging-statements"></a></p>

<h2 id="logging-sql-statements">Logging SQL Statements</h2>

<p>Using high-level abstraction components such as <a href="api/Phalcon_Db">Phalcon\Db</a> to access a database, it is difficult to understand which statements are sent to the database system. <a href="api/Phalcon_Logger">Phalcon\Logger</a> interacts with <a href="api/Phalcon_Db">Phalcon\Db</a>, providing logging capabilities on the database abstraction layer.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Logger;
use Phalcon\Events\Event;
use Phalcon\Events\Manager as EventsManager;
use Phalcon\Logger\Adapter\File as FileLogger;

$eventsManager = new EventsManager();

$logger = new FileLogger('app/logs/db.log');

$eventsManager-&gt;attach(
    'db:beforeQuery',
    function (Event $event, $connection) use ($logger) {
        $sql = $connection-&gt;getSQLStatement();

        $logger-&gt;log($sql, Logger::INFO);
    }
);

// Assign the eventsManager to the db adapter instance
$connection-&gt;setEventsManager($eventsManager);

// Execute some SQL statement
$connection-&gt;insert(
    'products',
    [
        'Hot pepper',
        3.50,
    ],
    [
        'name',
        'price',
    ]
);
</code></pre>

<p>As above, the file <code>app/logs/db.log</code> will contain something like this:</p>

<pre><code class="language-bash">[Sun, 29 Apr 12 22:35:26 -0500][DEBUG][Resource Id #77] INSERT INTO products
(name, price) VALUES ('Hot pepper', 3.50)
</code></pre>

<p><a name="logger-custom"></a></p>

<h2 id="implementing-your-own-logger">Implementing your own Logger</h2>

<p>You can implement your own logger class for database queries, by creating a class that implements a single method called <code>log</code>. The method needs to accept a string as the first argument. You can then pass your logging object to <code>Phalcon\Db::setLogger()</code>, and from then on any SQL statement executed will call that method to log the results.</p>

<p><a name="describing-tables"></a></p>

<h2 id="describing-tablesviews">Describing Tables/Views</h2>

<p><a href="api/Phalcon_Db">Phalcon\Db</a> also provides methods to retrieve detailed information about tables and views:</p>

<pre><code class="language-php">&lt;?php

// Get tables on the test_db database
$tables = $connection-&gt;listTables('test_db');

// Is there a table 'robots' in the database?
$exists = $connection-&gt;tableExists('robots');

// Get name, data types and special features of 'robots' fields
$fields = $connection-&gt;describeColumns('robots');
foreach ($fields as $field) {
    echo 'Column Type: ', $field['Type'];
}

// Get indexes on the 'robots' table
$indexes = $connection-&gt;describeIndexes('robots');
foreach ($indexes as $index) {
    print_r(
        $index-&gt;getColumns()
    );
}

// Get foreign keys on the 'robots' table
$references = $connection-&gt;describeReferences('robots');
foreach ($references as $reference) {
    // Print referenced columns
    print_r(
        $reference-&gt;getReferencedColumns()
    );
}
</code></pre>

<p>A table description is very similar to the MySQL <code>DESCRIBE</code> command, it contains the following information:</p>

<table>
  <thead>
    <tr>
      <th>Field</th>
      <th>Type</th>
      <th>Key</th>
      <th>Null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Field’s name</td>
      <td>Column Type</td>
      <td>Is the column part of the primary key or an index?</td>
      <td>Does the column allow null values?</td>
    </tr>
  </tbody>
</table>

<p>Methods to get information about views are also implemented for every supported database system:</p>

<pre><code class="language-php">&lt;?php

// Get views on the test_db database
$tables = $connection-&gt;listViews('test_db');

// Is there a view 'robots' in the database?
$exists = $connection-&gt;viewExists('robots');
</code></pre>

<p><a name="tables"></a></p>

<h2 id="creatingalteringdropping-tables">Creating/Altering/Dropping Tables</h2>

<p>Different database systems (MySQL, Postgresql etc.) offer the ability to create, alter or drop tables with the use of commands such as <code>CREATE</code>, <code>ALTER</code> or <code>DROP</code>. The SQL syntax differs based on which database system is used. <code>Phalcon\Db</code> offers a unified interface to alter tables, without the need to differentiate the SQL syntax based on the target storage system.</p>

<p><a name="tables-create"></a></p>

<h3 id="creating-tables">Creating Tables</h3>

<p>The following example shows how to create a table:</p>

<pre><code class="language-php">&lt;?php

use \Phalcon\Db\Column as Column;

$connection-&gt;createTable(
    'robots',
    null,
    [
       'columns' =&gt; [
            new Column(
                'id',
                [
                    'type'          =&gt; Column::TYPE_INTEGER,
                    'size'          =&gt; 10,
                    'notNull'       =&gt; true,
                    'autoIncrement' =&gt; true,
                    'primary'       =&gt; true,
                ]
            ),
            new Column(
                'name',
                [
                    'type'    =&gt; Column::TYPE_VARCHAR,
                    'size'    =&gt; 70,
                    'notNull' =&gt; true,
                ]
            ),
            new Column(
                'year',
                [
                    'type'    =&gt; Column::TYPE_INTEGER,
                    'size'    =&gt; 11,
                    'notNull' =&gt; true,
                ]
            ),
        ]
    ]
);
</code></pre>

<p><code>Phalcon\Db::createTable()</code> accepts an associative array describing the table. Columns are defined with the class <a href="api/Phalcon_Db_Column">Phalcon\Db\Column</a>. The table below shows the options available to define a column:</p>

<table>
  <thead>
    <tr>
      <th>Option</th>
      <th>Description</th>
      <th style="text-align: center">Optional</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>type</code></td>
      <td>Column type. Must be a <a href="api/Phalcon_Db_Column">Phalcon\Db\Column</a> constant (see below for a list)</td>
      <td style="text-align: center">No</td>
    </tr>
    <tr>
      <td><code>primary</code></td>
      <td>True if the column is part of the table’s primary key</td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td><code>size</code></td>
      <td>Some type of columns like <code>VARCHAR</code> or <code>INTEGER</code> may have a specific size</td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td><code>scale</code></td>
      <td><code>DECIMAL</code> or <code>NUMBER</code> columns may be have a scale to specify how many decimals should be stored</td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td><code>unsigned</code></td>
      <td><code>INTEGER</code> columns may be signed or unsigned. This option does not apply to other types of columns</td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td><code>notNull</code></td>
      <td>Column can store null values?</td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td><code>default</code></td>
      <td>Default value (when used with <code>'notNull' =&gt; true</code>).</td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td><code>autoIncrement</code></td>
      <td>With this attribute column will filled automatically with an auto-increment integer. Only one column in the table can have this attribute.</td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td><code>bind</code></td>
      <td>One of the <code>BIND_TYPE_*</code> constants telling how the column must be bound before save it</td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td><code>first</code></td>
      <td>Column must be placed at first position in the column order</td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td><code>after</code></td>
      <td>Column must be placed after indicated column</td>
      <td style="text-align: center">Yes</td>
    </tr>
  </tbody>
</table>

<p><a href="api/Phalcon_Db">Phalcon\Db</a> supports the following database column types:</p>

<ul>
  <li><code>Phalcon\Db\Column::TYPE_INTEGER</code></li>
  <li><code>Phalcon\Db\Column::TYPE_DATE</code></li>
  <li><code>Phalcon\Db\Column::TYPE_VARCHAR</code></li>
  <li><code>Phalcon\Db\Column::TYPE_DECIMAL</code></li>
  <li><code>Phalcon\Db\Column::TYPE_DATETIME</code></li>
  <li><code>Phalcon\Db\Column::TYPE_CHAR</code></li>
  <li><code>Phalcon\Db\Column::TYPE_TEXT</code></li>
</ul>

<p>The associative array passed in <code>Phalcon\Db::createTable()</code> can have the possible keys:</p>

<table>
  <thead>
    <tr>
      <th>Index</th>
      <th>Description</th>
      <th style="text-align: center">Optional</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>columns</code></td>
      <td>An array with a set of table columns defined with <a href="api/Phalcon_Db_Column">Phalcon\Db\Column</a></td>
      <td style="text-align: center">No</td>
    </tr>
    <tr>
      <td><code>indexes</code></td>
      <td>An array with a set of table indexes defined with <a href="api/Phalcon_Db_Index">Phalcon\Db\Index</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td><code>references</code></td>
      <td>An array with a set of table references (foreign keys) defined with <a href="api/Phalcon_Db_Reference">Phalcon\Db\Reference</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td><code>options</code></td>
      <td>An array with a set of table creation options. These options often relate to the database system in which the migration was generated.</td>
      <td style="text-align: center">Yes</td>
    </tr>
  </tbody>
</table>

<p><a name="tables-altering"></a></p>

<h3 id="altering-tables">Altering Tables</h3>

<p>As your application grows, you might need to alter your database, as part of a refactoring or adding new features. Not all database systems allow to modify existing columns or add columns between two existing ones. <a href="api/Phalcon_Db">Phalcon\Db</a> is limited by these constraints.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Db\Column as Column;

// Adding a new column
$connection-&gt;addColumn(
    'robots',
    null,
    new Column(
        'robot_type',
        [
            'type'    =&gt; Column::TYPE_VARCHAR,
            'size'    =&gt; 32,
            'notNull' =&gt; true,
            'after'   =&gt; 'name',
        ]
    )
);

// Modifying an existing column
$connection-&gt;modifyColumn(
    'robots',
    null,
    new Column(
        'name',
        [
            'type'    =&gt; Column::TYPE_VARCHAR,
            'size'    =&gt; 40,
            'notNull' =&gt; true,
        ]
    )
);

// Deleting the column 'name'
$connection-&gt;dropColumn(
    'robots',
    null,
    'name'
);
</code></pre>

<p><a name="tables-dropping"></a></p>

<h3 id="dropping-tables">Dropping Tables</h3>

<p>To drop an existing table from the current database, use the <code>dropTable</code> method. To drop an table from custom database, use second parameter describes database name. Examples on dropping tables:</p>

<pre><code class="language-php">&lt;?php

// Drop table 'robots' from active database
$connection-&gt;dropTable('robots');

// Drop table 'robots' from database 'machines'
$connection-&gt;dropTable('robots', 'machines');
</code></pre>

                    </div>
                </div>
            </div>
        </div>
    </div>

<footer>
    <div class="container">
        <div class="footer-wrapper clearfix">

            <div class="footer-link-container">
                <a class="footer-link" href="/">
                    <img class="footer-logo-img" src="/assets/images/footer_logo.svg" alt="logo">
                </a>
                <a class="footer-link" href="https://phalcon.link/about" target="_blank">
                    About
                </a>
                <a class="footer-link" href="https://phalcon.link/sponsors" target="_blank">
                    Sponsors
                </a>
                <a class="footer-link" href="https://phalcon.link/fund" target="_blank">
                    Support Us
                </a>
                <a class="footer-link" href="https://phalcon.link/download" target="_blank">
                    Download
                </a>
                <a class="footer-link" href="https://license.phalconphp.com/" target="_blank">
                    License New BSD
                </a>
            </div>

            <div class="footer-copyright">
                <a href="https://odva.pro/" target="_blank" class="o2-link">
                    <span>Development by</span> <img src="/assets/images/logo-o2.svg" alt="logo o2">
                </a>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript" src="/assets/js/main.min.js?v1547319779866581049"></script>
<script type="text/javascript" src="/assets/js/highlight/highlight.pack.js?v1547319779866581049"></script>
<script type="application/javascript">hljs.initHighlightingOnLoad();</script>
<script type="application/javascript">hljs.initHighlightingOnLoad();</script>
</body>
</html>
