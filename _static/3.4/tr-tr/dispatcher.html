<!doctype html>
<!--[if IE 8]>
<html lang="tr-tr" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="tr-tr" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="tr-tr" class="no-js">
<!--<![endif]-->








    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <script type="text/javascript" src="/assets/js/viewport-min-width.js?v1547319779866581049"></script>
        <meta name="description"
              content="Official Phalcon Documentation">
        <meta name="keywords" content="php, phalcon, phalcon php, php framework, faster php framework, php extension, next generation framework, docs, documentation">
        <meta name="author" href="/humans.txt">
        <meta name="generator" content="Phalcon Team - Jekyll - Netlify">

        <link href="http://0.0.0.0:4000/3.4/tr-tr/dispatcher.html" rel="canonical">
        <title>Phalcon Framework Documentation</title>

        <!-- Twitter -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@zephirlang">
        <meta name="twitter:creator" content="@zephirlang">
        <meta name="twitter:title" content="Phalcon Framework Documentation">
        <meta name="twitter:description" content="Official Phalcon Documentation">
        <meta name="twitter:image" content="https://assets.phalconphp.com/phalcon/logo.png">

        <!-- Facebook -->
        <meta property="og:url" content="http://0.0.0.0:4000">
        <meta property="og:title" content="Phalcon Framework Documentation">
        <meta property="og:description" content="Official Phalcon Documentation">
        <meta property="og:type" content="website">
        <meta property="og:image" content="https://assets.phalconphp.com/phalcon/logo.png">

        <meta name="msapplication-TileColor" content="#FFFFFF">
        <meta name="msapplication-square70x70logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-70x70.png">
        <meta name="msapplication-TileImage"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-144x144.png">
        <meta name="msapplication-square150x150logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-150x150.png">
        <meta name="msapplication-wide310x150logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-310x150.png">
        <meta name="msapplication-square310x310logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-310x310.png">

        <link rel="apple-touch-icon"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon.png">

        <link rel="apple-touch-icon-precomposed"
              sizes="57x57"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-57x57.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="60x60"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-60x60.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="72x72"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="76x76"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-76x76.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="114x114"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-114x114.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="120x120"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-120x120.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="144x144"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-144x144.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="152x152"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-152x152.png">

        <link rel="icon"
              type="image/png"
              sizes="16x16"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-16x16.png">
        <link rel="icon"
              type="image/png"
              sizes="32x32"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-32x32.png">
        <link rel="icon"
              type="image/png"
              sizes="96x96"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-96x96.png">
        <link rel="icon"
              type="image/png"
              sizes="128x128"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-128x128.png">
        <link rel="icon"
              type="image/png"
              sizes="196x196"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-196x196.png">
        <link rel="shortcut icon"
              type="image/png"
              href="https://assets.phalconphp.com/phalcon/favicon.ico"/>

        <link rel="alternate"
              type="application/rss+xml"
              title=" - "
              href="http://0.0.0.0:4000/feed.xml">

        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css"
              integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE="
              crossorigin="anonymous" />
        <link rel="stylesheet" href="/assets/css/monokai.css?v1547319779866581049" />
        <link rel="stylesheet" href="/assets/css/style.css?v1547319779866581049" />

        <script defer src="https://use.fontawesome.com/releases/v5.6.1/js/all.js"
                integrity="sha384-R5JkiUweZpJjELPWqttAYmYM1P3SNEJRM6ecTQF05pFFtxmCO+Y1CiUhvuDzgSVZ"
                crossorigin="anonymous"></script>
        
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90300500-6"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-90300500-6');
    </script>

    </head>


<body onclick="o2.allNavSlideUp()">
    <header class="header-image-doc">
        <div class="container">
            <div class="header-wrapper">
                <div class="clearfix">
                    <div class="row">
                        <div class="col-md-2 col-sm-3  col-xs-8">
                            <div class="header-image__logo-wrapper">
                                <a href="/3.4/tr-tr">
                                    <img class="logo-img" src="/assets/images/header_logo.svg" alt="logo">
                                </a>
                            </div>
                        </div>
                        <div class="col-md-10 col-sm-9 top-menu">

                            <div class="nav-icon" onclick="o2.showMobileMenu();">
                                <div class="nav-line"></div>
                                <div class="nav-line"></div>
                                <div class="nav-line"></div>
                            </div>
                            <nav class="header-nav">
                                <ul>
                                    <li class="nav-item" onclick="o2.toggleState(this, event);">
                                        <div class="nav-item_selected">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/tr.png"
                                                 alt="">
                                            <span class="caret"></span>
                                        </div>
                                        <div class="nav-item__list" onclick="event.stopPropagation();">
                                            
                                                <a href="/3.4/en/dispatcher" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                         alt="English (US)">
                                                    English (US)
                                                </a>
                                            
                                                <a href="/3.4/cs-cz/dispatcher" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/cs.png"
                                                         alt="Czech">
                                                    Czech
                                                </a>
                                            
                                                <a href="/3.4/de-de/dispatcher" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/de.png"
                                                         alt="German">
                                                    German
                                                </a>
                                            
                                                <a href="/3.4/es-es/dispatcher" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                         alt="Spanish">
                                                    Spanish
                                                </a>
                                            
                                                <a href="/3.4/fa-ir/dispatcher" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fa.png"
                                                         alt="Persian">
                                                    Persian
                                                </a>
                                            
                                                <a href="/3.4/fr-fr/dispatcher" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fr.png"
                                                         alt="French">
                                                    French
                                                </a>
                                            
                                                <a href="/3.4/id-id/dispatcher" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/id.png"
                                                         alt="Indonesian">
                                                    Indonesian
                                                </a>
                                            
                                                <a href="/3.4/it-it/dispatcher" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/it.png"
                                                         alt="Italian">
                                                    Italian
                                                </a>
                                            
                                                <a href="/3.4/ja-jp/dispatcher" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ja.png"
                                                         alt="Japanese">
                                                    Japanese
                                                </a>
                                            
                                                <a href="/3.4/pl-pl/dispatcher" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/pl.png"
                                                         alt="Polish">
                                                    Polish
                                                </a>
                                            
                                                <a href="/3.4/ru-ru/dispatcher" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ru.png"
                                                         alt="Russian">
                                                    Russian
                                                </a>
                                            
                                                <a href="/3.4/tr-tr/dispatcher" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/tr.png"
                                                         alt="Turkish">
                                                    Turkish
                                                </a>
                                            
                                                <a href="/3.4/uk-ua/dispatcher" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/uk.png"
                                                         alt="Ukrainian">
                                                    Ukrainian
                                                </a>
                                            
                                                <a href="/3.4/zh-cn/dispatcher" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                                         alt="Chinese Simplified">
                                                    Chinese Simplified
                                                </a>
                                            
                                        </div>
                                    </li>

                                        <li class="nav-item" onclick="o2.toggleState(this, event);">
                                            <div class="nav-item__selected custom-select__version">
                                                Version 3.4
                                                <span class="caret"></span>
                                            </div>
                                            <div class="nav-item__list" onclick="event.stopPropagation();">
                                                
                                                <a href="/3.4/tr-tr/dispatcher" class="custom-select__list-item">
                                                    <span>3.4</span>
                                                </a>
                                                
                                                <a href="/3.3/tr-tr/dispatcher" class="custom-select__list-item">
                                                    <span>3.3</span>
                                                </a>
                                                
                                                <a href="/3.2/tr-tr/dispatcher" class="custom-select__list-item">
                                                    <span>3.2</span>
                                                </a>
                                                
                                                <a href="/3.1/tr-tr/dispatcher" class="custom-select__list-item">
                                                    <span>3.1</span>
                                                </a>
                                                
                                                <a href="/4.0/tr-tr/dispatcher" class="custom-select__list-item">
                                                    <span>4.0</span>
                                                </a>
                                                
                                            </div>
                                        </li>

                                    <li class="nav-item" onclick="o2.toggleState(this, event);">
                                        <div class="nav-item_selected">
                                            Community
                                            <span class="caret"></span>
                                        </div>
                                        <div class="nav-item__list">
                                            <a href="https://phalcon.link/forum" class="custom-select__list-item" target="_blank">
                                                Forum
                                            </a>
                                            <a href="https://phalcon.link/blog" class="custom-select__list-item" target="_blank">
                                                Blog
                                            </a>
                                            <a href="https://phalcon.link/resources" class="custom-select__list-item" target="_blank">
                                                Resources
                                            </a>
                                            <div class="nav-item__divider"></div>
                                            <a href="https://phalcon.link/f" class="custom-select__list-item" target="_blank">
                                                Facebook
                                            </a>
                                            <a href="https://phalcon.link/t" class="custom-select__list-item" target="_blank">
                                                Twitter
                                            </a>
                                            <a href="https://phalcon.link/gab" class="custom-select__list-item" target="_blank">
                                                Gab.ai
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/about">
                                            About
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/sponsors">
                                            Sponsors
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/fund">
                                            Support Us
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/download">
                                            Download
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>

                        <div class="header-nav-mobile">
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this, event)">
                                    <img class="lang-image"
                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/tr.png"
                                         alt="">
                                    <span class="caret"></span>
                                </div>

                                <ul style="display:none;" class="clearfix" onclick="event.stopPropagation();">
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/en/dispatcher">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                 alt="English (US)">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/cs-cz/dispatcher">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/cs.png"
                                                 alt="Czech">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/de-de/dispatcher">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/de.png"
                                                 alt="German">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/es-es/dispatcher">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                 alt="Spanish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/fa-ir/dispatcher">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fa.png"
                                                 alt="Persian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/fr-fr/dispatcher">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fr.png"
                                                 alt="French">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/id-id/dispatcher">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/id.png"
                                                 alt="Indonesian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/it-it/dispatcher">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/it.png"
                                                 alt="Italian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/ja-jp/dispatcher">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ja.png"
                                                 alt="Japanese">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/pl-pl/dispatcher">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/pl.png"
                                                 alt="Polish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/ru-ru/dispatcher">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ru.png"
                                                 alt="Russian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/tr-tr/dispatcher">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/tr.png"
                                                 alt="Turkish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/uk-ua/dispatcher">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/uk.png"
                                                 alt="Ukrainian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/zh-cn/dispatcher">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                                 alt="Chinese Simplified">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                </ul>

                            </div>
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this,event)">
                                    Version 3.4
                                    <span class="caret"></span>
                                </div>

                                <ul style="display:none;" class="clearfix" onclick="event.stopPropagation();">
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.4/tr-tr/dispatcher">
                                            <span>3.4</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.3/tr-tr/dispatcher">
                                            <span>3.3</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.2/tr-tr/dispatcher">
                                            <span>3.2</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.1/tr-tr/dispatcher">
                                            <span>3.1</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/4.0/tr-tr/dispatcher">
                                            <span>4.0</span>
                                        </a>
                                    </li>
                                    
                                </ul>

                            </div>
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this, event)">
                                    
                                    <span class="caret"></span>
                                </div>
                                <ul style="display:none;">
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/forum" target="_blank">
                                            Forum
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/blog" target="_blank">
                                            Blog
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/resources" target="_blank">
                                            Resources
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/f" target="_blank">
                                            Facebook
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/t" target="_blank">
                                            Twitter
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/gab" target="_blank">
                                            Gab.ai
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/about">
                                    About
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/sponsors">
                                    Sponsors
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/fund">
                                    Support Us
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/download">
                                    Download
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>


    <div class="container-fluid article-page-wrap">
        <div class="row">
            <div>
                <div class="col-md-2 sidebar hidden-xs">
                    <div class="sidebar--spacer">&nbsp;</div>
                </div>
                <div class="m-t-md m-b-lg" id="articles">
                    <div class="article-content">
                        <p><a name="overview"></a></p>

<h1 id="dispatching-controllers">Dispatching Controllers</h1>

<p><a href="api/Phalcon_Mvc_Dispatcher">Phalcon\Mvc\Dispatcher</a> is the component responsible for instantiating controllers and executing the required actions on them in an MVC application. Understanding its operation and capabilities helps us get more out of the services provided by the framework.</p>

<p><a name="dispatch-loop"></a></p>

<h2 id="the-dispatch-loop">The Dispatch Loop</h2>

<p>This is an important process that has much to do with the MVC flow itself, especially with the controller part. The work occurs within the controller dispatcher. The controller files are read, loaded, and instantiated. Then the required actions are executed. If an action forwards the flow to another controller/action, the controller dispatcher starts again. To better illustrate this, the following example shows approximately the process performed within <a href="api/Phalcon_Mvc_Dispatcher">Phalcon\Mvc\Dispatcher</a>:</p>

<pre><code class="language-php">&lt;?php

// Dispatch loop
while (!$finished) {
    $finished = true;

    $controllerClass = $controllerName . 'Controller';

    // Instantiating the controller class via autoloaders
    $controller = new $controllerClass();

    // Execute the action
    call_user_func_array(
        [
            $controller,
            $actionName . 'Action'
        ],
        $params
    );

    // '$finished' should be reloaded to check if the flow was forwarded to another controller
    $finished = true;
}
</code></pre>

<p>The code above lacks validations, filters and additional checks, but it demonstrates the normal flow of operation in the dispatcher.</p>

<p><a name="dispatch-loop-events"></a></p>

<h3 id="dispatch-loop-events">Dispatch Loop Events</h3>

<p><a href="api/Phalcon_Mvc_Dispatcher">Phalcon\Mvc\Dispatcher</a> is able to send events to an <a href="/3.4/en/events">EventsManager</a> if it is present. Events are triggered using the type <code>dispatch</code>. Some events when returning boolean <code>false</code> could stop the active operation. The following events are supported:</p>

<table>
  <thead>
    <tr>
      <th>Event Name</th>
      <th>Triggered</th>
      <th>Can stop operation?</th>
      <th>Triggered on</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>beforeDispatchLoop</td>
      <td>Triggered before entering in the dispatch loop. At this point the dispatcher don’t know if the controller or the actions to be executed exist. The Dispatcher only knows the information passed by the Router.</td>
      <td>Yes</td>
      <td>Listeners</td>
    </tr>
    <tr>
      <td>beforeDispatch</td>
      <td>Triggered after entering in the dispatch loop. At this point the dispatcher don’t know if the controller or the actions to be executed exist. The Dispatcher only knows the information passed by the Router.</td>
      <td>Yes</td>
      <td>Listeners</td>
    </tr>
    <tr>
      <td>beforeExecuteRoute</td>
      <td>Triggered before executing the controller/action method. At this point the dispatcher has been initialized the controller and know if the action exist.</td>
      <td>Yes</td>
      <td>Listeners/Controllers</td>
    </tr>
    <tr>
      <td>initialize</td>
      <td>Allow to globally initialize the controller in the request</td>
      <td>No</td>
      <td>Controllers</td>
    </tr>
    <tr>
      <td>afterExecuteRoute</td>
      <td>Triggered after executing the controller/action method. As operation cannot be stopped, only use this event to make clean up after execute the action</td>
      <td>No</td>
      <td>Listeners/Controllers</td>
    </tr>
    <tr>
      <td>beforeNotFoundAction</td>
      <td>Triggered when the action was not found in the controller</td>
      <td>Yes</td>
      <td>Listeners</td>
    </tr>
    <tr>
      <td>beforeException</td>
      <td>Triggered before the dispatcher throws any exception</td>
      <td>Yes</td>
      <td>Listeners</td>
    </tr>
    <tr>
      <td>afterDispatch</td>
      <td>Triggered after executing the controller/action method. As operation cannot be stopped, only use this event to make clean up after execute the action</td>
      <td>Yes</td>
      <td>Listeners</td>
    </tr>
    <tr>
      <td>afterDispatchLoop</td>
      <td>Triggered after exiting the dispatch loop</td>
      <td>No</td>
      <td>Listeners</td>
    </tr>
    <tr>
      <td>afterBinding</td>
      <td>Triggered after models are bound but before executing route</td>
      <td>Yes</td>
      <td>Listeners/Controllers</td>
    </tr>
  </tbody>
</table>

<p>The <a href="/3.4/en/tutorial-invo">INVO</a> tutorial shows how to take advantage of dispatching events implementing a security filter with <a href="/3.4/en/acl">Acl</a></p>

<p>The following example demonstrates how to attach listeners to this component:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Dispatcher as MvcDispatcher;
use Phalcon\Events\Event;
use Phalcon\Events\Manager as EventsManager;

$di-&gt;set(
    'dispatcher',
    function () {
        // Create an event manager
        $eventsManager = new EventsManager();

        // Attach a listener for type 'dispatch'
        $eventsManager-&gt;attach(
            'dispatch',
            function (Event $event, $dispatcher) {
                // ...
            }
        );

        $dispatcher = new MvcDispatcher();

        // Bind the eventsManager to the view component
        $dispatcher-&gt;setEventsManager($eventsManager);

        return $dispatcher;
    },
    true
);
</code></pre>

<p>An instantiated controller automatically acts as a listener for dispatch events, so you can implement methods as callbacks:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Controller;
use Phalcon\Mvc\Dispatcher;

class PostsController extends Controller
{
    public function beforeExecuteRoute(Dispatcher $dispatcher)
    {
        // Executed before every found action
    }

    public function afterExecuteRoute(Dispatcher $dispatcher)
    {
        // Executed after every found action
    }
}
</code></pre>

<h5 class="alert alert-warning">Methods on event listeners accept an <a href="api/Phalcon_Events_Event">Phalcon\Events\Event</a> object as their first parameter - methods in controllers do not. </h5>

<p><a name="forwarding"></a></p>

<h2 id="forwarding-to-other-actions">Forwarding to other actions</h2>

<p>The dispatch loop allows us to forward the execution flow to another controller/action. This is very useful to check if the user can access to certain options, redirect users to other screens or simply reuse code.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Controller;

class PostsController extends Controller
{
    public function indexAction()
    {

    }

    public function saveAction($year, $postTitle)
    {
        // ... Store some product and forward the user

        // Forward flow to the index action
        $this-&gt;dispatcher-&gt;forward(
            [
                'controller' =&gt; 'posts',
                'action'     =&gt; 'index',
            ]
        );
    }
}
</code></pre>

<p>Keep in mind that making a <code>forward</code> is not the same as making a HTTP redirect. Although they apparently got the same result. The <code>forward</code> doesn’t reload the current page, all the redirection occurs in a single request, while the HTTP redirect needs two requests to complete the process.</p>

<p>More forwarding examples:</p>

<pre><code class="language-php">&lt;?php

// Forward flow to another action in the current controller
$this-&gt;dispatcher-&gt;forward(
    [
        'action' =&gt; 'search'
    ]
);

// Forward flow to another action in the current controller
// passing parameters
$this-&gt;dispatcher-&gt;forward(
    [
        'action' =&gt; 'search',
        'params' =&gt; [1, 2, 3]
    ]
);
</code></pre>

<p>A <code>forward</code> action accepts the following parameters:</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>controller</code></td>
      <td>A valid controller name to forward to.</td>
    </tr>
    <tr>
      <td><code>action</code></td>
      <td>A valid action name to forward to.</td>
    </tr>
    <tr>
      <td><code>params</code></td>
      <td>An array of parameters for the action.</td>
    </tr>
    <tr>
      <td><code>namespace</code></td>
      <td>A valid namespace name where the controller is part of.</td>
    </tr>
  </tbody>
</table>

<p><a name="forwarding-events-manager"></a></p>

<h3 id="using-the-events-manager">Using the Events Manager</h3>

<p>You can use the <code>dispatcher::beforeForward</code> event to change modules and redirect easier and “cleaner”:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Di;
use Phalcon\Events\Manager;
use Phalcon\Mvc\Dispatcher;
use Phalcon\Events\Event;

$di = new Di();

$modules = [
  'backend' =&gt; [
      'className' =&gt; 'App\Backend\Bootstrap',
      'path'      =&gt; '/app/Modules/Backend/Bootstrap.php',
      'metadata'  =&gt; [
          'controllersNamespace' =&gt; 'App\Backend\Controllers',
      ],
  ],
];

$manager = new Manager();

$manager-&gt;attach(
  'dispatch:beforeForward',
  function (Event $event, Dispatcher $dispatcher, array $forward) use ($modules) {
      $metadata = $modules[$forward['module']]['metadata'];
      $dispatcher-&gt;setModuleName($forward['module']);
      $dispatcher-&gt;setNamespaceName($metadata['controllersNamespace']);
  }
);

$dispatcher = new Dispatcher();
$dispatcher-&gt;setDI($di);
$dispatcher-&gt;setEventsManager($manager);
$di-&gt;set('dispatcher', $dispatcher);
$dispatcher-&gt;forward(
  [
      'module'     =&gt; 'backend',
      'controller' =&gt; 'posts',
      'action'     =&gt; 'index',
  ]
);

echo $dispatcher-&gt;getModuleName(); // will display properly 'backend'
</code></pre>

<p><a name="preparing-parameters"></a></p>

<h2 id="preparing-parameters">Preparing Parameters</h2>

<p>Thanks to the hook points provided by <a href="api/Phalcon_Mvc_Dispatcher">Phalcon\Mvc\Dispatcher</a> you can easily adapt your application to any URL schema; i.e. you might want your URLs look like: <code>http://example.com/controller/key1/value1/key2/value</code>. Since parameters are passed with the order that they are defined in the URL to actions, you can transform them to adopt the desired schema:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Dispatcher;
use Phalcon\Mvc\Dispatcher as MvcDispatcher;
use Phalcon\Events\Event;
use Phalcon\Events\Manager as EventsManager;

$di-&gt;set(
    'dispatcher',
    function () {
        // Create an EventsManager
        $eventsManager = new EventsManager();

        // Attach a listener
        $eventsManager-&gt;attach(
            'dispatch:beforeDispatchLoop',
            function (Event $event, $dispatcher) {
                $params = $dispatcher-&gt;getParams();

                $keyParams = [];

                // Use odd parameters as keys and even as values
                foreach ($params as $i =&gt; $value) {
                    if ($i &amp; 1) {
                        // Previous param
                        $key = $params[$i - 1];

                        $keyParams[$key] = $value;
                    }
                }

                // Override parameters
                $dispatcher-&gt;setParams($keyParams);
            }
        );

        $dispatcher = new MvcDispatcher();

        $dispatcher-&gt;setEventsManager($eventsManager);

        return $dispatcher;
    }
);
</code></pre>

<p>If the desired schema is: <code>http://example.com/controller/key1:value1/key2:value</code>, the following code is required:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Dispatcher;
use Phalcon\Mvc\Dispatcher as MvcDispatcher;
use Phalcon\Events\Event;
use Phalcon\Events\Manager as EventsManager;

$di-&gt;set(
    'dispatcher',
    function () {
        // Create an EventsManager
        $eventsManager = new EventsManager();

        // Attach a listener
        $eventsManager-&gt;attach(
            'dispatch:beforeDispatchLoop',
            function (Event $event, $dispatcher) {
                $params = $dispatcher-&gt;getParams();

                $keyParams = [];

                // Explode each parameter as key,value pairs
                foreach ($params as $number =&gt; $value) {
                    $parts = explode(':', $value);

                    $keyParams[$parts[0]] = $parts[1];
                }

                // Override parameters
                $dispatcher-&gt;setParams($keyParams);
            }
        );

        $dispatcher = new MvcDispatcher();

        $dispatcher-&gt;setEventsManager($eventsManager);

        return $dispatcher;
    }
);
</code></pre>

<p><a name="getting-parameters"></a></p>

<h2 id="getting-parameters">Getting Parameters</h2>

<p>When a route provides named parameters you can receive them in a controller, a view or any other component that extends <a href="api/Phalcon_Di_Injectable">Phalcon\Di\Injectable</a>.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Controller;

class PostsController extends Controller
{
    public function indexAction()
    {

    }

    public function saveAction()
    {
        // Get the post's title passed in the URL as parameter
        // or prepared in an event
        $title = $this-&gt;dispatcher-&gt;getParam('title');

        // Get the post's year passed in the URL as parameter
        // or prepared in an event also filtering it
        $year = $this-&gt;dispatcher-&gt;getParam('year', 'int');

        // ...
    }
}
</code></pre>

<p><a name="preparing-actions"></a></p>

<h2 id="preparing-actions">Preparing actions</h2>

<p>You can also define an arbitrary schema for actions <code>before</code> in the dispatch loop.</p>

<p><a name="preparing-actions-camelizing-action-names"></a></p>

<h3 id="camelize-action-names">Camelize action names</h3>

<p>If the original URL is: <code>http://example.com/admin/products/show-latest-products</code>, and for example you want to camelize <code>show-latest-products</code> to <code>ShowLatestProducts</code>, the following code is required:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Text;
use Phalcon\Mvc\Dispatcher as MvcDispatcher;
use Phalcon\Events\Event;
use Phalcon\Events\Manager as EventsManager;

$di-&gt;set(
    'dispatcher',
    function () {
        // Create an EventsManager
        $eventsManager = new EventsManager();

        // Camelize actions
        $eventsManager-&gt;attach(
            'dispatch:beforeDispatchLoop',
            function (Event $event, $dispatcher) {
                $dispatcher-&gt;setActionName(
                    Text::camelize($dispatcher-&gt;getActionName())
                );
            }
        );

        $dispatcher = new MvcDispatcher();

        $dispatcher-&gt;setEventsManager($eventsManager);

        return $dispatcher;
    }
);
</code></pre>

<p><a name="preparing-actions-removing-legacy-extensions"></a></p>

<h3 id="remove-legacy-extensions">Remove legacy extensions</h3>

<p>If the original URL always contains a <code>.php</code> extension:</p>

<pre><code class="language-php">http://example.com/admin/products/show-latest-products.php
http://example.com/admin/products/index.php
</code></pre>

<p>You can remove it before dispatch the controller/action combination:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Dispatcher as MvcDispatcher;
use Phalcon\Events\Event;
use Phalcon\Events\Manager as EventsManager;

$di-&gt;set(
    'dispatcher',
    function () {
        // Create an EventsManager
        $eventsManager = new EventsManager();

        // Remove extension before dispatch
        $eventsManager-&gt;attach(
            'dispatch:beforeDispatchLoop',
            function (Event $event, $dispatcher) {
                $action = $dispatcher-&gt;getActionName();

                // Remove extension
                $action = preg_replace('/\.php$/', '', $action);

                // Override action
                $dispatcher-&gt;setActionName($action);
            }
        );

        $dispatcher = new MvcDispatcher();

        $dispatcher-&gt;setEventsManager($eventsManager);

        return $dispatcher;
    }
);
</code></pre>

<p><a name="preparing-actions-inject-model-instances"></a></p>

<h3 id="inject-model-instances">Inject model instances</h3>

<p>In this example, the developer wants to inspect the parameters that an action will receive in order to dynamically inject model instances.</p>

<p>The controller looks like:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Controller;

class PostsController extends Controller
{
    /**
     * Shows posts
     *
     * @param \Posts $post
     */
    public function showAction(Posts $post)
    {
        $this-&gt;view-&gt;post = $post;
    }
}
</code></pre>

<p>Method <code>showAction</code> receives an instance of the model <code>\Posts</code>, the developer could inspect this before dispatch the action preparing the parameter accordingly:</p>

<pre><code class="language-php">&lt;?php

use \Exception;
use Phalcon\Mvc\Model;
use Phalcon\Mvc\Dispatcher as MvcDispatcher;
use Phalcon\Events\Event;
use Phalcon\Events\Manager as EventsManager;
use \ReflectionMethod;

$di-&gt;set(
    'dispatcher',
    function () {
        // Create an EventsManager
        $eventsManager = new EventsManager();

        $eventsManager-&gt;attach(
            'dispatch:beforeDispatchLoop',
            function (Event $event, $dispatcher) {
                // Possible controller class name
                $controllerName = $dispatcher-&gt;getControllerClass();

                // Possible method name
                $actionName = $dispatcher-&gt;getActiveMethod();

                try {
                    // Get the reflection for the method to be executed
                    $reflection = new ReflectionMethod($controllerName, $actionName);

                    $parameters = $reflection-&gt;getParameters();

                    // Check parameters
                    foreach ($parameters as $parameter) {
                        // Get the expected model name
                        $className = $parameter-&gt;getClass()-&gt;name;

                        // Check if the parameter expects a model instance
                        if (is_subclass_of($className, Model::class)) {
                            $model = $className::findFirstById($dispatcher-&gt;getParams()[0]);

                            // Override the parameters by the model instance
                            $dispatcher-&gt;setParams([$model]);
                        }
                    }
                } catch (Exception $e) {
                    // An exception has occurred, maybe the class or action does not exist?
                }
            }
        );

        $dispatcher = new MvcDispatcher();

        $dispatcher-&gt;setEventsManager($eventsManager);

        return $dispatcher;
    }
);
</code></pre>

<p>The above example has been simplified. A developer can improve it to inject any kind of dependency or model in actions before be executed.</p>

<p>From 3.1.x onwards the dispatcher also comes with an option to handle this internally for all models passed into a controller action by using <a href="api/Phalcon_Mvc_Model_Binder">Phalcon\Mvc\Model\Binder</a>.</p>

<pre><code class="language-php">use Phalcon\Mvc\Dispatcher;
use Phalcon\Mvc\Model\Binder;

$dispatcher = new Dispatcher();

$dispatcher-&gt;setModelBinder(new Binder());

return $dispatcher;
</code></pre>

<h5 class="alert alert-warning">Since the Binder object is using internally Reflection Api which can be heavy, there is ability to set cache. This can be done by using second argument in <code>setModelBinder()</code> which can also accept service name or just by passing cache instance to <code>Binder</code> constructor. </h5>

<p>It also introduces a new interface <a href="api/Phalcon_Mvc_Model_Binder_BindableInterface">Phalcon\Mvc\Model\Binder\BindableInterface</a> which allows you to define the controllers associated models to allow models binding in base controllers.</p>

<p>For example, you have a base <code>CrudController</code> which your <code>PostsController</code> extends from. Your <code>CrudController</code> looks something like this:</p>

<pre><code class="language-php">use Phalcon\Mvc\Controller;
use Phalcon\Mvc\Model;

class CrudController extends Controller
{
    /**
     * Show action
     *
     * @param Model $model
     */
    public function showAction(Model $model)
    {
        $this-&gt;view-&gt;model = $model;
    }
}
</code></pre>

<p>In your PostsController you need to define which model the controller is associated with. This is done by implementing the <a href="api/Phalcon_Mvc_Model_Binder_BindableInterface">Phalcon\Mvc\Model\Binder\BindableInterface</a> which will add the <code>getModelName()</code> method from which you can return the model name. It can return string with just one model name or associative array where key is parameter name.</p>

<pre><code class="language-php">use Phalcon\Mvc\Model\Binder\BindableInterface;
use Models\Posts;

class PostsController extends CrudController implements BindableInterface
{
    public static function getModelName()
    {
        return Posts::class;
    }
}
</code></pre>

<p>By declaring the model associated with the <code>PostsController</code> the binder can check the controller for the <code>getModelName()</code> method before passing the defined model into the parent show action.</p>

<p>If your project structure does not use any parent controller you can of course still bind the model directly into the controller action:</p>

<pre><code class="language-php">use Phalcon\Mvc\Controller;
use Models\Posts;

class PostsController extends Controller
{
    /**
     * Shows posts
     *
     * @param Posts $post
     */
    public function showAction(Posts $post)
    {
        $this-&gt;view-&gt;post = $post;
    }
}
</code></pre>

<h5 class="alert alert-warning">Currently the binder will only use the models primary key to perform a <code>findFirst()</code> on. An example route for the above would be <code>/posts/show/{1}</code> </h5>

<p><a name="handling-404"></a></p>

<h2 id="handling-not-found-exceptions">Handling Not-Found Exceptions</h2>

<p>Using the <a href="/3.4/en/events">EventsManager</a> it’s possible to insert a hook point before the dispatcher throws an exception when the controller/action combination wasn’t found:</p>

<pre><code class="language-php">&lt;?php

use Exception;
use Phalcon\Dispatcher;
use Phalcon\Mvc\Dispatcher as MvcDispatcher;
use Phalcon\Events\Event;
use Phalcon\Events\Manager as EventsManager;
use Phalcon\Mvc\Dispatcher\Exception as DispatchException;

$di-&gt;setShared(
    'dispatcher',
    function () {
        // Create an EventsManager
        $eventsManager = new EventsManager();

        // Attach a listener
        $eventsManager-&gt;attach(
            'dispatch:beforeException',
            function (Event $event, $dispatcher, Exception $exception) {
                // Handle 404 exceptions
                if ($exception instanceof DispatchException) {
                    $dispatcher-&gt;forward(
                        [
                            'controller' =&gt; 'index',
                            'action'     =&gt; 'show404',
                        ]
                    );

                    return false;
                }

                // Alternative way, controller or action doesn't exist
                switch ($exception-&gt;getCode()) {
                    case Dispatcher::EXCEPTION_HANDLER_NOT_FOUND:
                    case Dispatcher::EXCEPTION_ACTION_NOT_FOUND:
                        $dispatcher-&gt;forward(
                            [
                                'controller' =&gt; 'index',
                                'action'     =&gt; 'show404',
                            ]
                        );

                        return false;
                }
            }
        );

        $dispatcher = new MvcDispatcher();

        // Bind the EventsManager to the dispatcher
        $dispatcher-&gt;setEventsManager($eventsManager);

        return $dispatcher;
    }
);
</code></pre>

<p>Of course, this method can be moved onto independent plugin classes, allowing more than one class take actions when an exception is produced in the dispatch loop:</p>

<pre><code class="language-php">&lt;?php

use Exception;
use Phalcon\Events\Event;
use Phalcon\Mvc\Dispatcher;
use Phalcon\Mvc\Dispatcher\Exception as DispatchException;

class ExceptionsPlugin
{
    public function beforeException(Event $event, Dispatcher $dispatcher, Exception $exception)
    {
        // Default error action
        $action = 'show503';

        // Handle 404 exceptions
        if ($exception instanceof DispatchException) {
            $action = 'show404';
        }

        $dispatcher-&gt;forward(
            [
                'controller' =&gt; 'index',
                'action'     =&gt; $action,
            ]
        );

        return false;
    }
}
</code></pre>

<h5 class="alert alert-danger">Only exceptions produced by the dispatcher and exceptions produced in the executed action are notified in the <code>beforeException</code> events. Exceptions produced in listeners or controller events are redirected to the latest try/catch. </h5>

<p><a name="custom"></a></p>

<h2 id="implementing-your-own-dispatcher">Implementing your own Dispatcher</h2>

<p>The <a href="api/Phalcon_Mvc_DispatcherInterface">Phalcon\Mvc\DispatcherInterface</a> interface must be implemented to create your own dispatcher replacing the one provided by Phalcon.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>

<footer>
    <div class="container">
        <div class="footer-wrapper clearfix">

            <div class="footer-link-container">
                <a class="footer-link" href="/">
                    <img class="footer-logo-img" src="/assets/images/footer_logo.svg" alt="logo">
                </a>
                <a class="footer-link" href="https://phalcon.link/about" target="_blank">
                    About
                </a>
                <a class="footer-link" href="https://phalcon.link/sponsors" target="_blank">
                    Sponsors
                </a>
                <a class="footer-link" href="https://phalcon.link/fund" target="_blank">
                    Support Us
                </a>
                <a class="footer-link" href="https://phalcon.link/download" target="_blank">
                    Download
                </a>
                <a class="footer-link" href="https://license.phalconphp.com/" target="_blank">
                    License New BSD
                </a>
            </div>

            <div class="footer-copyright">
                <a href="https://odva.pro/" target="_blank" class="o2-link">
                    <span>Development by</span> <img src="/assets/images/logo-o2.svg" alt="logo o2">
                </a>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript" src="/assets/js/main.min.js?v1547319779866581049"></script>
<script type="text/javascript" src="/assets/js/highlight/highlight.pack.js?v1547319779866581049"></script>
<script type="application/javascript">hljs.initHighlightingOnLoad();</script>
<script type="application/javascript">hljs.initHighlightingOnLoad();</script>
</body>
</html>
