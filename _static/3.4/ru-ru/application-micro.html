<!doctype html>
<!--[if IE 8]>
<html lang="ru-ru" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="ru-ru" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="ru-ru" class="no-js">
<!--<![endif]-->








    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <script type="text/javascript" src="/assets/js/viewport-min-width.js?v1547266080100021829"></script>
        <meta name="description"
              content="Official Phalcon Documentation">
        <meta name="keywords" content="php, phalcon, phalcon php, php framework, faster php framework, php extension, next generation framework, docs, documentation">
        <meta name="author" href="/humans.txt">
        <meta name="generator" content="Phalcon Team - Jekyll - Netlify">

        <link href="https://phalcon-docs4.netlify.com/3.4/ru-ru/application-micro.html" rel="canonical">
        <title>Phalcon Framework Documentation</title>

        <!-- Twitter -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@zephirlang">
        <meta name="twitter:creator" content="@zephirlang">
        <meta name="twitter:title" content="Phalcon Framework Documentation">
        <meta name="twitter:description" content="Official Phalcon Documentation">
        <meta name="twitter:image" content="https://assets.phalconphp.com/phalcon/logo.png">

        <!-- Facebook -->
        <meta property="og:url" content="https://phalcon-docs4.netlify.com">
        <meta property="og:title" content="Phalcon Framework Documentation">
        <meta property="og:description" content="Official Phalcon Documentation">
        <meta property="og:type" content="website">
        <meta property="og:image" content="https://assets.phalconphp.com/phalcon/logo.png">

        <meta name="msapplication-TileColor" content="#FFFFFF">
        <meta name="msapplication-square70x70logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-70x70.png">
        <meta name="msapplication-TileImage"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-144x144.png">
        <meta name="msapplication-square150x150logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-150x150.png">
        <meta name="msapplication-wide310x150logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-310x150.png">
        <meta name="msapplication-square310x310logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-310x310.png">

        <link rel="apple-touch-icon"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon.png">

        <link rel="apple-touch-icon-precomposed"
              sizes="57x57"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-57x57.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="60x60"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-60x60.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="72x72"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="76x76"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-76x76.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="114x114"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-114x114.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="120x120"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-120x120.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="144x144"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-144x144.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="152x152"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-152x152.png">

        <link rel="icon"
              type="image/png"
              sizes="16x16"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-16x16.png">
        <link rel="icon"
              type="image/png"
              sizes="32x32"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-32x32.png">
        <link rel="icon"
              type="image/png"
              sizes="96x96"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-96x96.png">
        <link rel="icon"
              type="image/png"
              sizes="128x128"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-128x128.png">
        <link rel="icon"
              type="image/png"
              sizes="196x196"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-196x196.png">
        <link rel="shortcut icon"
              type="image/png"
              href="https://assets.phalconphp.com/phalcon/favicon.ico"/>

        <link rel="alternate"
              type="application/rss+xml"
              title=" - "
              href="https://phalcon-docs4.netlify.com/feed.xml">

        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css"
              integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE="
              crossorigin="anonymous" />
        <link rel="stylesheet" href="/assets/css/monokai.css?v1547266080100021829" />
        <link rel="stylesheet" href="/assets/css/style.css?v1547266080100021829" />

        <script defer src="https://use.fontawesome.com/releases/v5.6.1/js/all.js"
                integrity="sha384-R5JkiUweZpJjELPWqttAYmYM1P3SNEJRM6ecTQF05pFFtxmCO+Y1CiUhvuDzgSVZ"
                crossorigin="anonymous"></script>
        
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90300500-6"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-90300500-6');
    </script>

    </head>


<body onclick="o2.allNavSlideUp()">
    <header class="header-image-doc">
        <div class="container">
            <div class="header-wrapper">
                <div class="clearfix">
                    <div class="row">
                        <div class="col-md-2 col-sm-3  col-xs-8">
                            <div class="header-image__logo-wrapper">
                                <a href="/3.4/ru-ru">
                                    <img class="logo-img" src="/assets/images/header_logo.svg" alt="logo">
                                </a>
                            </div>
                        </div>
                        <div class="col-md-10 col-sm-9 top-menu">

                            <div class="nav-icon" onclick="o2.showMobileMenu();">
                                <div class="nav-line"></div>
                                <div class="nav-line"></div>
                                <div class="nav-line"></div>
                            </div>
                            <nav class="header-nav">
                                <ul>
                                    <li class="nav-item" onclick="o2.toggleState(this, event);">
                                        <div class="nav-item_selected">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ru.png"
                                                 alt="">
                                            <span class="caret"></span>
                                        </div>
                                        <div class="nav-item__list" onclick="event.stopPropagation();">
                                            
                                                <a href="/3.4/en/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                         alt="English (US)">
                                                    English (US)
                                                </a>
                                            
                                                <a href="/3.4/cs-cz/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/cs.png"
                                                         alt="Czech">
                                                    Czech
                                                </a>
                                            
                                                <a href="/3.4/de-de/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/de.png"
                                                         alt="German">
                                                    German
                                                </a>
                                            
                                                <a href="/3.4/es-es/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                         alt="Spanish">
                                                    Spanish
                                                </a>
                                            
                                                <a href="/3.4/fa-ir/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fa.png"
                                                         alt="Persian">
                                                    Persian
                                                </a>
                                            
                                                <a href="/3.4/fr-fr/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fr.png"
                                                         alt="French">
                                                    French
                                                </a>
                                            
                                                <a href="/3.4/id-id/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/id.png"
                                                         alt="Indonesian">
                                                    Indonesian
                                                </a>
                                            
                                                <a href="/3.4/it-it/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/it.png"
                                                         alt="Italian">
                                                    Italian
                                                </a>
                                            
                                                <a href="/3.4/ja-jp/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ja.png"
                                                         alt="Japanese">
                                                    Japanese
                                                </a>
                                            
                                                <a href="/3.4/pl-pl/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/pl.png"
                                                         alt="Polish">
                                                    Polish
                                                </a>
                                            
                                                <a href="/3.4/ru-ru/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ru.png"
                                                         alt="Russian">
                                                    Russian
                                                </a>
                                            
                                                <a href="/3.4/tr-tr/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/tr.png"
                                                         alt="Turkish">
                                                    Turkish
                                                </a>
                                            
                                                <a href="/3.4/uk-ua/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/uk.png"
                                                         alt="Ukrainian">
                                                    Ukrainian
                                                </a>
                                            
                                                <a href="/3.4/zh-cn/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                                         alt="Chinese Simplified">
                                                    Chinese Simplified
                                                </a>
                                            
                                        </div>
                                    </li>

                                        <li class="nav-item" onclick="o2.toggleState(this, event);">
                                            <div class="nav-item__selected custom-select__version">
                                                 3.4
                                                <span class="caret"></span>
                                            </div>
                                            <div class="nav-item__list" onclick="event.stopPropagation();">
                                                
                                                <a href="/3.4/ru-ru/application-micro" class="custom-select__list-item">
                                                    <span>3.4</span>
                                                </a>
                                                
                                                <a href="/3.3/ru-ru/application-micro" class="custom-select__list-item">
                                                    <span>3.3</span>
                                                </a>
                                                
                                                <a href="/3.2/ru-ru/application-micro" class="custom-select__list-item">
                                                    <span>3.2</span>
                                                </a>
                                                
                                                <a href="/3.1/ru-ru/application-micro" class="custom-select__list-item">
                                                    <span>3.1</span>
                                                </a>
                                                
                                                <a href="/4.0/ru-ru/application-micro" class="custom-select__list-item">
                                                    <span>4.0</span>
                                                </a>
                                                
                                            </div>
                                        </li>

                                    <li class="nav-item" onclick="o2.toggleState(this, event);">
                                        <div class="nav-item_selected">
                                            
                                            <span class="caret"></span>
                                        </div>
                                        <div class="nav-item__list">
                                            <a href="https://phalcon.link/forum" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/blog" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/resources" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <div class="nav-item__divider"></div>
                                            <a href="https://phalcon.link/f" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/t" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/gab" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/about">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/sponsors">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/fund">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/download">
                                            
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>

                        <div class="header-nav-mobile">
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this, event)">
                                    <img class="lang-image"
                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ru.png"
                                         alt="">
                                    <span class="caret"></span>
                                </div>

                                <ul style="display:none;" class="clearfix" onclick="event.stopPropagation();">
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/en/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                 alt="English (US)">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/cs-cz/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/cs.png"
                                                 alt="Czech">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/de-de/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/de.png"
                                                 alt="German">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/es-es/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                 alt="Spanish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/fa-ir/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fa.png"
                                                 alt="Persian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/fr-fr/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fr.png"
                                                 alt="French">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/id-id/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/id.png"
                                                 alt="Indonesian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/it-it/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/it.png"
                                                 alt="Italian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/ja-jp/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ja.png"
                                                 alt="Japanese">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/pl-pl/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/pl.png"
                                                 alt="Polish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/ru-ru/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ru.png"
                                                 alt="Russian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/tr-tr/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/tr.png"
                                                 alt="Turkish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/uk-ua/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/uk.png"
                                                 alt="Ukrainian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/zh-cn/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                                 alt="Chinese Simplified">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                </ul>

                            </div>
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this,event)">
                                     3.4
                                    <span class="caret"></span>
                                </div>

                                <ul style="display:none;" class="clearfix" onclick="event.stopPropagation();">
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.4/ru-ru/application-micro">
                                            <span>3.4</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.3/ru-ru/application-micro">
                                            <span>3.3</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.2/ru-ru/application-micro">
                                            <span>3.2</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.1/ru-ru/application-micro">
                                            <span>3.1</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/4.0/ru-ru/application-micro">
                                            <span>4.0</span>
                                        </a>
                                    </li>
                                    
                                </ul>

                            </div>
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this, event)">
                                    
                                    <span class="caret"></span>
                                </div>
                                <ul style="display:none;">
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/forum" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/blog" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/resources" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/f" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/t" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/gab" target="_blank">
                                            
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/about">
                                    
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/sponsors">
                                    
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/fund">
                                    
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/download">
                                    
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>


    <div class="container-fluid article-page-wrap">
        <div class="row">
            <div>
                <div class="col-md-2 sidebar hidden-xs">
                    <div class="sidebar--spacer">&nbsp;</div>
                </div>
                <div class="m-t-md m-b-lg" id="articles">
                    <div class="article-content">
                        







                        <section class="documentation-section">
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-md-8 col-lg-9 parse-content">
                                        <div>
                                            <a class="article-content-edit-link pull-right"
                                               href="https://crowdin.com/project/phalcon-documentation/ru-ru">
                                                
                                            </a>
                                            <br>
                                        </div>
                                        <h1 id="Микроприложения">Микроприложения</h1>

<p>С помощью Phalcon можно создавать приложения по типу “Микрофреймворк”. Для этого, необходимо написать всего лишь несколько строк кода.</p>

<p>Микроприложения подходят для небольших приложений, которые будут иметь очень низкие накладные расходы. Such applications are for instance our `<a href="https://github.com/phalcon/website">website</a>, this website (<a href="https://github.com/phalcon/docs">docs</a>), our <a href="https://github.com/phalcon/store">store</a>, APIs, prototypes etc.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro;

$app = new Micro();

$app-&gt;get(
    '/orders/display/{name}',
    function ($name) {
        echo "&lt;h1&gt;Это заказ: {$name}!&lt;/h1&gt;";
    }
);

$app-&gt;handle();
</code></pre>

<p><a name="creating-micro-applications"></a></p>

<h2 id="Создание-микроприложения">Создание микроприложения</h2>

<p>The <a href="api/Phalcon_Mvc_Micro">Phalcon\Mvc\Micro</a> class is the one responsible for creating a Micro application.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro;

$app = new Micro();
</code></pre>

<p><a name="routing"></a></p>

<h2 id="Маршрутизация-роутинг">Маршрутизация (роутинг)</h2>

<p>Defining routes in a <a href="api/Phalcon_Mvc_Micro">Phalcon\Mvc\Micro</a> application is very easy. Routes are defined as follows:</p>

<pre><code class="language-text">   Приложение -&gt; (метод/глагол) -&gt; (url адрес/регулярное выражение, вызываемая функция PHP)
</code></pre>

<p><a name="routing-setup"></a></p>

<h3 id="Настройка">Настройка</h3>

<p>Routing is handled by the <a href="api/Phalcon_Mvc_Router">Phalcon\Mvc\Router</a> object. [<a href="/3.4/en/routing">Info</a>]</p>

<h5 class="alert alert-warning">Маршруты всегда должны начинаться с <code>/</code></h5>

<p>Обычно, <code>/</code> является стартовым маршрутом приложения, и в большинстве случаев осуществляется через метод GET протокола HTTP:</p>

<pre><code class="language-php">&lt;?php

// Это стартовый маршрут
$app-&gt;get(
    '/',
    function () {
        echo '&lt;h1&gt;Welcome!&lt;/h1&gt;';
    }
);
</code></pre>

<p><a name="routing-setup-application"></a></p>

<h3 id="Объект-application">Объект Application</h3>

<p>Routes can be set using the <a href="api/Phalcon_Mvc_Micro">Phalcon\Mvc\Micro</a> application object as follows:</p>

<pre><code class="language-php">use Phalcon\Mvc\Micro;

$app = new Micro();

// Соответствия для GET запроса
$app-&gt;get(
    '/orders/display/{name}',
    function ($name) {
        echo "&lt;h1&gt;This is order: {$name}!&lt;/h1&gt;";
    }
);
</code></pre>

<p><a name="routing-setup-router"></a></p>

<h3 id="Объект-router">Объект Router</h3>

<p>You can also create a <a href="api/Phalcon_Mvc_Router">Phalcon\Mvc\Router</a> object, setting the routes there and then injecting it in the dependency injection container.</p>

<pre><code class="language-php">use Phalcon\Mvc\Micro;
use Phalcon\Mvc\Router;

$router = new Router();

$router-&gt;addGet(
    '/orders/display/{name}',
    'OrdersClass::display';
    }
);


$app = new Micro();
$app-&gt;setService('router', $router, true);
</code></pre>

<p>Setting up your routes using the <a href="api/Phalcon_Mvc_Micro">Phalcon\Mvc\Micro</a> applications verb methods (<code>get</code>, <code>post</code>, etc.) is much easier than setting up a router object with relevant routes and then injecting it in the application.</p>

<p>Each method has its advantages and disadvantages. It all depends on the design and needs of your application.</p>

<p><a name="rewrite-rules"></a></p>

<h2 id="rewrite-правила">Rewrite правила</h2>

<p>Для того чтобы маршруты работали необходимо также внести изменения в конфигурацию, вашего, веб-сервера для, вашего, конкретного сайта.</p>

<p>Those changes are outlined in the <a href="/3.4/en/rewrite-rules">rewrite rules</a>.</p>

<p><a name="routing-handlers"></a></p>

<h2 id="Обработчики">Обработчики</h2>

<p>Обработчик — это вызываемая часть кода, которая “привязана” к маршруту. При совпадении с маршрутом, его обработчик выполняется с заданными параметрами. Обработчиком может быть любая вызываемая часть кода, которая существует в PHP.</p>

<p><a name="routing-handlers-definitions"></a></p>

<h3 id="Определения">Определения</h3>

<p>Phalcon offers several ways to attach a handler to a route. Your application needs and design as well as coding style will be the factors influencing your choice of implementation.</p>

<p><a name="routing-handlers-anonymous-function"></a></p>

<h4 id="Анонимная-Функция">Анонимная Функция</h4>

<p>Мы можем использовать анонимные функции (как показано ниже) для обработки запроса</p>

<pre><code class="language-php">$app-&gt;get(
    '/orders/display/{name}',
    function ($name) {
        echo "&lt;h1&gt;Это заказ: {$name}!&lt;/h1&gt;";
    }
);
</code></pre>

<p>Доступ к объекту <code>$app</code>, внутри анонимной функции может достигаться путем инъекций переменой следующим образом:</p>

<pre><code class="language-php">$app-&gt;get(
    '/orders/display/{name}',
    function ($name) use ($app) {
        $context = "&lt;h1&gt;Это заказ: {$name}!&lt;/h1&gt;";
        $app-&gt;response-&gt;setContext($context);
        $app-&gt;response-&gt;send();
    }
);
</code></pre>

<p><a name="routing-handlers-function"></a></p>

<h4 id="Функция">Функция</h4>

<p>Мы можем определить функцию как обработчик и прикрепить её к определенному маршруту.</p>

<pre><code class="language-php">// Определение функции
function order_display($name) {
    echo "&lt;h1&gt;Это заказа: {$name}!&lt;/h1&gt;";
}

$app-&gt;get(
    '/orders/display/{name}',
    'orders_display'
);
</code></pre>

<p><a name="routing-handlers-static-method"></a></p>

<h4 id="Статический-метод">Статический метод</h4>

<p>Также возможно использовать статический метод класса в качестве обработчика:</p>

<pre><code class="language-php">class OrdersClass
{
    public static function display($name) {
        echo "&lt;h1&gt;Это заказ: {$name}!&lt;/h1&gt;";
    }
}

$app-&gt;get(
    '/orders/display/{name}',
    'OrdersClass::display'
);
</code></pre>

<p><a name="routing-handlers-object-method"></a></p>

<h4 id="Метод-объекта">Метод объекта</h4>

<p>Мы также можем использовать метод экземпляра объекта:</p>

<pre><code class="language-php">class OrdersClass
{
    public function display($name) {
        echo "&lt;h1&gt;Это заказ: {$name}!&lt;/h1&gt;";
    }
}

$orders = new OrdersClass();
$app-&gt;get(
    '/orders/display/{name}',
    [
        $orders,
        'display',
    ]
);
</code></pre>

<p><a name="routing-handlers-controllers"></a></p>

<h4 id="Контроллеры">Контроллеры</h4>

<p>With the <a href="api/Phalcon_Mvc_Micro">Phalcon\Mvc\Micro</a> you can create micro or medium applications. Средне-сложные приложения используют микро-архитектуру, но расширяют её, таким образом являясь компромиссом между микро- и полноценными приложениями.</p>

<p>В средне-сложных приложениях вы можете организовывать обработчики в контроллеры.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro\Collection as MicroCollection;

$orders = new MicroCollection();

// Установка главного обработчика, т.е. экземпляра контроллера
$orders-&gt;setHandler(new OrdersController());

// Установка основного префикса для всех маршрутов
$orders-&gt;setPrefix('/orders');

// Использовать метод 'index' контроллера OrdersController
$orders-&gt;get('/', 'index');

// Использовать метод 'show' контроллера OrdersController
$orders-&gt;get('/display/{slug}', 'show');

$app-&gt;mount($orders);
</code></pre>

<p>Контроллер <code>OrdersController</code> может выглядеть следующим образом:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Controller;

class OrdersController extends Controller
{
    public function index()
    {
        // ...
    }

    public function show($name)
    {
        // ...
    }
}
</code></pre>

<p>Since our controllers extend the <a href="api/Phalcon_Mvc_Controller">Phalcon\Mvc\Controller</a>, all the dependency injection services are available with their respective registration names. For example:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Controller;

class OrdersController extends Controller
{
    public function index()
    {
        // ...
    }

    public function show($name)
    {
        $context = "&lt;h1&gt;Это заказ: {$name}!&lt;/h1&gt;";
        $this-&gt;response-&gt;setContext($context);

        return $this-&gt;response;
    }
}
</code></pre>

<p><a name="routing-handlers-controllers-lazy-loading"></a></p>

<h3 id="Загрузка-по-требованию">Загрузка по требованию</h3>

<p>In order to increase performance, you might consider implementing lazy loading for your controllers (handlers). The controller will be loaded only if the relevant route is matched.</p>

<p>Lazy loading can be easily achieved when setting your handler in your <a href="api/Phalcon_Mvc_Micro_Collection">Phalcon\Mvc\Micro\Collection</a>:</p>

<pre><code class="language-php">$orders-&gt;setHandler('OrdersController', true);
$orders-&gt;setHandler('Blog\Controllers\OrdersController', true);
</code></pre>

<p><a name="routing-handlers-controllers-lazy-loading-use-case"></a></p>

<h4 id="Пример-использования">Пример использования</h4>

<p>Предположим мы занимаемся разработкой API для интернет-магазина. Конечные точки <code>/users</code>, <code>/orders</code> и <code>/products</code>. Каждая из этих конечных точек зарегистрирована с использованием обработчиков, каждый обработчик это контроллер с соответствующими действиями.</p>

<p>Контроллеры, которые мы используем, как обработчики, выглядят следующим образом:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Controller;

class UsersController extends Controller
{
    public function get($id)
    {
        // ...
    }

    public function add($payload)
    {
        // ...
    }
}

class OrdersController extends Controller
{
    public function get($id)
    {
        // ...
    }

    public function add($payload)
    {
        // ...
    }
}

class ProductsController extends Controller
{
    public function get($id)
    {
        // ...
    }

    public function add($payload)
    {
        // ...
    }
}
</code></pre>

<p>Мы зарегистрировать обработчики:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro\Collection as MicroCollection;

// Обработчик Users
$users = new MicroCollection();
$users-&gt;setHandler(new UsersController());
$users-&gt;setPrefix('/users');
$users-&gt;get('/get/{id}', 'get');
$users-&gt;get('/add/{payload}', 'add');
$app-&gt;mount($users);

// Обработчик Orders
$orders = new MicroCollection();
$orders-&gt;setHandler(new OrdersController());
$orders-&gt;setPrefix('/users');
$orders-&gt;get('/get/{id}', 'get');
$orders-&gt;get('/add/{payload}', 'add');
$app-&gt;mount($orders);

// Обработчик Products
$products = new MicroCollection();
$products-&gt;setHandler(new ProductsController());
$products-&gt;setPrefix('/products');
$products-&gt;get('/get/{id}', 'get');
$products-&gt;get('/add/{payload}', 'add');
$app-&gt;mount($products);
</code></pre>

<p>Эта реализация загружает каждый обработчик по очереди и монтирует их в наш объект приложения. Проблема этого подхода в том, что каждый запрос приведет только в одну конечную точку, и будет выполнен только один метод класса. Остальные методы/обработчики просто останутся в памяти и не будут использованы.</p>

<p>Используя загрузку по запросу мы уменьшаем количество загруженных в память объектов, и в результате наше приложение использует меньше памяти.</p>

<p>Реализация выше изменяется, если мы желаем использовать загрузку по запросу, и будет выглядеть следующим образом:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro\Collection as MicroCollection;

// Обработчик Users
$users = new MicroCollection();
$users-&gt;setHandler(new UsersController(), true);
$users-&gt;setPrefix('/users');
$users-&gt;get('/get/{id}', 'get');
$users-&gt;get('/add/{payload}', 'add');
$app-&gt;mount($users);

// Обработчик Orders
$orders = new MicroCollection();
$orders-&gt;setHandler(new OrdersController(), true);
$orders-&gt;setPrefix('/users');
$orders-&gt;get('/get/{id}', 'get');
$orders-&gt;get('/add/{payload}', 'add');
$app-&gt;mount($orders);

// Обработчик Products
$products = new MicroCollection();
$products-&gt;setHandler(new ProductsController(), true);
$products-&gt;setPrefix('/products');
$products-&gt;get('/get/{id}', 'get');
$products-&gt;get('/add/{payload}', 'add');
$app-&gt;mount($products);
</code></pre>

<p>Используя это простое изменение в реализации, все обработчики остаются не созданными, пока не будут запрошены вызывающим. Поэтому когда вызывающий запрашивает <code>/orders/get/2</code>, наше приложение создаст экземпляр <code>OrdersController</code> и вызовет в нем метод <code>get</code>. Теперь наше приложение использует меньше ресурсов, чем прежде.</p>

<p><a name="routing-handlers-not-found"></a></p>

<h3 id="Не-найдено-404">Не найдено (404)</h3>

<p>Any route that has not been matched in our <a href="api/Phalcon_Mvc_Micro">Phalcon\Mvc\Micro</a> application will cause it to try and execute the handler defined with the <code>notFound</code> method. Аналогично для других методов/действий (<code>get</code>, <code>post</code> и т. д.), Вы можете зарегистрировать обработчик с помощью метода <code>notFound</code>, который может быть любой вызываемой PHP функцией.</p>

<pre><code class="language-php">&lt;?php

$app-&gt;notFound(
    function () use ($app) {
        $app-&gt;response-&gt;setStatusCode(404, 'Не найдено');
        $app-&gt;response-&gt;sendHeaders();

        $message = 'Не на что здесь смотреть. Продолжаем....';
        $app-&gt;response-&gt;setContent($message);
        $app-&gt;response-&gt;send();
    }
);
</code></pre>

<p>Также, вы можете обрабатывать маршруты, которые не были сопоставлены (404) с помощью middleware, обсуждаемых ниже.</p>

<p><a name="routing-verbs"></a></p>

<h2 id="Методы-глаголы">Методы-глаголы</h2>

<p>The <a href="api/Phalcon_Mvc_Micro">Phalcon\Mvc\Micro</a> application provides a set of methods to bind the HTTP method with the route it is intended to.</p>

<p><a name="routing-verbs-delete"></a></p>

<h3 id="delete">delete</h3>

<p>Пример ниже сработает если HTTP-метод будет <code>DELETE</code> и маршрут соответствовать <code>/api/products/delete/{id}</code></p>

<pre><code class="language-php">    $app-&gt;delete(
        '/api/products/delete/{id}',
        'delete_product'
    );
</code></pre>

<p><a name="routing-verbs-get"></a></p>

<h3 id="get">get</h3>

<p>Пример ниже сработает если HTTP-метод будет <code>GET</code>, а маршрут равен <code>/api/products</code></p>

<pre><code class="language-php">    $app-&gt;get(
        '/api/products',
        'get_products'
    );
</code></pre>

<p><a name="routing-verbs-head"></a></p>

<h3 id="head">head</h3>

<p>Сработает, если HTTP метод будет <code>HEAD</code>, а маршурт <code>/api/products</code></p>

<pre><code class="language-php">    $app-&gt;get(
        '/api/products',
        'get_products'
    );
</code></pre>

<p><a name="routing-verbs-map"></a></p>

<h3 id="map">map</h3>

<p>Map позволяет назначить одну и ту же конечную точку для более чем одного HTTP метода. Пример ниже сработает, если HTTP метод будет <code>GET</code> или <code>POST</code>, а маршрут <code>/repos/store/refs</code></p>

<pre><code class="language-php">    $app
        -&gt;map(
            '/repos/store/refs',
            'action_product'
        )
        -&gt;via(
            [
                'GET',
                'POST',
            ]
        );
</code></pre>

<p><a name="routing-verbs-options"></a></p>

<h3 id="options">options</h3>

<p>Сработает, если HTTP метод будет <code>OPTIONS</code>, а маршрут <code>/api/products/options</code></p>

<pre><code class="language-php">    $app-&gt;options(
        '/api/products/options',
        'info_product'
    );
</code></pre>

<p><a name="routing-verbs-patch"></a></p>

<h3 id="patch">patch</h3>

<p>Сработает, если HTTP методбудет <code>PATCH</code>, а маршрут <code>/api/products/update/{id}</code></p>

<pre><code class="language-php">    $app-&gt;patch(
        '/api/products/update/{id}',
        'update_product'
    );
</code></pre>

<p><a name="routing-verbs-post"></a></p>

<h3 id="post">post</h3>

<p>Сработает, есди HTTP метод будет <code>POST</code>, а маршрут <code>/api/products/add</code></p>

<pre><code class="language-php">    $app-&gt;post(
        '/api/products',
        'add_product'
    );
</code></pre>

<p><a name="routing-verbs-put"></a></p>

<h3 id="put">put</h3>

<p>Сработает, если HTTP метод будет <code>PUT</code>, а маршрут<code>/api/products/update/{id}</code></p>

<pre><code class="language-php">    $app-&gt;put(
        '/api/products/update/{id}',
        'update_product'
    );
</code></pre>

<p><a name="routing-collections"></a></p>

<h2 id="Коллекции">Коллекции</h2>

<p>Collections are a handy way to group collections attached to a handler and a common prefix (if needed). For a hypothetical <code>/orders</code> endpoint we could have the following endpoints:</p>

<pre><code>/orders/get/{id}
/orders/add/{payload}
/orders/update/{id}
/orders/delete/{id}
</code></pre>

<p>All of those routes are handled by our <code>OrdersController</code>. We set up our routes with a collection as follows:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro\Collection as MicroCollection;

$orders = new MicroCollection();
$orders-&gt;setHandler(new OrdersController());

$orders-&gt;setPrefix('/orders');

$orders-&gt;get('/get/{id}', 'displayAction');
$orders-&gt;get('/add/{payload}', 'addAction');
$orders-&gt;get('/update/{id}', 'updateAction');
$orders-&gt;get('/delete/{id}', 'deleteAction');

$app-&gt;mount($orders);
</code></pre>

<h5 class="alert alert-warning">The name that we bind each route has a suffix of <code>Action</code>. This is not necessary, your method can be called anything you like.</h5>

<p><a name="routing-parameters"></a></p>

<h2 id="Параметры">Параметры</h2>

<p>We have briefly seen above how parameters are defined in the routes. Parameters are set in a route string by enclosing the name of the parameter in brackets.</p>

<pre><code class="language-php">$app-&gt;get(
    '/orders/display/{name}',
    function ($name) {
        echo "&lt;h1&gt;Это заказ: {$name}!&lt;/h1&gt;";
    }
);
</code></pre>

<p>We can also enforce certain rules for each parameter by using regular expressions. The regular expression is set after the name of the parameter, separating it with <code>:</code>.</p>

<pre><code class="language-php">// Сопоставить order id
$app-&gt;get(
    '/orders/display/{id:[0-9]+}',
    function ($id) {
        echo "&lt;h1&gt;This is order: #{$id}!&lt;/h1&gt;";
    }
);

// Сопоставить год (4 числа) и заголовок (буквы)
$app-&gt;get(
    '/posts/{year:[0-9][4]}/{title:[a-zA-Z\-]+}',
    function ($year, $title) {
        echo '&lt;h1&gt;Заголовок: $title&lt;/h1&gt;';
        echo '&lt;h2&gt;Год: $year&lt;/h2&gt;';
    }
);
</code></pre>

<p>Additional information: <a href="api/Phalcon_Mvc_Router">Phalcon\Mvc\Router</a> <a href="/3.4/en/routing">Info</a></p>

<p><a name="routing-redirections"></a></p>

<h2 id="Перенаправления">Перенаправления</h2>

<p>You can redirect one matched route to another using the <a href="api/Phalcon_Http_Response">Phalcon\Http\Response</a> object, just like in a full application.</p>

<pre><code class="language-php">$app-&gt;post('/old/url',
    function () use ($app) {
        $app-&gt;response-&gt;redirect('new/url');
        $app-&gt;response-&gt;sendHeaders();
    }
);

$app-&gt;post('/new/welcome',
    function () use ($app) {
        echo 'This is the new Welcome';
    }
);
</code></pre>

<p><strong>Примечание</strong> мы должны передать объект <code>$app</code> в нашу анонимную функцию, чтобы иметь доступ к объекту <code>request</code>.</p>

<p>Когда контроллеры используются в качестве обработчиков, Вы можете выполнить перенаправление очень просто:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Controller;

class UsersController extends Controller
{
    public function oldget($id)
    {
        return $this-&gt;response-&gt;redirect('users/get/' . $id);
    }

    public function get($id)
    {
        // ...
    }
}
</code></pre>

<p>Finally, you can perform redirections in your middleware (if you are using it). An example is below in the relevant section.</p>

<p><a name="routing-urls-for-routes"></a></p>

<h2 id="url-адреса-для-маршрутов">URL-адреса для маршрутов</h2>

<p>Другая возможность маршрутизации — настройка именованных маршрутов и генерация URL-адресов для этих маршрутов. Это двухшаговый процесс.</p>

<ul>
  <li>First we need to name our route. Это может быть достигнуто с помощью метода <code>setName()</code>, который доступен из методов-глаголов в нашем приложении (<code>get</code>, <code>post</code>, и т. д.);</li>
</ul>

<pre><code class="language-php">// Задать маршрут с именем 'show-order'
$app
    -&gt;get(
        '/orders/display/{id}',
        function ($id) use ($app) {
            // ... Найти заказ и показать его
        }
    )
    -&gt;setName('show-order');
</code></pre>

<ul>
  <li>We need to use the <a href="api/Phalcon_Mvc_Url">Phalcon\Mvc\Url</a> component to generate URLs for the named routes.</li>
</ul>

<pre><code class="language-php">// Используем именованный маршрут и создаем URL от него
$app-&gt;get(
    '/',
    function () use ($app) {
        $url = sprintf(
            '&lt;a href="%s"&gt;Show the order&lt;/a&gt;',
            $app-&gt;url-&gt;get(
                [
                    'for' =&gt; 'show-order',
                    'id'  =&gt; 1234,
                ]
            )
        );

        echo $url;
    }
);
</code></pre>

<p><a name="dependency-injector"></a></p>

<h1 id="Внедрение-зависимостей">Внедрение зависимостей</h1>

<p>When a micro application is created, a <a href="api/Phalcon_Di_FactoryDefault">Phalcon\Di\FactoryDefault</a> services container is create implicitly.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro;
$app = new Micro();

$app-&gt;get(
    '/',
    function () use ($app) {
        $app-&gt;response-&gt;setContent('Hello!!');
        $app-&gt;response-&gt;send();
    }
);
</code></pre>

<p>Кроме того, вы можете создать Di контейнер самостоятельно, и назначить его микроприложению. Таким образом, манипуляция сервисами полностью будет зависеть от нужд вашего приложения.</p>

<pre><code class="language-php">use Phalcon\Mvc\Micro;
use Phalcon\Di\FactoryDefault;
use Phalcon\Config\Adapter\Ini as IniConfig;

$di = new FactoryDefault();

$di-&gt;set(
    'config',
    function () {
        return new IniConfig('config.ini');
    }
);

$app = new Micro();

$app-&gt;setDI($di);

$app-&gt;get(
    '/',
    function () use ($app) {
        // Читаем настройки из конфига
        echo $app-&gt;config-&gt;app_name;
    }
);

$app-&gt;post(
    '/contact',
    function () use ($app) {
        $app-&gt;flash-&gt;success('Что ты делаешь Дэйв?');
    }
);
</code></pre>

<p>Также вы можете использовать синтаксис массивов, чтобы зарегистрировать сервисы в контейнере зависимостей из объекта приложения:</p>

<pre><code class="language-php">&lt;br /&gt;&amp;lt;?php

use Phalcon\Mvc\Micro;
use Phalcon\Db\Adapter\Pdo\Mysql as MysqlAdapter;

$app = new Micro();

// Настройка сервиса базы данных
$app['db'] = function () {
    return new MysqlAdapter(
        [
            'host'     =&amp;gt; 'localhost',
            'username' =&amp;gt; 'root',
            'password' =&amp;gt; 'secret',
            'dbname'   =&amp;gt; 'test_db',
        ]
    );
};

$app-&amp;gt;get(
    '/blog',
    function () use ($app) {
        $news = $app['db']-&amp;gt;query('SELECT * FROM news');

        foreach ($news as $new) {
            echo $new-&amp;gt;title;
        }
    }
);
</code></pre>

<p><a name="responses"></a></p>

<h1 id="Ответы">Ответы</h1>

<p>A micro application can return many different types of responses. Direct output, use a template engine, calculated data, view based data, JSON etc.</p>

<p>Handlers may return raw responses using plain text, <a href="api/Phalcon_Http_Response">Phalcon\Http\Response</a> object or a custom built component that implements the <a href="api/Phalcon_Http_ResponseInterface">Phalcon\Http\ResponseInterface</a>.</p>

<p><a name="responses-direct-output"></a></p>

<h2 id="Прямой-вывод">Прямой вывод</h2>

<pre><code class="language-php">$app-&gt;get(
    '/orders/display/{name}',
    function ($name) {
        echo "&lt;h1&gt;Это заказ: {$name}!&lt;/h1&gt;";
    }
);
</code></pre>

<p><a name="responses-include"></a></p>

<h2 id="Подключение-внешнего-файла">Подключение внешнего файла</h2>

<pre><code class="language-php">$app-&gt;get(
    '/orders/display/{name}',
    function ($name) {
        require 'views/results.php';
    }
);
</code></pre>

<p><a name="responses-direct-output-json"></a></p>

<h2 id="Прямой-вывод-json">Прямой вывод JSON</h2>

<pre><code class="language-php">$app-&gt;get(
    '/orders/display/{name}',
    function ($name) {
        echo json_encode(
            [
                'code' =&gt; 200,
                'name' =&gt; $name,
            ]
        );
    }
);
</code></pre>

<p><a name="responses-new-response-object"></a></p>

<h2 id="Новый-объект-response">Новый объект Response</h2>

<p>Вы можете использовать метод <code>setContent</code> объекта Response, чтобы вернуть ответ:</p>

<pre><code class="language-php">$app-&gt;get(
    '/show/data',
    function () {
        // Создание ответа
        $response = new Phalcon\Http\Response();

        // Установка заголовка Content-Type
        $response-&gt;setContentType('text/plain');

        // Передача контента из файла
        $response-&gt;setContent(file_get_contents('data.txt'));

        // Возврат ответа
        return $response;
    }
);
</code></pre>

<p><a name="responses-application-response"></a></p>

<h2 id="Ответ-приложения">Ответ приложения</h2>

<p>You can also use the <a href="api/Phalcon_Http_Response">Phalcon\Http\Response</a> object to return responses to the caller. The response object has a lot of useful methods that make returning respones much easier.</p>

<pre><code class="language-php">$app-&gt;get(
    '/show/data',
    function () use ($app) {
        // Установка заголовка Content-Type
        $app-&gt;response-&gt;setContentType('text/plain');
        $app-&gt;response-&gt;sendHeaders();

        // Вывод файла
        readfile('data.txt');
    }
);
</code></pre>

<p><a name="responses-return-application-response"></a></p>

<h2 id="Возврат-ответа-приложения">Возврат ответа приложения</h2>

<p>Другим подходом возврата данных обратно вызывающей стороне является возвращения объекта Response напрямую из приложения. Когда ответы возвращаются обработчиками они автоматически отправляются приложением.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro;
use Phalcon\Http\Response;

$app = new Micro();

// Возврат объекта Response
$app-&gt;get(
    '/welcome/index',
    function () {
        $response = new Response();

        $response-&gt;setStatusCode(401, 'Не авторизован');
        $response-&gt;setContent('Доступ не авторизован');

        return $response;
    }
);
</code></pre>

<p><a name="responses-json"></a></p>

<h2 id="json">JSON</h2>

<p>JSON can be sent back just as easy using the <a href="api/Phalcon_Http_Response">Phalcon\Http\Response</a> object:</p>

<pre><code class="language-php">$app-&gt;get(
    '/welcome/index',
    function () use ($app) {

        $data = [
            'code'    =&gt; 401,
            'status'  =&gt; 'error',
            'message' =&gt; 'Не авторизированный доступ',
            'payload' =&gt; [],
        ];

        $response-&gt;setJsonContent($data);

        return $response;
    }
);
</code></pre>

<p><a name="events"></a></p>

<h1 id="События">События</h1>

<p>A <a href="api/Phalcon_Mvc_Micro">Phalcon\Mvc\Micro</a> application works closely with a <a href="api/Phalcon_Events_Manager">Phalcon\Events\Manager</a> if it is present, to trigger events that can be used throughout our application. Тип этих событий — <code>micro</code>. Эти события вызываются в нашем приложение и могут быть прикреплены к соответствующим обработчикам, которые будут выполнять действия необходимые нашему приложению.</p>

<p><a name="events-available-events"></a></p>

<h2 id="Доступные-события">Доступные события</h2>

<p>Поддерживаются следующие события:</p>

<table>
  <thead>
    <tr>
      <th>Название события</th>
      <th>Срабатывает</th>
      <th style="text-align: center">Может остановить операцию?</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>beforeHandleRoute</td>
      <td>Основной метод вызван; Маршруты ее не проверены</td>
      <td style="text-align: center">Да</td>
    </tr>
    <tr>
      <td>beforeExecuteRoute</td>
      <td>Маршрут сопоставлен, обработчик верный, но еще не выполнен</td>
      <td style="text-align: center">Да</td>
    </tr>
    <tr>
      <td>afterExecuteRoute</td>
      <td>Обработчик только что закончил работать</td>
      <td style="text-align: center">Нет</td>
    </tr>
    <tr>
      <td>beforeNotFound</td>
      <td>Маршрут не найден</td>
      <td style="text-align: center">Да</td>
    </tr>
    <tr>
      <td>afterHandleRoute</td>
      <td>Маршрут только что закончил выполнение</td>
      <td style="text-align: center">Да</td>
    </tr>
    <tr>
      <td>afterBinding</td>
      <td>Срабатывает после того, как модели связаны, но перед выполнением обработчика</td>
      <td style="text-align: center">Да</td>
    </tr>
  </tbody>
</table>

<p><a name="events-available-events-authentication"></a></p>

<h3 id="Пример-Аутентификация">Пример: Аутентификация</h3>

<p>Вы легко можете проверить был ли пользователь аутентифицирован или нет используя событие <code>beforeExecuteRoute</code>. В следующем примере, мы рассмотрим как контролировать безопасность приложения используя событийную модель:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro;
use Phalcon\Events\Event;
use Phalcon\Events\Manager as EventsManager;

// Создаем менеджер событий
$eventsManager = new EventsManager();

$eventsManager-&gt;attach(
    'micro:beforeExecuteRoute',
    function (Event $event, $app) {
        if ($app-&gt;session-&gt;get('auth') === false) {
            $app-&gt;flashSession-&gt;error("The user isn't authenticated");

            $app-&gt;response-&gt;redirect('/');
            $app-&gt;response-&gt;sendHeaders();

            // Возврат (false) останавливает операцию
            return false;
        }
    }
);

$app = new Micro();

// Привязываем менеджер событий к приложению
$app-&gt;setEventsManager($eventsManager);
</code></pre>

<p><a name="events-available-events-not-found"></a></p>

<h3 id="Пример-Страница-не-найдена">Пример: Страница не найдена</h3>

<p>Вы легко можете проверить был ли пользователь аутентифицирован или нет используя событие <code>beforeExecuteRoute</code>. В следующем примере, мы рассмотрим как контролировать безопасность приложения используя событийную модель:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro;
use Phalcon\Events\Event;
use Phalcon\Events\Manager as EventsManager;

// Создаем менеджер событий
$eventsManager = new EventsManager();

$eventsManager-&gt;attach(
    'micro:beforeNotFound',
    function (Event $event, $app) {
        $app-&gt;response-&gt;redirect('/404');
        $app-&gt;response-&gt;sendHeaders();

        return $app-&gt;response;
    }
);

$app = new Micro();

// Привязываем менеджер событий к приложению
$app-&gt;setEventsManager($eventsManager);
</code></pre>

<p><a name="middleware"></a></p>

<h1 id="middleware">Middleware</h1>

<p>Middleware — это классы, которые могут быть прикреплены к вашему приложению, с целью ввести ещё один слой, для обработки бизнес-логики. Они запускаются последовательно, в соответствии с порядком регистрации и не только улучшают гибкость, путем инкапсуляции специфичной функциональности, но также повышают производительность. Middleware может остановить выполнение, когда конкретное бизнес-правило не было удовлетворенно. Это дает возможность приложению завершить работу на ранней стадии, без выполнения полного цикла запроса.</p>

<p>The presence of a <a href="api/Phalcon_Events_Manager">Phalcon\Events\Manager</a> is essential for middleware to operate, so it has to be registered in our Di container.</p>

<p><a name="middleware-attached-events"></a></p>

<h2 id="Прикреплённые-события">Прикреплённые события</h2>

<p>Middleware can be attached to a micro application in 3 different events. Those are:</p>

<table>
  <thead>
    <tr>
      <th>Событие</th>
      <th>Описание</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>before</td>
      <td>Перед выполнением обработчика</td>
    </tr>
    <tr>
      <td>after</td>
      <td>После выполнения обработчика</td>
    </tr>
    <tr>
      <td>final</td>
      <td>После того, как был отправлен ответ вызывающему</td>
    </tr>
  </tbody>
</table>

<h5 class="alert alert-warning">You can attach as many middleware classes as you want in each of the above events. They will be executed sequentially when the relevant event fires.</h5>

<p><a name="middleware-attached-events-before"></a></p>

<h3 id="before">before</h3>

<p>Это событие идеально для остановки выполнения приложения, когда определенный критерий не соблюден. В примере ниже, мы проверяем был ли пользователь авторизован и останавливаем выполнение с необходимым перенаправлением.</p>

<pre><code class="language-php">&lt;?php

$app = new Phalcon\Mvc\Micro();

// Вызывается перед выполнением каждого маршрута
// Возврат false отменяет выполнение маршрута
$app-&gt;before(
    function () use ($app) {
        if (false === $app['session']-&gt;get('auth')) {
            $app['flashSession']-&gt;error("Пользователь не авторизован");

            $app['response']-&gt;redirect('/error');

            // Возврат false останавливает нормальное выполнение
            return false;
        }

        return true;
    }
);
</code></pre>

<p><a name="middleware-attached-events-after"></a></p>

<h3 id="after">after</h3>

<p>This event can be used to manipulate data or perform actions that are needed after the handler has finished executing. In the example below, we manipulate our response to send JSON back to the caller.</p>

<pre><code class="language-php">$app-&gt;map(
    '/api/robots',
    function () {
        return [
            'status' =&gt; 'OK',
        ];
    }
);

$app-&gt;after(
    function () use ($app) {
        // Выполняется после выполнения маршрута
        echo json_encode($app-&gt;getReturnedValue());
    }
);
</code></pre>

<p><a name="middleware-attached-events-finish"></a></p>

<h3 id="finish">finish</h3>

<p>This even will fire up when the whole request cycle has been completed. In the example below, we use it to clean up some cache files.</p>

<pre><code class="language-php">$app-&gt;finish(
    function () use ($app) {
        if (true === file_exists('/tmp/processing.cache')) {
            unlink('/tmp/processing.cache');
        }
    }
);
</code></pre>

<p><a name="middleware-setup"></a></p>

<h2 id="Настройка-1">Настройка</h2>

<p>Прикрепление middleware к вашему приложению происходит очень легко, как показано выше, с помощью вызова методов <code>before</code>, <code>after</code> и <code>finish</code>.</p>

<pre><code class="language-php">$app-&gt;before(
    function () use ($app) {
        if (false === $app['session']-&gt;get('auth')) {
            $app['flashSession']-&gt;error("Пользователь не авторизован");

            $app['response']-&gt;redirect('/error');

            // Возврат false останавливает нормальное выполнение
            return false;
        }

        return true;
    }
);

$app-&gt;after(
    function () use ($app) {
        // Выполняется после выполнения маршрута
        echo json_encode($app-&gt;getReturnedValue());
    }
);
</code></pre>

<p>Прикрепление middleware к вашему приложению, как классов прослушивающих события из менеджера событий, может быть достигнуто следующим образом:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Events\Manager;
use Phalcon\Mvc\Micro;

use Website\Middleware\CacheMiddleware;
use Website\Middleware\NotFoundMiddleware;
use Website\Middleware\ResponseMiddleware;

/**
 * Create a new Events Manager.
 */
$eventsManager = new Manager();
$application   = new Micro();

/**
 * Прикрепляем middleware к менеджеру событий и приложению 
*/
$eventsManager-&gt;attach('micro', new CacheMiddleware());
$application-&gt;before(new CacheMiddleware());

$eventsManager-&gt;attach('micro', new NotFoundMiddleware());
$application-&gt;before(new NotFoundMiddleware());

/**
 * Этот нужен, чтобы слушать событие `after`
 */
$eventsManager-&gt;attach('micro', new ResponseMiddleware());
$application-&gt;after(new ResponseMiddleware());

/**
 * Убедимся, что наш менеджер событий теперь находится в DI контейнере
 */
$application-&gt;setEventsManager($eventsManager);

</code></pre>

<p>We need a <a href="api/Phalcon_Events_Manager">Phalcon\Events\Manager</a> object. Это может быть вновь созданный экземпляр, или мы можем получить один из существующих в нашем DI контейнере (если вы использовали <code>FactoryDefault</code>).</p>

<p>We attach every middleware class in the <code>micro</code> hook in the Events Manager. We could also be a bit more specific and attach it to say the <code>micro:beforeExecuteRoute</code> event.</p>

<p>Затем мы прикрепляем класс middleware в наше приложение на одно из трех прослушиваемых событий, описанных выше (<code>before</code>, <code>after</code>, <code>finish</code>).</p>

<p><a name="middleware-implementation"></a></p>

<h2 id="Реализация">Реализация</h2>

<p>Middleware может быть любой вызываемой PHP функцией. Вы можете организовать код любым путем, который вам нравится, для реализации middleware. If you choose to use classes for your middleware, you will need them to implement the <a href="api/Phalcon_Mvc_Micro_MiddlewareInterface">Phalcon\Mvc\Micro\MiddlewareInterface</a></p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro;
use Phalcon\Mvc\Micro\MiddlewareInterface;

/**
 * CacheMiddleware
 *
 * Кэширует страницы, чтобы сократить обработку
 */
class CacheMiddleware implements MiddlewareInterface
{
    /**
     * Вызывает middleware
     *
     * @param Micro $application
     *
     * @returns bool
     */
    public function call(Micro $application)
    {
        $cache  = $application['cache'];
        $router = $application['router'];

        $key = preg_replace('/^[a-zA-Z0-9]/', '', $router-&gt;getRewriteUri());

        // Проверяет закэширован ли запрос
        if ($cache-&gt;exists($key)) {
            echo $cache-&gt;get($key);

            return false;
        }

        return true;
    }
}
</code></pre>

<p><a name="middleware-events"></a></p>

<h2 id="События-в-middleware">События в Middleware</h2>

<p>The <a href="#events">events</a> that are triggered for our application also trigger inside a class that implements the <a href="api/Phalcon_Mvc_Micro_MiddlewareInterface">Phalcon\Mvc\Micro\MiddlewareInterface</a>. Это обеспечивает большую гибкость и более широкие возможности для разработчиков, поскольку можем взаимодействовать с обработкой запроса.</p>

<p><a name="middleware-events-api"></a></p>

<h3 id="Пример-api">Пример API</h3>

<p>Предположим, у нас есть API, которое мы реализовали с помощью Micro приложения. Нам необходимо прикрепить различные Middleware классы к приложению, чтобы иметь возможность лучше контролировать его выполнение.</p>

<p>The middleware that we will use are:</p>

<ul>
  <li>Firewall</li>
  <li>NotFound</li>
  <li>Redirect</li>
  <li>CORS</li>
  <li>Request</li>
  <li>Response</li>
</ul>

<p><a name="middleware-events-api-firewall"></a></p>

<h4 id="firewall-middleware">Firewall Middleware</h4>

<p>Этот middleware прикрепляется к событию <code>before</code> нашего микроприложения. Цель этого middleware проверить, кто вызывает наше API, и опираясь на белый список, разрешает ему продолжить или нет</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Events\Event;
use Phalcon\Mvc\Micro;
use Phalcon\Mvc\Micro\MiddlewareInterface;

/**
 * FirewallMiddleware
 *
 * Проверяет белый список и допускает клиентов или нет
 */
class FirewallMiddleware implements MiddlewareInterface
{
    /**
     * Before anything happens
     *
     * @param Event $event
     * @param Micro $application
     *
     * @returns bool
     */
    public function beforeHandleRoute(Event $event, Micro $application)
    {
        $whitelist = [
            '10.4.6.1',
            '10.4.6.2',
            '10.4.6.3',
            '10.4.6.4',
        ];
        $ipAddress = $application-&gt;request-&gt;getClientAddress();

        if (true !== array_key_exists($ipAddress, $whitelist)) {
            $this-&gt;response-&gt;redirect('/401');
            $this-&gt;response-&gt;send();

            return false;
        }

        return true;
    }

    /**
     * Вызывает middleware
     *
     * @param Micro $application
     *
     * @returns bool
     */
    public function call(Micro $application)
    {
        return true;
    }
}
</code></pre>

<p><a name="middleware-events-api-not-found"></a></p>

<h4 id="not-found-middleware">Not Found Middleware</h4>

<p>Когда этот middleware обработан, это означает, что запрашивающему IP разрешен доступ к нашему приложению. Приложение попытается сопоставить маршрут, и если он не будет найден сработает событие <code>beforeNotFound</code>. Тогда мы прекратим обработку и вернем пользователю соответствующий ответ 404. Этот middleware прикреплен к событию <code>before</code> нашего Micro приложения</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro;
use Phalcon\Mvc\Micro\MiddlewareInterface;

/**
 * NotFoundMiddleware
 *
 * Обрабатывает 404
 */
class NotFoundMiddleware implements MiddlewareInterface
{
    /**
     * Маршрут не был найден
     *
     * @returns bool
     */
    public function beforeNotFound()
    {
        $this-&gt;response-&gt;redirect('/404');
        $this-&gt;response-&gt;send();

        return false;
    }

    /**
     * Вызывает middleware
     *
     * @param Micro $application
     *
     * @returns bool
     */
    public function call(Micro $application)
    {
        return true;
    }
}
</code></pre>

<p><a name="middleware-events-api-redirect"></a></p>

<h4 id="redirect-middleware">Redirect Middleware</h4>

<p>Мы прикрепляем этот middleware снова к событию <code>before</code> нашего Micro приложения, потому что мы не хотим, чтобы запрос продолжал обрабатываться, если запрашиваемая конечная точка должна быть перенаправлена.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Events\Event;
use Phalcon\Mvc\Micro;
use Phalcon\Mvc\Micro\MiddlewareInterface;

/**
 * RedirectMiddleware
 *
 * Проверяет запрос и перенаправляет пользователя куда-нибудь еще, если необходимо
 */
class RedirectMiddleware implements MiddlewareInterface
{
    /**
     * Прежде чем что-то произойдет
     *
     * @param Event $event
     * @param Micro $application
     *
     * @returns bool
     */
    public function beforeHandleRoute(Event $event, Micro $application)
    {
        if ('github' === $application-&gt;request-&gt;getURI()) {
            $application-&gt;response-&gt;redirect('https://github.com');
            $application-&gt;response-&gt;send();

            return false;
        }

        return true;
    }

    /**
     * Вызывает middleware
     *
     * @param Micro $application
     *
     * @returns bool
     */
    public function call(Micro $application)
    {
        return true;
    }
}
</code></pre>

<p><a name="middleware-events-api-cors"></a></p>

<h4 id="cors-middleware">CORS Middleware</h4>

<p>Again this middleware is attached to the <code>before</code> event of our Micro application. We need to ensure that it fires before anything happens with our application</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Events\Event;
use Phalcon\Mvc\Micro;
use Phalcon\Mvc\Micro\MiddlewareInterface;

/**
 * CORSMiddleware
 *
 * Проверка CORS
 */
class CORSMiddleware implements MiddlewareInterface
{
    /**
     * Прежде, чем что-нибудь случится
     *
     * @param Event $event
     * @param Micro $application
     *
     * @returns bool
     */
    public function beforeHandleRoute(Event $event, Micro $application)
    {
        if ($application-&gt;request-&gt;getHeader('ORIGIN')) {
            $origin = $application-&gt;request-&gt;getHeader('ORIGIN');
        } else {
            $origin = '*';
        }

        $application
            -&gt;response
            -&gt;setHeader('Access-Control-Allow-Origin', $origin)
            -&gt;setHeader(
                'Access-Control-Allow-Methods',
                'GET,PUT,POST,DELETE,OPTIONS'
            )
            -&gt;setHeader(
                'Access-Control-Allow-Headers',
                'Origin, X-Requested-With, Content-Range, ' .
                'Content-Disposition, Content-Type, Authorization'
            )
            -&gt;setHeader('Access-Control-Allow-Credentials', 'true');
    }

    /**
     * Вызывает middleware
     *
     * @param Micro $application
     *
     * @returns bool
     */
    public function call(Micro $application)
    {
        return true;
    }
}
</code></pre>

<p><a name="middleware-events-api-request"></a></p>

<h4 id="request-middleware">Request Middleware</h4>

<p>This middleware is receiving a JSON payload and checks it. If the JSON payload is not valid it will stop execution.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Events\Event;
use Phalcon\Mvc\Micro;
use Phalcon\Mvc\Micro\MiddlewareInterface;

/**
 * RequestMiddleware
 *
 * Проверяет входящие данные
 */
class RequestMiddleware implements MiddlewareInterface
{
    /**
     * Перед выполнением маршрута
     *
     * @param Event $event
     * @param Micro $application
     *
     * @returns bool
     */
    public function beforeExecuteRoute(Event $event, Micro $application)
    {
        json_decode($application-&gt;request-&gt;getRawBody());
        if (JSON_ERROR_NONE !== json_last_error()) {
            $application-&gt;response-&gt;redirect('/malformed');
            $application-&gt;response-&gt;send();

            return false;
        }

        return true;

    }

    /**
     * Вызывает middleware
     *
     * @param Micro $application
     *
     * @returns bool
     */
    public function call(Micro $application)
    {
        return true;
    }
}
</code></pre>

<p><a name="middleware-events-api-response"></a></p>

<h4 id="response-middleware">Response Middleware</h4>

<p>Этот middleware отвечает за изменение нашего ответа и его отправку вызывающему в виде JSON строки. Следовательно, мы должны прикрепить его к событию <code>after</code> нашего Micro приложения.</p>

<h5 class="alert alert-warning">Мы будем использовать метод <code>call</code> для этого middleware, так как мы выполнили почти весь цикл запроса.</h5>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro;
use Phalcon\Mvc\Micro\MiddlewareInterface;

/**
* ResponseMiddleware
*
* Изменяет ответ
*/
class ResponseMiddleware implements MiddlewareInterface
{
     /**
      * Прежде, чем что-нибудь случится
      *
      * @param Micro $application
      *
      * @returns bool
      */
    public function call(Micro $application)
    {
        $payload = [
            'code'    =&gt; 200,
            'status'  =&gt; 'success',
            'message' =&gt; '',
            'payload' =&gt; $application-&gt;getReturnedValue(),
        ];

        $application-&gt;response-&gt;setJsonContent($payload);
        $application-&gt;response-&gt;send();

        return true;
    }
}
</code></pre>

<p><a name="models"></a></p>

<h1 id="Модели">Модели</h1>

<p>Модели могут быть использованы в Micro приложениях, до тех пор, пока мы инструктируем приложение, как оно может найти соответствующие классы с помощью автозагрузчика.</p>

<h5 class="alert alert-warning">Соответствующий<code>db</code> сервис должен быть зарегистрирован в Ваше DI контейнере.</h5>

<pre><code class="language-php">&lt;?php

$loader = new \Phalcon\Loader();
$loader
    -&gt;registerDirs(
        [
            __DIR__ . '/models/',
        ]
    )
    -&gt;register();

$app = new \Phalcon\Mvc\Micro();

$app-&gt;get(
    '/products/find',
    function () {
        $products = \MyModels\Products::find();

        foreach ($products as $product) {
            echo $product-&gt;name, '&lt;br&gt;';
        }
    }
);

$app-&gt;handle();
</code></pre>

<p><a name="model-instances"></a></p>

<h1 id="Внедрение-моделей">Внедрение моделей</h1>

<p>By using the <a href="api/Phalcon_Mvc_Model_Binder">Phalcon\Mvc\Model\Binder</a> class you can inject model instances into your routes:</p>

<pre><code class="language-php">&lt;?php

$loader = new \Phalcon\Loader();

$loader-&gt;registerDirs(
    [
        __DIR__ . '/models/',
    ]
)-&gt;register();

$app = new \Phalcon\Mvc\Micro();
$app-&gt;setModelBinder(new \Phalcon\Mvc\Model\Binder());

$app-&gt;get(
    "/products/{product:[0-9]+}",
    function (Products $product) {
        // делаем что-нибудь с объектом $product
    }
);

$app-&gt;handle();
</code></pre>

<p>Так как объект Binder использует внутренний Reflection Api, который может быть тяжелым, есть возможность установить кэш, чтобы ускорить этот процесс. Это можно выполнить используя второй аргумент метода <code>setModelBinder()</code>, который также может принимать имя сервиса, или просто передав экземпляр кэша в конструктор класса <code>Binder</code>.</p>

<p>Currently the binder will only use the models primary key to perform a <code>findFirst()</code> on. An example route for the above would be <code>/products/1</code>.</p>

<p><a name="views"></a></p>

<h1 id="Представления">Представления</h1>

<p><a href="api/Phalcon_Mvc_Micro">Phalcon\Mvc\Micro</a> does not have inherently a view service. We can however use the <a href="api/Phalcon_Mvc_View_Simple">Phalcon\Mvc\View\Simple</a> component to render views.</p>

<pre><code class="language-php">&lt;?php

$app = new Phalcon\Mvc\Micro();

$app['view'] = function () {
    $view = new \Phalcon\Mvc\View\Simple();

    $view-&gt;setViewsDir('app/views/');

    return $view;
};

// Вернуть отображенный вид
$app-&gt;get(
    '/products/show',
    function () use ($app) {
        // Отобразить app/views/products/show.phtml с передачей некоторых переменных
        echo $app['view']-&gt;render(
            'products/show',
            [
                'id'   =&gt; 100,
                'name' =&gt; 'Artichoke',
            ]
        );
    }
);
</code></pre>

<h5 class="alert alert-warning">The above example uses the <a href="api/Phalcon_Mvc_View_Simple">Phalcon\Mvc\View\Simple</a> component, which uses relative paths instead of controllers and actions. You can use the <a href="api/Phalcon_Mvc_View">Phalcon\Mvc\View</a> component instead, but to do so you will need to change the parameters passed to <code>render()</code></h5>

<pre><code class="language-php">&lt;?php

$app = new Phalcon\Mvc\Micro();

$app['view'] = function () {
    $view = new \Phalcon\Mvc\View();

    $view-&gt;setViewsDir('app/views/');

    return $view;
};

// Вернуть отображенный вид
$app-&gt;get(
    '/products/show',
    function () use ($app) {
        // Отображаем app/views/products/show.phtml с передачей некоторых переменных
        echo $app['view']-&gt;render(
            'products',
            'show',
            [
                'id'   =&gt; 100,
                'name' =&gt; 'Artichoke',
            ]
        );
    }
);
</code></pre>

<p><a name="error-handling"></a></p>

<h1 id="Обработка-ошибок">Обработка ошибок</h1>

<p>The <a href="api/Phalcon_Mvc_Micro">Phalcon\Mvc\Micro</a> application also has an <code>error</code> method, which can be used to trap any errors that originate from exceptions. Следующий фрагмент кода показывает основное использование этой возможности:</p>

<pre><code class="language-php">&lt;?php

$app = new Phalcon\Mvc\Micro();

$app-&gt;get(
    '/',
    function () {
        throw new \Exception('Произошла ошибка', 401);
    }
);

$app-&gt;error(
    function ($exception) {
        echo json_encode(
            [
                'code'    =&gt; $exception-&gt;getCode(),
                'status'  =&gt; 'error',
                'message' =&gt; $exception-&gt;getMessage(),
            ]
        );
    }
);
</code></pre>

                                    </div>
                                    <div class="col-md-4 col-lg-3 col-sm-12 support-column-margin">
                                        <div class="topic-search">
    <form class="bd-search d-flex align-items-center">
        <input type="search"
               class="form-control"
               id="docs-search"
               placeholder=""
               aria-label=""
               autocomplete="off"
               data-siteurl="https://phalcon-docs4.netlify.com"
               data-docs-version="3.4">
        <button class="btn btn-link bd-search-docs-toggle d-md-none p-0 ml-3"
                type="button"
                data-toggle="collapse"
                data-target="#bd-docs-nav"
                aria-controls="bd-docs-nav"
                aria-expanded="false"
                aria-label="Toggle docs navigation">
            <svg xmlns="http://www.w3.org/2000/svg"
                 viewbox="0 0 30 30"
                 width="30"
                 height="30"
                 focusable="false">
                <title>Menu</title>
                <path stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-miterlimit="10"
                      d="M4 7h22M4 15h22M4 23h22"></path>
            </svg>
        </button>
    </form>
</div>
                                        <div class="topic-categories">
    
</div>

                                        <div class="article-menu">
    <ul>
        
        
    </ul>
</div>
                                    </div>
                                </div>
                            </div>
                        </section>

                    </div>
                </div>
            </div>
        </div>
    </div>

<footer>
    <div class="container">
        <div class="footer-wrapper clearfix">

            <div class="footer-link-container">
                <a class="footer-link" href="/">
                    <img class="footer-logo-img" src="/assets/images/footer_logo.svg" alt="logo">
                </a>
                <a class="footer-link" href="https://phalcon.link/about" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://phalcon.link/sponsors" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://phalcon.link/fund" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://phalcon.link/download" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://license.phalconphp.com/" target="_blank">
                     New BSD
                </a>
            </div>

            <div class="footer-copyright">
                <a href="https://odva.pro/" target="_blank" class="o2-link">
                    <span></span> <img src="/assets/images/logo-o2.svg" alt="logo o2">
                </a>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript" src="/assets/js/main.min.js?v1547266080100021829"></script>
<script type="text/javascript" src="/assets/js/highlight/highlight.pack.js?v1547266080100021829"></script>
<script type="application/javascript">hljs.initHighlightingOnLoad();</script>
<script type="application/javascript">hljs.initHighlightingOnLoad();</script>
</body>
</html>
