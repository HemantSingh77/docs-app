<!doctype html>
<!--[if IE 8]>
<html lang="es-es" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="es-es" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="es-es" class="no-js">
<!--<![endif]-->








    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <script type="text/javascript" src="/assets/js/viewport-min-width.js?v1547266080100021829"></script>
        <meta name="description"
              content="Official Phalcon Documentation">
        <meta name="keywords" content="php, phalcon, phalcon php, php framework, faster php framework, php extension, next generation framework, docs, documentation">
        <meta name="author" href="/humans.txt">
        <meta name="generator" content="Phalcon Team - Jekyll - Netlify">

        <link href="https://phalcon-docs4.netlify.com/3.4/es-es/db-odm.html" rel="canonical">
        <title>Phalcon Framework Documentation</title>

        <!-- Twitter -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@zephirlang">
        <meta name="twitter:creator" content="@zephirlang">
        <meta name="twitter:title" content="Phalcon Framework Documentation">
        <meta name="twitter:description" content="Official Phalcon Documentation">
        <meta name="twitter:image" content="https://assets.phalconphp.com/phalcon/logo.png">

        <!-- Facebook -->
        <meta property="og:url" content="https://phalcon-docs4.netlify.com">
        <meta property="og:title" content="Phalcon Framework Documentation">
        <meta property="og:description" content="Official Phalcon Documentation">
        <meta property="og:type" content="website">
        <meta property="og:image" content="https://assets.phalconphp.com/phalcon/logo.png">

        <meta name="msapplication-TileColor" content="#FFFFFF">
        <meta name="msapplication-square70x70logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-70x70.png">
        <meta name="msapplication-TileImage"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-144x144.png">
        <meta name="msapplication-square150x150logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-150x150.png">
        <meta name="msapplication-wide310x150logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-310x150.png">
        <meta name="msapplication-square310x310logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-310x310.png">

        <link rel="apple-touch-icon"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon.png">

        <link rel="apple-touch-icon-precomposed"
              sizes="57x57"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-57x57.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="60x60"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-60x60.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="72x72"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="76x76"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-76x76.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="114x114"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-114x114.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="120x120"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-120x120.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="144x144"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-144x144.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="152x152"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-152x152.png">

        <link rel="icon"
              type="image/png"
              sizes="16x16"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-16x16.png">
        <link rel="icon"
              type="image/png"
              sizes="32x32"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-32x32.png">
        <link rel="icon"
              type="image/png"
              sizes="96x96"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-96x96.png">
        <link rel="icon"
              type="image/png"
              sizes="128x128"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-128x128.png">
        <link rel="icon"
              type="image/png"
              sizes="196x196"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-196x196.png">
        <link rel="shortcut icon"
              type="image/png"
              href="https://assets.phalconphp.com/phalcon/favicon.ico"/>

        <link rel="alternate"
              type="application/rss+xml"
              title=" - "
              href="https://phalcon-docs4.netlify.com/feed.xml">

        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css"
              integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE="
              crossorigin="anonymous" />
        <link rel="stylesheet" href="/assets/css/monokai.css?v1547266080100021829" />
        <link rel="stylesheet" href="/assets/css/style.css?v1547266080100021829" />

        <script defer src="https://use.fontawesome.com/releases/v5.6.1/js/all.js"
                integrity="sha384-R5JkiUweZpJjELPWqttAYmYM1P3SNEJRM6ecTQF05pFFtxmCO+Y1CiUhvuDzgSVZ"
                crossorigin="anonymous"></script>
        
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90300500-6"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-90300500-6');
    </script>

    </head>


<body onclick="o2.allNavSlideUp()">
    <header class="header-image-doc">
        <div class="container">
            <div class="header-wrapper">
                <div class="clearfix">
                    <div class="row">
                        <div class="col-md-2 col-sm-3  col-xs-8">
                            <div class="header-image__logo-wrapper">
                                <a href="/3.4/es-es">
                                    <img class="logo-img" src="/assets/images/header_logo.svg" alt="logo">
                                </a>
                            </div>
                        </div>
                        <div class="col-md-10 col-sm-9 top-menu">

                            <div class="nav-icon" onclick="o2.showMobileMenu();">
                                <div class="nav-line"></div>
                                <div class="nav-line"></div>
                                <div class="nav-line"></div>
                            </div>
                            <nav class="header-nav">
                                <ul>
                                    <li class="nav-item" onclick="o2.toggleState(this, event);">
                                        <div class="nav-item_selected">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                 alt="">
                                            <span class="caret"></span>
                                        </div>
                                        <div class="nav-item__list" onclick="event.stopPropagation();">
                                            
                                                <a href="/3.4/en/db-odm" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                         alt="English (US)">
                                                    English (US)
                                                </a>
                                            
                                                <a href="/3.4/cs-cz/db-odm" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/cs.png"
                                                         alt="Czech">
                                                    Czech
                                                </a>
                                            
                                                <a href="/3.4/de-de/db-odm" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/de.png"
                                                         alt="German">
                                                    German
                                                </a>
                                            
                                                <a href="/3.4/es-es/db-odm" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                         alt="Spanish">
                                                    Spanish
                                                </a>
                                            
                                                <a href="/3.4/fa-ir/db-odm" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fa.png"
                                                         alt="Persian">
                                                    Persian
                                                </a>
                                            
                                                <a href="/3.4/fr-fr/db-odm" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fr.png"
                                                         alt="French">
                                                    French
                                                </a>
                                            
                                                <a href="/3.4/id-id/db-odm" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/id.png"
                                                         alt="Indonesian">
                                                    Indonesian
                                                </a>
                                            
                                                <a href="/3.4/it-it/db-odm" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/it.png"
                                                         alt="Italian">
                                                    Italian
                                                </a>
                                            
                                                <a href="/3.4/ja-jp/db-odm" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ja.png"
                                                         alt="Japanese">
                                                    Japanese
                                                </a>
                                            
                                                <a href="/3.4/pl-pl/db-odm" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/pl.png"
                                                         alt="Polish">
                                                    Polish
                                                </a>
                                            
                                                <a href="/3.4/ru-ru/db-odm" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ru.png"
                                                         alt="Russian">
                                                    Russian
                                                </a>
                                            
                                                <a href="/3.4/tr-tr/db-odm" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/tr.png"
                                                         alt="Turkish">
                                                    Turkish
                                                </a>
                                            
                                                <a href="/3.4/uk-ua/db-odm" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/uk.png"
                                                         alt="Ukrainian">
                                                    Ukrainian
                                                </a>
                                            
                                                <a href="/3.4/zh-cn/db-odm" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                                         alt="Chinese Simplified">
                                                    Chinese Simplified
                                                </a>
                                            
                                        </div>
                                    </li>

                                        <li class="nav-item" onclick="o2.toggleState(this, event);">
                                            <div class="nav-item__selected custom-select__version">
                                                 3.4
                                                <span class="caret"></span>
                                            </div>
                                            <div class="nav-item__list" onclick="event.stopPropagation();">
                                                
                                                <a href="/3.4/es-es/db-odm" class="custom-select__list-item">
                                                    <span>3.4</span>
                                                </a>
                                                
                                                <a href="/3.3/es-es/db-odm" class="custom-select__list-item">
                                                    <span>3.3</span>
                                                </a>
                                                
                                                <a href="/3.2/es-es/db-odm" class="custom-select__list-item">
                                                    <span>3.2</span>
                                                </a>
                                                
                                                <a href="/3.1/es-es/db-odm" class="custom-select__list-item">
                                                    <span>3.1</span>
                                                </a>
                                                
                                                <a href="/4.0/es-es/db-odm" class="custom-select__list-item">
                                                    <span>4.0</span>
                                                </a>
                                                
                                            </div>
                                        </li>

                                    <li class="nav-item" onclick="o2.toggleState(this, event);">
                                        <div class="nav-item_selected">
                                            
                                            <span class="caret"></span>
                                        </div>
                                        <div class="nav-item__list">
                                            <a href="https://phalcon.link/forum" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/blog" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/resources" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <div class="nav-item__divider"></div>
                                            <a href="https://phalcon.link/f" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/t" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/gab" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/about">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/sponsors">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/fund">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/download">
                                            
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>

                        <div class="header-nav-mobile">
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this, event)">
                                    <img class="lang-image"
                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                         alt="">
                                    <span class="caret"></span>
                                </div>

                                <ul style="display:none;" class="clearfix" onclick="event.stopPropagation();">
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/en/db-odm">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                 alt="English (US)">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/cs-cz/db-odm">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/cs.png"
                                                 alt="Czech">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/de-de/db-odm">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/de.png"
                                                 alt="German">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/es-es/db-odm">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                 alt="Spanish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/fa-ir/db-odm">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fa.png"
                                                 alt="Persian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/fr-fr/db-odm">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fr.png"
                                                 alt="French">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/id-id/db-odm">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/id.png"
                                                 alt="Indonesian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/it-it/db-odm">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/it.png"
                                                 alt="Italian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/ja-jp/db-odm">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ja.png"
                                                 alt="Japanese">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/pl-pl/db-odm">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/pl.png"
                                                 alt="Polish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/ru-ru/db-odm">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ru.png"
                                                 alt="Russian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/tr-tr/db-odm">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/tr.png"
                                                 alt="Turkish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/uk-ua/db-odm">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/uk.png"
                                                 alt="Ukrainian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/zh-cn/db-odm">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                                 alt="Chinese Simplified">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                </ul>

                            </div>
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this,event)">
                                     3.4
                                    <span class="caret"></span>
                                </div>

                                <ul style="display:none;" class="clearfix" onclick="event.stopPropagation();">
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.4/es-es/db-odm">
                                            <span>3.4</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.3/es-es/db-odm">
                                            <span>3.3</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.2/es-es/db-odm">
                                            <span>3.2</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.1/es-es/db-odm">
                                            <span>3.1</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/4.0/es-es/db-odm">
                                            <span>4.0</span>
                                        </a>
                                    </li>
                                    
                                </ul>

                            </div>
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this, event)">
                                    
                                    <span class="caret"></span>
                                </div>
                                <ul style="display:none;">
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/forum" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/blog" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/resources" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/f" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/t" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/gab" target="_blank">
                                            
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/about">
                                    
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/sponsors">
                                    
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/fund">
                                    
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/download">
                                    
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>


    <div class="container-fluid article-page-wrap">
        <div class="row">
            <div>
                <div class="col-md-2 sidebar hidden-xs">
                    <div class="sidebar--spacer">&nbsp;</div>
                </div>
                <div class="m-t-md m-b-lg" id="articles">
                    <div class="article-content">
                        







                        <section class="documentation-section">
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-md-8 col-lg-9 parse-content">
                                        <div>
                                            <a class="article-content-edit-link pull-right"
                                               href="https://crowdin.com/project/phalcon-documentation/es-es">
                                                
                                            </a>
                                            <br>
                                        </div>
                                        <h5 class="alert alert-info">Tenga en cuenta que si utiliza el controlador de Mongo proporcionado por PHP 7, el ODM no funcionará para usted. Hay un adaptador en la incubadora pero debe ser reescrito totalmente el código de Mongo (utilizando el nuevo tipo Bson en vez de array, no MongoId, no MongoDate, etcétera...). Asegúrese de testear su código antes de actualizar a PHP 7 y/o Phalcon 3+</h5>

<p><a name="overview"></a></p>

<h1 id="odm-mapeador-objecto-documento">ODM (Mapeador Objecto-Documento)</h1>

<p>In addition to its ability to <a href="/3.4/en/models">map tables</a> in relational databases, Phalcon can map documents from NoSQL databases. El ODM ofrece una funcionalidad CRUD, eventos, validaciones entre otros servicios.</p>

<p>Debido a la ausencia de consultas y planificadores SQL, con las bases de datos NoSQL se pueden ver mejoras reales en el rendimiento utilizando el enfoque de Phalcon. Además, no hay construcción de sentencias de SQL, lo que reduce la posibilidad de inyecciones SQL.</p>

<p>Son soportadas las siguientes bases de datos NoSQL:</p>

<table>
  <thead>
    <tr>
      <th>Nombre</th>
      <th>Descripción</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="http://www.mongodb.org/">MongoDB</a></td>
      <td>MongoDB es una base de datos NoSQL de código fuente abierto, escalable y de alto desempeño.</td>
    </tr>
  </tbody>
</table>

<p><a name="creating-models"></a></p>

<h2 id="creación-de-modelos">Creación de Modelos</h2>

<p>A model is a class that extends from <a href="api/Phalcon_Mvc_Collection">Phalcon\Mvc\Collection</a>. Debe colocarse en el directorio de los modelos. Un archivo de modelo debe contener una sola clase; su nombre de clase debe estar en notación “camel case”:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Collection;

class Robots extends Collection
{

}
</code></pre>

<p>Por defecto, el modelo <code>Robots</code> se refiere a la colección <code>robots</code>. Si deseas especificar manualmente otro nombre para la colección de asignación, puedes utilizar el método <code>setSource()</code>:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Collection;

class Robots extends Collection
{
    public function initialize()
    {
        $this-&gt;setSource('the_robots');
    }
}
</code></pre>

<p><a name="documents-to-objects"></a></p>

<h2 id="entendiendo-documentos-a-objetos">Entendiendo Documentos a Objetos</h2>

<p>Cada instancia de un modelo representa un documento en la colección. Podrás acceder fácilmente a la colección de datos al leer las propiedades de los objetos. Por ejemplo, para una colección de <code>robots</code> con los documentos:</p>

<pre><code class="language-bash">$ mongo test
MongoDB shell version: 1.8.2
connecting to: test
&gt; db.robots.find()
{ '_id' : ObjectId('508735512d42b8c3d15ec4e1'), 'name' : 'Astro Boy', 'year' : 1952,
    'type' : 'mechanical' }
{ '_id' : ObjectId('5087358f2d42b8c3d15ec4e2'), 'name' : 'Bender', 'year' : 1999,
    'type' : 'mechanical' }
{ '_id' : ObjectId('508735d32d42b8c3d15ec4e3'), 'name' : 'Wall-E', 'year' : 2008 }
&gt;
</code></pre>

<p><a name="namespaces"></a></p>

<h2 id="modelos-en-espacios-de-nombres">Modelos en Espacios de Nombres</h2>

<p>Namespaces can be used to avoid class name collision. In this case it is necessary to indicate the name of the related collection using the <code>setSource()</code> method:</p>

<pre><code class="language-php">&lt;?php

namespace Store\Toys;

use Phalcon\Mvc\Collection;

class Robots extends Collection
{
    public function initialize()
    {
        $this-&gt;setSource('robots');
    }
}
</code></pre>

<p>Podrías encontrar cierto documento por su ID primaria y luego imprimir su nombre:</p>

<pre><code class="language-php">&lt;?php

// Encontrar el registro con _id = '5087358f2d42b8c3d15ec4e2'
$robot = Robots::findById('5087358f2d42b8c3d15ec4e2');

// Imprime 'Bender'
echo $robot-&gt;name;
</code></pre>

<p>Una vez que el registro está en la memoria, puede hacer modificaciones a sus datos y guardar los cambios:</p>

<pre><code class="language-php">&lt;?php

$robot = Robots::findFirst(
    [
        [
            'name' =&gt; 'Astro Boy',
        ]
    ]
);

$robot-&gt;name = 'Voltron';

$robot-&gt;save();
</code></pre>

<p><a name="connection-setup"></a></p>

<h2 id="establecer-una-conexión">Establecer una Conexión</h2>

<p>Connections are retrieved from the services container. By default, Phalcon tries to find the connection in a service called <code>mongo</code>:</p>

<pre><code class="language-php">&lt;?php

// Conexión simple de base de datos a localhost
$di-&gt;set(
    'mongo',
    function () {
        $mongo = new MongoClient();

        return $mongo-&gt;selectDB('store');
    },
    true
);

// Conectando a un socket de dominio, volviendo a la conexión localhost
$di-&gt;set(
    'mongo',
    function () {
        $mongo = new MongoClient(
            'mongodb:///tmp/mongodb-27017.sock,localhost:27017'
        );

        return $mongo-&gt;selectDB('store');
    },
    true
);
</code></pre>

<p><a name="finding-documents"></a></p>

<h2 id="búsqueda-de-documentos">Búsqueda de Documentos</h2>

<p>As <a href="api/Phalcon_Mvc_Collection">Phalcon\Mvc\Collection</a> relies on the Mongo PHP extension you have the same facilities to query documents and convert them transparently to model instances:</p>

<pre><code class="language-php">&lt;?php

// Cuantos robots hay?
$robots = Robots::find();
echo 'Hay ', count($robots), "\n";

// Cuantos robots mecánicos hay?
$robots = Robots::find(
    [
        [
            'type' =&gt; 'mechanical',
        ]
    ]
);
echo 'Hay ', count($robots), "\n";

// Obtener e imprimir los robots mecánicos ordenados por nombre ascendentemente
$robots = Robots::find(
    [
        [
            'type' =&gt; 'mechanical',
        ],
        'sort' =&gt; [
            'name' =&gt; 1,
        ],
    ]
);

foreach ($robots as $robot) {
    echo $robot-&gt;name, "\n";
}

// Obtener los primeros 100 robots mecánicos ordenados por nombre
$robots = Robots::find(
    [
        [
            'type' =&gt; 'mechanical',
        ],
        'sort'  =&gt; [
            'name' =&gt; 1,
        ],
        'limit' =&gt; 100,
    ]
);

foreach ($robots as $robot) {
    echo $robot-&gt;name, "\n";
}
</code></pre>

<p>También puedes utilizar el método de <code>findFirst()</code> para obtener sólo el primer registro que coincida con el criterio dado:</p>

<pre><code class="language-php">&lt;?php

// Cual es el primer robot en la colección robots?
$robot = Robots::findFirst();
echo 'El nombre del robot es ', $robot-&gt;name, "\n";

// Cual es el primer robot mecánico en la colección robots?
$robot = Robots::findFirst(
    [
        [
            'type' =&gt; 'mechanical',
        ]
    ]
);

echo 'El nombre del primer robot mecánico es ', $robot-&gt;name, "\n";
</code></pre>

<p>Ambos métodos <code>find()</code> y <code>findFirst()</code> aceptan un arreglo asociativo, especificando los criterios de búsqueda:</p>

<pre><code class="language-php">&lt;?php

// Primer robot donde tipo 'mechanical' y año '1999'
$robot = Robots::findFirst(
    [
        'conditions' =&gt; [
            'type' =&gt; 'mechanical',
            'year' =&gt; '1999',
        ],
    ]
);

// Todos los robots virtuales ordenados por nombre descendentemente
$robots = Robots::find(
    [
        'conditions' =&gt; [
            'type' =&gt; 'virtual',
        ],
        'sort' =&gt; [
            'name' =&gt; -1,
        ],
    ]
);

// Encontrar todos los robots que tengan más de 4 amigos usando la condición where
$robots = Robots::find(
    [
        'conditions' =&gt; [
            '$where' =&gt; 'this.friends.length &gt; 4',
        ]
    ]
);
</code></pre>

<p>Las opciones disponibles de consulta son:</p>

<table>
  <thead>
    <tr>
      <th>Parámetro</th>
      <th>Descripción</th>
      <th>Ejemplo</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>conditions</code></td>
      <td>Condiciones de búsqueda para la operación de búsqueda. Se utiliza para extraer sólo los registros que cumplan con un criterio especificado. By default Phalcon_model assumes the first parameter are the conditions.</td>
      <td><code>'conditions' =&gt; array('$gt' =&gt; 1990)</code></td>
    </tr>
    <tr>
      <td><code>fields</code></td>
      <td>Retorna las columnas especificadas en vez de todos campos del modelo. Cuando utilizamos esta opción, un objecto incompleto es retornado</td>
      <td><code>'fields' =&gt; array('name' =&gt; true)</code></td>
    </tr>
    <tr>
      <td><code>sort</code></td>
      <td>Es utilizado para ordenar el conjunto de resultados. Utiliza uno o más campos para cada elemento en el arreglo, 1 significa ordenar de forma ascendente, -1 descendente</td>
      <td><code>'sort' =&gt; array('name' =&gt; -1, 'status' =&gt; 1)</code></td>
    </tr>
    <tr>
      <td><code>limit</code></td>
      <td>Limitar los resultados de la consulta a cierto rango</td>
      <td><code>'limit' =&gt; 10</code></td>
    </tr>
    <tr>
      <td><code>skip</code></td>
      <td>Omite un número específico de resultados</td>
      <td><code>'skip' =&gt; 50</code></td>
    </tr>
  </tbody>
</table>

<p>Si tienes experiencia con las bases de datos SQL, tal vez quiere ver la <a href="http://www.php.net/manual/en/mongo.sqltomongo.php">Tabla de mapeo de SQL a Mongo</a>.</p>

<p><a name="finding-documents-fields"></a></p>

<h2 id="consulta-de-campos-específicos">Consulta de Campos Específicos</h2>

<p>Para consultar campos específicos de los campos de una base de datos MongoDB con el ODM Phalcon, todo lo que necesitas hacer es:</p>

<pre><code class="language-php">$myRobots = Robots:find(
    [
        'fields' =&gt; ['name' =&gt; 1]
    ]
];
</code></pre>

<p>The <code>find()</code> above only returns a <code>name</code>. It can also be combined with a <code>condition</code>:</p>

<pre><code class="language-php">$myRobots = Robots:find(
    [
        ['type' =&gt; 'maid'],
        'fields' =&gt; ['name' =&gt; 1]
    ]
];
</code></pre>

<p>El ejemplo anterior devuelve el campo <code>name</code> que es el nombre del robot con con el campo <code>type = 'maid'</code>.</p>

<p><a name="aggregations"></a></p>

<h2 id="agregaciones">Agregaciones</h2>

<p>Un modelo puede devolver cálculos utilizando el <a href="http://docs.mongodb.org/manual/applications/aggregation/">framework de agregados</a> que provee Mongo. Los valores agregados se calculan sin tener que utilizar MapReduce. Con esta opción es fácil realizar tareas como calcular un total o un promedio de valores de los campos:</p>

<pre><code class="language-php">&lt;?php

$data = Article::aggregate(
    [
        [
            '\$project' =&gt; [
                'category' =&gt; 1,
            ],
        ],
        [
            '\$group' =&gt; [
                '_id' =&gt; [
                    'category' =&gt; '\$category'
                ],
                'id'  =&gt; [
                    '\$max' =&gt; '\$_id',
                ],
            ],
        ],
    ]
);
</code></pre>

<p><a name="creating-updating"></a></p>

<h2 id="creación-y-actualización-de-registros">Creación y Actualización de Registros</h2>

<p>El método <code>Phalcon\Mvc\Collection::save()</code> te permite crear o actualizar documentos según si ya existen en la colección asociada a un modelo. The <code>save()</code> method is called internally by the create and update methods of <a href="api/Phalcon_Mvc_Collection">Phalcon\Mvc\Collection</a>.</p>

<p>El método también ejecuta validadores y eventos asociados que están definidos en modelo:</p>

<pre><code class="language-php">&lt;?php

$robot = new Robots();

$robot-&gt;type = 'mechanical';
$robot-&gt;name = 'Astro Boy';
$robot-&gt;year = 1952;

if ($robot-&gt;save() === false) {
    echo "Ups, no podemos almacenar robots en este momento: \n";

    $messages = $robot-&gt;getMessages();

    foreach ($messages as $message) {
        echo $message, "\n";
    }
} else {
    echo 'Grandioso, un nuevo robot ha sido agregado con éxito!';
}
</code></pre>

<p>La propiedad <code>_id</code> se actualiza automáticamente con el objeto <a href="http://www.php.net/manual/en/class.mongoid.php">MongoId</a> creado por el controlador:</p>

<pre><code class="language-php">&lt;?php

$robot-&gt;save();

echo 'La id generada es: ', $robot-&gt;getId();
</code></pre>

<p><a name="validation-messages"></a></p>

<h3 id="mensajes-de-validación">Mensajes de Validación</h3>

<p><a href="api/Phalcon_Mvc_Collection">Phalcon\Mvc\Collection</a> has a messaging subsystem that provides a flexible way to output or store the validation messages generated during the insert/update processes.</p>

<p>Each message consists of an instance of the class <a href="api/Phalcon_Mvc_Model_Message">Phalcon\Mvc\Model\Message</a>. El conjunto de mensajes generados se puede recuperar con el método getMessages(). Cada mensaje proporciona información ampliada como el nombre del campo que genera el mensaje o el tipo de mensaje:</p>

<pre><code class="language-php">&lt;?php

if ($robot-&gt;save() === false) {
    $messages = $robot-&gt;getMessages();

    foreach ($messages as $message) {
        echo 'Mensaje: ', $message-&gt;getMessage();
        echo 'Campo: ', $message-&gt;getField();
        echo 'Tipo: ', $message-&gt;getType();
    }
}
</code></pre>

<p><a name="events"></a></p>

<h3 id="eventos-de-validación-y-gestor-de-eventos">Eventos de Validación y Gestor de Eventos</h3>

<p>Los modelos permiten implementar eventos que serán ejecutados cuando se realice una inserción o actualización. Ellos ayudan a definir reglas de negocio para cierto modelo. The following are the events supported by <a href="api/Phalcon_Mvc_Collection">Phalcon\Mvc\Collection</a> and their order of execution:</p>

<table>
  <thead>
    <tr>
      <th>Operación</th>
      <th>Nombre</th>
      <th>¿Puede detener la operación?</th>
      <th>Explicación</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Insertar o actualizar</td>
      <td><code>beforeValidation</code></td>
      <td>SI</td>
      <td>Es ejecutado antes del proceso de validación y la inserción o actualización final en la base de datos</td>
    </tr>
    <tr>
      <td>Insertar</td>
      <td><code>beforeValidationOnCreate</code></td>
      <td>SI</td>
      <td>Es ejecutado antes del proceso de validación solo cuando es una operación de inserción</td>
    </tr>
    <tr>
      <td>Actualizar</td>
      <td><code>beforeValidationOnUpdate</code></td>
      <td>SI</td>
      <td>Es ejecutado antes de validar los campos no nulos o claves foraneas cuando es una operación de actualización</td>
    </tr>
    <tr>
      <td>Insertar o actualizar</td>
      <td><code>onValidationFails</code></td>
      <td>SI (detenido)</td>
      <td>Es ejecutado antes del proceso de validación solo cuando es una operación de inserción</td>
    </tr>
    <tr>
      <td>Insertar</td>
      <td><code>afterValidationOnCreate</code></td>
      <td>SI</td>
      <td>Es ejecutado después del proceso de validación cuando es una operación de inserción</td>
    </tr>
    <tr>
      <td>Actualizar</td>
      <td><code>afterValidationOnUpdate</code></td>
      <td>SI</td>
      <td>Es ejecutado después del proceso de validación cuando es una operación de actualización</td>
    </tr>
    <tr>
      <td>Insertar o actualizar</td>
      <td><code>afterValidation</code></td>
      <td>SI</td>
      <td>Se ejecuta tras el proceso de validación</td>
    </tr>
    <tr>
      <td>Insertar o actualizar</td>
      <td><code>beforeSave</code></td>
      <td>SI</td>
      <td>Se ejecuta antes de la operación sobre el sistema de base de datos, para operaciones de inserción o actualización</td>
    </tr>
    <tr>
      <td>Actualizar</td>
      <td><code>beforeUpdate</code></td>
      <td>SI</td>
      <td>Se ejecuta antes de la operación sobre el sistema de base de datos, sólo cuando se realiza una operación de actualización</td>
    </tr>
    <tr>
      <td>Insertar</td>
      <td><code>beforeCreate</code></td>
      <td>SI</td>
      <td>Se ejecuta antes de la operación sobre el sistema de base de datos, sólo cuando se realiza una operación de inserción</td>
    </tr>
    <tr>
      <td>Actualizar</td>
      <td><code>afterUpdate</code></td>
      <td>NO</td>
      <td>Se ejecuta después de la operación sobre el sistema de base de datos pero sólo cuando se realiza una operación de actualización</td>
    </tr>
    <tr>
      <td>Insertar</td>
      <td><code>afterCreate</code></td>
      <td>NO</td>
      <td>Se ejecuta después de la operación sobre el sistema de base de datos pero sólo cuando se realiza una operación de inserción</td>
    </tr>
    <tr>
      <td>Insertar o actualizar</td>
      <td><code>afterSave</code></td>
      <td>NO</td>
      <td>Después que la operación se ejecuta sobre el sistema de base de datos solo para inserción o actualización</td>
    </tr>
  </tbody>
</table>

<p>Para hacer a un modelo reaccionar a un evento, debemos implementar un método con el mismo nombre del evento:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Collection;

class Robots extends Collection
{
    public function beforeValidationOnCreate()
    {
        echo 'Esto es ejecutado antes de crear un Robot!';
    }
}
</code></pre>

<p>Los eventos pueden utilizarse para asignar valores antes de realizar una operación, por ejemplo:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Collection;

class Products extends Collection
{
    public function beforeCreate()
    {
        // Establecer la fecha de creación
        $this-&gt;created_at = date('Y-m-d H:i:s');
    }

    public function beforeUpdate()
    {
        // Establecer la fecha de modificación
        $this-&gt;modified_in = date('Y-m-d H:i:s');
    }
}
</code></pre>

<p>Additionally, this component is integrated with the <a href="/3.4/en/events">Phalcon Events Manager</a> (<a href="api/Phalcon_Events_Manager">Phalcon\Events\Manager</a>), this means we can create listeners that run when an event is triggered.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Events\Event;
use Phalcon\Events\Manager as EventsManager;

$eventsManager = new EventsManager();

// Ajuntar una función anónima como oyente de los eventos de 'model'
$eventsManager-&gt;attach(
    'collection:beforeSave',
    function (Event $event, $robot) {
        if ($robot-&gt;name === 'Scooby Doo') {
            echo "Scooby Doo no es un robot!";

            return false;
        }

        return true;
    }
);

$robot = new Robots();

$robot-&gt;setEventsManager($eventsManager);

$robot-&gt;name = 'Scooby Doo';
$robot-&gt;year = 1969;

$robot-&gt;save();
</code></pre>

<p>En el ejemplo anterior el EventsManager o Gestor de Eventos sólo actuó como un puente entre un objeto y un oyente que era una función anónima. Si queremos que todos los objetos creados en nuestra aplicación utilicen el mismo EventsManager, tenemos que asignarlo al administrador de modelos:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Events\Event;
use Phalcon\Events\Manager as EventsManager;
use Phalcon\Mvc\Collection\Manager as CollectionManager;

// Registrando el servicio collectionManager
$di-&gt;set(
    'collectionManager',
    function () {
        $eventsManager = new EventsManager();

        // Adjuntar una función anónima como oyente de los eventos del 'model'
        $eventsManager-&gt;attach(
            'collection:beforeSave',
            function (Event $event, $model) {
                if (get_class($model) === 'Robots') {
                    if ($model-&gt;name === 'Scooby Doo') {
                        echo "Scooby Doo no es un robot!";

                        return false;
                    }
                }

                return true;
            }
        );

        // Establecer un EventsManager por defecto
        $modelsManager = new CollectionManager();

        $modelsManager-&gt;setEventsManager($eventsManager);

        return $modelsManager;
    },
    true
);
</code></pre>

<p><a name="business-rules"></a></p>

<h3 id="implementación-de-una-regla-de-negocio">Implementación de una Regla de Negocio</h3>

<p>Cuando se ejecuta una inserción, actualización o borrado, el modelo verifica si hay algunos métodos con nombres de eventos listados en la tabla anterior.</p>

<p>Recomendamos que los métodos de validación sean declaramos como protegidos para prevenir que las reglas de negocio queden expuestas públicamente.</p>

<p>El siguiente ejemplo implementa un evento que valida que el año no sea menor a cero en la actualización o inserción:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Collection;

class Robots extends Collection
{
    protected function beforeSave()
    {
        if ($this-&gt;year &lt; 0) {
            echo 'El año no puede ser menor a cero!';

            return false;
        }
    }
}
</code></pre>

<p>Some events return <code>false</code> as an indication to stop the current operation. If an event doesn’t return anything, <code>Phalcon\Mvc\Collection</code> will assume a <code>true</code> value.</p>

<p><a name="data-integrity"></a></p>

<h3 id="validar-la-integridad-de-datos">Validar la Integridad de Datos</h3>

<p><a href="api/Phalcon_Mvc_Collection">Phalcon\Mvc\Collection</a> provides several events to validate data and implement business rules. El evento especial <code>validation</code> nos permite llamar a validadores incorporados en el registro. Phalcon expone algunos validadores incorporados que pueden utilizarse en esta etapa de validación.</p>

<p>En el ejemplo siguiente se muestra cómo se utiliza:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Collection;
use Phalcon\Validation;
use Phalcon\Validation\Validator\InclusionIn;
use Phalcon\Validation\Validator\Numericality;

class Robots extends Collection
{
    public function validation()
    {
        $validation = new Validation();

        $validation-&gt;add(
            'type',
            new InclusionIn(
                [
                    'message' =&gt; 'El tipo debe ser: mechanical o virtual',
                    'domain' =&gt; [
                        'Mechanical',
                        'Virtual',
                    ],
                ]
            )
        );

        $validation-&gt;add(
            'price',
            new Numericality(
                [
                    'message' =&gt; 'El precio debe ser numérico'
                ]
            )
        );

        return $this-&gt;validate($validation);
    }
}
</code></pre>

<p>El ejemplo anterior realiza una validación con el validador integrado <code>InclusionIn</code>. Comprueba que el valor del campo <code>type</code> este en la lista <code>domain</code>. Si el valor no está incluido en el dominio, entonces el validador fallará y devolverá <code>false</code>.</p>

<h5 class="alert alert-warning">For more information on validators, see the <a href="/3.4/en/validation">Validation documentation</a> </h5>

<p><a name="deleting-records"></a></p>

<h2 id="eliminar-registros">Eliminar Registros</h2>

<p>The <code>Phalcon\Mvc\Collection::delete()</code> method allows you to delete a document. You can use it as follows:</p>

<pre><code class="language-php">&lt;?php

$robot = Robots::findFirst();

if ($robot !== false) {
    if ($robot-&gt;delete() === false) {
        echo "Lo sentimos, no pudimos borrar el robot: \n";

        $messages = $robot-&gt;getMessages();

        foreach ($messages as $message) {
            echo $message, "\n";
        }
    } else {
        echo 'El robot fue borrado correctamente!';
    }
}
</code></pre>

<p>También puede eliminar muchos documentos recorriendo un conjunto de resultados con un bucle <code>foreach</code>:</p>

<pre><code class="language-php">&lt;?php

$robots = Robots::find(
    [
        [
            'type' =&gt; 'mechanical',
        ]
    ]
);

foreach ($robots as $robot) {
    if ($robot-&gt;delete() === false) {
        echo "Lo sentimos, no pudimos borrar el robot: \n";

        $messages = $robot-&gt;getMessages();

        foreach ($messages as $message) {
            echo $message, "\n";
        }
    } else {
        echo 'El robot fue borrado correctamente!';
    }
}
</code></pre>

<p>Los siguientes eventos están disponibles para definir reglas de negocios personalizadas que se pueden ejecutar cuando se realiza una operación de eliminación:</p>

<table>
  <thead>
    <tr>
      <th>Operación</th>
      <th>Nombre</th>
      <th>¿Puede detener la operación?</th>
      <th>Explicación</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Eliminar</td>
      <td><code>beforeDelete</code></td>
      <td>SI</td>
      <td>Se ejecuta antes de la operación de eliminación</td>
    </tr>
    <tr>
      <td>Eliminar</td>
      <td><code>afterDelete</code></td>
      <td>NO</td>
      <td>Se ejecuta después de la operación de eliminación</td>
    </tr>
  </tbody>
</table>

<p><a name="validation-failed-events"></a></p>

<h2 id="eventos-de-fallas-de-validación">Eventos de Fallas de Validación</h2>

<p>Otro tipo de eventos está disponible cuando el proceso de validación de datos encuentra cualquier inconsistencia:</p>

<table>
  <thead>
    <tr>
      <th>Operación</th>
      <th>Nombre</th>
      <th>Explicación</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Insertar o actualizar</td>
      <td><code>notSave</code></td>
      <td>Se dispara cuando la operación de inserción o actualización falla por alguna razón</td>
    </tr>
    <tr>
      <td>Insertar, borrar o actualizar</td>
      <td><code>onValidationFails</code></td>
      <td>Se dispara cuando cualquier operación de manipulación de datos falla</td>
    </tr>
  </tbody>
</table>

<p><a name="ids-vs-primary-keys"></a></p>

<h2 id="ids-implícitas-vs-claves-primarias-del-usuario">Ids implícitas vs. Claves primarias del usuario</h2>

<p>By default <a href="api/Phalcon_Mvc_Collection">Phalcon\Mvc\Collection</a> assumes that the <code>_id</code> attribute is automatically generated using <a href="http://www.php.net/manual/en/class.mongoid.php">MongoIds</a>.</p>

<p>Si un modelo utiliza un claves primarias personalizadas este comportamiento puede ser redefinido:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Collection;

class Robots extends Collection
{
    public function initialize()
    {
        $this-&gt;useImplicitObjectIds(false);
    }
}
</code></pre>

<p><a name="multiple-databases"></a></p>

<h2 id="configuración-de-múltiples-bases-de-datos">Configuración de Múltiples Bases de Datos</h2>

<p>En Phalcon, todos los modelos pueden compartir la misma conexión a la base de datos o especificar una conexión por modelo. Actualmente, cuando <code>Phalcon\Mvc\Collection</code> necesita conectarse a la base de datos pide el servicio <code>mongo</code> al contenedor de servicios de la aplicación. Usted puede sobrescribir este servicio configurándolo en el método <code>initialize()</code>:</p>

<pre><code class="language-php">&lt;?php

// El servicio retorna una base de datos monto en 192.168.1.100
$di-&gt;set(
    'mongo1',
    function () {
        $mongo = new MongoClient(
            'mongodb://scott:nekhen@192.168.1.100'
        );

        return $mongo-&gt;selectDB('management');
    },
    true
);

// Este servicio retorna una base de datos mongo en localhost
$di-&gt;set(
    'mongo2',
    function () {
        $mongo = new MongoClient(
            'mongodb://localhost'
        );

        return $mongo-&gt;selectDB('invoicing');
    },
    true
);
</code></pre>

<p>Luego, en el método <code>initialize()</code>, definimos el servicio de conexión para el modelo:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Collection;

class Robots extends Collection
{
    public function initialize()
    {
        $this-&gt;setConnectionService('mongo1');
    }
}
</code></pre>

<p><a name="services-in-models"></a></p>

<h2 id="servicios-de-inyección-en-modelos">Servicios de Inyección en Modelos</h2>

<p>Si requiere acceder a los servicios de la aplicación dentro de un modelo, en el siguiente ejemplo se explica cómo hacerlo:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Collection;

class Robots extends Collection
{
    public function notSave()
    {
        // Obtener el servicio flash desde el contenedor DI
        $flash = $this-&gt;getDI()-&gt;getShared('flash');

        $messages = $this-&gt;getMessages();

        // Mostramos los mensajes de validación
        foreach ($messages as $message) {
            $flash-&gt;error(
                (string) $message
            );
        }
    }
}
</code></pre>

<p>El evento <code>notSaved</code> se desencadena cada vez que falla una acción de <code>creacion</code> o <code>actualización</code>. Estamos mostrando los mensajes de validación obteniendo el servicio <code>flash</code> del contenedor DI. Haciendo esto, no tenemos que imprimir los mensajes después de cada guardado.</p>

                                    </div>
                                    <div class="col-md-4 col-lg-3 col-sm-12 support-column-margin">
                                        <div class="topic-search">
    <form class="bd-search d-flex align-items-center">
        <input type="search"
               class="form-control"
               id="docs-search"
               placeholder=""
               aria-label=""
               autocomplete="off"
               data-siteurl="https://phalcon-docs4.netlify.com"
               data-docs-version="3.4">
        <button class="btn btn-link bd-search-docs-toggle d-md-none p-0 ml-3"
                type="button"
                data-toggle="collapse"
                data-target="#bd-docs-nav"
                aria-controls="bd-docs-nav"
                aria-expanded="false"
                aria-label="Toggle docs navigation">
            <svg xmlns="http://www.w3.org/2000/svg"
                 viewbox="0 0 30 30"
                 width="30"
                 height="30"
                 focusable="false">
                <title>Menu</title>
                <path stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-miterlimit="10"
                      d="M4 7h22M4 15h22M4 23h22"></path>
            </svg>
        </button>
    </form>
</div>
                                        <div class="topic-categories">
    
</div>

                                        <div class="article-menu">
    <ul>
        
        
    </ul>
</div>
                                    </div>
                                </div>
                            </div>
                        </section>

                    </div>
                </div>
            </div>
        </div>
    </div>

<footer>
    <div class="container">
        <div class="footer-wrapper clearfix">

            <div class="footer-link-container">
                <a class="footer-link" href="/">
                    <img class="footer-logo-img" src="/assets/images/footer_logo.svg" alt="logo">
                </a>
                <a class="footer-link" href="https://phalcon.link/about" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://phalcon.link/sponsors" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://phalcon.link/fund" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://phalcon.link/download" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://license.phalconphp.com/" target="_blank">
                     New BSD
                </a>
            </div>

            <div class="footer-copyright">
                <a href="https://odva.pro/" target="_blank" class="o2-link">
                    <span></span> <img src="/assets/images/logo-o2.svg" alt="logo o2">
                </a>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript" src="/assets/js/main.min.js?v1547266080100021829"></script>
<script type="text/javascript" src="/assets/js/highlight/highlight.pack.js?v1547266080100021829"></script>
<script type="application/javascript">hljs.initHighlightingOnLoad();</script>
<script type="application/javascript">hljs.initHighlightingOnLoad();</script>
</body>
</html>
