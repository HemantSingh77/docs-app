<!doctype html>
<!--[if IE 8]>
<html lang="es-es" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="es-es" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="es-es" class="no-js">
<!--<![endif]-->








    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <script type="text/javascript" src="/assets/js/viewport-min-width.js?v1547266080100021829"></script>
        <meta name="description"
              content="Official Phalcon Documentation">
        <meta name="keywords" content="php, phalcon, phalcon php, php framework, faster php framework, php extension, next generation framework, docs, documentation">
        <meta name="author" href="/humans.txt">
        <meta name="generator" content="Phalcon Team - Jekyll - Netlify">

        <link href="https://phalcon-docs4.netlify.com/3.4/es-es/di.html" rel="canonical">
        <title>Phalcon Framework Documentation</title>

        <!-- Twitter -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@zephirlang">
        <meta name="twitter:creator" content="@zephirlang">
        <meta name="twitter:title" content="Phalcon Framework Documentation">
        <meta name="twitter:description" content="Official Phalcon Documentation">
        <meta name="twitter:image" content="https://assets.phalconphp.com/phalcon/logo.png">

        <!-- Facebook -->
        <meta property="og:url" content="https://phalcon-docs4.netlify.com">
        <meta property="og:title" content="Phalcon Framework Documentation">
        <meta property="og:description" content="Official Phalcon Documentation">
        <meta property="og:type" content="website">
        <meta property="og:image" content="https://assets.phalconphp.com/phalcon/logo.png">

        <meta name="msapplication-TileColor" content="#FFFFFF">
        <meta name="msapplication-square70x70logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-70x70.png">
        <meta name="msapplication-TileImage"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-144x144.png">
        <meta name="msapplication-square150x150logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-150x150.png">
        <meta name="msapplication-wide310x150logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-310x150.png">
        <meta name="msapplication-square310x310logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-310x310.png">

        <link rel="apple-touch-icon"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon.png">

        <link rel="apple-touch-icon-precomposed"
              sizes="57x57"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-57x57.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="60x60"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-60x60.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="72x72"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="76x76"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-76x76.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="114x114"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-114x114.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="120x120"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-120x120.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="144x144"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-144x144.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="152x152"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-152x152.png">

        <link rel="icon"
              type="image/png"
              sizes="16x16"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-16x16.png">
        <link rel="icon"
              type="image/png"
              sizes="32x32"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-32x32.png">
        <link rel="icon"
              type="image/png"
              sizes="96x96"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-96x96.png">
        <link rel="icon"
              type="image/png"
              sizes="128x128"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-128x128.png">
        <link rel="icon"
              type="image/png"
              sizes="196x196"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-196x196.png">
        <link rel="shortcut icon"
              type="image/png"
              href="https://assets.phalconphp.com/phalcon/favicon.ico"/>

        <link rel="alternate"
              type="application/rss+xml"
              title=" - "
              href="https://phalcon-docs4.netlify.com/feed.xml">

        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css"
              integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE="
              crossorigin="anonymous" />
        <link rel="stylesheet" href="/assets/css/monokai.css?v1547266080100021829" />
        <link rel="stylesheet" href="/assets/css/style.css?v1547266080100021829" />

        <script defer src="https://use.fontawesome.com/releases/v5.6.1/js/all.js"
                integrity="sha384-R5JkiUweZpJjELPWqttAYmYM1P3SNEJRM6ecTQF05pFFtxmCO+Y1CiUhvuDzgSVZ"
                crossorigin="anonymous"></script>
        
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90300500-6"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-90300500-6');
    </script>

    </head>


<body onclick="o2.allNavSlideUp()">
    <header class="header-image-doc">
        <div class="container">
            <div class="header-wrapper">
                <div class="clearfix">
                    <div class="row">
                        <div class="col-md-2 col-sm-3  col-xs-8">
                            <div class="header-image__logo-wrapper">
                                <a href="/3.4/es-es">
                                    <img class="logo-img" src="/assets/images/header_logo.svg" alt="logo">
                                </a>
                            </div>
                        </div>
                        <div class="col-md-10 col-sm-9 top-menu">

                            <div class="nav-icon" onclick="o2.showMobileMenu();">
                                <div class="nav-line"></div>
                                <div class="nav-line"></div>
                                <div class="nav-line"></div>
                            </div>
                            <nav class="header-nav">
                                <ul>
                                    <li class="nav-item" onclick="o2.toggleState(this, event);">
                                        <div class="nav-item_selected">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                 alt="">
                                            <span class="caret"></span>
                                        </div>
                                        <div class="nav-item__list" onclick="event.stopPropagation();">
                                            
                                                <a href="/3.4/en/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                         alt="English (US)">
                                                    English (US)
                                                </a>
                                            
                                                <a href="/3.4/cs-cz/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/cs.png"
                                                         alt="Czech">
                                                    Czech
                                                </a>
                                            
                                                <a href="/3.4/de-de/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/de.png"
                                                         alt="German">
                                                    German
                                                </a>
                                            
                                                <a href="/3.4/es-es/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                         alt="Spanish">
                                                    Spanish
                                                </a>
                                            
                                                <a href="/3.4/fa-ir/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fa.png"
                                                         alt="Persian">
                                                    Persian
                                                </a>
                                            
                                                <a href="/3.4/fr-fr/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fr.png"
                                                         alt="French">
                                                    French
                                                </a>
                                            
                                                <a href="/3.4/id-id/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/id.png"
                                                         alt="Indonesian">
                                                    Indonesian
                                                </a>
                                            
                                                <a href="/3.4/it-it/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/it.png"
                                                         alt="Italian">
                                                    Italian
                                                </a>
                                            
                                                <a href="/3.4/ja-jp/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ja.png"
                                                         alt="Japanese">
                                                    Japanese
                                                </a>
                                            
                                                <a href="/3.4/pl-pl/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/pl.png"
                                                         alt="Polish">
                                                    Polish
                                                </a>
                                            
                                                <a href="/3.4/ru-ru/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ru.png"
                                                         alt="Russian">
                                                    Russian
                                                </a>
                                            
                                                <a href="/3.4/tr-tr/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/tr.png"
                                                         alt="Turkish">
                                                    Turkish
                                                </a>
                                            
                                                <a href="/3.4/uk-ua/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/uk.png"
                                                         alt="Ukrainian">
                                                    Ukrainian
                                                </a>
                                            
                                                <a href="/3.4/zh-cn/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                                         alt="Chinese Simplified">
                                                    Chinese Simplified
                                                </a>
                                            
                                        </div>
                                    </li>

                                        <li class="nav-item" onclick="o2.toggleState(this, event);">
                                            <div class="nav-item__selected custom-select__version">
                                                 3.4
                                                <span class="caret"></span>
                                            </div>
                                            <div class="nav-item__list" onclick="event.stopPropagation();">
                                                
                                                <a href="/3.4/es-es/di" class="custom-select__list-item">
                                                    <span>3.4</span>
                                                </a>
                                                
                                                <a href="/3.3/es-es/di" class="custom-select__list-item">
                                                    <span>3.3</span>
                                                </a>
                                                
                                                <a href="/3.2/es-es/di" class="custom-select__list-item">
                                                    <span>3.2</span>
                                                </a>
                                                
                                                <a href="/3.1/es-es/di" class="custom-select__list-item">
                                                    <span>3.1</span>
                                                </a>
                                                
                                                <a href="/4.0/es-es/di" class="custom-select__list-item">
                                                    <span>4.0</span>
                                                </a>
                                                
                                            </div>
                                        </li>

                                    <li class="nav-item" onclick="o2.toggleState(this, event);">
                                        <div class="nav-item_selected">
                                            
                                            <span class="caret"></span>
                                        </div>
                                        <div class="nav-item__list">
                                            <a href="https://phalcon.link/forum" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/blog" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/resources" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <div class="nav-item__divider"></div>
                                            <a href="https://phalcon.link/f" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/t" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/gab" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/about">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/sponsors">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/fund">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/download">
                                            
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>

                        <div class="header-nav-mobile">
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this, event)">
                                    <img class="lang-image"
                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                         alt="">
                                    <span class="caret"></span>
                                </div>

                                <ul style="display:none;" class="clearfix" onclick="event.stopPropagation();">
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/en/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                 alt="English (US)">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/cs-cz/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/cs.png"
                                                 alt="Czech">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/de-de/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/de.png"
                                                 alt="German">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/es-es/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                 alt="Spanish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/fa-ir/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fa.png"
                                                 alt="Persian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/fr-fr/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fr.png"
                                                 alt="French">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/id-id/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/id.png"
                                                 alt="Indonesian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/it-it/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/it.png"
                                                 alt="Italian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/ja-jp/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ja.png"
                                                 alt="Japanese">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/pl-pl/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/pl.png"
                                                 alt="Polish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/ru-ru/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ru.png"
                                                 alt="Russian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/tr-tr/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/tr.png"
                                                 alt="Turkish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/uk-ua/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/uk.png"
                                                 alt="Ukrainian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/zh-cn/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                                 alt="Chinese Simplified">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                </ul>

                            </div>
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this,event)">
                                     3.4
                                    <span class="caret"></span>
                                </div>

                                <ul style="display:none;" class="clearfix" onclick="event.stopPropagation();">
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.4/es-es/di">
                                            <span>3.4</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.3/es-es/di">
                                            <span>3.3</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.2/es-es/di">
                                            <span>3.2</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.1/es-es/di">
                                            <span>3.1</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/4.0/es-es/di">
                                            <span>4.0</span>
                                        </a>
                                    </li>
                                    
                                </ul>

                            </div>
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this, event)">
                                    
                                    <span class="caret"></span>
                                </div>
                                <ul style="display:none;">
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/forum" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/blog" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/resources" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/f" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/t" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/gab" target="_blank">
                                            
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/about">
                                    
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/sponsors">
                                    
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/fund">
                                    
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/download">
                                    
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>


    <div class="container-fluid article-page-wrap">
        <div class="row">
            <div>
                <div class="col-md-2 sidebar hidden-xs">
                    <div class="sidebar--spacer">&nbsp;</div>
                </div>
                <div class="m-t-md m-b-lg" id="articles">
                    <div class="article-content">
                        







                        <section class="documentation-section">
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-md-8 col-lg-9 parse-content">
                                        <div>
                                            <a class="article-content-edit-link pull-right"
                                               href="https://crowdin.com/project/phalcon-documentation/es-es">
                                                
                                            </a>
                                            <br>
                                        </div>
                                        <p><a name="di-service-location"></a></p>

<h1 id="inyector-de-dependencias--localización-de-servicios">Inyector de Dependencias / Localización de Servicios</h1>

<p><a name="di-explained"></a></p>

<h2 id="di-explicado">DI explicado</h2>

<p>El siguiente ejemplo es un poco largo, pero trata de explicar por qué Phalcon utiliza la inyección de dependencia y la localización de servicios. Primero, supongamos que estamos desarrollando un componente llamado <code>SomeComponent</code>. Este realiza algunas tareas. Nuestro componente tiene una dependencia, que es una conexión a base de datos.</p>

<p>En el primer ejemplo, la conexión es creada dentro del componente. Aunque se trata de una implementación perfectamente válida, no es práctica, debido a que no podemos cambiar los parámetros de conexión o el tipo de base de datos, ya que el componente sólo funciona de la forma en que fue creado.</p>

<pre><code class="language-php">&lt;?php

class SomeComponent
{
    /**
     * La instancia de la conexión está codificada dentro
     * del componente, por lo tanto, es difícil reemplazarla externamente
     * o cambiar su comportamiento
     */
    public function someDbTask()
    {
        $connection = new Connection(
            [
                'host'     =&gt; 'localhost',
                'username' =&gt; 'root',
                'password' =&gt; 'secret',
                'dbname'   =&gt; 'invo',
            ]
        );

        // ...
    }
}

$some = new SomeComponent();

$some-&gt;someDbTask();
</code></pre>

<p>To solve this shortcoming, we have created a setter that injects the dependency externally before using it. This is also a valid implementation but has its shortcomings:</p>

<pre><code class="language-php">&lt;?php

class SomeComponent
{
    private $connection;

    /**
     * Configurar la conexión externamente
     *
     * @param Connection $connection
     */
    public function setConnection(Connection $connection)
    {
        $this-&gt;connection = $connection;
    }

    public function someDbTask()
    {
        $connection = $this-&gt;connection;

        // ...
    }
}

$some = new SomeComponent();

// Crear la conexión
$connection = new Connection(
    [
        'host'     =&gt; 'localhost',
        'username' =&gt; 'root',
        'password' =&gt; 'secret',
        'dbname'   =&gt; 'invo',
    ]
);

// Inyectar la conexión en el componente
$some-&gt;setConnection($connection);

$some-&gt;someDbTask();
</code></pre>

<p>Ahora consideremos que utilizamos este componente en diferentes partes de la aplicación; entonces necesitaremos crear la conexión varias veces antes de pasarla al componente. Usando un patrón de registro global, podemos almacenar el objeto de conexión ahí y reutilizarlo siempre que lo necesitemos.</p>

<pre><code class="language-php">&lt;?php

class Registry
{
    /**
     * Retornar la conexión
     */
    public static function getConnection()
    {
        return new Connection(
            [
                'host'     =&gt; 'localhost',
                'username' =&gt; 'root',
                'password' =&gt; 'secret',
                'dbname'   =&gt; 'invo',
            ]
        );
    }
}

class SomeComponent
{
    protected $connection;

    /**
     * Establecer la conexión externamente
     *
     * @param Connection $connection
     */
    public function setConnection(Connection $connection)
    {
        $this-&gt;connection = $connection;
    }

    public function someDbTask()
    {
        $connection = $this-&gt;connection;

        // ...
    }
}

$some = new SomeComponent();

// Pasamos la conexión definida en el registro
$some-&gt;setConnection(Registry::getConnection());

$some-&gt;someDbTask();
</code></pre>

<p>Ahora, imaginemos que debemos implementar dos métodos en el componente, el primero siempre necesita crear una conexión nueva y el segundo siempre necesita utilizar una conexión compartida:</p>

<pre><code class="language-php">&lt;?php

class Registry
{
    protected static $connection;

    /**
     * Crea una conexión
     *
     * @return Connection
     */
    protected static function createConnection(): Connection
    {
        return new Connection(
            [
                'host'     =&gt; 'localhost',
                'username' =&gt; 'root',
                'password' =&gt; 'secret',
                'dbname'   =&gt; 'invo',
            ]
        );
    }

    /**
     * Crea una conexión una sola vez y la devuelve
     *
     * @return Connection
     */
    public static function getSharedConnection(): Connection
    {
        if (self::$connection === null) {
            self::$connection = self::createConnection();
        }

        return self::$connection;
    }

    /**
     * Siempre regresa una nueva conexión
     *
     * @return Connection
     */
    public static function getNewConnection(): Connection
    {
        return self::createConnection();
    }
}

class SomeComponent
{
    protected $connection;

    /**
     * Establece una conexión externa
     *
     * @param Connection $connection
     */
    public function setConnection(Connection $connection)
    {
        $this-&gt;connection = $connection;
    }

    /**
     * Este método siempre regresa una conexión compartida
     */
    public function someDbTask()
    {
        $connection = $this-&gt;connection;

        // ...
    }

    /**
     * Este método siempre necesita una nueva conexión
     *
     * @param Connection $connection
     */
    public function someOtherDbTask(Connection $connection)
    {

    }
}

$some = new SomeComponent();

// Esto inyecta una conexión compartida
$some-&gt;setConnection(
    Registry::getSharedConnection()
);

$some-&gt;someDbTask();

// Siempre pasamos una nueva conexión como parámetro
$some-&gt;someOtherDbTask(
    Registry::getNewConnection()
);
</code></pre>

<p>Hasta ahora hemos visto cómo la inyección de dependencias resolvió nuestros problemas. Pasando las dependencias como argumentos en lugar de crearlas internamente en el código, haciendo a nuestra aplicación más mantenible y desacoplada. Sin embargo, a la larga, esta forma de inyección de dependencias tiene algunas desventajas.</p>

<p>Por ejemplo, si el componente tiene muchas dependencias, necesitaremos crear múltiples argumentos setter para pasar las dependencias o crear un constructor que las pase con muchos argumentos, creando (todas las veces) dependencias adicionales antes de usar el componente, haciendo a nuestro código no sea tan fácil de mantener como nos gustaría:</p>

<pre><code class="language-php">&lt;?php

// Crear dependencias u obtenerlas del registro
$connection = new Connection();
$session    = new Session();
$fileSystem = new FileSystem();
$filter     = new Filter();
$selector   = new Selector();

// Pasarlas después como parámetros del constructor
$some = new SomeComponent($connection, $session, $fileSystem, $filter, $selector);

// ... O utilizando setters
$some-&gt;setConnection($connection);
$some-&gt;setSession($session);
$some-&gt;setFileSystem($fileSystem);
$some-&gt;setFilter($filter);
$some-&gt;setSelector($selector);
</code></pre>

<p>Piense ahora, si tuviéramos que crear este objeto en muchas partes de nuestra aplicación. En el futuro, si no requerimos ninguna de las dependencias, tenemos que ir a través de todo el código fuente para quitar el parámetro en cualquier constructor o setter donde inyectamos el código. Para solucionar esto, volvemos otra vez a un registro global para crear el componente. Sin embargo, se añade una nueva capa de abstracción antes de crear el objeto:</p>

<pre><code class="language-php">&lt;?php

class SomeComponent
{
    // ...

    /**
     * Definir un método factory para crear instancias de SomeComponent e inyectar las dependencias
     */
    public static function factory()
    {
        $connection = new Connection();
        $session    = new Session();
        $fileSystem = new FileSystem();
        $filter     = new Filter();
        $selector   = new Selector();

        return new self($connection, $session, $fileSystem, $filter, $selector);
    }
}
</code></pre>

<p>Now we find ourselves back where we started, we are again building the dependencies inside of the component! We must find a solution that keeps us from repeatedly falling into bad practices.</p>

<p>Una forma práctica y elegante de solucionar estos problemas es utilizando un contenedor para las dependencias. Los contenedores actúan como el registro global que vimos anteriormente. Utilizando el contenedor para las dependencias como un puente para obtenerlas permitiendo reducir la complejidad de nuestro componente:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Di;
use Phalcon\DiInterface;

class SomeComponent
{
    protected $di;

    public function __construct(DiInterface $di)
    {
        $this-&gt;di = $di;
    }

    public function someDbTask()
    {
        // Obtiene el servicio de conexión
        // Siempre devuelve una conexión nueva 
        $connection = $this-&gt;di-&gt;get('db');
    }

    public function someOtherDbTask()
    {
        // Obtiene el servicio de conexión compartida
        // Siempre regresa la misma conexión
        $connection = $this-&gt;di-&gt;getShared('db');

        // Este método requiere el servicio 'filter'
        $filter = $this-&gt;di-&gt;get('filter');
    }
}

$di = new Di();

// Registrar el servicio 'db' en el contenedor
$di-&gt;set(
    'db',
    function () {
        return new Connection(
            [
                'host'     =&gt; 'localhost',
                'username' =&gt; 'root',
                'password' =&gt; 'secret',
                'dbname'   =&gt; 'invo',
            ]
        );
    }
);

// Registrar el servicio 'filter' en el contenedor
$di-&gt;set(
    'filter',
    function () {
        return new Filter();
    }
);

// Registrar el servicio 'session' en el contenedor
$di-&gt;set(
    'session',
    function () {
        return new Session();
    }
);

// Pasamos al contenedor de servicios como único parámetro
$some = new SomeComponent($di);

$some-&gt;someDbTask();
</code></pre>

<p>El componente ahora puede simplemente acceder al servicio que requiere cuando lo necesita, si no requiere un servicio ni si quiera se inicializa, ahorrando recursos. El componente ahora es altamente desvinculado. Por ejemplo, podemos cambiar la manera en que las conexiones se crean, su comportamiento o cualquier otro aspecto de ellas y no afectaría al componente en si.</p>

<p><a href="api/Phalcon_Di">Phalcon\Di</a> is a component implementing Dependency Injection and Location of services and it’s itself a container for them.</p>

<p>Since Phalcon is highly decoupled, <a href="api/Phalcon_Di">Phalcon\Di</a> is essential to integrate the different components of the framework. El desarrollador también puede utilizar este componente para inyectar dependencias y administrar instancias globales de las diferentes clases que se utilizan en la aplicación.</p>

<p>Básicamente, este componente implementa el patrón de <a href="http://en.wikipedia.org/wiki/Inversion_of_control">Inversión de Control</a>. Aplicando esto, los objetos no reciben sus dependencias usando configuradores o constructores, sino solicitando un servicios de inyección de dependencias. Esto reduce la complejidad total, puesto que hay solamente una manera de conseguir las dependencias necesarias dentro de un componente.</p>

<p>Además, este patrón aumenta la posibilidad de pruebas con el código, por lo que es menos propenso a errores.</p>

<p><a name="registering-services"></a></p>

<h2 id="registrando-servicios-en-el-contenedor">Registrando Servicios en el Contenedor</h2>

<p>El framework mismo o el desarrollador pueden registrar servicios. Cuando un componente A requiere del componente B (o una instancia de su clase) para funcionar, puede solicitar el componente B desde el contenedor, en lugar de crear un nuevo componente de la instancia B.</p>

<p>Esta forma de trabajar nos da muchas ventajas:</p>

<ul>
  <li>Podemos fácilmente reemplazar un componente con uno creado por nosotros mismos o por un tercero.</li>
  <li>Tenemos control total de la inicialización del objeto, lo que nos permite definir estos objetos según sea necesario antes de entregarlos a los componentes.</li>
  <li>Podemos obtener instancias globales de los componentes en forma estructurada y unificada.</li>
</ul>

<p>Los servicios pueden ser registrados utilizando varios tipos de definiciones:</p>

<p><a name="simple-registration"></a></p>

<h3 id="registro-simple">Registro simple</h3>

<p>As seen before, there are several ways to register services. These we call simple:</p>

<p><a name="simple-registration-string"></a></p>

<h4 id="cadena-de-caracteres-string">Cadena de caracteres (string)</h4>

<p>Este tipo espera el nombre de una clase válida, retornando un objecto de la clase especificada, si la clase no esta cargada, será instanciada utilizando un cargador automático. Este tipo de definición no permite para especificar argumentos o parámetros para el constructor de la clase:</p>

<pre><code class="language-php">&lt;?php

// Retorna new Phalcon\Http\Request();
$di-&gt;set(
    'request',
    'Phalcon\Http\Request'
);
</code></pre>

<p><a name="class-instances"></a></p>

<h4 id="instancias-de-clase">Instancias de clase</h4>

<p>Este tipo espera un objeto. Como el objeto no necesita ser resuelto debido a que ya es un objeto, se podría decir que en realidad no es una inyección de dependencia, sin embargo, es útil si desea forzar la dependencia de retorno a ser siempre el mismo valor u objeto:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Http\Request;

// Retorna new Phalcon\Http\Request();
$di-&gt;set(
    'request',
    new Request()
);
</code></pre>

<p><a name="closures-anonymous-functions"></a></p>

<h4 id="closuresfunciones-anónimas">Closures/Funciones anónimas</h4>

<p>Este método ofrece una mayor libertad para construir la dependencia como se desee, sin embargo, es difícil cambiar algunos de los parámetros desde el exterior sin tener que cambiar por completo la definición de dependencia:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Db\Adapter\Pdo\Mysql as PdoMysql;

$di-&gt;set(
    'db',
    function () {
        return new PdoMysql(
            [
                'host'     =&gt; 'localhost',
                'username' =&gt; 'root',
                'password' =&gt; 'secret',
                'dbname'   =&gt; 'blog',
            ]
        );
    }
);
</code></pre>

<p>Algunas de las limitaciones pueden superarse pasando variables adicionales al entorno del cierre:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Config;
use Phalcon\Db\Adapter\Pdo\Mysql as PdoMysql;

$config = new Config(
    [
        'host'     =&gt; '127.0.0.1',
        'username' =&gt; 'user',
        'password' =&gt; 'pass',
        'dbname'   =&gt; 'my_database',
    ]
);

// Utilizando la variable $config en el ámbito actual
$di-&gt;set(
    'db',
    function () use ($config) {
        return new PdoMysql(
            [
                'host'     =&gt; $config-&gt;host,
                'username' =&gt; $config-&gt;username,
                'password' =&gt; $config-&gt;password,
                'dbname'   =&gt; $config-&gt;name,
            ]
        );
    }
);
</code></pre>

<p>También puede acceder a otros servicios del DI con el método <code>get()</code>:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Config;
use Phalcon\Db\Adapter\Pdo\Mysql as PdoMysql;

$di-&gt;set(
    'config',
    function () {
        return new Config(
            [
                'host'     =&gt; '127.0.0.1',
                'username' =&gt; 'user',
                'password' =&gt; 'pass',
                'dbname'   =&gt; 'my_database',
            ]
        );
    }
);

// Usando el servicio 'config' desde el DI
$di-&gt;set(
    'db',
    function () {
        $config = $this-&gt;get('config');

        return new PdoMysql(
            [
                'host'     =&gt; $config-&gt;host,
                'username' =&gt; $config-&gt;username,
                'password' =&gt; $config-&gt;password,
                'dbname'   =&gt; $config-&gt;name,
            ]
        );
    }
);
</code></pre>

<p><a name="complex-registration"></a></p>

<h3 id="registro-complejo">Registro Complejo</h3>

<p>Si es necesario cambiar la definición de un servicio sin crear instancias/resolver el servicio, entonces, necesitamos definir los servicios utilizando la sintaxis de matriz. Definir un servicio utilizando una definición de matriz puede ser un poco más detallado:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Logger\Adapter\File as LoggerFile;

// Registrar un servicio 'logger' con nombre de clase y sus parámetros
$di-&gt;set(
    'logger',
    [
        'className' =&gt; 'Phalcon\Logger\Adapter\File',
        'arguments' =&gt; [
            [
                'type'  =&gt; 'parameter',
                'value' =&gt; '../apps/logs/error.log',
            ]
        ]
    ]
);

// Utilizando una función anónima
$di-&gt;set(
    'logger',
    function () {
        return new LoggerFile('../apps/logs/error.log');
    }
);
</code></pre>

<p>Both service registrations above produce the same result. The array definition however, allows for alteration of the service parameters if needed:</p>

<pre><code class="language-php">&lt;?php

// Cambiar el nombre de clase del servicio
$di
    -&gt;getService('logger')
    -&gt;setClassName('MyCustomLogger');

// Cambiar el primer parámetro sin instanciar al logger
$di
    -&gt;getService('logger')
    -&gt;setParameter(
        0,
        [
            'type'  =&gt; 'parameter',
            'value' =&gt; '../apps/logs/error.log',
        ]
    );
</code></pre>

<p>Además mediante la sintaxis de matriz, puede utilizar tres tipos de inyección de dependencias:</p>

<p><a name="constructor-injection"></a></p>

<h4 id="inyección-de-contructores">Inyección de Contructores</h4>

<p>This injection type passes the dependencies/arguments to the class constructor. Let’s pretend we have the following component:</p>

<pre><code class="language-php">&lt;?php

namespace SomeApp;

use Phalcon\Http\Response;

class SomeComponent
{
    /**
     * @var Response
     */
    protected $response;

    protected $someFlag;



    public function __construct(Response $response, $someFlag)
    {
        $this-&gt;response = $response;
        $this-&gt;someFlag = $someFlag;
    }
}
</code></pre>

<p>El servicio puede registrarse de esta manera:</p>

<pre><code class="language-php">&lt;?php

$di-&gt;set(
    'response',
    [
        'className' =&gt; 'Phalcon\Http\Response'
    ]
);

$di-&gt;set(
    'someComponent',
    [
        'className' =&gt; 'SomeApp\SomeComponent',
        'arguments' =&gt; [
            [
                'type' =&gt; 'service',
                'name' =&gt; 'response',
            ],
            [
                'type'  =&gt; 'parameter',
                'value' =&gt; true,
            ],
        ]
    ]
);
</code></pre>

<p>The service ‘response’ (<a href="api/Phalcon_Http_Response">Phalcon\Http\Response</a>) is resolved to be passed as the first argument of the constructor, while the second is a boolean value (true) that is passed as it is.</p>

<p><a name="setter-injection"></a></p>

<h4 id="inyección-de-configuraciones">Inyección de Configuraciones</h4>

<p>Las clases pueden tener setters para inyectar dependencias opcionales, nuestra clase anterior, puede modificarse para aceptar las dependencias con setters:</p>

<pre><code class="language-php">&lt;?php

namespace SomeApp;

use Phalcon\Http\Response;

class SomeComponent
{
    /**
     * @var Response
     */
    protected $response;

    protected $someFlag;

    public function setResponse(Response $response)
    {
        $this-&gt;response = $response;
    }

    public function setFlag($someFlag)
    {
        $this-&gt;someFlag = $someFlag;
    }
}
</code></pre>

<p>Un servicio con setter de inyección puede ser registrado de la siguiente manera:</p>

<pre><code class="language-php">&lt;?php

$di-&gt;set(
    'response',
    [
        'className' =&gt; 'Phalcon\Http\Response',
    ]
);

$di-&gt;set(
    'someComponent',
    [
        'className' =&gt; 'SomeApp\SomeComponent',
        'calls'     =&gt; [
            [
                'method'    =&gt; 'setResponse',
                'arguments' =&gt; [
                    [
                        'type' =&gt; 'service',
                        'name' =&gt; 'response',
                    ]
                ]
            ],
            [
                'method'    =&gt; 'setFlag',
                'arguments' =&gt; [
                    [
                        'type'  =&gt; 'parameter',
                        'value' =&gt; true,
                    ]
                ]
            ]
        ]
    ]
);
</code></pre>

<p><a name="properties-injection"></a></p>

<h4 id="inyección-de-propiedades">Inyección de Propiedades</h4>

<p>Una estrategia menos común es inyectar dependencias o parámetros en atributos públicos de la clase:</p>

<pre><code class="language-php">&lt;?php

namespace SomeApp;

use Phalcon\Http\Response;

class SomeComponent
{
    /**
     * @var Response
     */
    public $response;

    public $someFlag;
}
</code></pre>

<p>Un servicio con propiedades de inyección puede ser registrado de la siguiente manera:</p>

<pre><code class="language-php">&lt;?php

$di-&gt;set(
    'response',
    [
        'className' =&gt; 'Phalcon\Http\Response',
    ]
);

$di-&gt;set(
    'someComponent',
    [
        'className'  =&gt; 'SomeApp\SomeComponent',
        'properties' =&gt; [
            [
                'name'  =&gt; 'response',
                'value' =&gt; [
                    'type' =&gt; 'service',
                    'name' =&gt; 'response',
                ],
            ],
            [
                'name'  =&gt; 'someFlag',
                'value' =&gt; [
                    'type'  =&gt; 'parameter',
                    'value' =&gt; true,
                ],
            ]
        ]
    ]
);
</code></pre>

<p>Los tipos de parámetros soportados son los siguientes:</p>

<table>
  <tr>
    <th>
      Tipo
    </th>
    
    <th>
      Descripción
    </th>
    
    <th>
      Ejemplo
    </th>
  </tr>
  
  <tr>
    <td>
      parameter
    </td>
    
    <td>
      Representa un valor literal que se pasa como parámetro
    </td>
    
    <td>
      <pre><code>php['type' =&gt; 'parameter', 'value' =&gt; 1234]</code></pre>
    </td>
  </tr>
  
  <tr>
    <td>
      service
    </td>
    
    <td>
      Representa otro servicio en el contenedor de servicio
    </td>
    
    <td>
      <pre><code>php['type' =&gt; 'service', 'name' =&gt; 'request']</code></pre>
    </td>
  </tr>
  
  <tr>
    <td>
      instance
    </td>
    
    <td>
      Representa un objeto que debe ser construido de forma dinámica
    </td>
    
    <td>
      <pre><code>php['type' =&gt; 'instance', 'className' =&gt; 'DateTime', 'arguments' =&gt; ['now']]</code></pre>
    </td>
  </tr>
</table>

<p>Resolving a service whose definition is complex may be slightly slower than simple definitions seen previously. However, these provide a more robust approach to define and inject services.</p>

<p>Es posible mezclar de diferentes tipos de definiciones, cada uno puede decidir cuál es la manera más apropiada para registrar los servicios según las necesidades de su aplicación.</p>

<p><a name="array-syntax"></a></p>

<h3 id="sintaxis-de-array">Sintaxis de array</h3>

<p>Con la sintaxis de array o matriz también se puede registrar servicios:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Di;
use Phalcon\Http\Request;

// Crear un contenedor de inyección de dependencias
$di = new Di();

// Por su nombre de clase
$di['request'] = 'Phalcon\Http\Request';

// Usando una función anónima, la instancia será con carga peresoza
$di['request'] = function () {
    return new Request();
};

// Registrando una instancia directamente
$di['request'] = new Request();

// Utilizando un array como definición
$di['request'] = [
    'className' =&gt; 'Phalcon\Http\Request',
];
</code></pre>

<p>En los ejemplos anteriores, cuando el framework necesite acceder a los datos de la solicitud, pedirá el servicio identificado como ‘request’ en el contenedor. El contenedor a su vez devolverá una instancia del servicio requerido. Un desarrollador puede eventualmente reemplazar un componente cuando lo necesite.</p>

<p>Cada uno de los métodos (demostrados en los ejemplos anteriores) utilizados para el sistema el registro de un servicio tienen ventajas y desventajas. Es el desarrollador y los requisitos particulares que se designan cual debe ser utilizado.</p>

<p>Establecer un servicio por una cadena de texto es simple, pero carece de flexibilidad. La configuración de servicios mediante una matriz ofrece mucho más flexibilidad, pero hace al código más complicado. La función lambda es un buen equilibrio entre ambos, pero podría conducir a más mantenimiento del que uno esperaría.</p>

<p><a href="api/Phalcon_Di">Phalcon\Di</a> offers lazy loading for every service it stores. A menos que el desarrollador decida instanciar un objeto directamente y guardarlo en el contenedor, cualquier objeto almacenado en él (a través de array, cadena, etc.) será con carga perezosa, es decir, instanciado sólo cuando se solicite.</p>

<p><a name="loading-from-yaml"></a></p>

<h3 id="cargando-servicios-desde-archivos-yaml">Cargando servicios desde archivos YAML</h3>

<p>This feature will let you set your services in <code>yaml</code> files or just in plain php. For example you can load services using a <code>yaml</code> file like this:</p>

<pre><code class="language-yaml">config:
  className: \Phalcon\Config
  shared: true
</code></pre>

<pre><code class="language-php">&lt;?php

use Phalcon\Di;

$di = new Di();
$di-&gt;loadFromYaml('services.yml');
$di-&gt;get('config'); // Se obtendrá el servicio config
</code></pre>

<div class="alert alert-danger">
    <p>
        This approach requires that the module Yaml be installed. Please refer to <a href="http://php.net/manual/book.yaml.php">this</a> for more information.
    </p>
</div>

<p><a name="resolving-services"></a></p>

<h2 id="resolviendo-servicios">Resolviendo Servicios</h2>

<p>Obtaining a service from the container is a matter of simply calling the ‘get’ method. A new instance of the service will be returned:</p>

<pre><code class="language-php">$request = $di-&gt;get('request');
</code></pre>

<p>O llamando a través del método mágico:</p>

<pre><code class="language-php">$request = $di-&gt;getRequest();
</code></pre>

<p>O usando la sintaxis de matriz de acceso:</p>

<pre><code class="language-php">$request = $di['request'];
</code></pre>

<p>Se pueden pasar argumentos al constructor mediante la adición de un parámetro de matriz al método <code>get()</code>:</p>

<pre><code class="language-php">&lt;?php

// new MyComponent('some-parameter', 'other')
$component = $di-&gt;get(
    'MyComponent',
    [
        'some-parameter',
        'other',
    ]
);
</code></pre>

<p><a name="envents"></a></p>

<h3 id="eventos">Eventos</h3>

<p><a href="api/Phalcon_Di">Phalcon\Di</a> is able to send events to an <a href="/3.4/en/events">EventsManager</a> if it is present. Los eventos son disparados usando el tipo ‘di’. Si algún evento devuelve <code>false</code> podría detener la operación activa. Son soportados los siguientes eventos:</p>

<table>
  <thead>
    <tr>
      <th>Nombre de Evento</th>
      <th>Activador</th>
      <th style="text-align: center">¿Puede detener la operación?</th>
      <th style="text-align: center">Activa en</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>beforeServiceResolve</td>
      <td>Ejecutado antes de resolver el servicio. Los oyentes reciben el nombre del servicio y los parámetros pasados en el.</td>
      <td style="text-align: center">No</td>
      <td style="text-align: center">Oyentes</td>
    </tr>
    <tr>
      <td>afterServiceResolve</td>
      <td>Ejecutado después de resolver el servicio. Los oyentes reciben el nombre de servicio, la instancia y los parámetros pasados a él.</td>
      <td style="text-align: center">No</td>
      <td style="text-align: center">Oyentes</td>
    </tr>
  </tbody>
</table>

<p><a name="shared-services"></a></p>

<h2 id="servicios-compartidos">Servicios Compartidos</h2>

<p>Los servicios pueden ser registrados como servicios ‘compartidos’ esto significa que siempre actuarán como <a href="http://en.wikipedia.org/wiki/Singleton_pattern">singletons</a>. Una vez que el servicio se resuelve por primera vez, la misma instancia del mismo, se devuelve cada vez que un consumidor solicita el servicio del contenedor:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Session\Adapter\Files as SessionFiles;

// Registrar el servicio de sesión como 'siempre compartido'
$di-&gt;setShared(
    'session',
    function () {
        $session = new SessionFiles();

        $session-&gt;start();

        return $session;
    }
);

// Obtenemos el servicio por primera vez
$session = $di-&gt;get('session');

// Retorna el primer objecto instanciado
$session = $di-&gt;getSession();
</code></pre>

<p>Una forma alternativa para registrar servicios compartidos, es pasar el valor <code>true</code> como tercer parámetro del método <code>set()</code>:</p>

<pre><code class="language-php">&lt;?php

// Registrar el servicio de sesión como 'siempre compartido'
$di-&gt;set(
    'session',
    function () {
        // ...
    },
    true
);
</code></pre>

<p>Si un servicio no está registrado como compartido y usted quiere estar seguro de que una instancia compartida se accederá cada vez que el servicio se obtiene desde el DI, se puede utilizar el método <code>getShared()</code>:</p>

<pre><code class="language-php">$request = $di-&gt;getShared('request');
</code></pre>

<p><a name="manipulating-services-individually"></a></p>

<h2 id="manipulación-individual-de-servicios">Manipulación individual de servicios</h2>

<p>Una vez que un servicio está registrado en el contenedor de servicios, se puede acceder para manipularlo individualmente:</p>

<pre><code class="language-php">    &lt;?php

    use Phalcon\Http\Request;

    // Registrar el servicio 'request'
    $di-&gt;set('request', 'Phalcon\Http\Request');

    // Obtener el servicio
    $requestService = $di-&gt;getService('request');

    // Cambiar la definición
    $requestService-&gt;setDefinition(
        function () {
            return new Request();
        }
    );

    // Compartir el servicio
    $requestService-&gt;setShared(true);

    // Resolver el servicio(retorna una instancia de Phalcon\Http\Request)
    $request = $requestService-&gt;resolve();
</code></pre>

<p><a name="instantiating-classes-service-container"></a></p>

<h2 id="instanciando-clases-a-través-del-contenedor-de-servicios">Instanciando clases a través del Contenedor de Servicios</h2>

<p>Cuando usted solicita un servicio al contenedor de servicios, si no se puede encontrar un servicio con el mismo nombre, se intentará cargar una clase con el mismo nombre. Con este comportamiento podemos reemplazar cualquier clase por otra, simplemente registrándo un servicio con su nombre:</p>

<pre><code class="language-php">&lt;?php

// Registrar un controlador como un servicio
$di-&gt;set(
    'IndexController',
    function () {
        $component = new Component();

        return $component;
    },
    true
);

// Registrar un controlador como un servicio
$di-&gt;set(
    'MyOtherComponent',
    function () {
        // Actualmente retorna otro componente
        $component = new AnotherComponent();

        return $component;
    }
);

// Crear una instancia a través del contenedor de servicios
$myComponent = $di-&gt;get('MyOtherComponent');
</code></pre>

<p>Usted puede tomar ventaja de esto, siempre instanciando sus clases mediante el contenedor de servicio (incluso si no están registradas como servicios). Finalmente el DI recurrirá a un autocargador válido para cargar la clase. Haciendo esto, puede substituir fácilmente cualquier clase en el futuro mediante la aplicación de una definición para ella.</p>

<p><a name="automatic-injecting-di-itself"></a></p>

<h2 id="auto-inyección-del-di">Auto inyección del DI</h2>

<p>If a class or component requires the DI itself to locate services, the DI can automatically inject itself to the instances it creates, to do this, you need to implement the <a href="api/Phalcon_Di_InjectionAwareInterface">Phalcon\Di\InjectionAwareInterface</a> in your classes:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\DiInterface;
use Phalcon\Di\InjectionAwareInterface;

class MyClass implements InjectionAwareInterface
{
    /**
     * @var DiInterface
     */
    protected $di;


    public function setDi(DiInterface $di)
    {
        $this-&gt;di = $di;
    }

    public function getDi()
    {
        return $this-&gt;di;
    }
}
</code></pre>

<p>Entonces una vez que el servicio es resuelto, el <code>$di</code> se pasará a <code>setDi()</code> automáticamente:</p>

<pre><code class="language-php">&lt;?php

// Registrar el servicio
$di-&gt;set('myClass', 'MyClass');

// Resolver el servicio (NOTA: $myClass-&gt;setDi($di) es llamado automáticamente)
$myClass = $di-&gt;get('myClass');
</code></pre>

<p><a name="organizing-services-files"></a></p>

<h2 id="organizando-servicios-en-archivos">Organizando Servicios en Archivos</h2>

<p>Puede organizar mejor su aplicación moviendo el registro de servicios a archivo individuales, en lugar de hacer todo en el arranque de la aplicación:</p>

<pre><code class="language-php">&lt;?php

$di-&gt;set(
    'router',
    function () {
        return include '../app/config/routes.php';
    }
);
</code></pre>

<p>Entonces en el archivo (<code>'../app/config/routes.php'</code>) devolvera el objeto resuelto:</p>

<pre><code class="language-php">&lt;?php

$router = new MyRouter();

$router-&gt;post('/login');

return $router;
</code></pre>

<p><a name="accessing-di-static-way"></a></p>

<h2 id="accediendo-al-di-en-forma-estática">Accediendo al DI en forma estática</h2>

<p>Si es necesario, puede acceder a la última DI creada en una función estática de la siguiente manera:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Di;

class SomeComponent
{
    public static function someMethod()
    {
        // Obtener el servicio de sesión
        $session = Di::getDefault()-&gt;getSession();
    }
}
</code></pre>

<p><a name="service-providers"></a></p>

<h2 id="proveedores-de-servicio">Proveedores de Servicio</h2>

<p>Using the <code>ServiceProviderInterface</code> you now register services by context. You can move all your <code>$di-&gt;set()</code> calls to classes like this:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Di\ServiceProviderInterface;
use Phalcon\DiInterface;
use Phalcon\Di;
use Phalcon\Config\Adapter\Ini;

class SomeServiceProvider implements ServiceProviderInterface
{
    public function register(DiInterface $di)
    {
        $di-&gt;set(
            'config', 
            function () {
                return new Ini('config.ini');
            }
        );
    }
}

$di = new Di();
$di-&gt;register(new SomeServiceProvider());
var_dump($di-&gt;get('config')); // Retornará nuestro config
</code></pre>

<p><a name="factory-default-di"></a></p>

<h2 id="factory-por-defecto-de-di">Factory por defecto de DI</h2>

<p>Aunque el carácter desacoplado de Phalcon nos ofrece gran libertad y flexibilidad, quizás simplemente queremos utilizarlo como un framework completo. To achieve this, the framework provides a variant of <a href="api/Phalcon_Di">Phalcon\Di</a> called <a href="api/Phalcon_Di_FactoryDefault">Phalcon\Di\FactoryDefault</a>. Esta clase automáticamente registra los servicios adecuados con el framework para actuar como full-stack.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Di\FactoryDefault;

$di = new FactoryDefault();
</code></pre>

<p><a name="service-name-conventions"></a></p>

<h2 id="convenciones-de-nombres-de-servicios">Convenciones de nombres de servicios</h2>

<p>Aunque puede registrar servicios con los nombres que desee, Phalcon tiene unas cuantas convenciones de nomenclatura que permitan que se la el servicio correcto (pre integrados) cuando lo necesite.</p>

<table>
  <thead>
    <tr>
      <th>Nombre del servicio</th>
      <th>Descripción</th>
      <th>Por defecto</th>
      <th style="text-align: center">Compartido</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>assets</td>
      <td>Gestión de Activos (Assets)</td>
      <td><a href="api/Phalcon_Assets_Manager">Phalcon\Assets\Manager</a></td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>annotations</td>
      <td>Analizador de anotaciones</td>
      <td><a href="api/Phalcon_Annotations_Adapter_Memory">Phalcon\Annotations\Adapter\Memory</a></td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>cookies</td>
      <td>Servicio de gestión de Cookies HTTP</td>
      <td><a href="api/Phalcon_Http_Response_Cookies">Phalcon\Http\Response\Cookies</a></td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>crypt</td>
      <td>Encriptar/Desencriptar datos</td>
      <td><a href="api/Phalcon_Crypt">Phalcon\Crypt</a></td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>db</td>
      <td>Servicio de conexión de base de datos de bajo nivel</td>
      <td><a href="api/Phalcon_Db">Phalcon\Db</a></td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>dispatcher</td>
      <td>Servicio de despacho de controladores</td>
      <td><a href="api/Phalcon_Mvc_Dispatcher">Phalcon\Mvc\Dispatcher</a></td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>eventsManager</td>
      <td>Servicio de gestión de eventos</td>
      <td><a href="api/Phalcon_Events_Manager">Phalcon\Events\Manager</a></td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>escaper</td>
      <td>Escapado contextual</td>
      <td><a href="api/Phalcon_Escaper">Phalcon\Escaper</a></td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>flash</td>
      <td>Servicio de mensajería Flash</td>
      <td><a href="api/Phalcon_Flash_Direct">Phalcon\Flash\Direct</a></td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>flashSession</td>
      <td>Servicio de mensajería Flash en sesión</td>
      <td><a href="api/Phalcon_Flash_Session">Phalcon\Flash\Session</a></td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>filter</td>
      <td>Servicio de filtrado de entrada</td>
      <td><a href="api/Phalcon_Filter">Phalcon\Filter</a></td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>modelsCache</td>
      <td>Cache de modelos para cacheos en Backend</td>
      <td>Nada</td>
      <td style="text-align: center">No</td>
    </tr>
    <tr>
      <td>modelsManager</td>
      <td>Servicio de gestión de modelos</td>
      <td><a href="api/Phalcon_Mvc_Model_Manager">Phalcon\Mvc\Model\Manager</a></td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>modelsMetadata</td>
      <td>Servicio de metadatos de modelos</td>
      <td><a href="api/Phalcon_Mvc_Model_MetaData_Memory">Phalcon\Mvc\Model\MetaData\Memory</a></td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>request</td>
      <td>Servicio de entorno de solicitud HTTP</td>
      <td><a href="api/Phalcon_Http_Request">Phalcon\Http\Request</a></td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>response</td>
      <td>Servicio de entorno de respuesta HTTP</td>
      <td><a href="api/Phalcon_Http_Response">Phalcon\Http\Response</a></td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>router</td>
      <td>Servicio de enrutamiento</td>
      <td><a href="api/Phalcon_Mvc_Router">Phalcon\Mvc\Router</a></td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>security</td>
      <td>Ayudantes de seguridad</td>
      <td><a href="api/Phalcon_Security">Phalcon\Security</a></td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>session</td>
      <td>Servicio de sesión</td>
      <td><a href="api/Phalcon_Session_Adapter_Files">Phalcon\Session\Adapter\Files</a></td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>sessionBag</td>
      <td>Servicio de bolsa de sesión</td>
      <td><a href="api/Phalcon_Session_Bag">Phalcon\Session\Bag</a></td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>tag</td>
      <td>Ayudantes de generación de HTML</td>
      <td><a href="api/Phalcon_Tag">Phalcon\Tag</a></td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>transactionManager</td>
      <td>Servicio de administrador de transacciones de modelos</td>
      <td><a href="api/Phalcon_Mvc_Model_Transaction_Manager">Phalcon\Mvc\Model\Transaction\Manager</a></td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>url</td>
      <td>Servicio de generador de URL</td>
      <td><a href="api/Phalcon_Mvc_Url">Phalcon\Mvc\Url</a></td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>viewsCache</td>
      <td>Backend de cache para cache de fragmentos de vista</td>
      <td>Nada</td>
      <td style="text-align: center">No</td>
    </tr>
  </tbody>
</table>

<p><a name="implementing-your-own-di"></a></p>

<h2 id="implementando-tu-propio-di">Implementando tu propio DI</h2>

<p>The <a href="api/Phalcon_DiInterface">Phalcon\DiInterface</a> interface must be implemented to create your own DI replacing the one provided by Phalcon or extend the current one.</p>

                                    </div>
                                    <div class="col-md-4 col-lg-3 col-sm-12 support-column-margin">
                                        <div class="topic-search">
    <form class="bd-search d-flex align-items-center">
        <input type="search"
               class="form-control"
               id="docs-search"
               placeholder=""
               aria-label=""
               autocomplete="off"
               data-siteurl="https://phalcon-docs4.netlify.com"
               data-docs-version="3.4">
        <button class="btn btn-link bd-search-docs-toggle d-md-none p-0 ml-3"
                type="button"
                data-toggle="collapse"
                data-target="#bd-docs-nav"
                aria-controls="bd-docs-nav"
                aria-expanded="false"
                aria-label="Toggle docs navigation">
            <svg xmlns="http://www.w3.org/2000/svg"
                 viewbox="0 0 30 30"
                 width="30"
                 height="30"
                 focusable="false">
                <title>Menu</title>
                <path stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-miterlimit="10"
                      d="M4 7h22M4 15h22M4 23h22"></path>
            </svg>
        </button>
    </form>
</div>
                                        <div class="topic-categories">
    
</div>

                                        <div class="article-menu">
    <ul>
        
        
    </ul>
</div>
                                    </div>
                                </div>
                            </div>
                        </section>

                    </div>
                </div>
            </div>
        </div>
    </div>

<footer>
    <div class="container">
        <div class="footer-wrapper clearfix">

            <div class="footer-link-container">
                <a class="footer-link" href="/">
                    <img class="footer-logo-img" src="/assets/images/footer_logo.svg" alt="logo">
                </a>
                <a class="footer-link" href="https://phalcon.link/about" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://phalcon.link/sponsors" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://phalcon.link/fund" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://phalcon.link/download" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://license.phalconphp.com/" target="_blank">
                     New BSD
                </a>
            </div>

            <div class="footer-copyright">
                <a href="https://odva.pro/" target="_blank" class="o2-link">
                    <span></span> <img src="/assets/images/logo-o2.svg" alt="logo o2">
                </a>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript" src="/assets/js/main.min.js?v1547266080100021829"></script>
<script type="text/javascript" src="/assets/js/highlight/highlight.pack.js?v1547266080100021829"></script>
<script type="application/javascript">hljs.initHighlightingOnLoad();</script>
<script type="application/javascript">hljs.initHighlightingOnLoad();</script>
</body>
</html>
