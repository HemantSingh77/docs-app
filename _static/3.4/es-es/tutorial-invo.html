<!doctype html>
<!--[if IE 8]>
<html lang="es-es" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="es-es" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="es-es" class="no-js">
<!--<![endif]-->








    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <script type="text/javascript" src="/assets/js/viewport-min-width.js?v1547266080100021829"></script>
        <meta name="description"
              content="Official Phalcon Documentation">
        <meta name="keywords" content="php, phalcon, phalcon php, php framework, faster php framework, php extension, next generation framework, docs, documentation">
        <meta name="author" href="/humans.txt">
        <meta name="generator" content="Phalcon Team - Jekyll - Netlify">

        <link href="https://phalcon-docs4.netlify.com/3.4/es-es/tutorial-invo.html" rel="canonical">
        <title>Phalcon Framework Documentation</title>

        <!-- Twitter -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@zephirlang">
        <meta name="twitter:creator" content="@zephirlang">
        <meta name="twitter:title" content="Phalcon Framework Documentation">
        <meta name="twitter:description" content="Official Phalcon Documentation">
        <meta name="twitter:image" content="https://assets.phalconphp.com/phalcon/logo.png">

        <!-- Facebook -->
        <meta property="og:url" content="https://phalcon-docs4.netlify.com">
        <meta property="og:title" content="Phalcon Framework Documentation">
        <meta property="og:description" content="Official Phalcon Documentation">
        <meta property="og:type" content="website">
        <meta property="og:image" content="https://assets.phalconphp.com/phalcon/logo.png">

        <meta name="msapplication-TileColor" content="#FFFFFF">
        <meta name="msapplication-square70x70logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-70x70.png">
        <meta name="msapplication-TileImage"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-144x144.png">
        <meta name="msapplication-square150x150logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-150x150.png">
        <meta name="msapplication-wide310x150logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-310x150.png">
        <meta name="msapplication-square310x310logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-310x310.png">

        <link rel="apple-touch-icon"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon.png">

        <link rel="apple-touch-icon-precomposed"
              sizes="57x57"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-57x57.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="60x60"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-60x60.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="72x72"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="76x76"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-76x76.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="114x114"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-114x114.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="120x120"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-120x120.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="144x144"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-144x144.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="152x152"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-152x152.png">

        <link rel="icon"
              type="image/png"
              sizes="16x16"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-16x16.png">
        <link rel="icon"
              type="image/png"
              sizes="32x32"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-32x32.png">
        <link rel="icon"
              type="image/png"
              sizes="96x96"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-96x96.png">
        <link rel="icon"
              type="image/png"
              sizes="128x128"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-128x128.png">
        <link rel="icon"
              type="image/png"
              sizes="196x196"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-196x196.png">
        <link rel="shortcut icon"
              type="image/png"
              href="https://assets.phalconphp.com/phalcon/favicon.ico"/>

        <link rel="alternate"
              type="application/rss+xml"
              title=" - "
              href="https://phalcon-docs4.netlify.com/feed.xml">

        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css"
              integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE="
              crossorigin="anonymous" />
        <link rel="stylesheet" href="/assets/css/monokai.css?v1547266080100021829" />
        <link rel="stylesheet" href="/assets/css/style.css?v1547266080100021829" />

        <script defer src="https://use.fontawesome.com/releases/v5.6.1/js/all.js"
                integrity="sha384-R5JkiUweZpJjELPWqttAYmYM1P3SNEJRM6ecTQF05pFFtxmCO+Y1CiUhvuDzgSVZ"
                crossorigin="anonymous"></script>
        
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90300500-6"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-90300500-6');
    </script>

    </head>


<body onclick="o2.allNavSlideUp()">
    <header class="header-image-doc">
        <div class="container">
            <div class="header-wrapper">
                <div class="clearfix">
                    <div class="row">
                        <div class="col-md-2 col-sm-3  col-xs-8">
                            <div class="header-image__logo-wrapper">
                                <a href="/3.4/es-es">
                                    <img class="logo-img" src="/assets/images/header_logo.svg" alt="logo">
                                </a>
                            </div>
                        </div>
                        <div class="col-md-10 col-sm-9 top-menu">

                            <div class="nav-icon" onclick="o2.showMobileMenu();">
                                <div class="nav-line"></div>
                                <div class="nav-line"></div>
                                <div class="nav-line"></div>
                            </div>
                            <nav class="header-nav">
                                <ul>
                                    <li class="nav-item" onclick="o2.toggleState(this, event);">
                                        <div class="nav-item_selected">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                 alt="">
                                            <span class="caret"></span>
                                        </div>
                                        <div class="nav-item__list" onclick="event.stopPropagation();">
                                            
                                                <a href="/3.4/en/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                         alt="English (US)">
                                                    English (US)
                                                </a>
                                            
                                                <a href="/3.4/cs-cz/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/cs.png"
                                                         alt="Czech">
                                                    Czech
                                                </a>
                                            
                                                <a href="/3.4/de-de/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/de.png"
                                                         alt="German">
                                                    German
                                                </a>
                                            
                                                <a href="/3.4/es-es/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                         alt="Spanish">
                                                    Spanish
                                                </a>
                                            
                                                <a href="/3.4/fa-ir/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fa.png"
                                                         alt="Persian">
                                                    Persian
                                                </a>
                                            
                                                <a href="/3.4/fr-fr/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fr.png"
                                                         alt="French">
                                                    French
                                                </a>
                                            
                                                <a href="/3.4/id-id/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/id.png"
                                                         alt="Indonesian">
                                                    Indonesian
                                                </a>
                                            
                                                <a href="/3.4/it-it/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/it.png"
                                                         alt="Italian">
                                                    Italian
                                                </a>
                                            
                                                <a href="/3.4/ja-jp/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ja.png"
                                                         alt="Japanese">
                                                    Japanese
                                                </a>
                                            
                                                <a href="/3.4/pl-pl/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/pl.png"
                                                         alt="Polish">
                                                    Polish
                                                </a>
                                            
                                                <a href="/3.4/ru-ru/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ru.png"
                                                         alt="Russian">
                                                    Russian
                                                </a>
                                            
                                                <a href="/3.4/tr-tr/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/tr.png"
                                                         alt="Turkish">
                                                    Turkish
                                                </a>
                                            
                                                <a href="/3.4/uk-ua/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/uk.png"
                                                         alt="Ukrainian">
                                                    Ukrainian
                                                </a>
                                            
                                                <a href="/3.4/zh-cn/tutorial-invo" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                                         alt="Chinese Simplified">
                                                    Chinese Simplified
                                                </a>
                                            
                                        </div>
                                    </li>

                                        <li class="nav-item" onclick="o2.toggleState(this, event);">
                                            <div class="nav-item__selected custom-select__version">
                                                 3.4
                                                <span class="caret"></span>
                                            </div>
                                            <div class="nav-item__list" onclick="event.stopPropagation();">
                                                
                                                <a href="/3.4/es-es/tutorial-invo" class="custom-select__list-item">
                                                    <span>3.4</span>
                                                </a>
                                                
                                                <a href="/3.3/es-es/tutorial-invo" class="custom-select__list-item">
                                                    <span>3.3</span>
                                                </a>
                                                
                                                <a href="/3.2/es-es/tutorial-invo" class="custom-select__list-item">
                                                    <span>3.2</span>
                                                </a>
                                                
                                                <a href="/3.1/es-es/tutorial-invo" class="custom-select__list-item">
                                                    <span>3.1</span>
                                                </a>
                                                
                                                <a href="/4.0/es-es/tutorial-invo" class="custom-select__list-item">
                                                    <span>4.0</span>
                                                </a>
                                                
                                            </div>
                                        </li>

                                    <li class="nav-item" onclick="o2.toggleState(this, event);">
                                        <div class="nav-item_selected">
                                            
                                            <span class="caret"></span>
                                        </div>
                                        <div class="nav-item__list">
                                            <a href="https://phalcon.link/forum" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/blog" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/resources" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <div class="nav-item__divider"></div>
                                            <a href="https://phalcon.link/f" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/t" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/gab" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/about">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/sponsors">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/fund">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/download">
                                            
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>

                        <div class="header-nav-mobile">
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this, event)">
                                    <img class="lang-image"
                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                         alt="">
                                    <span class="caret"></span>
                                </div>

                                <ul style="display:none;" class="clearfix" onclick="event.stopPropagation();">
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/en/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                 alt="English (US)">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/cs-cz/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/cs.png"
                                                 alt="Czech">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/de-de/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/de.png"
                                                 alt="German">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/es-es/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                 alt="Spanish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/fa-ir/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fa.png"
                                                 alt="Persian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/fr-fr/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fr.png"
                                                 alt="French">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/id-id/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/id.png"
                                                 alt="Indonesian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/it-it/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/it.png"
                                                 alt="Italian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/ja-jp/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ja.png"
                                                 alt="Japanese">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/pl-pl/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/pl.png"
                                                 alt="Polish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/ru-ru/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ru.png"
                                                 alt="Russian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/tr-tr/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/tr.png"
                                                 alt="Turkish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/uk-ua/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/uk.png"
                                                 alt="Ukrainian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/zh-cn/tutorial-invo">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                                 alt="Chinese Simplified">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                </ul>

                            </div>
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this,event)">
                                     3.4
                                    <span class="caret"></span>
                                </div>

                                <ul style="display:none;" class="clearfix" onclick="event.stopPropagation();">
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.4/es-es/tutorial-invo">
                                            <span>3.4</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.3/es-es/tutorial-invo">
                                            <span>3.3</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.2/es-es/tutorial-invo">
                                            <span>3.2</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.1/es-es/tutorial-invo">
                                            <span>3.1</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/4.0/es-es/tutorial-invo">
                                            <span>4.0</span>
                                        </a>
                                    </li>
                                    
                                </ul>

                            </div>
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this, event)">
                                    
                                    <span class="caret"></span>
                                </div>
                                <ul style="display:none;">
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/forum" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/blog" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/resources" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/f" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/t" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/gab" target="_blank">
                                            
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/about">
                                    
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/sponsors">
                                    
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/fund">
                                    
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/download">
                                    
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>


    <div class="container-fluid article-page-wrap">
        <div class="row">
            <div>
                <div class="col-md-2 sidebar hidden-xs">
                    <div class="sidebar--spacer">&nbsp;</div>
                </div>
                <div class="m-t-md m-b-lg" id="articles">
                    <div class="article-content">
                        







                        <section class="documentation-section">
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-md-8 col-lg-9 parse-content">
                                        <div>
                                            <a class="article-content-edit-link pull-right"
                                               href="https://crowdin.com/project/phalcon-documentation/es-es">
                                                
                                            </a>
                                            <br>
                                        </div>
                                        <p><a name="overview"></a></p>

<h1 id="tutorial-invo">Tutorial: INVO</h1>

<p>En este segundo tutorial vamos a explicar una aplicación más completa para obtener un conocimiento más profundo del desarrollo con Phalcon. INVO es una de las aplicaciones de ejemplo que hemos creado. INVO es un pequeño sitio web que permite a los usuarios generar facturas y hacer otras tareas como gestión de clientes y productos. Puede clonar su código desde <a href="https://github.com/phalcon/invo">Github</a>.</p>

<p>INVO fue hecha con el framework <a href="http://getbootstrap.com/">Bootstrap</a> del lado del cliente. Aunque la aplicación no genera facturas reales, nos sirve como un ejemplo para mostrar cómo funciona el framework.</p>

<p><a name="structure"></a></p>

<h2 id="estructura-del-proyecto">Estructura del proyecto</h2>

<p>Una vez clonado el proyecto en la raíz de tu documento, podrá ver la siguiente estructura:</p>

<pre><code class="language-bash">invo/
    app/
        config/
        controllers/
        forms/
        library/
        logs/
        models/
        plugins/
        views/
    cache/
        volt/
    docs/
    public/
        css/
        fonts/
        js/
    schemas/
</code></pre>

<p>As you know, Phalcon does not impose a particular file structure for application development. This project has a simple MVC structure and a public document root.</p>

<p>Una vez que usted abra la aplicación en su navegador <code>http://localhost/invo</code> verás algo como esto:</p>

<p><img src="/assets/images/content/tutorial-invo-1.png" alt="" /></p>

<p>La aplicación se divide en dos partes: un frontend y un backend. El frontend es un espacio público donde los visitantes pueden recibir información acerca de INVO y solicitar información de contacto. El backend es un área administrativa donde los usuarios registrados pueden gestionar sus productos y clientes.</p>

<p><a name="routing"></a></p>

<h2 id="enrutamiento">Enrutamiento</h2>

<p>INVO uses the standard route that is built-in with the <a href="/3.4/en/routing">Router</a> component. Estas rutas coinciden con el siguiente patrón: <code>/:controlador/:acción/:params</code>. Esto significa que la primera parte de un URI es el controlador, el segundo que la acción del controlador y el resto son los parámetros.</p>

<p>La ruta siguiente <code>/session/register</code> ejecuta el controlador <code>SessionController</code> y su acción <code>registerAction</code>.</p>

<p><a name="configuration"></a></p>

<h2 id="configuración">Configuración</h2>

<p>INVO tiene un archivo de configuración que establece los parámetros generales en la aplicación. Este archivo se encuentra en <code>app/config/config.ini</code> y se carga en las primeras líneas del arranque de la aplicación (<code>public/index.php</code>):</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Config\Adapter\Ini as ConfigIni;

// ...

// Leer la configuración
$config = new ConfigIni(
    APP_PATH . 'app/config/config.ini'
);

</code></pre>

<p><a href="/3.4/en/config">Phalcon Config</a> (<a href="api/Phalcon_Config">Phalcon\Config</a>) allows us to manipulate the file in an object-oriented way. In this example, we’re using an ini file for configuration but Phalcon has <a href="/3.4/en/config">adapters</a> for other file types as well. El archivo de configuración contiene las siguientes opciones:</p>

<pre><code class="language-ini">[database]
host     = localhost
username = root
password = secret
name     = invo

[application]
controllersDir = app/controllers/
modelsDir      = app/models/
viewsDir       = app/views/
pluginsDir     = app/plugins/
formsDir       = app/forms/
libraryDir     = app/library/
baseUri        = /invo/
</code></pre>

<p>Phalcon no tiene ningún convenio de ajustes predefinidos. Las secciones nos ayudan a organizar las opciones según sea el caso. En este archivo hay dos secciones para utilizar más adelante: <code>application</code> y <code>database</code>.</p>

<p><a name="autoloaders"></a></p>

<h2 id="cargadores-automáticos">Cargadores automáticos</h2>

<p>La segunda parte que aparece en el archivo bootstrap (<code>public/index.php</code>) es el auto cargador:</p>

<pre><code class="language-php">&lt;?php

/**
 * Configuración del auto cargador
 */
require APP_PATH . 'app/config/loader.php';
</code></pre>

<p>El cargador automático registra un conjunto de directorios en los que la aplicación buscará las clases que eventualmente serían necesarias.</p>

<pre><code class="language-php">&lt;?php

$loader = new Phalcon\Loader();

// Registramos un conjunto de directorios tomados desde el archivo de configuración
$loader-&gt;registerDirs(
    [
        APP_PATH . $config-&gt;application-&gt;controllersDir,
        APP_PATH . $config-&gt;application-&gt;pluginsDir,
        APP_PATH . $config-&gt;application-&gt;libraryDir,
        APP_PATH . $config-&gt;application-&gt;modelsDir,
        APP_PATH . $config-&gt;application-&gt;formsDir,
    ]
);

$loader-&gt;register();
</code></pre>

<p>Tenga en cuenta que el código anterior ha registrado los directorios definidos en el archivo de configuración. El único directorio que no está registrado es el viewsDir ya que contiene archivos HTML + PHP pero no hay clases. También, observe que utilizamos una constante llamada APP_PATH. Esta constante está definida en el bootstrap (<code>public/index.php</code>) que nos permiten tener una referencia a la raíz de nuestro proyecto:</p>

<pre><code class="language-php">&lt;?php

// ...

define(
    'APP_PATH',
    realpath('..') . '/'
);
</code></pre>

<p><a name="services"></a></p>

<h2 id="registro-de-servicios">Registro de servicios</h2>

<p>Another file that is required in the bootstrap is (<code>app/config/services.php</code>). This file allows us to organize the services that INVO uses.</p>

<pre><code class="language-php">&lt;?php

/**
 * Cargar los servicios de la aplicación
 */
require APP_PATH . 'app/config/services.php';
</code></pre>

<p>El registro de servicios se logra con clausulas para la carga perezosa de los componentes necesarios:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Url as UrlProvider;

// ...

/**
 * El componente URL es utilizado para generar todas las URL's en la aplicación
 */
$di-&gt;set(
    'url',
    function () use ($config) {
        $url = new UrlProvider();

        $url-&gt;setBaseUri(
            $config-&gt;application-&gt;baseUri
        );

        return $url;
    }
);
</code></pre>

<p>Hablaremos de este archivo en profundidad más adelante.</p>

<p><a name="handling-requests"></a></p>

<h2 id="gestionando-la-solicitud">Gestionando la solicitud</h2>

<p>If we skip to the end of the file (<code>public/index.php</code>), the request is finally handled by <a href="api/Phalcon_Mvc_Application">Phalcon\Mvc\Application</a> which initializes and executes all that is necessary to make the application run:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Application;

// ...

$application = new Application($di);

$response = $application-&gt;handle();

$response-&gt;send();
</code></pre>

<p><a name="dependency-injection"></a></p>

<h2 id="inyección-de-dependencias">Inyección de Dependencias</h2>

<p>En la primera línea del bloque de código anterior, el constructor de la clase de aplicación recibe la variable <code>$di</code> como argumento. ¿Cuál es el propósito de esa variable? Phalcon es un framework muy desacoplado por lo que necesitamos un componente que actúe como pegamento para que todo funcione en conjunto. That component is <a href="api/Phalcon_Di">Phalcon\Di</a>. Es un contenedor de servicios que también realiza la inyección de dependencias y la localización de servicios, instanciando todos los componentes que son necesarios para la aplicación.</p>

<p>Hay muchas maneras de registrar servicios en el contenedor. En INVO, la mayoría de los servicios se han registrado mediante funciones anónimas. Gracias a esto, se crean instancias de los objetos de una manera perezosa, reduciendo los recursos necesarios para la aplicación.</p>

<p>For instance, in the following excerpt the session service is registered. The anonymous function will only be called when the application requires access to the session data:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Session\Adapter\Files as Session;

// ...

// Iniciar la sesión la primera vez que un componente solicite el servicio de sesión
$di-&gt;set(
    'session',
    function () {
        $session = new Session();

        $session-&gt;start();

        return $session;
    }
);
</code></pre>

<p>Aquí, tenemos la libertad para cambiar el adaptador, realizar una inicialización adicional y mucho más. Tenga en cuenta que el servicio se registró con el nombre de <code>session</code>. Se trata de un convenio que permitirá al framework identificar el servicio activo en el contenedor de servicios.</p>

<p>Una solicitud puede utilizar muchos servicios y registrar individualmente cada servicio puede ser una tarea engorrosa. For that reason, the framework provides a variant of <a href="api/Phalcon_Di">Phalcon\Di</a> called <a href="api/Phalcon_Di_FactoryDefault">Phalcon\Di\FactoryDefault</a> whose task is to register all services providing a full-stack framework.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Di\FactoryDefault;

// ...

// El inyector de dependencias FactoryDefault automáticamente registra
// todos los servicios provistos por el framework
$di = new FactoryDefault();
</code></pre>

<p>Registra la mayoría de los servicios con componentes proporcionados por defecto por el framework como estándar. Si necesitamos reemplazar la definición de algún servicio podríamos definirlo otra vez como los hicimos anteriormente con <code>session</code> o <code>url</code>. Esta es la razón de la existencia de la variable <code>$di</code>.</p>

<p><a name="log-in"></a></p>

<h2 id="inicie-sesión-en-la-aplicación">Inicie sesión en la aplicación</h2>

<p>Un <code>inicio de sesión</code> nos permitirá trabajar en los controladores del backend. La separación entre controladores de backend y frontend es solo por lógica. Todos los controladores se encuentran en el mismo directorio (<code>app/controladores/</code>).</p>

<p>To enter the system, users must have a valid username and password. Users are stored in the table <code>users</code> in the database <code>invo</code>.</p>

<p>Antes de que podamos iniciar una sesión, tenemos que configurar la conexión a la base de datos en la aplicación. Un servicio llamado <code>db</code> está configurado en el contenedor de servicios con la información de conexión. Con el autocargador, estamos otra vez tomando parámetros del archivo de configuración para configurar un servicio:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Db\Adapter\Pdo\Mysql as DbAdapter;

// ...

// La conexión a la base de datos es creada basada en los 
// parámetros de configuración del archivo de configuración
$di-&gt;set(
    'db',
    function () use ($config) {
        return new DbAdapter(
            [
                'host'     =&gt; $config-&gt;database-&gt;host,
                'username' =&gt; $config-&gt;database-&gt;username,
                'password' =&gt; $config-&gt;database-&gt;password,
                'dbname'   =&gt; $config-&gt;database-&gt;name,
            ]
        );
    }
);
</code></pre>

<p>Here, we return an instance of the MySQL connection adapter. If needed, you could do extra actions such as adding a logger, a profiler or change the adapter, setting it up as you want.</p>

<p>The following simple form (<code>app/views/session/index.volt</code>) requests the login information. We’ve removed some HTML code to make the example more concise:</p>

<pre><code class="language-twig">
{{ form('session/start') }}
    &lt;fieldset&gt;
        &lt;div&gt;
            &lt;label for='email'&gt;
                Username/Email
            &lt;/label&gt;

            &lt;div&gt;
                {{ text_field('email') }}
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;div&gt;
            &lt;label for='password'&gt;
                Password
            &lt;/label&gt;

            &lt;div&gt;
                {{ password_field('password') }}
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;div&gt;
            {{ submit_button('Login') }}
        &lt;/div&gt;
    &lt;/fieldset&gt;
{{ endForm() }}

</code></pre>

<p>Instead of using raw PHP as the previous tutorial, we started to use <a href="/3.4/en/volt">Volt</a>. Se trata de un motor incorporado inspirado en Jinja, el cual proporciona una sintaxis más simple y amigable para crear plantillas. No tomará mucho tiempo antes que te familiarices con volt.</p>

<p>La función <code>SessionController::startAction</code> (<code>app/controllers/SessionController.php</code>) tiene la tarea de validar los datos introducidos en el formulario, incluyendo la comprobación de un usuario válido en la base de datos:</p>

<pre><code class="language-php">&lt;?php

class SessionController extends ControllerBase
{
    // ...

    private function _registerSession($user)
    {
        $this-&gt;session-&gt;set(
            'auth',
            [
                'id'   =&gt; $user-&gt;id,
                'name' =&gt; $user-&gt;name,
            ]
        );
    }

    /**
     * Esta acción autentica y registra a un usuario dentro de la aplicación
     */
    public function startAction()
    {
        if ($this-&gt;request-&gt;isPost()) {
            // Obtener datos desde el usuario
            $email    = $this-&gt;request-&gt;getPost('email');
            $password = $this-&gt;request-&gt;getPost('password');

            // Buscar el usuario en la base de datos
            $user = Users::findFirst(
                [
                    "(email = :email: OR username = :email:) AND password = :password: AND active = 'Y'",
                    'bind' =&gt; [
                        'email'    =&gt; $email,
                        'password' =&gt; sha1($password),
                    ]
                ]
            );

            if ($user !== false) {
                $this-&gt;_registerSession($user);

                $this-&gt;flash-&gt;success(
                    'Bienvenido ' . $user-&gt;name
                );

                // Enviar al controlador 'invoices' si el usuario es válido
                return $this-&gt;dispatcher-&gt;forward(
                    [
                        'controller' =&gt; 'invoices',
                        'action'     =&gt; 'index',
                    ]
                );
            }

            $this-&gt;flash-&gt;error(
                'Email/Contraseña incorrectos'
            );
        }

        // Enviar al formulario de inicio de sesión nuevamente
        return $this-&gt;dispatcher-&gt;forward(
            [
                'controller' =&gt; 'session',
                'action'     =&gt; 'index',
            ]
        );
    }
}
</code></pre>

<p>For the sake of simplicity, we have used <a href="http://php.net/manual/en/function.sha1.php">sha1</a> to store the password hashes in the database, however, this algorithm is not recommended in real applications, use <a href="/3.4/en/security">bcrypt</a> instead.</p>

<p>Tenga en cuenta que varios atributos públicos son accedidos en el controlador como: <code>$this-&gt;flash</code>, <code>$this-&gt;request</code> o <code>$this-&gt;session</code>. Estos son los servicios definidos en el contenedor de servicios, como vimos anteriormente (<code>app/config/services.php</code>). Cuando se acceden por primera vez, ellos se inyectan como parte del controlador. Estos servicios son <code>compartidos</code>, lo que significa que siempre estamos accediendo a la misma instancia independientemente del lugar donde se les invocan. Por ejemplo, aquí se invoca el servicio <code>session</code> y luego guardamos la identidad del usuario en la variable <code>auth</code>:</p>

<pre><code class="language-php">&lt;?php

$this-&gt;session-&gt;set(
    'auth',
    [
        'id'   =&gt; $user-&gt;id,
        'name' =&gt; $user-&gt;name,
    ]
);
</code></pre>

<p>Otro aspecto importante de esta sección es cómo el usuario se valida como válido, primero validamos si la solicitud se ha hecho usando el método <code>POST</code>:</p>

<pre><code class="language-php">&lt;?php

if ($this-&gt;request-&gt;isPost()) {
    // ...
}
</code></pre>

<p>Después, recibimos los parámetros desde el formulario:</p>

<pre><code class="language-php">&lt;?php

$email    = $this-&gt;request-&gt;getPost('email');
$password = $this-&gt;request-&gt;getPost('password');
</code></pre>

<p>Ahora, tenemos que comprobar si hay un usuario con el mismo nombre de usuario o correo electrónico y contraseña:</p>

<pre><code class="language-php">&lt;?php

$user = Users::findFirst(
    [
        "(email = :email: OR username = :email:) AND password = :password: AND active = 'Y'",
        'bind' =&gt; [
            'email'    =&gt; $email,
            'password' =&gt; sha1($password),
        ]
    ]
);
</code></pre>

<p>Tenga en cuenta, el uso de ‘parámetros enlazados’, los marcadores <code>:email:</code> y <code>:password:</code> se colocan donde los valores deben estar, entonces se ‘enlazan’ los valores usando el parámetro <code>bind</code>. Esto reemplaza de manera segura los valores de esas columnas sin tener el riesgo de una inyección SQL.</p>

<p>Si el usuario es válido, registrarlo en la sesión y enviarlo al panel principal:</p>

<pre><code class="language-php">&lt;?php

if ($user !== false) {
    $this-&gt;_registerSession($user);

    $this-&gt;flash-&gt;success(
        'Bienvenido ' . $user-&gt;name
    );

    return $this-&gt;dispatcher-&gt;forward(
        [
            'controller' =&gt; 'invoices',
            'action'     =&gt; 'index',
        ]
    );
}
</code></pre>

<p>Si el usuario no existe, lo enviamos nuevamente a la acción donde se muestra el formulario:</p>

<pre><code class="language-php">&lt;?php

return $this-&gt;dispatcher-&gt;forward(
    [
        'controller' =&gt; 'session',
        'action'     =&gt; 'index',
    ]
);
</code></pre>

<p><a name="securing-backend"></a></p>

<h2 id="asegurando-el-backend">Asegurando el backend</h2>

<p>El backend es un área privada donde sólo los usuarios registrados tienen acceso. Por lo tanto, es necesario comprobar que sólo los usuarios registrados tienen acceso a estos controladores. Si usted no ha iniciado sesión en la aplicación y trata de acceder, por ejemplo, al controlador de productos (que es privado), verá una pantalla como esta:</p>

<p><img src="/assets/images/content/tutorial-invo-2.png" alt="" /></p>

<p>Cada vez que alguien intenta acceder a cualquier controlador y acción, la aplicación verifica que el rol actual (en sesión) tenga acceso a ellos, de lo contrario muestra un mensaje como el de arriba y remite el flujo a la página principal.</p>

<p>Ahora vamos a averiguar cómo la aplicación logra esto. The first thing to know is that there is a component called <a href="/3.4/en/dispatcher">Dispatcher</a>. It is informed about the route found by the <a href="/3.4/en/routing">Routing</a> component. Entonces, es el responsable de cargar el controlador adecuado y ejecutar el método correspondiente de la acción.</p>

<p>Normalmente, el framework crea automáticamente el despachador. En nuestro caso, queremos realizar una verificación antes de ejecutar la acción requerida, comprobando si el usuario tiene acceso a ella o no. Para lograr esto, hemos sustituido el componente mediante la creación de una función en el sistema de arranque:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Dispatcher;

// ...

/**
 * Despachador MVC
 */
$di-&gt;set(
    'dispatcher',
    function () {
        // ...

        $dispatcher = new Dispatcher();

        return $dispatcher;
    }
);
</code></pre>

<p>Ahora tenemos control total sobre el despachador utilizado en la aplicación. Muchos componentes en el framework desencadenan eventos que nos permiten modificar su flujo interno de operación. As the Dependency Injector component acts as glue for components, a new component called <a href="/3.4/en/events">EventsManager</a> allows us to intercept the events produced by a component, routing the events to listeners.</p>

<p><a name="events-manager"></a></p>

<h3 id="gestión-de-eventos">Gestión de Eventos</h3>

<p>The <a href="/3.4/en/events">EventsManager</a> allows us to attach listeners to a particular type of event. El tipo que nos interesa ahora es ‘dispatch’. El siguiente código filtra todos los eventos producidos por el despachador:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Dispatcher;
use Phalcon\Events\Manager as EventsManager;

$di-&gt;set(
    'dispatcher',
    function () {
        // Crear un gestor de eventos
        $eventsManager = new EventsManager();

        // Oír los eventos producidos por el despachador utizando el plugin Security
        $eventsManager-&gt;attach(
            'dispatch:beforeExecuteRoute',
            new SecurityPlugin()
        );

        // Gestionar excepciones y no encontrados "not-found" utilizando el plugin NotFoundPlugin
        $eventsManager-&gt;attach(
            'dispatch:beforeException',
            new NotFoundPlugin()
        );

        $dispatcher = new Dispatcher();

        // Agregar los eventos del gestor del despachador
        $dispatcher-&gt;setEventsManager($eventsManager);

        return $dispatcher;
    }
);
</code></pre>

<p>Cuando se desencadena un evento denominado <code>beforeExecuteRoute</code> se notificará al siguiente plugin:</p>

<pre><code class="language-php">&lt;?php

/**
 * Comprobar si el usuario tiene acceso permitido a una determinada acción utilizando el plugin SecurityPlugin
 */
$eventsManager-&gt;attach(
    'dispatch:beforeExecuteRoute',
    new SecurityPlugin()
);
</code></pre>

<p>Cuando se dispara un <code>beforeException</code>, otro plugin es notificado:</p>

<pre><code class="language-php">&lt;?php

/**
 * Gestionar excepciones y no encontrados "not-found" utilizando el plugin NotFoundPlugin
 */
$eventsManager-&gt;attach(
    'dispatch:beforeException',
    new NotFoundPlugin()
);
</code></pre>

<p>El plugin SecurityPlugin es una clase que se encuentra en (<code>app/plugins/SecurityPlugin.php</code>). Esta clase implementa el método <code>beforeExecuteRoute</code>. Este es el mismo nombre que uno de los eventos producidos en el despachador:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Events\Event;
use Phalcon\Mvc\User\Plugin;
use Phalcon\Mvc\Dispatcher;

class SecurityPlugin extends Plugin
{
    // ...

    public function beforeExecuteRoute(Event $event, Dispatcher $dispatcher)
    {
        // ...
    }
}
</code></pre>

<p>Los eventos enganchados siempre reciben un primer parámetro que contiene información contextual del evento producido (<code>$event</code>) y un segundo que es el objeto que produjo el evento en sí (<code>$dispatcher</code>). It is not mandatory that plugins extend the class <a href="api/Phalcon_Mvc_User_Plugin">Phalcon\Mvc\User\Plugin</a>, but by doing this they gain easier access to the services available in the application.</p>

<p>Now, we’re verifying the role in the current session, checking if the user has access using the ACL list. If the user does not have access we redirect to the home screen as explained before:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Acl;
use Phalcon\Events\Event;
use Phalcon\Mvc\User\Plugin;
use Phalcon\Mvc\Dispatcher;

class SecurityPlugin extends Plugin
{
    // ...

    public function beforeExecuteRoute(Event $event, Dispatcher $dispatcher)
    {
        // Compruebe si la variable 'auth' existe en sesión para definir el rol activo
        $auth = $this-&gt;session-&gt;get('auth');

        if (!$auth) {
            $role = 'Guests';
        } else {
            $role = 'Users';
        }

        // Tomar el controlador/acción activos desde el despachador
        $controller = $dispatcher-&gt;getControllerName();
        $action     = $dispatcher-&gt;getActionName();

        // Obtener la lista ACL
        $acl = $this-&gt;getAcl();

        // Comprobar si el rol tiene acceso al controlador (recurso)
        $allowed = $acl-&gt;isAllowed($role, $controller, $action);

        if (!$allowed) {
            // Si no tiene acceso, redirigir al controlador Index
            $this-&gt;flash-&gt;error(
                "Ud. no tiene acceso a este módulo"
            );

            $dispatcher-&gt;forward(
                [
                    'controller' =&gt; 'index',
                    'action'     =&gt; 'index',
                ]
            );

            // Regresando 'false' le decimos al despachador que detenga la acción actual
            return false;
        }
    }
}
</code></pre>

<p><a name="acl"></a></p>

<h3 id="obteniendo-la-lista-acl">Obteniendo la lista ACL</h3>

<p>En el ejemplo anterior hemos obtenido una ACL mediante el método <code>$this-&gt;getAcl()</code>. Este método también se implementa en el Plugin. Ahora vamos a explicar paso a paso cómo construimos la lista de control de acceso (ACL):</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Acl;
use Phalcon\Acl\Role;
use Phalcon\Acl\Adapter\Memory as AclList;

// Crear la ACL
$acl = new AclList();

// La acción de acceso por defecto es DENY (denegar)
$acl-&gt;setDefaultAction(
    Acl::DENY
);

// Registrar dos roles, Users es para los usuarios registrados
// y guests (invitados) son usuarios sin una identidad definida
$roles = [
    'users'  =&gt; new Role('Users'),
    'guests' =&gt; new Role('Guests'),
];

foreach ($roles as $role) {
    $acl-&gt;addRole($role);
}
</code></pre>

<p>Now, we define the resources for each area respectively. Controller names are resources and their actions are accesses for the resources:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Acl\Resource;

// ...

// Recursos del área privada (backend)
$privateResources = [
    'companies'    =&gt; ['index', 'search', 'new', 'edit', 'save', 'create', 'delete'],
    'products'     =&gt; ['index', 'search', 'new', 'edit', 'save', 'create', 'delete'],
    'producttypes' =&gt; ['index', 'search', 'new', 'edit', 'save', 'create', 'delete'],
    'invoices'     =&gt; ['index', 'profile'],
];

foreach ($privateResources as $resourceName =&gt; $actions) {
    $acl-&gt;addResource(
        new Resource($resourceName),
        $actions
    );
}

// Recursos del área pública (frontend)
$publicResources = [
    'index'    =&gt; ['index'],
    'about'    =&gt; ['index'],
    'register' =&gt; ['index'],
    'errors'   =&gt; ['show404', 'show500'],
    'session'  =&gt; ['index', 'register', 'start', 'end'],
    'contact'  =&gt; ['index', 'send'],
];

foreach ($publicResources as $resourceName =&gt; $actions) {
    $acl-&gt;addResource(
        new Resource($resourceName),
        $actions
    );
}
</code></pre>

<p>La ACL ahora sabe acerca de los controladores existentes y sus acciones relacionadas. El rol <code>Users</code> tiene acceso a todos los recursos del frontend y backend. El rol <code>Guests</code> sólo tiene acceso a la zona pública:</p>

<pre><code class="language-php">&lt;?php

// Permitir acceso a áreas públicas para ambos roles
foreach ($roles as $role) {
    foreach ($publicResources as $resource =&gt; $actions) {
        $acl-&gt;allow(
            $role-&gt;getName(),
            $resource,
            '*'
        );
    }
}

// Permitir acceso al área privada solo para el rol Users
foreach ($privateResources as $resource =&gt; $actions) {
    foreach ($actions as $action) {
        $acl-&gt;allow(
            'Users',
            $resource,
            $action
        );
    }
}
</code></pre>

<p><a name="working-with-crud"></a></p>

<h2 id="trabajando-con-el-crud">Trabajando con el CRUD</h2>

<p>Los Backends generalmente proporcionan formularios para permitir a los usuarios manipular los datos. Continuando con la explicación del INVO, abordamos ahora la creación de CRUDs, una tarea muy común que Phalcon facilitará a través de formularios, validaciones, paginadores y más.</p>

<p>La mayoría de las opciones que manipulan datos en INVO (empresas, productos y tipos de productos) se desarrollan usando un simple <a href="http://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> (Create, Read, Update y Delete) o en español Crear, Leer, Actualizar y Borrar. Cada CRUD contiene los siguientes archivos:</p>

<pre><code class="language-bash">invo/
    app/
        controllers/
            ProductsController.php
        models/
            Products.php
        forms/
            ProductsForm.php
        views/
            products/
                edit.volt
                index.volt
                new.volt
                search.volt
</code></pre>

<p>Cada controlador tiene las siguientes acciones:</p>

<pre><code class="language-php">&lt;?php

class ProductsController extends ControllerBase
{
    /**
     * Acción inicial, muestra la vista de busqueda
     */
    public function indexAction()
    {
        // ...
    }

    /**
     * Ejecuta la búsqueda basada en los criterios enviados desde el 'Index'
     * Retornando resultados paginados
     */
    public function searchAction()
    {
        // ...
    }

    /**
     * Muestra una vista para crear un nuevo producto
     */
    public function newAction()
    {
        // ...
    }

    /**
     * Muestra una vista para editar un producto existente
     */
    public function editAction()
    {
        // ...
    }

    /**
     * Crea un producto basado en los datos ingresados en la acción 'new'
     */
    public function createAction()
    {
        // ...
    }

    /**
     * Actualiza un producto basado en los datos ingresados en la acción 'edit'
     */
    public function saveAction()
    {
        // ...
    }

    /**
     * Elimina un producto existente
     */
    public function deleteAction($id)
    {
        // ...
    }
}
</code></pre>

<p><a name="search-form"></a></p>

<h2 id="formulario-de-búsqueda">Formulario de búsqueda</h2>

<p>Cada CRUD comienza con un formulario de búsqueda. Este formulario muestra cada campo que tiene la tabla productos (products), lo que permite al usuario crear una búsqueda de criterios para cualquier campo. La tabla de <code>products</code> tiene una relación con la tabla <code>products_types</code>. En este caso, nos consulta previamente los registros de esta tabla con el fin de facilitar la búsqueda de ese campo:</p>

<pre><code class="language-php">&lt;?php

/**
 * La acción inicial, muestra la vista de búsqueda
 */
public function indexAction()
{
    $this-&gt;persistent-&gt;searchParams = null;

    $this-&gt;view-&gt;form = new ProductsForm();
}
</code></pre>

<p>An instance of the <code>ProductsForm</code> form (<code>app/forms/ProductsForm.php</code>) is passed to the view. This form defines the fields that are visible to the user:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Forms\Form;
use Phalcon\Forms\Element\Text;
use Phalcon\Forms\Element\Hidden;
use Phalcon\Forms\Element\Select;
use Phalcon\Validation\Validator\Email;
use Phalcon\Validation\Validator\PresenceOf;
use Phalcon\Validation\Validator\Numericality;

class ProductsForm extends Form
{
    /**
     * Inicializar formulario de productos
     */
    public function initialize($entity = null, $options = [])
    {
        if (!isset($options['edit'])) {
            $element = new Text('id');
            $element-&gt;setLabel('Id');
            $this-&gt;add($element);
        } else {
            $this-&gt;add(new Hidden('id'));
        }

        $name = new Text('name');
        $name-&gt;setLabel('Nombre');
        $name-&gt;setFilters(
            [
                'striptags',
                'string',
            ]
        );
        $name-&gt;addValidators(
            [
                new PresenceOf(
                    [
                        'message' =&gt; 'El nombre es requerido',
                    ]
                )
            ]
        );
        $this-&gt;add($name);

        $type = new Select(
            'profilesId',
            ProductTypes::find(),
            [
                'using'      =&gt; [
                    'id',
                    'name',
                ],
                'useEmpty'   =&gt; true,
                'emptyText'  =&gt; '...',
                'emptyValue' =&gt; '',
            ]
        );

        $this-&gt;add($type);

        $price = new Text('price');
        $price-&gt;setLabel('Precio');
        $price-&gt;setFilters(
            [
                'float',
            ]
        );
        $price-&gt;addValidators(
            [
                new PresenceOf(
                    [
                        'message' =&gt; 'El precio es requerido',
                    ]
                ),
                new Numericality(
                    [
                        'message' =&gt; 'El precio debe ser un número',
                    ]
                ),
            ]
        );
        $this-&gt;add($price);
    }
}
</code></pre>

<p>The form is declared using an object-oriented scheme based on the elements provided by the <a href="/3.4/en/forms">forms</a> component. Cada elemento sigue casi la misma estructura:</p>

<pre><code class="language-php">&lt;?php

// Crear el elemento
$name = new Text('name');

// Configurar una etiqueta
$name-&gt;setLabel('Nombre');

// Antes de validar el elemento aplicar estos filtros
$name-&gt;setFilters(
    [
        'striptags',
        'string',
    ]
);

// Aplicar estos validadores
$name-&gt;addValidators(
    [
        new PresenceOf(
            [
                'message' =&gt; 'El nombre es requerido',
            ]
        )
    ]
);

// Agregar el elemento al formulario
$this-&gt;add($name);
</code></pre>

<p>Otros elementos también se utilizan en este formulario:</p>

<pre><code class="language-php">&lt;?php

// Agregar un input oculto al formulario
$this-&gt;add(
    new Hidden('id')
);

// ...

$productTypes = ProductTypes::find();

// Agregar una lista (HTML Select) al formulario
// y completar los datos desde 'product_types'
$type = new Select(
    'profilesId',
    $productTypes,
    [
        'using'      =&gt; [
            'id',
            'name',
        ],
        'useEmpty'   =&gt; true,
        'emptyText'  =&gt; '...',
        'emptyValue' =&gt; '',
    ]
);
</code></pre>

<p>Observe que <code>ProductTypes::find()</code> contiene los datos necesarios para completar la etiqueta SELECT usando <code>Phalcon\Tag::select()</code>. Una vez que el formulario se pasa a la vista, se puede procesar y presentar al usuario:</p>

<pre><code class="language-twig">
{{ form('products/search') }}

    &lt;h2&gt;
        Search products
    &lt;/h2&gt;

    &lt;fieldset&gt;

        {% for element in form %}
            &lt;div class='control-group'&gt;
                {{ element.label(['class': 'control-label']) }}

                &lt;div class='controls'&gt;
                    {{ element }}
                &lt;/div&gt;
            &lt;/div&gt;
        {% endfor %}



        &lt;div class='control-group'&gt;
            {{ submit_button('Search', 'class': 'btn btn-primary') }}
        &lt;/div&gt;

    &lt;/fieldset&gt;

{{ endForm() }}

</code></pre>

<p>Esto produce el siguiente código HTML:</p>

<pre><code class="language-html">&lt;form action='/invo/products/search' method='post'&gt;

    &lt;h2&gt;
        Buscar productos
    &lt;/h2&gt;

    &lt;fieldset&gt;

        &lt;div class='control-group'&gt;
            &lt;label for='id' class='control-label'&gt;Id&lt;/label&gt;

            &lt;div class='controls'&gt;
                &lt;input type='text' id='id' name='id' /&gt;
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class='control-group'&gt;
            &lt;label for='name' class='control-label'&gt;Nombre&lt;/label&gt;

            &lt;div class='controls'&gt;
                &lt;input type='text' id='name' name='name' /&gt;
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class='control-group'&gt;
            &lt;label for='profilesId' class='control-label'&gt;profilesId&lt;/label&gt;

            &lt;div class='controls'&gt;
                &lt;select id='profilesId' name='profilesId'&gt;
                    &lt;option value=''&gt;...&lt;/option&gt;
                    &lt;option value='1'&gt;Vegetables&lt;/option&gt;
                    &lt;option value='2'&gt;Fruits&lt;/option&gt;
                &lt;/select&gt;
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class='control-group'&gt;
            &lt;label for='price' class='control-label'&gt;Precio&lt;/label&gt;

            &lt;div class='controls'&gt;
                &lt;input type='text' id='price' name='price' /&gt;
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class='control-group'&gt;
            &lt;input type='submit' value='Buscar' class='btn btn-primary' /&gt;
        &lt;/div&gt;

    &lt;/fieldset&gt;

&lt;/form&gt;
</code></pre>

<p>Cuando se envía el formulario, se ejecuta en el controlador la acción <code>search</code> realizando la búsqueda basada en los datos introducidos por el usuario.</p>

<p><a name="performing-searches"></a></p>

<h2 id="realizando-una-búsqueda">Realizando una búsqueda</h2>

<p>La acción <code>search</code> tiene dos comportamientos. Cuando se accede a través del método POST, realiza una búsqueda basada en los datos enviados desde el formulario pero cuando se accede a través de GET se mueve la página actual en el paginator. To differentiate HTTP methods, we check it using the <a href="/3.4/en/request">Request</a> component:</p>

<pre><code class="language-php">&lt;?php

/**
 * Ejecutar la busqueda basada en los criterios enviados desde el 'index'
 * Regresando un paginador para los resultados
 */
public function searchAction()
{
    if ($this-&gt;request-&gt;isPost()) {
        // Crear las condiciones de consulta
    } else {
        // Paginar utilizando las condiciones existentes
    }

    // ...
}
</code></pre>

<p>With the help of <a href="api/Phalcon_Mvc_Model_Criteria">Phalcon\Mvc\Model\Criteria</a>, we can create the search conditions intelligently based on the data types and values sent from the form:</p>

<pre><code class="language-php">&lt;?php

$query = Criteria::fromInput(
    $this-&gt;di,
    'Products',
    $this-&gt;request-&gt;getPost()
);
</code></pre>

<p>Este método comprueba que los valores son diferentes de <code>''</code> (cadena vacía) y <code>nulo</code>. Teniendo en cuenta para crear los criterios de búsqueda los siguientes puntos:</p>

<ul>
  <li>Si el tipo de datos de campo es texto o similar (char, varchar, text, etcetera). Utiliza un operador <code>like</code> de SQL para filtrar los resultados.</li>
  <li>Si el tipo de datos no es texto o similar, usara el operador <code>=</code>.</li>
</ul>

<p>Additionally, <code>Criteria</code> ignores all the <code>$_POST</code> variables that do not match any field in the table. Values are automatically escaped using <code>bound parameters</code>.</p>

<p>Ahora, guardamos los parámetros producidos en la bolsa de sesión del controlador:</p>

<pre><code class="language-php">&lt;?php

$this-&gt;persistent-&gt;searchParams = $query-&gt;getParams();
</code></pre>

<p>La bolsa de sesión, es un atributo especial en un controlador que persiste entre las solicitudes utilizando el servicio de sesión. When accessed, this attribute injects a <a href="api/Phalcon_Session_Bag">Phalcon\Session\Bag</a> instance that is independent in each controller.</p>

<p>Entonces, basado en los parámetros construidos, realizamos la consulta:</p>

<pre><code class="language-php">&lt;?php

$products = Products::find($parameters);

if (count($products) === 0) {
    $this-&gt;flash-&gt;notice(
        'La búsqueda no encontró ningún producto'
    );

    return $this-&gt;dispatcher-&gt;forward(
        [
            'controller' =&gt; 'products',
            'action'     =&gt; 'index',
        ]
    );
}
</code></pre>

<p>If the search doesn’t return any product, we forward the user to the index action again. Let’s pretend the search returned results, then we create a paginator to navigate easily through them:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Paginator\Adapter\Model as Paginator;

// ...

$paginator = new Paginator(
    [
        'data'  =&gt; $products,   // Datos a paginar
        'limit' =&gt; 5,           // Filas por página
        'page'  =&gt; $numberPage, // Página activa o actual
    ]
);

// Obtener la página activa en el paginador
$page = $paginator-&gt;getPaginate();
</code></pre>

<p>Finalmente pasamos la página retornada a la vista:</p>

<pre><code class="language-php">&lt;?php

$this-&gt;view-&gt;page = $page;
</code></pre>

<p>En la vista (<code>app/views/products/search.volt</code>), recorremos los resultados correspondientes a la página actual, mostrando cada fila de la página actual al usuario:</p>

<pre><code class="language-twig">
{% for product in page.items %}
    {% if loop.first %}
        &lt;table&gt;
            &lt;thead&gt;
                &lt;tr&gt;
                    &lt;th&gt;Id&lt;/th&gt;
                    &lt;th&gt;Product Type&lt;/th&gt;
                    &lt;th&gt;Name&lt;/th&gt;
                    &lt;th&gt;Price&lt;/th&gt;
                    &lt;th&gt;Active&lt;/th&gt;
                &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
    {% endif %}

    &lt;tr&gt;
        &lt;td&gt;
            {{ product.id }}
        &lt;/td&gt;

        &lt;td&gt;
            {{ product.getProductTypes().name }}
        &lt;/td&gt;

        &lt;td&gt;
            {{ product.name }}
        &lt;/td&gt;

        &lt;td&gt;
            {{ '%.2f'|format(product.price) }}
        &lt;/td&gt;

        &lt;td&gt;
            {{ product.getActiveDetail() }}
        &lt;/td&gt;

        &lt;td width='7%'&gt;
            {{ link_to('products/edit/' ~ product.id, 'Edit') }}
        &lt;/td&gt;

        &lt;td width='7%'&gt;
            {{ link_to('products/delete/' ~ product.id, 'Delete') }}
        &lt;/td&gt;
    &lt;/tr&gt;

    {% if loop.last %}
            &lt;/tbody&gt;
            &lt;tbody&gt;
                &lt;tr&gt;
                    &lt;td colspan='7'&gt;
                        &lt;div&gt;
                            {{ link_to('products/search', 'First') }}
                            {{ link_to('products/search?page=' ~ page.before, 'Previous') }}
                            {{ link_to('products/search?page=' ~ page.next, 'Next') }}
                            {{ link_to('products/search?page=' ~ page.last, 'Last') }}
                            &lt;span class='help-inline'&gt;{{ page.current }} of {{ page.total_pages }}&lt;/span&gt;
                        &lt;/div&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
            &lt;/tbody&gt;
        &lt;/table&gt;
    {% endif %}
{% else %}
    No products are recorded
{% endfor %}

</code></pre>

<p>Hay muchas cosas en el ejemplo anterior que vale la pena detallar. En primer lugar, los elementos activos de la página actual son recorridos utilizando un <code>for</code> de Volt. Volt proporciona una sintaxis más simple para un <code>foreach</code> de PHP.</p>

<pre><code class="language-twig">
{% for product in page.items %}

</code></pre>

<p>En PHP es lo mismo que:</p>

<pre><code class="language-php">&lt;?php foreach ($page-&gt;items as $product) { ?&gt;
</code></pre>

<p>El bloque entero <code>for</code> proporciona lo siguiente:</p>

<pre><code class="language-twig">
{% for product in page.items %}
    {% if loop.first %}
        Executed before the first product in the loop
    {% endif %}

    Executed for every product of page.items

    {% if loop.last %}
        Executed after the last product is loop
    {% endif %}
{% else %}
    Executed if page.items does not have any products
{% endfor %}

</code></pre>

<p>Now you can go back to the view and find out what every block is doing. Every field in <code>product</code> is printed accordingly:</p>

<pre><code class="language-twig">
&lt;tr&gt;
    &lt;td&gt;
        {{ product.id }}
    &lt;/td&gt;

    &lt;td&gt;
        {{ product.productTypes.name }}
    &lt;/td&gt;

    &lt;td&gt;
        {{ product.name }}
    &lt;/td&gt;

    &lt;td&gt;
        {{ '%.2f'|format(product.price) }}
    &lt;/td&gt;

    &lt;td&gt;
        {{ product.getActiveDetail() }}
    &lt;/td&gt;

    &lt;td width='7%'&gt;
        {{ link_to('products/edit/' ~ product.id, 'Edit') }}
    &lt;/td&gt;

    &lt;td width='7%'&gt;
        {{ link_to('products/delete/' ~ product.id, 'Delete') }}
    &lt;/td&gt;
&lt;/tr&gt;

</code></pre>

<p>Como hemos visto antes usando <code>product.id</code> es igual que hacer en PHP: <code>$product-&gt;id</code>, hicimos lo mismo con <code>product.name</code> y así sucesivamente. Otros campos se procesan diferente, por ejemplo, enfoquémonos en <code>product.productTypes.name</code>. Para entender esta parte, tenemos que revisar el modelo de productos (<code>app/models/Products.php</code>):</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Model;

/**
 * Productos
 */
class Products extends Model
{
    // ...

    /**
     * Inicializador de productos
     */
    public function initialize()
    {
        $this-&gt;belongsTo(
            'product_types_id',
            'ProductTypes',
            'id',
            [
                'reusable' =&gt; true,
            ]
        );
    }

    // ...
}
</code></pre>

<p>Un modelo puede tener un método llamado <code>initialize()</code>, se llama a este método una vez por petición y sirve al ORM para inicializar un modelo. En este caso, ‘Products’ se inicializa al definir que este modelo tiene una relación de uno a muchos con otro modelo llamado ‘ProductTypes’.</p>

<pre><code class="language-php">&lt;?php

$this-&gt;belongsTo(
    'product_types_id',
    'ProductTypes',
    'id',
    [
        'reusable' =&gt; true,
    ]
);
</code></pre>

<p>Esto significa que el atributo local <code>product_types_id</code> en <code>Products</code> tiene una relación uno a muchos con el modelo de <code>ProductTypes</code> en su atributo <code>id</code>. Definiendo esta relación podemos acceder el nombre del tipo de producto utilizando:</p>

<pre><code class="language-twig">
&lt;td&gt;{{ product.productTypes.name }}&lt;/td&gt;

</code></pre>

<p>El campo <code>price</code> es impreso mediante su formato utilizando un filtro de Volt:</p>

<pre><code class="language-twig">
&lt;td&gt;{{ '%.2f'|format(product.price) }}&lt;/td&gt;

</code></pre>

<p>En PHP plano, sería:</p>

<pre><code class="language-php">&lt;?php echo sprintf('%.2f', $product-&gt;price) ?&gt;
</code></pre>

<p>Al imprimir si el producto está activo o no, se utiliza un ayudante implementado en el modelo:</p>

<pre><code class="language-php">
&lt;td&gt;{{ product.getActiveDetail() }}&lt;/td&gt;

</code></pre>

<p>Este método se define en el modelo.</p>

<p><a name="creating-updating-records"></a></p>

<h2 id="creación-y-actualización-de-registros">Creación y actualización de registros</h2>

<p>Ahora vamos a ver cómo el CRUD crea y actualiza los registros. Desde las vistas <code>new</code> y <code>edit</code>, los datos introducidos por el usuario son enviados a las acciones <code>create</code> y <code>save</code> que realizan las acciones de <code>creación</code> y <code>actualización</code> de productos, respectivamente.</p>

<p>En el caso de la creación, recuperamos los datos enviados y los asignarlos a una nueva instancia de <code>Products</code>:</p>

<pre><code class="language-php">&lt;?php

/**
 * Crear un producto basado en los datos ingresados en la acción 'new'
 */
public function createAction()
{
    if (!$this-&gt;request-&gt;isPost()) {
        return $this-&gt;dispatcher-&gt;forward(
            [
                'controller' =&gt; 'products',
                'action'     =&gt; 'index',
            ]
        );
    }

    $form = new ProductsForm();

    $product = new Products();

    $product-&gt;id               = $this-&gt;request-&gt;getPost('id', 'int');
    $product-&gt;product_types_id = $this-&gt;request-&gt;getPost('product_types_id', 'int');
    $product-&gt;name             = $this-&gt;request-&gt;getPost('name', 'striptags');
    $product-&gt;price            = $this-&gt;request-&gt;getPost('price', 'double');
    $product-&gt;active           = $this-&gt;request-&gt;getPost('active');

    // ...
}
</code></pre>

<p>¿Recuerda los filtros que definimos en el formulario de productos? Los datos se filtran antes de ser asignados al objeto <code>$product</code>. Este filtrado es opcional; el ORM también escapa los datos de entrada y realiza casting adicional según los tipos de columna:</p>

<pre><code class="language-php">&lt;?php

// ...

$name = new Text('name');

$name-&gt;setLabel('Nombre');

// Filtros para el nombre
$name-&gt;setFilters(
    [
        'striptags',
        'string',
    ]
);

// Validadores para el nombre
$name-&gt;addValidators(
    [
        new PresenceOf(
            [
                'message' =&gt; 'El nombre es requerido',
            ]
        )
    ]
);

$this-&gt;add($name);
</code></pre>

<p>Al guardar, sabremos si los datos se ajustan a las reglas de negocio y las validaciones del formulario <code>ProductsForm</code> (<code>app/forms/ProductsForm.php</code>):</p>

<pre><code class="language-php">&lt;?php

// ...

$form = new ProductsForm();

$product = new Products();

// Validar los datos enviados
$data = $this-&gt;request-&gt;getPost();

if (!$form-&gt;isValid($data, $product)) {
    $messages = $form-&gt;getMessages();

    foreach ($messages as $message) {
        $this-&gt;flash-&gt;error($message);
    }

    return $this-&gt;dispatcher-&gt;forward(
        [
            'controller' =&gt; 'products',
            'action'     =&gt; 'new',
        ]
    );
}
</code></pre>

<p>Finalmente, si el formulario no devuelve ningún mensaje de validación podemos guardar la instancia de producto:</p>

<pre><code class="language-php">&lt;?php

// ...

if ($product-&gt;save() === false) {
    $messages = $product-&gt;getMessages();

    foreach ($messages as $message) {
        $this-&gt;flash-&gt;error($message);
    }

    return $this-&gt;dispatcher-&gt;forward(
        [
            'controller' =&gt; 'products',
            'action'     =&gt; 'new',
        ]
    );
}

$form-&gt;clear();

$this-&gt;flash-&gt;success(
    'El producto fue creado correctamente'
);

return $this-&gt;dispatcher-&gt;forward(
    [
        'controller' =&gt; 'products',
        'action'     =&gt; 'index',
    ]
);
</code></pre>

<p>Ahora, en el caso de actualización de un producto, primero debemos presentar al usuario los datos que se encuentran actualmente en el registro editado:</p>

<pre><code class="language-php">&lt;?php

/**
 * Editar un producto basado en su ID
 */
public function editAction($id)
{
    if (!$this-&gt;request-&gt;isPost()) {
        $product = Products::findFirstById($id);

        if (!$product) {
            $this-&gt;flash-&gt;error(
                'Producto no encontrado'
            );

            return $this-&gt;dispatcher-&gt;forward(
                [
                    'controller' =&gt; 'products',
                    'action'     =&gt; 'index',
                ]
            );
        }

        $this-&gt;view-&gt;form = new ProductsForm(
            $product,
            [
                'edit' =&gt; true,
            ]
        );
    }
}
</code></pre>

<p>Los datos está ligados al formulario pasando el modelo como primer parámetro. Gracias a esto, el usuario puede cambiar cualquier valor y luego enviarlo a la base de datos a través de la acción de <code>save</code>:</p>

<pre><code class="language-php">&lt;?php

/**
 * Actualizar un producto basado en los datos ingresados en la acción 'edit'
 */
public function saveAction()
{
    if (!$this-&gt;request-&gt;isPost()) {
        return $this-&gt;dispatcher-&gt;forward(
            [
                'controller' =&gt; 'products',
                'action'     =&gt; 'index',
            ]
        );
    }

    $id = $this-&gt;request-&gt;getPost('id', 'int');

    $product = Products::findFirstById($id);

    if (!$product) {
        $this-&gt;flash-&gt;error(
            'El producto no existe'
        );

        return $this-&gt;dispatcher-&gt;forward(
            [
                'controller' =&gt; 'products',
                'action'     =&gt; 'index',
            ]
        );
    }

    $form = new ProductsForm();

    $data = $this-&gt;request-&gt;getPost();

    if (!$form-&gt;isValid($data, $product)) {
        $messages = $form-&gt;getMessages();

        foreach ($messages as $message) {
            $this-&gt;flash-&gt;error($message);
        }

        return $this-&gt;dispatcher-&gt;forward(
            [
                'controller' =&gt; 'products',
                'action'     =&gt; 'new',
            ]
        );
    }

    if ($product-&gt;save() === false) {
        $messages = $product-&gt;getMessages();

        foreach ($messages as $message) {
            $this-&gt;flash-&gt;error($message);
        }

        return $this-&gt;dispatcher-&gt;forward(
            [
                'controller' =&gt; 'products',
                'action'     =&gt; 'new',
            ]
        );
    }

    $form-&gt;clear();

    $this-&gt;flash-&gt;success(
        'El producto fue actualizado correctamente'
    );

    return $this-&gt;dispatcher-&gt;forward(
        [
            'controller' =&gt; 'products',
            'action'     =&gt; 'index',
        ]
    );
}
</code></pre>

<p><a name="user-components"></a></p>

<h2 id="componentes-de-usuario">Componentes de usuario</h2>

<p>Todos los elementos de la interfaz y estilos visuales de la aplicación se han logrado principalmente a través de <a href="http://getbootstrap.com/">Bootstrap</a>. Algunos elementos, como barra de navegación, cambian según el estado de la aplicación. Por ejemplo, en la esquina superior derecha, el enlace <code>Iniciar sesión / Registrarse</code> cambia a <code>Cerrar sesión</code> si un usuario está logueado en la aplicación.</p>

<p>Esta parte de la aplicación se implementa en el componente <code>Elements</code> (<code>app/library/Elements.php</code>).</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\User\Component;

class Elements extends Component
{
    public function getMenu()
    {
        // ...
    }

    public function getTabs()
    {
        // ...
    }
}
</code></pre>

<p>This class extends the <a href="api/Phalcon_Mvc_User_Component">Phalcon\Mvc\User\Component</a>. No esta impuesto extender un componente con esta clase, pero esto ayuda para acceder más rápidamente a los servicios de aplicación. Ahora, vamos a registrar nuestro primer componente de usuario en el contenedor de servicios:</p>

<pre><code class="language-php">&lt;?php

// Registrar un componente de usuario
$di-&gt;set(
    'elements',
    function () {
        return new Elements();
    }
);
</code></pre>

<p>Al igual que los controladores, plugins o componentes de una vista, este componente también tiene acceso a los servicios registrados en el contenedor y al acceder a un atributo con el mismo nombre de un servicio previamente registrado:</p>

<pre><code class="language-twig">
&lt;div class='navbar navbar-fixed-top'&gt;
    &lt;div class='navbar-inner'&gt;
        &lt;div class='container'&gt;
            &lt;a class='btn btn-navbar' data-toggle='collapse' data-target='.nav-collapse'&gt;
                &lt;span class='icon-bar'&gt;&lt;/span&gt;
                &lt;span class='icon-bar'&gt;&lt;/span&gt;
                &lt;span class='icon-bar'&gt;&lt;/span&gt;
            &lt;/a&gt;

            &lt;a class='brand' href='#'&gt;INVO&lt;/a&gt;

            {{ elements.getMenu() }}
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;div class='container'&gt;
    {{ content() }}

    &lt;hr&gt;

    &lt;footer&gt;
        &lt;p&gt;&amp;copy; Company 2017&lt;/p&gt;
    &lt;/footer&gt;
&lt;/div&gt;

</code></pre>

<p>La parte importante es:</p>

<pre><code class="language-twig">
{{ elements.getMenu() }}

</code></pre>

<p><a name="dynamic-titles"></a></p>

<h2 id="cambiando-dinámicamente-el-título">Cambiando dinámicamente el título</h2>

<p>When you browse between one option and another will see that the title changes dynamically indicating where we are currently working. This is achieved in each controller initializer:</p>

<pre><code class="language-php">&lt;?php

class ProductsController extends ControllerBase
{
    public function initialize()
    {
        // Configurar el título del documento
        $this-&gt;tag-&gt;setTitle(
            'Gestor de tipos de producto'
        );

        parent::initialize();
    }

    // ...
}
</code></pre>

<p>Nota, que también se llama al método <code>parent::initialize()</code>, que agrega más datos en el título:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Controller;

class ControllerBase extends Controller
{
    protected function initialize()
    {
        // Anteponer el nombre de la aplicación al título
        $this-&gt;tag-&gt;prependTitle('INVO | ');
    }

    // ...
}
</code></pre>

<p>Finalmente, el título se imprime en la vista principal (app/views/index.volt):</p>

<pre><code class="language-php">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;?php echo $this-&gt;tag-&gt;getTitle(); ?&gt;
    &lt;/head&gt;

    &lt;!-- ... --&gt;
&lt;/html&gt;
</code></pre>

                                    </div>
                                    <div class="col-md-4 col-lg-3 col-sm-12 support-column-margin">
                                        <div class="topic-search">
    <form class="bd-search d-flex align-items-center">
        <input type="search"
               class="form-control"
               id="docs-search"
               placeholder=""
               aria-label=""
               autocomplete="off"
               data-siteurl="https://phalcon-docs4.netlify.com"
               data-docs-version="3.4">
        <button class="btn btn-link bd-search-docs-toggle d-md-none p-0 ml-3"
                type="button"
                data-toggle="collapse"
                data-target="#bd-docs-nav"
                aria-controls="bd-docs-nav"
                aria-expanded="false"
                aria-label="Toggle docs navigation">
            <svg xmlns="http://www.w3.org/2000/svg"
                 viewbox="0 0 30 30"
                 width="30"
                 height="30"
                 focusable="false">
                <title>Menu</title>
                <path stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-miterlimit="10"
                      d="M4 7h22M4 15h22M4 23h22"></path>
            </svg>
        </button>
    </form>
</div>
                                        <div class="topic-categories">
    
</div>

                                        <div class="article-menu">
    <ul>
        
        
    </ul>
</div>
                                    </div>
                                </div>
                            </div>
                        </section>

                    </div>
                </div>
            </div>
        </div>
    </div>

<footer>
    <div class="container">
        <div class="footer-wrapper clearfix">

            <div class="footer-link-container">
                <a class="footer-link" href="/">
                    <img class="footer-logo-img" src="/assets/images/footer_logo.svg" alt="logo">
                </a>
                <a class="footer-link" href="https://phalcon.link/about" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://phalcon.link/sponsors" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://phalcon.link/fund" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://phalcon.link/download" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://license.phalconphp.com/" target="_blank">
                     New BSD
                </a>
            </div>

            <div class="footer-copyright">
                <a href="https://odva.pro/" target="_blank" class="o2-link">
                    <span></span> <img src="/assets/images/logo-o2.svg" alt="logo o2">
                </a>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript" src="/assets/js/main.min.js?v1547266080100021829"></script>
<script type="text/javascript" src="/assets/js/highlight/highlight.pack.js?v1547266080100021829"></script>
<script type="application/javascript">hljs.initHighlightingOnLoad();</script>
<script type="application/javascript">hljs.initHighlightingOnLoad();</script>
</body>
</html>
