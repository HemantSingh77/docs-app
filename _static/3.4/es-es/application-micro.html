<!doctype html>
<!--[if IE 8]>
<html lang="es-es" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="es-es" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="es-es" class="no-js">
<!--<![endif]-->








    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <script type="text/javascript" src="/assets/js/viewport-min-width.js?v1547266080100021829"></script>
        <meta name="description"
              content="Official Phalcon Documentation">
        <meta name="keywords" content="php, phalcon, phalcon php, php framework, faster php framework, php extension, next generation framework, docs, documentation">
        <meta name="author" href="/humans.txt">
        <meta name="generator" content="Phalcon Team - Jekyll - Netlify">

        <link href="https://phalcon-docs4.netlify.com/3.4/es-es/application-micro.html" rel="canonical">
        <title>Phalcon Framework Documentation</title>

        <!-- Twitter -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@zephirlang">
        <meta name="twitter:creator" content="@zephirlang">
        <meta name="twitter:title" content="Phalcon Framework Documentation">
        <meta name="twitter:description" content="Official Phalcon Documentation">
        <meta name="twitter:image" content="https://assets.phalconphp.com/phalcon/logo.png">

        <!-- Facebook -->
        <meta property="og:url" content="https://phalcon-docs4.netlify.com">
        <meta property="og:title" content="Phalcon Framework Documentation">
        <meta property="og:description" content="Official Phalcon Documentation">
        <meta property="og:type" content="website">
        <meta property="og:image" content="https://assets.phalconphp.com/phalcon/logo.png">

        <meta name="msapplication-TileColor" content="#FFFFFF">
        <meta name="msapplication-square70x70logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-70x70.png">
        <meta name="msapplication-TileImage"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-144x144.png">
        <meta name="msapplication-square150x150logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-150x150.png">
        <meta name="msapplication-wide310x150logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-310x150.png">
        <meta name="msapplication-square310x310logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-310x310.png">

        <link rel="apple-touch-icon"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon.png">

        <link rel="apple-touch-icon-precomposed"
              sizes="57x57"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-57x57.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="60x60"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-60x60.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="72x72"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="76x76"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-76x76.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="114x114"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-114x114.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="120x120"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-120x120.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="144x144"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-144x144.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="152x152"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-152x152.png">

        <link rel="icon"
              type="image/png"
              sizes="16x16"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-16x16.png">
        <link rel="icon"
              type="image/png"
              sizes="32x32"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-32x32.png">
        <link rel="icon"
              type="image/png"
              sizes="96x96"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-96x96.png">
        <link rel="icon"
              type="image/png"
              sizes="128x128"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-128x128.png">
        <link rel="icon"
              type="image/png"
              sizes="196x196"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-196x196.png">
        <link rel="shortcut icon"
              type="image/png"
              href="https://assets.phalconphp.com/phalcon/favicon.ico"/>

        <link rel="alternate"
              type="application/rss+xml"
              title=" - "
              href="https://phalcon-docs4.netlify.com/feed.xml">

        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css"
              integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE="
              crossorigin="anonymous" />
        <link rel="stylesheet" href="/assets/css/monokai.css?v1547266080100021829" />
        <link rel="stylesheet" href="/assets/css/style.css?v1547266080100021829" />

        <script defer src="https://use.fontawesome.com/releases/v5.6.1/js/all.js"
                integrity="sha384-R5JkiUweZpJjELPWqttAYmYM1P3SNEJRM6ecTQF05pFFtxmCO+Y1CiUhvuDzgSVZ"
                crossorigin="anonymous"></script>
        
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90300500-6"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-90300500-6');
    </script>

    </head>


<body onclick="o2.allNavSlideUp()">
    <header class="header-image-doc">
        <div class="container">
            <div class="header-wrapper">
                <div class="clearfix">
                    <div class="row">
                        <div class="col-md-2 col-sm-3  col-xs-8">
                            <div class="header-image__logo-wrapper">
                                <a href="/3.4/es-es">
                                    <img class="logo-img" src="/assets/images/header_logo.svg" alt="logo">
                                </a>
                            </div>
                        </div>
                        <div class="col-md-10 col-sm-9 top-menu">

                            <div class="nav-icon" onclick="o2.showMobileMenu();">
                                <div class="nav-line"></div>
                                <div class="nav-line"></div>
                                <div class="nav-line"></div>
                            </div>
                            <nav class="header-nav">
                                <ul>
                                    <li class="nav-item" onclick="o2.toggleState(this, event);">
                                        <div class="nav-item_selected">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                 alt="">
                                            <span class="caret"></span>
                                        </div>
                                        <div class="nav-item__list" onclick="event.stopPropagation();">
                                            
                                                <a href="/3.4/en/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                         alt="English (US)">
                                                    English (US)
                                                </a>
                                            
                                                <a href="/3.4/cs-cz/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/cs.png"
                                                         alt="Czech">
                                                    Czech
                                                </a>
                                            
                                                <a href="/3.4/de-de/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/de.png"
                                                         alt="German">
                                                    German
                                                </a>
                                            
                                                <a href="/3.4/es-es/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                         alt="Spanish">
                                                    Spanish
                                                </a>
                                            
                                                <a href="/3.4/fa-ir/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fa.png"
                                                         alt="Persian">
                                                    Persian
                                                </a>
                                            
                                                <a href="/3.4/fr-fr/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fr.png"
                                                         alt="French">
                                                    French
                                                </a>
                                            
                                                <a href="/3.4/id-id/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/id.png"
                                                         alt="Indonesian">
                                                    Indonesian
                                                </a>
                                            
                                                <a href="/3.4/it-it/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/it.png"
                                                         alt="Italian">
                                                    Italian
                                                </a>
                                            
                                                <a href="/3.4/ja-jp/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ja.png"
                                                         alt="Japanese">
                                                    Japanese
                                                </a>
                                            
                                                <a href="/3.4/pl-pl/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/pl.png"
                                                         alt="Polish">
                                                    Polish
                                                </a>
                                            
                                                <a href="/3.4/ru-ru/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ru.png"
                                                         alt="Russian">
                                                    Russian
                                                </a>
                                            
                                                <a href="/3.4/tr-tr/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/tr.png"
                                                         alt="Turkish">
                                                    Turkish
                                                </a>
                                            
                                                <a href="/3.4/uk-ua/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/uk.png"
                                                         alt="Ukrainian">
                                                    Ukrainian
                                                </a>
                                            
                                                <a href="/3.4/zh-cn/application-micro" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                                         alt="Chinese Simplified">
                                                    Chinese Simplified
                                                </a>
                                            
                                        </div>
                                    </li>

                                        <li class="nav-item" onclick="o2.toggleState(this, event);">
                                            <div class="nav-item__selected custom-select__version">
                                                 3.4
                                                <span class="caret"></span>
                                            </div>
                                            <div class="nav-item__list" onclick="event.stopPropagation();">
                                                
                                                <a href="/3.4/es-es/application-micro" class="custom-select__list-item">
                                                    <span>3.4</span>
                                                </a>
                                                
                                                <a href="/3.3/es-es/application-micro" class="custom-select__list-item">
                                                    <span>3.3</span>
                                                </a>
                                                
                                                <a href="/3.2/es-es/application-micro" class="custom-select__list-item">
                                                    <span>3.2</span>
                                                </a>
                                                
                                                <a href="/3.1/es-es/application-micro" class="custom-select__list-item">
                                                    <span>3.1</span>
                                                </a>
                                                
                                                <a href="/4.0/es-es/application-micro" class="custom-select__list-item">
                                                    <span>4.0</span>
                                                </a>
                                                
                                            </div>
                                        </li>

                                    <li class="nav-item" onclick="o2.toggleState(this, event);">
                                        <div class="nav-item_selected">
                                            
                                            <span class="caret"></span>
                                        </div>
                                        <div class="nav-item__list">
                                            <a href="https://phalcon.link/forum" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/blog" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/resources" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <div class="nav-item__divider"></div>
                                            <a href="https://phalcon.link/f" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/t" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/gab" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/about">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/sponsors">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/fund">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/download">
                                            
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>

                        <div class="header-nav-mobile">
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this, event)">
                                    <img class="lang-image"
                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                         alt="">
                                    <span class="caret"></span>
                                </div>

                                <ul style="display:none;" class="clearfix" onclick="event.stopPropagation();">
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/en/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                 alt="English (US)">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/cs-cz/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/cs.png"
                                                 alt="Czech">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/de-de/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/de.png"
                                                 alt="German">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/es-es/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                 alt="Spanish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/fa-ir/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fa.png"
                                                 alt="Persian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/fr-fr/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fr.png"
                                                 alt="French">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/id-id/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/id.png"
                                                 alt="Indonesian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/it-it/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/it.png"
                                                 alt="Italian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/ja-jp/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ja.png"
                                                 alt="Japanese">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/pl-pl/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/pl.png"
                                                 alt="Polish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/ru-ru/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ru.png"
                                                 alt="Russian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/tr-tr/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/tr.png"
                                                 alt="Turkish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/uk-ua/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/uk.png"
                                                 alt="Ukrainian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/zh-cn/application-micro">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                                 alt="Chinese Simplified">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                </ul>

                            </div>
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this,event)">
                                     3.4
                                    <span class="caret"></span>
                                </div>

                                <ul style="display:none;" class="clearfix" onclick="event.stopPropagation();">
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.4/es-es/application-micro">
                                            <span>3.4</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.3/es-es/application-micro">
                                            <span>3.3</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.2/es-es/application-micro">
                                            <span>3.2</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.1/es-es/application-micro">
                                            <span>3.1</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/4.0/es-es/application-micro">
                                            <span>4.0</span>
                                        </a>
                                    </li>
                                    
                                </ul>

                            </div>
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this, event)">
                                    
                                    <span class="caret"></span>
                                </div>
                                <ul style="display:none;">
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/forum" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/blog" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/resources" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/f" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/t" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/gab" target="_blank">
                                            
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/about">
                                    
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/sponsors">
                                    
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/fund">
                                    
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/download">
                                    
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>


    <div class="container-fluid article-page-wrap">
        <div class="row">
            <div>
                <div class="col-md-2 sidebar hidden-xs">
                    <div class="sidebar--spacer">&nbsp;</div>
                </div>
                <div class="m-t-md m-b-lg" id="articles">
                    <div class="article-content">
                        







                        <section class="documentation-section">
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-md-8 col-lg-9 parse-content">
                                        <div>
                                            <a class="article-content-edit-link pull-right"
                                               href="https://crowdin.com/project/phalcon-documentation/es-es">
                                                
                                            </a>
                                            <br>
                                        </div>
                                        <h1 id="micro-aplicaciones">Micro Aplicaciones</h1>

<p>Phalcon ofrece una aplicación muy ‘fina’, para que pueda crear ‘Micro’ aplicaciones con un mínimo de código PHP.</p>

<p>Las Micro Aplicaciones son convenientes para aplicaciones pequeñas que van a tener un uso muy ligero. Such applications are for instance our `<a href="https://github.com/phalcon/website">website</a>, this website (<a href="https://github.com/phalcon/docs">docs</a>), our <a href="https://github.com/phalcon/store">store</a>, APIs, prototypes etc.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro;

$app = new Micro();

$app-&gt;get(
    '/orders/display/{name}',
    function ($name) {
        echo "&lt;h1&gt;This is order: {$name}!&lt;/h1&gt;";
    }
);

$app-&gt;handle();
</code></pre>

<p><a name="creating-micro-applications"></a></p>

<h2 id="creando-una-micro-aplicación">Creando una Micro Aplicación</h2>

<p>The <a href="api/Phalcon_Mvc_Micro">Phalcon\Mvc\Micro</a> class is the one responsible for creating a Micro application.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro;

$app = new Micro();
</code></pre>

<p><a name="routing"></a></p>

<h2 id="ruteo">Ruteo</h2>

<p>Defining routes in a <a href="api/Phalcon_Mvc_Micro">Phalcon\Mvc\Micro</a> application is very easy. Routes are defined as follows:</p>

<pre><code class="language-text">   Aplicación -&gt; (método/verbo) -&gt; (url de la ruta/expresión regular, función PHP de llamada)
</code></pre>

<p><a name="routing-setup"></a></p>

<h3 id="configuración">Configuración</h3>

<p>Routing is handled by the <a href="api/Phalcon_Mvc_Router">Phalcon\Mvc\Router</a> object. [<a href="/3.4/en/routing">Info</a>]</p>

<h5 class="alert alert-warning">Las rutas deben empezar siempre con <code>/</code></h5>

<p>Generalmente, la ruta de inicio en una aplicación, es la ruta <code>/</code> y en la mayoría de los casos se accede mediante el método HTTP GET:</p>

<pre><code class="language-php">&lt;?php

// Esta es la ruta inicial
$app-&gt;get(
    '/',
    function () {
        echo '&lt;h1&gt;Welcome!&lt;/h1&gt;';
    }
);
</code></pre>

<p><a name="routing-setup-application"></a></p>

<h3 id="el-objeto-de-la-aplicación">El Objeto de la Aplicación</h3>

<p>Routes can be set using the <a href="api/Phalcon_Mvc_Micro">Phalcon\Mvc\Micro</a> application object as follows:</p>

<pre><code class="language-php">use Phalcon\Mvc\Micro;

$app = new Micro();

// Captura consultas GET 
$app-&gt;get(
    '/orders/display/{name}',
    function ($name) {
        echo "&lt;h1&gt;This is order: {$name}!&lt;/h1&gt;";
    }
);
</code></pre>

<p><a name="routing-setup-router"></a></p>

<h3 id="el-objeto-ruoter">El Objeto Ruoter</h3>

<p>You can also create a <a href="api/Phalcon_Mvc_Router">Phalcon\Mvc\Router</a> object, setting the routes there and then injecting it in the dependency injection container.</p>

<pre><code class="language-php">use Phalcon\Mvc\Micro;
use Phalcon\Mvc\Router;

$router = new Router();

$router-&gt;addGet(
    '/orders/display/{name}',
    'OrdersClass::display';
    }
);


$app = new Micro();
$app-&gt;setService('router', $router, true);
</code></pre>

<p>Setting up your routes using the <a href="api/Phalcon_Mvc_Micro">Phalcon\Mvc\Micro</a> applications verb methods (<code>get</code>, <code>post</code>, etc.) is much easier than setting up a router object with relevant routes and then injecting it in the application.</p>

<p>Each method has its advantages and disadvantages. It all depends on the design and needs of your application.</p>

<p><a name="rewrite-rules"></a></p>

<h2 id="reglas-de-reescritura">Reglas de Reescritura</h2>

<p>Para que las rutas funcionen, ciertos cambios de configuración deben hacerse en la configuración de tu servidor web para cada sitio web en particular.</p>

<p>Those changes are outlined in the <a href="/3.4/en/rewrite-rules">rewrite rules</a>.</p>

<p><a name="routing-handlers"></a></p>

<h2 id="manejadores">Manejadores</h2>

<p>Los Manejadores (Handlers), son piezas de código accesibles que están vinculados a una ruta. When the route is matched, the handler is executed with all the defined parameters. Un manejador es cualquier código accesible que existe en PHP.</p>

<p><a name="routing-handlers-definitions"></a></p>

<h3 id="definiciones">Definiciones</h3>

<p>Phalcon offers several ways to attach a handler to a route. Your application needs and design as well as coding style will be the factors influencing your choice of implementation.</p>

<p><a name="routing-handlers-anonymous-function"></a></p>

<h4 id="funciones-anónimas">Funciones Anónimas</h4>

<p>Finalmente podemos utilizar una función anónima (como se ve arriba) para atender la solicitud</p>

<pre><code class="language-php">$app-&gt;get(
    '/orders/display/{name}',
    function ($name) {
        echo "&lt;h1&gt;This is order: {$name}!&lt;/h1&gt;";
    }
);
</code></pre>

<p>Accessing the <code>$app</code> object inside the anonymous function can be achieved by injecting it as follows:</p>

<pre><code class="language-php">$app-&gt;get(
    '/orders/display/{name}',
    function ($name) use ($app) {
        $context = "&lt;h1&gt;This is order: {$name}!&lt;/h1&gt;";
        $app-&gt;response-&gt;setContext($context);
        $app-&gt;response-&gt;send();
    }
);
</code></pre>

<p><a name="routing-handlers-function"></a></p>

<h4 id="función">Función</h4>

<p>Podemos definir una función como nuestro manejador y adjuntarlo a una ruta específica.</p>

<pre><code class="language-php">// Con una función
function order_display($name) {
    echo "&lt;h1&gt;This is order: {$name}!&lt;/h1&gt;";
}

$app-&gt;get(
    '/orders/display/{name}',
    'orders_display'
);
</code></pre>

<p><a name="routing-handlers-static-method"></a></p>

<h4 id="método-estático">Método Estático</h4>

<p>We can also use a static method as our handler as follows:</p>

<pre><code class="language-php">class OrdersClass
{
    public static function display($name) {
        echo "&lt;h1&gt;This is order: {$name}!&lt;/h1&gt;";
    }
}

$app-&gt;get(
    '/orders/display/{name}',
    'OrdersClass::display'
);
</code></pre>

<p><a name="routing-handlers-object-method"></a></p>

<h4 id="método-en-un-objeto">Método en un Objeto</h4>

<p>También podemos usar un método en un objeto:</p>

<pre><code class="language-php">class OrdersClass
{
    public function display($name) {
        echo "&lt;h1&gt;This is order: {$name}!&lt;/h1&gt;";
    }
}

$orders = new OrdersClass();
$app-&gt;get(
    '/orders/display/{name}',
    [
        $orders,
        'display',
    ]
);
</code></pre>

<p><a name="routing-handlers-controllers"></a></p>

<h4 id="controladores">Controladores</h4>

<p>With the <a href="api/Phalcon_Mvc_Micro">Phalcon\Mvc\Micro</a> you can create micro or medium applications. Estas últimas utilizan la arquitectura de micro pero se amplían para que utilicen más características que las aplicaciones Micro pero no tantas como lo hace una aplicación completa.</p>

<p>In medium applications you can organize handlers in controllers.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro\Collection as MicroCollection;

$orders = new MicroCollection();

// Establece el manejador principal. Por ejemplo, la instancia de un controlador
$orders-&gt;setHandler(new OrdersController());

// Establece un prefijo común para todas la rutas
$orders-&gt;setPrefix('/orders');

// Usa el método 'index' en OrdersController
$orders-&gt;get('/', 'index');

// Usa el método 'show' en OrdersController
$orders-&gt;get('/display/{slug}', 'show');

$app-&gt;mount($orders);
</code></pre>

<p>El <code>OrdersController</code> podría tener este aspecto:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Controller;

class OrdersController extends Controller
{
    public function index()
    {
        // ...
    }

    public function show($name)
    {
        // ...
    }
}
</code></pre>

<p>Since our controllers extend the <a href="api/Phalcon_Mvc_Controller">Phalcon\Mvc\Controller</a>, all the dependency injection services are available with their respective registration names. Por ejemplo:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Controller;

class OrdersController extends Controller
{
    public function index()
    {
        // ...
    }

    public function show($name)
    {
        $context = "&lt;h1&gt;This is order: {$name}!&lt;/h1&gt;";
        $this-&gt;response-&gt;setContext($context);

        return $this-&gt;response;
    }
}
</code></pre>

<p><a name="routing-handlers-controllers-lazy-loading"></a></p>

<h3 id="carga-perezosa-lazy-load">Carga Perezosa (Lazy Load)</h3>

<p>In order to increase performance, you might consider implementing lazy loading for your controllers (handlers). The controller will be loaded only if the relevant route is matched.</p>

<p>Lazy loading can be easily achieved when setting your handler in your <a href="api/Phalcon_Mvc_Micro_Collection">Phalcon\Mvc\Micro\Collection</a>:</p>

<pre><code class="language-php">$orders-&gt;setHandler('OrdersController', true);
$orders-&gt;setHandler('Blog\Controllers\OrdersController', true);
</code></pre>

<p><a name="routing-handlers-controllers-lazy-loading-use-case"></a></p>

<h4 id="casos-de-uso">Casos de uso</h4>

<p>Desarrollaremos una API para una tienda en línea. Los puntos de acceso son <code>/users</code>, <code>/orders</code> y <code>/products</code>. Cada uno de los puntos de acceso se registran usando los manejadores, y cada manejador es un controlador con las acciones pertinentes.</p>

<p>Los controladores que usaremos como manejadores son los siguientes:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Controller;

class UsersController extends Controller
{
    public function get($id)
    {
        // ...
    }

    public function add($payload)
    {
        // ...
    }
}

class OrdersController extends Controller
{
    public function get($id)
    {
        // ...
    }

    public function add($payload)
    {
        // ...
    }
}

class ProductsController extends Controller
{
    public function get($id)
    {
        // ...
    }

    public function add($payload)
    {
        // ...
    }
}
</code></pre>

<p>Registraremos los manejadores:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro\Collection as MicroCollection;

// Manejador Users
$users = new MicroCollection();
$users-&gt;setHandler(new UsersController());
$users-&gt;setPrefix('/users');
$users-&gt;get('/get/{id}', 'get');
$users-&gt;get('/add/{payload}', 'add');
$app-&gt;mount($users);

// Manejador Orders
$orders = new MicroCollection();
$orders-&gt;setHandler(new OrdersController());
$orders-&gt;setPrefix('/users');
$orders-&gt;get('/get/{id}', 'get');
$orders-&gt;get('/add/{payload}', 'add');
$app-&gt;mount($orders);

// Manejador Products
$products = new MicroCollection();
$products-&gt;setHandler(new ProductsController());
$products-&gt;setPrefix('/products');
$products-&gt;get('/get/{id}', 'get');
$products-&gt;get('/add/{payload}', 'add');
$app-&gt;mount($products);
</code></pre>

<p>This implementation loads each handler in turn and mounts it in our application object. El problema con este enfoque es que cada petición dará lugar a sólo un punto final y por lo tanto de la ejecución de un método de la clase. The remaining methods/handlers will just remain in memory without being used.</p>

<p>Utilizando Carga Perezosa, podemos reducir el número de objetos cargados en memoria y como resultado nuestra aplicación utiliza menos memoria.</p>

<p>The above implementation changes if we want to use lazy loading as follows:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro\Collection as MicroCollection;

// Users handler
$users = new MicroCollection();
$users-&gt;setHandler(new UsersController(), true);
$users-&gt;setPrefix('/users');
$users-&gt;get('/get/{id}', 'get');
$users-&gt;get('/add/{payload}', 'add');
$app-&gt;mount($users);

// Orders handler
$orders = new MicroCollection();
$orders-&gt;setHandler(new OrdersController(), true);
$orders-&gt;setPrefix('/users');
$orders-&gt;get('/get/{id}', 'get');
$orders-&gt;get('/add/{payload}', 'add');
$app-&gt;mount($orders);

// Products handler
$products = new MicroCollection();
$products-&gt;setHandler(new ProductsController(), true);
$products-&gt;setPrefix('/products');
$products-&gt;get('/get/{id}', 'get');
$products-&gt;get('/add/{payload}', 'add');
$app-&gt;mount($products);
</code></pre>

<p>Con este simple cambio en la aplicación, todos los manejadores permanecen sin ser instanciados hasta que son solicitados. Por lo tanto cuando alguien hace una petición a <code>/orders/get/2</code>, nuestra aplicación crea una instancia de <code>OrdersController</code> y llama al método <code>get</code>. Nuestra aplicación ahora consume menos recursos que antes.</p>

<p><a name="routing-handlers-not-found"></a></p>

<h3 id="no-encontrado-404">No encontrado (404)</h3>

<p>Any route that has not been matched in our <a href="api/Phalcon_Mvc_Micro">Phalcon\Mvc\Micro</a> application will cause it to try and execute the handler defined with the <code>notFound</code> method. Similar a otros métodos/verbos (<code>get</code>, <code>post</code> etc.), puedes registrar un manejador en el método <code>notFound</code> que puede ser cualquier función PHP accesible.</p>

<pre><code class="language-php">&lt;?php

$app-&gt;notFound(
    function () use ($app) {
        $app-&gt;response-&gt;setStatusCode(404, 'Not Found');
        $app-&gt;response-&gt;sendHeaders();

        $message = 'Nothing to see here. Move along....';
        $app-&gt;response-&gt;setContent($message);
        $app-&gt;response-&gt;send();
    }
);
</code></pre>

<p>También puede manejar las rutas que no han sido vinculadas (404) con Middleware, este se discute a continuación.</p>

<p><a name="routing-verbs"></a></p>

<h2 id="métodos---verbos">Métodos - Verbos</h2>

<p>The <a href="api/Phalcon_Mvc_Micro">Phalcon\Mvc\Micro</a> application provides a set of methods to bind the HTTP method with the route it is intended to.</p>

<p><a name="routing-verbs-delete"></a></p>

<h3 id="delete">delete</h3>

<p>Coincide si el método HTTP es <code>DELETE</code> y la ruta es <code>/api/products/delete/{id}</code></p>

<pre><code class="language-php">    $app-&gt;delete(
        '/api/products/delete/{id}',
        'delete_product'
    );
</code></pre>

<p><a name="routing-verbs-get"></a></p>

<h3 id="get">get</h3>

<p>Coincide si el método HTTP es <code>GET</code> y la ruta es <code>/api/products/</code></p>

<pre><code class="language-php">    $app-&gt;get(
        '/api/products',
        'get_products'
    );
</code></pre>

<p><a name="routing-verbs-head"></a></p>

<h3 id="head">head</h3>

<p>Coincide si el método HTTP es <code>HEAD</code> y la ruta es <code>/api/products/</code></p>

<pre><code class="language-php">    $app-&gt;get(
        '/api/products',
        'get_products'
    );
</code></pre>

<p><a name="routing-verbs-map"></a></p>

<h3 id="map">map</h3>

<p>Map permite adjuntar el mismo punto de acceso a más de un método HTTP. El ejemplo a continuación funciona si el método HTTP es <code>GET</code> o <code>POST</code> y la ruta es <code>/repos/store/refs</code></p>

<pre><code class="language-php">    $app
        -&gt;map(
            '/repos/store/refs',
            'action_product'
        )
        -&gt;via(
            [
                'GET',
                'POST',
            ]
        );
</code></pre>

<p><a name="routing-verbs-options"></a></p>

<h3 id="options">options</h3>

<p>Coincide si el método HTTP es <code>OPTIONS</code> y la ruta es <code>/api/products/options</code></p>

<pre><code class="language-php">    $app-&gt;options(
        '/api/products/options',
        'info_product'
    );
</code></pre>

<p><a name="routing-verbs-patch"></a></p>

<h3 id="patch">patch</h3>

<p>Coincide si el método HTTP es <code>PATCH</code> y la ruta es <code>/api/products/update/{id}</code></p>

<pre><code class="language-php">    $app-&gt;patch(
        '/api/products/update/{id}',
        'update_product'
    );
</code></pre>

<p><a name="routing-verbs-post"></a></p>

<h3 id="post">post</h3>

<p>Matches if the HTTP method is <code>POST</code> and the route is <code>/api/products/add</code></p>

<pre><code class="language-php">    $app-&gt;post(
        '/api/products',
        'add_product'
    );
</code></pre>

<p><a name="routing-verbs-put"></a></p>

<h3 id="put">put</h3>

<p>Coincide si el método HTTP es <code>PUT</code> y la ruta es <code>/api/products/update/{id}</code></p>

<pre><code class="language-php">    $app-&gt;put(
        '/api/products/update/{id}',
        'update_product'
    );
</code></pre>

<p><a name="routing-collections"></a></p>

<h2 id="colecciones">Colecciones</h2>

<p>Collections are a handy way to group collections attached to a handler and a common prefix (if needed). For a hypothetical <code>/orders</code> endpoint we could have the following endpoints:</p>

<pre><code>/orders/get/{id}
/orders/add/{payload}
/orders/update/{id}
/orders/delete/{id}
</code></pre>

<p>All of those routes are handled by our <code>OrdersController</code>. We set up our routes with a collection as follows:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro\Collection as MicroCollection;

$orders = new MicroCollection();
$orders-&gt;setHandler(new OrdersController());

$orders-&gt;setPrefix('/orders');

$orders-&gt;get('/get/{id}', 'displayAction');
$orders-&gt;get('/add/{payload}', 'addAction');
$orders-&gt;get('/update/{id}', 'updateAction');
$orders-&gt;get('/delete/{id}', 'deleteAction');

$app-&gt;mount($orders);
</code></pre>

<h5 class="alert alert-warning">The name that we bind each route has a suffix of <code>Action</code>. This is not necessary, your method can be called anything you like.</h5>

<p><a name="routing-parameters"></a></p>

<h2 id="parámetros">Parámetros</h2>

<p>We have briefly seen above how parameters are defined in the routes. Parameters are set in a route string by enclosing the name of the parameter in brackets.</p>

<pre><code class="language-php">$app-&gt;get(
    '/orders/display/{name}',
    function ($name) {
        echo "&lt;h1&gt;This is order: {$name}!&lt;/h1&gt;";
    }
);
</code></pre>

<p>We can also enforce certain rules for each parameter by using regular expressions. The regular expression is set after the name of the parameter, separating it with <code>:</code>.</p>

<pre><code class="language-php">// Coincidir por id de orden
$app-&gt;get(
    '/orders/display/{id:[0-9]+}',
    function ($id) {
        echo "&lt;h1&gt;This is order: #{$id}!&lt;/h1&gt;";
    }
);

// Coincidir por 4 números y un título alfabético
$app-&gt;get(
    '/posts/{year:[0-9][4]}/{title:[a-zA-Z\-]+}',
    function ($year, $title) {
        echo '&lt;h1&gt;Title: $title&lt;/h1&gt;';
        echo '&lt;h2&gt;Year: $year&lt;/h2&gt;';
    }
);
</code></pre>

<p>Additional information: <a href="api/Phalcon_Mvc_Router">Phalcon\Mvc\Router</a> <a href="/3.4/en/routing">Info</a></p>

<p><a name="routing-redirections"></a></p>

<h2 id="redirecciones">Redirecciones</h2>

<p>You can redirect one matched route to another using the <a href="api/Phalcon_Http_Response">Phalcon\Http\Response</a> object, just like in a full application.</p>

<pre><code class="language-php">$app-&gt;post('/old/url',
    function () use ($app) {
        $app-&gt;response-&gt;redirect('new/url');
        $app-&gt;response-&gt;sendHeaders();
    }
);

$app-&gt;post('/new/welcome',
    function () use ($app) {
        echo 'This is the new Welcome';
    }
);
</code></pre>

<p><strong>Nota</strong> tenemos que pasar el objeto <code>$app</code> en nuestra función anónima para tener acceso al objeto <code>request</code>.</p>

<p>When using controllers as handlers, you can perform the redirect just as easy:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Controller;

class UsersController extends Controller
{
    public function oldget($id)
    {
        return $this-&gt;response-&gt;redirect('users/get/' . $id);
    }

    public function get($id)
    {
        // ...
    }
}
</code></pre>

<p>Finally, you can perform redirections in your middleware (if you are using it). An example is below in the relevant section.</p>

<p><a name="routing-urls-for-routes"></a></p>

<h2 id="urls-para-rutas">URLs para Rutas</h2>

<p>Otra característica de las rutas es la posibilidad de crear rutas nombradas y generar URLs para estas rutas. Se trata de un proceso de dos pasos.</p>

<ul>
  <li>Primero tenemos que nombrar nuestra ruta. Esto puede lograrse con el método <code>setName()</code> que es presentado por los métodos/verbos (<code>get</code>, <code>post</code>, etc.) en nuestra aplicación;</li>
</ul>

<pre><code class="language-php">// Establecer una ruta con el nombre 'show-order'
$app
    -&gt;get(
        '/orders/display/{id}',
        function ($id) use ($app) {
            // ... Encontrar la orden y mostrarla
        }
    )
    -&gt;setName('show-order');
</code></pre>

<ul>
  <li>We need to use the <a href="api/Phalcon_Mvc_Url">Phalcon\Mvc\Url</a> component to generate URLs for the named routes.</li>
</ul>

<pre><code class="language-php">// Usar el nombre de ruta y generar una URL desde esta
$app-&gt;get(
    '/',
    function () use ($app) {
        $url = sprintf(
            '&lt;a href="%s"&gt;Show the order&lt;/a&gt;',
            $app-&gt;url-&gt;get(
                [
                    'for' =&gt; 'show-order',
                    'id'  =&gt; 1234,
                ]
            )
        );

        echo $url;
    }
);
</code></pre>

<p><a name="dependency-injector"></a></p>

<h1 id="inyector-de-dependencias">Inyector de Dependencias</h1>

<p>When a micro application is created, a <a href="api/Phalcon_Di_FactoryDefault">Phalcon\Di\FactoryDefault</a> services container is create implicitly.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro;
$app = new Micro();

$app-&gt;get(
    '/',
    function () use ($app) {
        $app-&gt;response-&gt;setContent('Hello!!');
        $app-&gt;response-&gt;send();
    }
);
</code></pre>

<p>You can also create a Di container yourself, and assign it to the micro application, therefore manipulating the services depending on the needs of your application.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro;
use Phalcon\Di\FactoryDefault;
use Phalcon\Config\Adapter\Ini as IniConfig;

$di = new FactoryDefault();

$di-&gt;set(
    'config',
    function () {
        return new IniConfig('config.ini');
    }
);

$app = new Micro();

$app-&gt;setDI($di);

$app-&gt;get(
    '/',
    function () use ($app) {
        // Leer una configuración desde el config
        echo $app-&gt;config-&gt;app_name;
    }
);

$app-&gt;post(
    '/contact',
    function () use ($app) {
        $app-&gt;flash-&gt;success('What are you doing Dave?');
    }
);
</code></pre>

<p>You can also use the array syntax to register services in the dependency injection container from the application object:</p>

<pre><code class="language-php">&lt;br /&gt;&amp;lt;?php

use Phalcon\Mvc\Micro;
use Phalcon\Db\Adapter\Pdo\Mysql as MysqlAdapter;

$app = new Micro();

// Establece el servicio de Base de Datos
$app['db'] = function () {
    return new MysqlAdapter(
        [
            'host'     =&amp;gt; 'localhost',
            'username' =&amp;gt; 'root',
            'password' =&amp;gt; 'secret',
            'dbname'   =&amp;gt; 'test_db',
        ]
    );
};

$app-&amp;gt;get(
    '/blog',
    function () use ($app) {
        $news = $app['db']-&amp;gt;query('SELECT * FROM news');

        foreach ($news as $new) {
            echo $new-&amp;gt;title;
        }
    }
);
</code></pre>

<p><a name="responses"></a></p>

<h1 id="respuestas">Respuestas</h1>

<p>A micro application can return many different types of responses. Direct output, use a template engine, calculated data, view based data, JSON etc.</p>

<p>Handlers may return raw responses using plain text, <a href="api/Phalcon_Http_Response">Phalcon\Http\Response</a> object or a custom built component that implements the <a href="api/Phalcon_Http_ResponseInterface">Phalcon\Http\ResponseInterface</a>.</p>

<p><a name="responses-direct-output"></a></p>

<h2 id="salida-directa">Salida Directa</h2>

<pre><code class="language-php">$app-&gt;get(
    '/orders/display/{name}',
    function ($name) {
        echo "&lt;h1&gt;This is order: {$name}!&lt;/h1&gt;";
    }
);
</code></pre>

<p><a name="responses-include"></a></p>

<h2 id="incluir-otro-archivo">Incluir Otro Archivo</h2>

<pre><code class="language-php">$app-&gt;get(
    '/orders/display/{name}',
    function ($name) {
        require 'views/results.php';
    }
);
</code></pre>

<p><a name="responses-direct-output-json"></a></p>

<h2 id="salida-directa-json">Salida Directa JSON</h2>

<pre><code class="language-php">$app-&gt;get(
    '/orders/display/{name}',
    function ($name) {
        echo json_encode(
            [
                'code' =&gt; 200,
                'name' =&gt; $name,
            ]
        );
    }
);
</code></pre>

<p><a name="responses-new-response-object"></a></p>

<h2 id="nuevo-objeto-response">Nuevo Objeto Response</h2>

<p>You can use the <code>setContent</code> method of the response object to return the response back:</p>

<pre><code class="language-php">$app-&gt;get(
    '/show/data',
    function () {
        // Crear una respuesta
        $response = new Phalcon\Http\Response();

        // Establecer la cabecera Content-Type
        $response-&gt;setContentType('text/plain');

        // Pasar el contenido del archivo
        $response-&gt;setContent(file_get_contents('data.txt'));

        // Devolver la respuesta
        return $response;
    }
);
</code></pre>

<p><a name="responses-application-response"></a></p>

<h2 id="respuesta-de-la-aplicación">Respuesta de la Aplicación</h2>

<p>You can also use the <a href="api/Phalcon_Http_Response">Phalcon\Http\Response</a> object to return responses to the caller. The response object has a lot of useful methods that make returning respones much easier.</p>

<pre><code class="language-php">$app-&gt;get(
    '/show/data',
    function () use ($app) {
        // Establecer la cabecera Content-Type
        $app-&gt;response-&gt;setContentType('text/plain');
        $app-&gt;response-&gt;sendHeaders();

        // Imprimir un archivo
        readfile('data.txt');
    }
);
</code></pre>

<p><a name="responses-return-application-response"></a></p>

<h2 id="devolver-respuestas-de-la-aplicación">Devolver Respuestas de la Aplicación</h2>

<p>A different approach returning data back to the caller is to return the response object directly from the application. Cuando las respuestas son devueltas por los manejadores, éstas se envían automáticamente por la aplicación.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro;
use Phalcon\Http\Response;

$app = new Micro();

// Devuelve una respuesta
$app-&gt;get(
    '/welcome/index',
    function () {
        $response = new Response();

        $response-&gt;setStatusCode(401, 'Unauthorized');
        $response-&gt;setContent('Access is not authorized');

        return $response;
    }
);
</code></pre>

<p><a name="responses-json"></a></p>

<h2 id="json">JSON</h2>

<p>JSON can be sent back just as easy using the <a href="api/Phalcon_Http_Response">Phalcon\Http\Response</a> object:</p>

<pre><code class="language-php">$app-&gt;get(
    '/welcome/index',
    function () use ($app) {

        $data = [
            'code'    =&gt; 401,
            'status'  =&gt; 'error',
            'message' =&gt; 'Unauthorized access',
            'payload' =&gt; [],
        ];

        $response-&gt;setJsonContent($data);

        return $response;
    }
);
</code></pre>

<p><a name="events"></a></p>

<h1 id="eventos">Eventos</h1>

<p>A <a href="api/Phalcon_Mvc_Micro">Phalcon\Mvc\Micro</a> application works closely with a <a href="api/Phalcon_Events_Manager">Phalcon\Events\Manager</a> if it is present, to trigger events that can be used throughout our application. El tipo de estos eventos es <code>micro</code>. These events trigger in our application and can be attached to relevant handlers that will perform actions needed by our application.</p>

<p><a name="events-available-events"></a></p>

<h2 id="eventos-disponibles">Eventos Disponibles</h2>

<p>Son soportados los siguientes eventos:</p>

<table>
  <thead>
    <tr>
      <th>Nombre de Evento</th>
      <th>Activador</th>
      <th style="text-align: center">¿Puede detener la operación?</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>beforeHandleRoute</td>
      <td>Método principal llamado; Las rutas no han sido verificadas aún</td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>beforeExecuteRoute</td>
      <td>Coincidencia en la Ruta, Manejador válido, el Manejador aún no ha sido ejecutado</td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>afterExecuteRoute</td>
      <td>Manejador acaba de terminar de correr</td>
      <td style="text-align: center">No</td>
    </tr>
    <tr>
      <td>beforeNotFound</td>
      <td>Ruta no ha sido encontrada</td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>afterHandleRoute</td>
      <td>Ruta acaba de terminar su ejecución</td>
      <td style="text-align: center">Sí</td>
    </tr>
    <tr>
      <td>afterBinding</td>
      <td>Activa después de que los modelos están enlazados pero antes de ejecutar el Manejador</td>
      <td style="text-align: center">Sí</td>
    </tr>
  </tbody>
</table>

<p><a name="events-available-events-authentication"></a></p>

<h3 id="ejemplo-de-autenticación">Ejemplo de Autenticación</h3>

<p>Puede comprobar fácilmente si un usuario se ha autenticado o no mediante el evento <code>beforeExecuteRoute</code>. En el ejemplo siguiente, explicamos cómo controlar la seguridad de las aplicaciones usando eventos:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro;
use Phalcon\Events\Event;
use Phalcon\Events\Manager as EventsManager;

// Crear un gestor de eventos
$eventsManager = new EventsManager();

$eventsManager-&gt;attach(
    'micro:beforeExecuteRoute',
    function (Event $event, $app) {
        if ($app-&gt;session-&gt;get('auth') === false) {
            $app-&gt;flashSession-&gt;error("The user isn't authenticated");

            $app-&gt;response-&gt;redirect('/');
            $app-&gt;response-&gt;sendHeaders();

            // Devolver (false) y detener la operación
            return false;
        }
    }
);

$app = new Micro();

// Enlazar el gestor de eventos a la aplicación
$app-&gt;setEventsManager($eventsManager);
</code></pre>

<p><a name="events-available-events-not-found"></a></p>

<h3 id="ejemplo-de-not-found">Ejemplo de Not Found</h3>

<p>Puede comprobar fácilmente si un usuario se ha autenticado o no mediante el evento <code>beforeExecuteRoute</code>. En el ejemplo siguiente, explicamos cómo controlar la seguridad de las aplicaciones usando eventos:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro;
use Phalcon\Events\Event;
use Phalcon\Events\Manager as EventsManager;

// Crear un gestor de eventos
$eventsManager = new EventsManager();

$eventsManager-&gt;attach(
    'micro:beforeNotFound',
    function (Event $event, $app) {
        $app-&gt;response-&gt;redirect('/404');
        $app-&gt;response-&gt;sendHeaders();

        return $app-&gt;response;
    }
);

$app = new Micro();

// Enlazar el gestor de eventos a la aplicación
$app-&gt;setEventsManager($eventsManager);
</code></pre>

<p><a name="middleware"></a></p>

<h1 id="middleware">Middleware</h1>

<p>Middleware son clases que pueden adjuntarse a su solicitud y presentar otra capa donde la lógica de negocio puede existir. Se ejecutan secuencialmente, según el orden que están registrados y no sólo mejoran el mantenimiento, mediante el encapsulamiento de funcionalidades específicas, sino también el rendimiento. A middleware class can stop execution when a particular business rule has not been satisfied, thus allowing the application to exit early without executing the full cycle of a request.</p>

<p>The presence of a <a href="api/Phalcon_Events_Manager">Phalcon\Events\Manager</a> is essential for middleware to operate, so it has to be registered in our Di container.</p>

<p><a name="middleware-attached-events"></a></p>

<h2 id="eventos-adjuntos">Eventos adjuntos</h2>

<p>Middleware can be attached to a micro application in 3 different events. Those are:</p>

<table>
  <thead>
    <tr>
      <th>Evento</th>
      <th>Descripción</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>before</td>
      <td>Antes de que el manejador haya sido ejecutado</td>
    </tr>
    <tr>
      <td>after</td>
      <td>Después de que el manejador haya sido ejecutado</td>
    </tr>
    <tr>
      <td>final</td>
      <td>Después de que la respuesta ha sido enviada al componente que hizo la llamada</td>
    </tr>
  </tbody>
</table>

<h5 class="alert alert-warning">You can attach as many middleware classes as you want in each of the above events. They will be executed sequentially when the relevant event fires.</h5>

<p><a name="middleware-attached-events-before"></a></p>

<h3 id="before">before</h3>

<p>Este evento es perfecto para detener la ejecución de la aplicación si no se cumplen ciertos criterios. En el siguiente ejemplo comprobaremos si el usuario ha sido autenticado y detenemos la ejecución con la redirección es necesaria.</p>

<pre><code class="language-php">&lt;?php

$app = new Phalcon\Mvc\Micro();

// Ejecutado antes que cada route se ejecute
// Retornar false cancela la ejecución del route
$app-&gt;before(
    function () use ($app) {
        if (false === $app['session']-&gt;get('auth')) {
            $app['flashSession']-&gt;error("The user isn't authenticated");

            $app['response']-&gt;redirect('/error');

            // Retornamos false para detener la ejecución 
            return false;
        }

        return true;
    }
);
</code></pre>

<p><a name="middleware-attached-events-after"></a></p>

<h3 id="after">after</h3>

<p>This event can be used to manipulate data or perform actions that are needed after the handler has finished executing. In the example below, we manipulate our response to send JSON back to the caller.</p>

<pre><code class="language-php">$app-&gt;map(
    '/api/robots',
    function () {
        return [
            'status' =&gt; 'OK',
        ];
    }
);

$app-&gt;after(
    function () use ($app) {
        // Esto es ejecutado después de ejecutarse el route
        echo json_encode($app-&gt;getReturnedValue());
    }
);
</code></pre>

<p><a name="middleware-attached-events-finish"></a></p>

<h3 id="finish">finish</h3>

<p>This even will fire up when the whole request cycle has been completed. In the example below, we use it to clean up some cache files.</p>

<pre><code class="language-php">$app-&gt;finish(
    function () use ($app) {
        if (true === file_exists('/tmp/processing.cache')) {
            unlink('/tmp/processing.cache');
        }
    }
);
</code></pre>

<p><a name="middleware-setup"></a></p>

<h2 id="configuración-1">Configuración</h2>

<p>Agregar un middleware para tu aplicación es muy fácil como se muestra arriba, con las llamadas al método <code>before</code>, <code>after</code> y <code>finish</code>.</p>

<pre><code class="language-php">$app-&gt;before(
    function () use ($app) {
        if (false === $app['session']-&gt;get('auth')) {
            $app['flashSession']-&gt;error("The user isn't authenticated");

            $app['response']-&gt;redirect('/error');

            // Devolver false detiene la ejecución normal
            return false;
        }

        return true;
    }
);

$app-&gt;after(
    function () use ($app) {
        // Esto se ejecuta después de que la ruta es ejecutada
        echo json_encode($app-&gt;getReturnedValue());
    }
);
</code></pre>

<p>Attaching middleware to your application as classes and having it listen to events from the events manager can be achieved as follows:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Events\Manager;
use Phalcon\Mvc\Micro;

use Website\Middleware\CacheMiddleware;
use Website\Middleware\NotFoundMiddleware;
use Website\Middleware\ResponseMiddleware;

/**
 * Crear un nuevo Gestor de Eventos.
 */
$eventsManager = new Manager();
$application   = new Micro();

/**
 * Agregar el middleware tanto para el gestor de eventos como para la aplicación
 */
$eventsManager-&gt;attach('micro', new CacheMiddleware());
$application-&gt;before(new CacheMiddleware());

$eventsManager-&gt;attach('micro', new NotFoundMiddleware());
$application-&gt;before(new NotFoundMiddleware());

/**
 * Este se necesita para escuchar al eventos `after`
 */
$eventsManager-&gt;attach('micro', new ResponseMiddleware());
$application-&gt;after(new ResponseMiddleware());

/**
 * Asegurate que el gestor de eventos esté ahora en el contenedor DI
 */
$application-&gt;setEventsManager($eventsManager);

</code></pre>

<p>We need a <a href="api/Phalcon_Events_Manager">Phalcon\Events\Manager</a> object. Esto puede ser una nueva instancia del objeto o podemos conseguir uno que exista en nuestro contenedor de DI (si has usado el de <code>FactoryDefault</code>).</p>

<p>We attach every middleware class in the <code>micro</code> hook in the Events Manager. We could also be a bit more specific and attach it to say the <code>micro:beforeExecuteRoute</code> event.</p>

<p>Entonces conectamos la clase de middleware en nuestra aplicación en uno de los tres eventos comentados anteriormente (<code>before</code>, <code>after</code>, <code>finish</code>).</p>

<p><a name="middleware-implementation"></a></p>

<h2 id="implementación">Implementación</h2>

<p>Un Middleware puede ser cualquier tipo de función PHP accesible. You can organize your code whichever way you like it to implement middleware. If you choose to use classes for your middleware, you will need them to implement the <a href="api/Phalcon_Mvc_Micro_MiddlewareInterface">Phalcon\Mvc\Micro\MiddlewareInterface</a></p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro;
use Phalcon\Mvc\Micro\MiddlewareInterface;

/**
 * CacheMiddleware
 *
 * Caches de página para reducir el procesamiento
 */
class CacheMiddleware implements MiddlewareInterface
{
    /**
     * Llama al middleware
     *
     * @param Micro $application
     *
     * @returns bool
     */
    public function call(Micro $application)
    {
        $cache  = $application['cache'];
        $router = $application['router'];

        $key = preg_replace('/^[a-zA-Z0-9]/', '', $router-&gt;getRewriteUri());

        // Verificar si la solicitud se encuentra en cache
        if ($cache-&gt;exists($key)) {
            echo $cache-&gt;get($key);

            return false;
        }

        return true;
    }
}
</code></pre>

<p><a name="middleware-events"></a></p>

<h2 id="eventos-en-middleware">Eventos en Middleware</h2>

<p>The <a href="#events">events</a> that are triggered for our application also trigger inside a class that implements the <a href="api/Phalcon_Mvc_Micro_MiddlewareInterface">Phalcon\Mvc\Micro\MiddlewareInterface</a>. Esto ofrece una gran flexibilidad y potencial para los desarrolladores, ya que podemos interactuar con el proceso de solicitud.</p>

<p><a name="middleware-events-api"></a></p>

<h3 id="ejemplo-de-api">Ejemplo de API</h3>

<p>Supongamos que tenemos una API que hayamos implementado con una Micro aplicación. Tendríamos que colocar diferentes clases de Middleware en la aplicación y así podríamos controlar la ejecución de la aplicación.</p>

<p>Los middleware que utilizamos son:</p>

<ul>
  <li>Firewall</li>
  <li>NotFound</li>
  <li>Redirect</li>
  <li>CORS</li>
  <li>Request</li>
  <li>Response</li>
</ul>

<p><a name="middleware-events-api-firewall"></a></p>

<h4 id="firewall-middleware">Firewall Middleware</h4>

<p>Este middleware se conecta al evento <code>before</code> de nuestra Micro aplicación. El propósito de este middleware es verificar quién está llamando nuestra API y basado en una lista blanca, permitir que se proceda o no</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Events\Event;
use Phalcon\Mvc\Micro;
use Phalcon\Mvc\Micro\MiddlewareInterface;

/**
 * FirewallMiddleware
 *
 * Comprueba la lista blanca y permite el acceso a los clientes o no
 */
class FirewallMiddleware implements MiddlewareInterface
{
    /**
     * Antes que se ejecute cualquier cosa
     *
     * @param Event $event
     * @param Micro $application
     *
     * @returns bool
     */
    public function beforeHandleRoute(Event $event, Micro $application)
    {
        $whitelist = [
            '10.4.6.1',
            '10.4.6.2',
            '10.4.6.3',
            '10.4.6.4',
        ];
        $ipAddress = $application-&gt;request-&gt;getClientAddress();

        if (true !== array_key_exists($ipAddress, $whitelist)) {
            $this-&gt;response-&gt;redirect('/401');
            $this-&gt;response-&gt;send();

            return false;
        }

        return true;
    }

    /**
     * Llamar al middleware
     *
     * @param Micro $application
     *
     * @returns bool
     */
    public function call(Micro $application)
    {
        return true;
    }
}
</code></pre>

<p><a name="middleware-events-api-not-found"></a></p>

<h4 id="not-found-middleware">Not Found Middleware</h4>

<p>Cuando se procesa este middleware, significa que la IP solicitante está autorizada a acceder a nuestra aplicación. La aplicación probará y buscará una coincidencia con la ruta y si no encuentra alguna, el evento <code>beforeNotFound</code> se activará. Cuando esto ocurra se detendrá el proceso y se devolverá al usuario la respuesta 404 pertinente. Este middleware está conectado al evento <code>before</code> de la Micro aplicación</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro;
use Phalcon\Mvc\Micro\MiddlewareInterface;

/**
 * NotFoundMiddleware
 *
 * Procesa los 404s
 */
class NotFoundMiddleware implements MiddlewareInterface
{
    /**
     * La ruta no ha sido encontrada
     *
     * @returns bool
     */
    public function beforeNotFound()
    {
        $this-&gt;response-&gt;redirect('/404');
        $this-&gt;response-&gt;send();

        return false;
    }

    /**
     * Llama al middleware
     *
     * @param Micro $application
     *
     * @returns bool
     */
    public function call(Micro $application)
    {
        return true;
    }
}
</code></pre>

<p><a name="middleware-events-api-redirect"></a></p>

<h4 id="redirect-middleware">Redirect Middleware</h4>

<p>Conectamos este middleware otra vez al evento <code>before</code> de nuestra Micro aplicación porque no queremos que se procese la solicitud si del destino requerido necesita ser redirigido.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Events\Event;
use Phalcon\Mvc\Micro;
use Phalcon\Mvc\Micro\MiddlewareInterface;

/**
 * RedirectMiddleware
 *
 * Verificar la solicitud y redireccionar al usuario a algún lugar si se necesario
 */
class RedirectMiddleware implements MiddlewareInterface
{
    /**
     * Antes que nada ocurra
     *
     * @param Event $event
     * @param Micro $application
     *
     * @returns bool
     */
    public function beforeHandleRoute(Event $event, Micro $application)
    {
        if ('github' === $application-&gt;request-&gt;getURI()) {
            $application-&gt;response-&gt;redirect('https://github.com');
            $application-&gt;response-&gt;send();

            return false;
        }

        return true;
    }

    /**
     * Llama al middleware
     *
     * @param Micro $application
     *
     * @returns bool
     */
    public function call(Micro $application)
    {
        return true;
    }
}
</code></pre>

<p><a name="middleware-events-api-cors"></a></p>

<h4 id="cors-middleware">CORS Middleware</h4>

<p>Again this middleware is attached to the <code>before</code> event of our Micro application. We need to ensure that it fires before anything happens with our application</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Events\Event;
use Phalcon\Mvc\Micro;
use Phalcon\Mvc\Micro\MiddlewareInterface;

/**
 * CORSMiddleware
 *
 * Verificación CORS
 */
class CORSMiddleware implements MiddlewareInterface
{
    /**
     * Antes de que algo suceda
     *
     * @param Event $event
     * @param Micro $application
     *
     * @returns bool
     */
    public function beforeHandleRoute(Event $event, Micro $application)
    {
        if ($application-&gt;request-&gt;getHeader('ORIGIN')) {
            $origin = $application-&gt;request-&gt;getHeader('ORIGIN');
        } else {
            $origin = '*';
        }

        $application
            -&gt;response
            -&gt;setHeader('Access-Control-Allow-Origin', $origin)
            -&gt;setHeader(
                'Access-Control-Allow-Methods',
                'GET,PUT,POST,DELETE,OPTIONS'
            )
            -&gt;setHeader(
                'Access-Control-Allow-Headers',
                'Origin, X-Requested-With, Content-Range, ' .
                'Content-Disposition, Content-Type, Authorization'
            )
            -&gt;setHeader('Access-Control-Allow-Credentials', 'true');
    }

    /**
     * Calls the middleware
     *
     * @param Micro $application
     *
     * @returns bool
     */
    public function call(Micro $application)
    {
        return true;
    }
}
</code></pre>

<p><a name="middleware-events-api-request"></a></p>

<h4 id="request-middleware">Request Middleware</h4>

<p>This middleware is receiving a JSON payload and checks it. If the JSON payload is not valid it will stop execution.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Events\Event;
use Phalcon\Mvc\Micro;
use Phalcon\Mvc\Micro\MiddlewareInterface;

/**
 * RequestMiddleware
 *
 * Verifica la carga que se está recibiendo
 */
class RequestMiddleware implements MiddlewareInterface
{
    /**
     * Antes de que la ruta sea ejecutada
     *
     * @param Event $event
     * @param Micro $application
     *
     * @returns bool
     */
    public function beforeExecuteRoute(Event $event, Micro $application)
    {
        json_decode($application-&gt;request-&gt;getRawBody());
        if (JSON_ERROR_NONE !== json_last_error()) {
            $application-&gt;response-&gt;redirect('/malformed');
            $application-&gt;response-&gt;send();

            return false;
        }

        return true;

    }

    /**
     * Realiza la llamada al Middleware
     *
     * @param Micro $application
     *
     * @returns bool
     */
    public function call(Micro $application)
    {
        return true;
    }
}
</code></pre>

<p><a name="middleware-events-api-response"></a></p>

<h4 id="response-middleware">Response Middleware</h4>

<p>Este middleware es responsable de manipular nuestra respuesta y enviarla de vuelta a la entidad que lo llamó como una cadena JSON. Por lo tanto tenemos que conectar al evento <code>after</code> de nuestra Micro aplicación.</p>

<h5 class="alert alert-warning">Usaremos el método <code>call</code> de este middleware, ya que casi hemos ejecutado el ciclo completo de la petición.</h5>

<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro;
use Phalcon\Mvc\Micro\MiddlewareInterface;

/**
* ResponseMiddleware
*
* Se manipula la respuesta
*/
class ResponseMiddleware implements MiddlewareInterface
{
     /**
      * Antes que cualquier cosa ocurra
      *
      * @param Micro $application
      *
      * @returns bool
      */
    public function call(Micro $application)
    {
        $payload = [
            'code'    =&gt; 200,
            'status'  =&gt; 'success',
            'message' =&gt; '',
            'payload' =&gt; $application-&gt;getReturnedValue(),
        ];

        $application-&gt;response-&gt;setJsonContent($payload);
        $application-&gt;response-&gt;send();

        return true;
    }
}
</code></pre>

<p><a name="models"></a></p>

<h1 id="modelos">Modelos</h1>

<p>Los Modelos pueden utilizarse en Micro aplicaciones, siempre y cuando podamos indicar a la aplicación como puede encontrar las clases relevantes con un cargador automático.</p>

<h5 class="alert alert-warning">El servicio <code>db</code> debe estar registrado en el contenedor de Di.</h5>

<pre><code class="language-php">&lt;?php

$loader = new \Phalcon\Loader();
$loader
    -&gt;registerDirs(
        [
            __DIR__ . '/models/',
        ]
    )
    -&gt;register();

$app = new \Phalcon\Mvc\Micro();

$app-&gt;get(
    '/products/find',
    function () {
        $products = \MyModels\Products::find();

        foreach ($products as $product) {
            echo $product-&gt;name, '&lt;br&gt;';
        }
    }
);

$app-&gt;handle();
</code></pre>

<p><a name="model-instances"></a></p>

<h1 id="inyectando-instancias-de-modelos">Inyectando instancias de modelos</h1>

<p>By using the <a href="api/Phalcon_Mvc_Model_Binder">Phalcon\Mvc\Model\Binder</a> class you can inject model instances into your routes:</p>

<pre><code class="language-php">&lt;?php

$loader = new \Phalcon\Loader();

$loader-&gt;registerDirs(
    [
        __DIR__ . '/models/',
    ]
)-&gt;register();

$app = new \Phalcon\Mvc\Micro();
$app-&gt;setModelBinder(new \Phalcon\Mvc\Model\Binder());

$app-&gt;get(
    "/products/{product:[0-9]+}",
    function (Products $product) {
        // haz lo que necesites con el objeto $product
    }
);

$app-&gt;handle();
</code></pre>

<p>Since Binder object is using internally Reflection Api which can be heavy, there is ability to set a cache so as to speed up the process. Esto puede hacerse mediante el segundo argumento de <code>setModelBinder()</code> que también puede aceptar un nombre de servicio o simplemente pasando una instancia de caché al constructor <code>Binder</code>.</p>

<p>Currently the binder will only use the models primary key to perform a <code>findFirst()</code> on. An example route for the above would be <code>/products/1</code>.</p>

<p><a name="views"></a></p>

<h1 id="vistas">Vistas</h1>

<p><a href="api/Phalcon_Mvc_Micro">Phalcon\Mvc\Micro</a> does not have inherently a view service. We can however use the <a href="api/Phalcon_Mvc_View_Simple">Phalcon\Mvc\View\Simple</a> component to render views.</p>

<pre><code class="language-php">&lt;?php

$app = new Phalcon\Mvc\Micro();

$app['view'] = function () {
    $view = new \Phalcon\Mvc\View\Simple();

    $view-&gt;setViewsDir('app/views/');

    return $view;
};

// Devolver una vista
$app-&gt;get(
    '/products/show',
    function () use ($app) {
        // Construir app/views/products/show.phtml pasando algunas variables
        echo $app['view']-&gt;render(
            'products/show',
            [
                'id'   =&gt; 100,
                'name' =&gt; 'Artichoke',
            ]
        );
    }
);
</code></pre>

<h5 class="alert alert-warning">The above example uses the <a href="api/Phalcon_Mvc_View_Simple">Phalcon\Mvc\View\Simple</a> component, which uses relative paths instead of controllers and actions. You can use the <a href="api/Phalcon_Mvc_View">Phalcon\Mvc\View</a> component instead, but to do so you will need to change the parameters passed to <code>render()</code></h5>

<pre><code class="language-php">&lt;?php

$app = new Phalcon\Mvc\Micro();

$app['view'] = function () {
    $view = new \Phalcon\Mvc\View();

    $view-&gt;setViewsDir('app/views/');

    return $view;
};

// Devuelve una vista
$app-&gt;get(
    '/products/show',
    function () use ($app) {
        // Construye app/views/products/show.phtml pasando algunas variables
        echo $app['view']-&gt;render(
            'products',
            'show',
            [
                'id'   =&gt; 100,
                'name' =&gt; 'Artichoke',
            ]
        );
    }
);
</code></pre>

<p><a name="error-handling"></a></p>

<h1 id="manejo-de-errores">Manejo de Errores</h1>

<p>The <a href="api/Phalcon_Mvc_Micro">Phalcon\Mvc\Micro</a> application also has an <code>error</code> method, which can be used to trap any errors that originate from exceptions. El siguiente fragmento de código muestra el uso básico de esta función:</p>

<pre><code class="language-php">&lt;?php

$app = new Phalcon\Mvc\Micro();

$app-&gt;get(
    '/',
    function () {
        throw new \Exception('Some error happened', 401);
    }
);

$app-&gt;error(
    function ($exception) {
        echo json_encode(
            [
                'code'    =&gt; $exception-&gt;getCode(),
                'status'  =&gt; 'error',
                'message' =&gt; $exception-&gt;getMessage(),
            ]
        );
    }
);
</code></pre>

                                    </div>
                                    <div class="col-md-4 col-lg-3 col-sm-12 support-column-margin">
                                        <div class="topic-search">
    <form class="bd-search d-flex align-items-center">
        <input type="search"
               class="form-control"
               id="docs-search"
               placeholder=""
               aria-label=""
               autocomplete="off"
               data-siteurl="https://phalcon-docs4.netlify.com"
               data-docs-version="3.4">
        <button class="btn btn-link bd-search-docs-toggle d-md-none p-0 ml-3"
                type="button"
                data-toggle="collapse"
                data-target="#bd-docs-nav"
                aria-controls="bd-docs-nav"
                aria-expanded="false"
                aria-label="Toggle docs navigation">
            <svg xmlns="http://www.w3.org/2000/svg"
                 viewbox="0 0 30 30"
                 width="30"
                 height="30"
                 focusable="false">
                <title>Menu</title>
                <path stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-miterlimit="10"
                      d="M4 7h22M4 15h22M4 23h22"></path>
            </svg>
        </button>
    </form>
</div>
                                        <div class="topic-categories">
    
</div>

                                        <div class="article-menu">
    <ul>
        
        
    </ul>
</div>
                                    </div>
                                </div>
                            </div>
                        </section>

                    </div>
                </div>
            </div>
        </div>
    </div>

<footer>
    <div class="container">
        <div class="footer-wrapper clearfix">

            <div class="footer-link-container">
                <a class="footer-link" href="/">
                    <img class="footer-logo-img" src="/assets/images/footer_logo.svg" alt="logo">
                </a>
                <a class="footer-link" href="https://phalcon.link/about" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://phalcon.link/sponsors" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://phalcon.link/fund" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://phalcon.link/download" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://license.phalconphp.com/" target="_blank">
                     New BSD
                </a>
            </div>

            <div class="footer-copyright">
                <a href="https://odva.pro/" target="_blank" class="o2-link">
                    <span></span> <img src="/assets/images/logo-o2.svg" alt="logo o2">
                </a>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript" src="/assets/js/main.min.js?v1547266080100021829"></script>
<script type="text/javascript" src="/assets/js/highlight/highlight.pack.js?v1547266080100021829"></script>
<script type="application/javascript">hljs.initHighlightingOnLoad();</script>
<script type="application/javascript">hljs.initHighlightingOnLoad();</script>
</body>
</html>
