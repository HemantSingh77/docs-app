<!doctype html>
<!--[if IE 8]>
<html lang="zh-cn" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="zh-cn" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="zh-cn" class="no-js">
<!--<![endif]-->








    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <script type="text/javascript" src="/assets/js/viewport-min-width.js?v1547319779866581049"></script>
        <meta name="description"
              content="Official Phalcon Documentation">
        <meta name="keywords" content="php, phalcon, phalcon php, php framework, faster php framework, php extension, next generation framework, docs, documentation">
        <meta name="author" href="/humans.txt">
        <meta name="generator" content="Phalcon Team - Jekyll - Netlify">

        <link href="http://0.0.0.0:4000/3.4/zh-cn/di.html" rel="canonical">
        <title>Phalcon Framework Documentation</title>

        <!-- Twitter -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@zephirlang">
        <meta name="twitter:creator" content="@zephirlang">
        <meta name="twitter:title" content="Phalcon Framework Documentation">
        <meta name="twitter:description" content="Official Phalcon Documentation">
        <meta name="twitter:image" content="https://assets.phalconphp.com/phalcon/logo.png">

        <!-- Facebook -->
        <meta property="og:url" content="http://0.0.0.0:4000">
        <meta property="og:title" content="Phalcon Framework Documentation">
        <meta property="og:description" content="Official Phalcon Documentation">
        <meta property="og:type" content="website">
        <meta property="og:image" content="https://assets.phalconphp.com/phalcon/logo.png">

        <meta name="msapplication-TileColor" content="#FFFFFF">
        <meta name="msapplication-square70x70logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-70x70.png">
        <meta name="msapplication-TileImage"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-144x144.png">
        <meta name="msapplication-square150x150logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-150x150.png">
        <meta name="msapplication-wide310x150logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-310x150.png">
        <meta name="msapplication-square310x310logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-310x310.png">

        <link rel="apple-touch-icon"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon.png">

        <link rel="apple-touch-icon-precomposed"
              sizes="57x57"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-57x57.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="60x60"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-60x60.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="72x72"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="76x76"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-76x76.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="114x114"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-114x114.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="120x120"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-120x120.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="144x144"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-144x144.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="152x152"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-152x152.png">

        <link rel="icon"
              type="image/png"
              sizes="16x16"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-16x16.png">
        <link rel="icon"
              type="image/png"
              sizes="32x32"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-32x32.png">
        <link rel="icon"
              type="image/png"
              sizes="96x96"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-96x96.png">
        <link rel="icon"
              type="image/png"
              sizes="128x128"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-128x128.png">
        <link rel="icon"
              type="image/png"
              sizes="196x196"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-196x196.png">
        <link rel="shortcut icon"
              type="image/png"
              href="https://assets.phalconphp.com/phalcon/favicon.ico"/>

        <link rel="alternate"
              type="application/rss+xml"
              title=" - "
              href="http://0.0.0.0:4000/feed.xml">

        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css"
              integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE="
              crossorigin="anonymous" />
        <link rel="stylesheet" href="/assets/css/monokai.css?v1547319779866581049" />
        <link rel="stylesheet" href="/assets/css/style.css?v1547319779866581049" />

        <script defer src="https://use.fontawesome.com/releases/v5.6.1/js/all.js"
                integrity="sha384-R5JkiUweZpJjELPWqttAYmYM1P3SNEJRM6ecTQF05pFFtxmCO+Y1CiUhvuDzgSVZ"
                crossorigin="anonymous"></script>
        
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90300500-6"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-90300500-6');
    </script>

    </head>


<body onclick="o2.allNavSlideUp()">
    <header class="header-image-doc">
        <div class="container">
            <div class="header-wrapper">
                <div class="clearfix">
                    <div class="row">
                        <div class="col-md-2 col-sm-3  col-xs-8">
                            <div class="header-image__logo-wrapper">
                                <a href="/3.4/zh-cn">
                                    <img class="logo-img" src="/assets/images/header_logo.svg" alt="logo">
                                </a>
                            </div>
                        </div>
                        <div class="col-md-10 col-sm-9 top-menu">

                            <div class="nav-icon" onclick="o2.showMobileMenu();">
                                <div class="nav-line"></div>
                                <div class="nav-line"></div>
                                <div class="nav-line"></div>
                            </div>
                            <nav class="header-nav">
                                <ul>
                                    <li class="nav-item" onclick="o2.toggleState(this, event);">
                                        <div class="nav-item_selected">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                                 alt="">
                                            <span class="caret"></span>
                                        </div>
                                        <div class="nav-item__list" onclick="event.stopPropagation();">
                                            
                                                <a href="/3.4/en/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                         alt="English (US)">
                                                    English (US)
                                                </a>
                                            
                                                <a href="/3.4/cs-cz/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/cs.png"
                                                         alt="Czech">
                                                    Czech
                                                </a>
                                            
                                                <a href="/3.4/de-de/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/de.png"
                                                         alt="German">
                                                    German
                                                </a>
                                            
                                                <a href="/3.4/es-es/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                         alt="Spanish">
                                                    Spanish
                                                </a>
                                            
                                                <a href="/3.4/fa-ir/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fa.png"
                                                         alt="Persian">
                                                    Persian
                                                </a>
                                            
                                                <a href="/3.4/fr-fr/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fr.png"
                                                         alt="French">
                                                    French
                                                </a>
                                            
                                                <a href="/3.4/id-id/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/id.png"
                                                         alt="Indonesian">
                                                    Indonesian
                                                </a>
                                            
                                                <a href="/3.4/it-it/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/it.png"
                                                         alt="Italian">
                                                    Italian
                                                </a>
                                            
                                                <a href="/3.4/ja-jp/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ja.png"
                                                         alt="Japanese">
                                                    Japanese
                                                </a>
                                            
                                                <a href="/3.4/pl-pl/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/pl.png"
                                                         alt="Polish">
                                                    Polish
                                                </a>
                                            
                                                <a href="/3.4/ru-ru/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ru.png"
                                                         alt="Russian">
                                                    Russian
                                                </a>
                                            
                                                <a href="/3.4/tr-tr/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/tr.png"
                                                         alt="Turkish">
                                                    Turkish
                                                </a>
                                            
                                                <a href="/3.4/uk-ua/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/uk.png"
                                                         alt="Ukrainian">
                                                    Ukrainian
                                                </a>
                                            
                                                <a href="/3.4/zh-cn/di" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                                         alt="Chinese Simplified">
                                                    Chinese Simplified
                                                </a>
                                            
                                        </div>
                                    </li>

                                        <li class="nav-item" onclick="o2.toggleState(this, event);">
                                            <div class="nav-item__selected custom-select__version">
                                                Version 3.4
                                                <span class="caret"></span>
                                            </div>
                                            <div class="nav-item__list" onclick="event.stopPropagation();">
                                                
                                                <a href="/3.4/zh-cn/di" class="custom-select__list-item">
                                                    <span>3.4</span>
                                                </a>
                                                
                                                <a href="/3.3/zh-cn/di" class="custom-select__list-item">
                                                    <span>3.3</span>
                                                </a>
                                                
                                                <a href="/3.2/zh-cn/di" class="custom-select__list-item">
                                                    <span>3.2</span>
                                                </a>
                                                
                                                <a href="/3.1/zh-cn/di" class="custom-select__list-item">
                                                    <span>3.1</span>
                                                </a>
                                                
                                                <a href="/4.0/zh-cn/di" class="custom-select__list-item">
                                                    <span>4.0</span>
                                                </a>
                                                
                                            </div>
                                        </li>

                                    <li class="nav-item" onclick="o2.toggleState(this, event);">
                                        <div class="nav-item_selected">
                                            Community
                                            <span class="caret"></span>
                                        </div>
                                        <div class="nav-item__list">
                                            <a href="https://phalcon.link/forum" class="custom-select__list-item" target="_blank">
                                                Forum
                                            </a>
                                            <a href="https://phalcon.link/blog" class="custom-select__list-item" target="_blank">
                                                Blog
                                            </a>
                                            <a href="https://phalcon.link/resources" class="custom-select__list-item" target="_blank">
                                                Resources
                                            </a>
                                            <div class="nav-item__divider"></div>
                                            <a href="https://phalcon.link/f" class="custom-select__list-item" target="_blank">
                                                Facebook
                                            </a>
                                            <a href="https://phalcon.link/t" class="custom-select__list-item" target="_blank">
                                                Twitter
                                            </a>
                                            <a href="https://phalcon.link/gab" class="custom-select__list-item" target="_blank">
                                                Gab.ai
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/about">
                                            About
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/sponsors">
                                            Sponsors
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/fund">
                                            Support Us
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/download">
                                            Download
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>

                        <div class="header-nav-mobile">
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this, event)">
                                    <img class="lang-image"
                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                         alt="">
                                    <span class="caret"></span>
                                </div>

                                <ul style="display:none;" class="clearfix" onclick="event.stopPropagation();">
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/en/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                 alt="English (US)">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/cs-cz/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/cs.png"
                                                 alt="Czech">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/de-de/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/de.png"
                                                 alt="German">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/es-es/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                 alt="Spanish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/fa-ir/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fa.png"
                                                 alt="Persian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/fr-fr/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fr.png"
                                                 alt="French">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/id-id/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/id.png"
                                                 alt="Indonesian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/it-it/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/it.png"
                                                 alt="Italian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/ja-jp/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ja.png"
                                                 alt="Japanese">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/pl-pl/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/pl.png"
                                                 alt="Polish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/ru-ru/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ru.png"
                                                 alt="Russian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/tr-tr/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/tr.png"
                                                 alt="Turkish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/uk-ua/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/uk.png"
                                                 alt="Ukrainian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/zh-cn/di">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                                 alt="Chinese Simplified">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                </ul>

                            </div>
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this,event)">
                                    Version 3.4
                                    <span class="caret"></span>
                                </div>

                                <ul style="display:none;" class="clearfix" onclick="event.stopPropagation();">
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.4/zh-cn/di">
                                            <span>3.4</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.3/zh-cn/di">
                                            <span>3.3</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.2/zh-cn/di">
                                            <span>3.2</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.1/zh-cn/di">
                                            <span>3.1</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/4.0/zh-cn/di">
                                            <span>4.0</span>
                                        </a>
                                    </li>
                                    
                                </ul>

                            </div>
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this, event)">
                                    
                                    <span class="caret"></span>
                                </div>
                                <ul style="display:none;">
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/forum" target="_blank">
                                            Forum
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/blog" target="_blank">
                                            Blog
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/resources" target="_blank">
                                            Resources
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/f" target="_blank">
                                            Facebook
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/t" target="_blank">
                                            Twitter
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/gab" target="_blank">
                                            Gab.ai
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/about">
                                    About
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/sponsors">
                                    Sponsors
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/fund">
                                    Support Us
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/download">
                                    Download
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>


    <div class="container-fluid article-page-wrap">
        <div class="row">
            <div>
                <div class="col-md-2 sidebar hidden-xs">
                    <div class="sidebar--spacer">&nbsp;</div>
                </div>
                <div class="m-t-md m-b-lg" id="articles">
                    <div class="article-content">
                        <p><a name="di-service-location"></a></p>

<h1 id="依赖注入--服务定位">依赖注入 / 服务定位</h1>

<p><a name="di-explained"></a></p>

<h2 id="di-解释">DI 解释</h2>

<p>下面的示例是有点长，但它试图解释为什么Phalcon使用服务定位和依赖关系注入。 首先，让我们假设我们正在开发一个称为 <code>SomeComponent</code> 的组件。 这个组件执行某一任务。 我们的组件具有依赖项，就是与数据库的连接。</p>

<p>在这第一个示例中，连接是在组件内创建的。 Although this is a perfectly valid implementation, it is impartical, due to the fact that we cannot change the connection parameters or the type of the database system because the component only works as created.</p>

<pre><code class="language-php">&lt;?php

class SomeComponent
{
    /**
     * The instantiation of the connection is hardcoded inside
     * the component, therefore it's difficult replace it externally
     * or change its behavior
     */
    public function someDbTask()
    {
        $connection = new Connection(
            [
                'host'     =&gt; 'localhost',
                'username' =&gt; 'root',
                'password' =&gt; 'secret',
                'dbname'   =&gt; 'invo',
            ]
        );

        // ...
    }
}
    }
}

$some = new SomeComponent();

$some-&amp;gt;someDbTask();
</code></pre>

<p>To solve this shortcoming, we have created a setter that injects the dependency externally before using it. This is also a valid implementation but has its shortcomings:</p>

<pre><code class="language-php">&lt;?php

class SomeComponent
{
    private $connection;

    /**
     * Sets the connection externally
     *
     * @param Connection $connection
     */
    public function setConnection(Connection $connection)
    {
        $this-&gt;connection = $connection;
    }

    public function someDbTask()
    {
        $connection = $this-&gt;connection;

        // ...
    }
}

$some = new SomeComponent();

// Create the connection
$connection = new Connection(
    [
        'host'     =&gt; 'localhost',
        'username' =&gt; 'root',
        'password' =&gt; 'secret',
        'dbname'   =&gt; 'invo',
    ]
);

// Inject the connection in the component
$some-&gt;setConnection($connection);

$some-&gt;someDbTask();
</code></pre>

<p>现在考虑，我们使用此组件在应用程序的不同部分，然后我们将需要创建传递给该组件之前几次连接。 使用全局注册表模式，我们可以存储连接对象在那里和重用它，当我们需要它的时候。</p>

<pre><code class="language-php">&lt;?php

class Registry
{
    /**
     * Returns the connection
     */
    public static function getConnection()
    {
        return new Connection(
            [
                'host'     =&gt; 'localhost',
                'username' =&gt; 'root',
                'password' =&gt; 'secret',
                'dbname'   =&gt; 'invo',
            ]
        );
    }
}

class SomeComponent
{
    protected $connection;

    /**
     * Sets the connection externally
     *
     * @param Connection $connection
     */
    public function setConnection(Connection $connection)
    {
        $this-&gt;connection = $connection;
    }

    public function someDbTask()
    {
        $connection = $this-&gt;connection;

        // ...
    }
}

$some = new SomeComponent();

// Pass the connection defined in the registry
$some-&gt;setConnection(Registry::getConnection());

$some-&gt;someDbTask();
</code></pre>

<p>现在，让我们想象一下，我们必须实现两个方法在该组件上，第一次总是需要创建一个新的连接和第二个总是需要使用一个共享的连接：</p>

<pre><code class="language-php">&lt;?php

class Registry
{
    protected static $connection;

    /**
     * Creates a connection
     *
     * @return Connection
     */
    protected static function createConnection(): Connection
    {
        return new Connection(
            [
                'host'     =&gt; 'localhost',
                'username' =&gt; 'root',
                'password' =&gt; 'secret',
                'dbname'   =&gt; 'invo',
            ]
        );
    }

    /**
     * Creates a connection only once and returns it
     *
     * @return Connection
     */
    public static function getSharedConnection(): Connection
    {
        if (self::$connection === null) {
            self::$connection = self::createConnection();
        }

        return self::$connection;
    }

    /**
     * Always returns a new connection
     *
     * @return Connection
     */
    public static function getNewConnection(): Connection
    {
        return self::createConnection();
    }
}

class SomeComponent
{
    protected $connection;

    /**
     * Sets the connection externally
     *
     * @param Connection $connection
     */
    public function setConnection(Connection $connection)
    {
        $this-&gt;connection = $connection;
    }

    /**
     * This method always needs the shared connection
     */
    public function someDbTask()
    {
        $connection = $this-&gt;connection;

        // ...
    }

    /**
     * This method always needs a new connection
     *
     * @param Connection $connection
     */
    public function someOtherDbTask(Connection $connection)
    {

    }
}

$some = new SomeComponent();

// This injects the shared connection
$some-&gt;setConnection(
    Registry::getSharedConnection()
);

$some-&gt;someDbTask();

// Here, we always pass a new connection as parameter
$some-&gt;someOtherDbTask(
    Registry::getNewConnection()
);
</code></pre>

<p>到目前为止我们看到如何依赖注入解决我们的问题。 作为参数而不是在代码中创建内部传递依赖关系使我们的应用程序，更可维护性和去除耦合性。 然而，从长远来看，这种形式的依赖注入有一些缺点。</p>

<p>例如，如果该组件有许多依赖关系，我们将需要创建多个二传手参数传递依赖项或创建一个构造函数，通过他们与许多参数，此外之前使用的组件，每次创建依赖关系，使得我们的代码不容易维护，我们会像：</p>

<pre><code class="language-php">&lt;?php

// Create the dependencies or retrieve them from the registry
$connection = new Connection();
$session    = new Session();
$fileSystem = new FileSystem();
$filter     = new Filter();
$selector   = new Selector();

// Pass them as constructor parameters
$some = new SomeComponent($connection, $session, $fileSystem, $filter, $selector);

// ... Or using setters
$some-&gt;setConnection($connection);
$some-&gt;setSession($session);
$some-&gt;setFileSystem($fileSystem);
$some-&gt;setFilter($filter);
$some-&gt;setSelector($selector);
</code></pre>

<p>认为是否我们不得不在我们的应用程序的许多部分中创建此对象。 将来，如果我们不需要任何依赖项，我们需要去通过整个代码库的任何构造函数或 setter 中删除参数在那里我们注入的代码。 为了解决这个问题，我们再返回到全局注册表创建的组件。 然而，它会添加一个新创建的对象之前抽象层：</p>

<pre><code class="language-php">&lt;?php

class SomeComponent
{
    // ...

    /**
     * Define a factory method to create SomeComponent instances injecting its dependencies
     */
    public static function factory()
    {
        $connection = new Connection();
        $session    = new Session();
        $fileSystem = new FileSystem();
        $filter     = new Filter();
        $selector   = new Selector();

        return new self($connection, $session, $fileSystem, $filter, $selector);
    }
}
</code></pre>

<p>Now we find ourselves back where we started, we are again building the dependencies inside of the component! We must find a solution that keeps us from repeatedly falling into bad practices.</p>

<p>以实际和优雅的方式来解决这些问题使用容器的依赖关系。 容器作为我们前面看到的全局注册表。 使用容器的依赖关系作为桥梁获得依赖关系使我们能够减少我们的组件的复杂性：</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Di;
use Phalcon\DiInterface;

class SomeComponent
{
    protected $di;

    public function __construct(DiInterface $di)
    {
        $this-&gt;di = $di;
    }

    public function someDbTask()
    {
        // Get the connection service
        // Always returns a new connection
        $connection = $this-&gt;di-&gt;get('db');
    }

    public function someOtherDbTask()
    {
        // Get a shared connection service,
        // this will return the same connection every time
        $connection = $this-&gt;di-&gt;getShared('db');

        // This method also requires an input filtering service
        $filter = $this-&gt;di-&gt;get('filter');
    }
}

$di = new Di();

// Register a 'db' service in the container
$di-&gt;set(
    'db',
    function () {
        return new Connection(
            [
                'host'     =&gt; 'localhost',
                'username' =&gt; 'root',
                'password' =&gt; 'secret',
                'dbname'   =&gt; 'invo',
            ]
        );
    }
);

// Register a 'filter' service in the container
$di-&gt;set(
    'filter',
    function () {
        return new Filter();
    }
);

// Register a 'session' service in the container
$di-&gt;set(
    'session',
    function () {
        return new Session();
    }
);

// Pass the service container as unique parameter
$some = new SomeComponent($di);

$some-&gt;someDbTask();
</code></pre>

<p>组件现在可以简单地访问它需要时需要它，如果它不需要服务它不甚至初始化，节约资源的服务。 现在组件是高度解耦的。 例如，我们可以替换创建连接的方式，他们的行为或任何其他方面的他们，不会影响该组件。</p>

<p><a href="api/Phalcon_Di">Phalcon\Di</a> is a component implementing Dependency Injection and Location of services and it’s itself a container for them.</p>

<p>Since Phalcon is highly decoupled, <a href="api/Phalcon_Di">Phalcon\Di</a> is essential to integrate the different components of the framework. 开发人员还可以使用此组件把依赖项注入和管理的应用程序中使用的不同类的全局实例。</p>

<p>基本上，此组件实现的 <a href="http://en.wikipedia.org/wiki/Inversion_of_control">控制反转</a> 模式。 应用这个，对象不会收到使用 setter 或构造函数，但请求服务依赖注入器及其依赖项。 这降低了整体的复杂性，因为只有一种方式得到的组件中所需的依赖项。</p>

<p>另外，这种模式会增加可测试性的代码，从而使它不容易出错。</p>

<p><a name="registering-services"></a></p>

<h2 id="在容器中注册服务">在容器中注册服务</h2>

<p>框架本身或开发人员可以注册服务。 当 A 的组件要求组件 B （或其类的一个实例） 操作时，它可以从容器中，而不是创建新的实例组件 B. 请求组件 B</p>

<p>这种工作方式给了我们很多的优点：</p>

<ul>
  <li>我们可以轻松地用一个我们自己造的替换组件或第三方。</li>
  <li>我们可以完全控制的对象初始化，允许我们设置这些对象，根据需要将他们输送到组件之前。</li>
  <li>我们可以以结构的和统一的方式来管理全局组件实例。</li>
</ul>

<p>可以使用几种类型的定义注册服务：</p>

<p><a name="simple-registration"></a></p>

<h3 id="简单的注册">简单的注册</h3>

<p>As seen before, there are several ways to register services. These we call simple:</p>

<p><a name="simple-registration-string"></a></p>

<h4 id="字符串">字符串</h4>

<p>这种类型预计有效类名称，返回指定的类，如果它不加载的类的对象将使用自动加载程序实例化。 这种类型的定义不允许指定的类构造函数或参数的参数：</p>

<pre><code class="language-php">&lt;?php

// Return new Phalcon\Http\Request();
$di-&gt;set(
    'request',
    'Phalcon\Http\Request'
);
</code></pre>

<p><a name="class-instances"></a></p>

<h4 id="类实例">类实例</h4>

<p>这种期望的对象。 由于事实对象不需要解决的它已经是一个对象，可以说，并非真正的依赖注入，然而它是有用的如果你想强制返回的依赖关系，以永远是相同的对象值：</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Http\Request;

// Return new Phalcon\Http\Request();
$di-&gt;set(
    'request',
    new Request()
);
</code></pre>

<p><a name="closures-anonymous-functions"></a></p>

<h4 id="闭包匿名函数">闭包/匿名函数</h4>

<p>此方法提供了更大的自由来生成所需的依赖，然而，它是难以改变的一些参数外部而不必完全更改依赖项的定义：</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Db\Adapter\Pdo\Mysql as PdoMysql;

$di-&gt;set(
    'db',
    function () {
        return new PdoMysql(
            [
                'host'     =&gt; 'localhost',
                'username' =&gt; 'root',
                'password' =&gt; 'secret',
                'dbname'   =&gt; 'blog',
            ]
        );
    }
);
</code></pre>

<p>将额外的变量传递给封闭的环境，可以克服的一些限制：</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Config;
use Phalcon\Db\Adapter\Pdo\Mysql as PdoMysql;

$config = new Config(
    [
        'host'     =&gt; '127.0.0.1',
        'username' =&gt; 'user',
        'password' =&gt; 'pass',
        'dbname'   =&gt; 'my_database',
    ]
);

// Using the $config variable in the current scope
$di-&gt;set(
    'db',
    function () use ($config) {
        return new PdoMysql(
            [
                'host'     =&gt; $config-&gt;host,
                'username' =&gt; $config-&gt;username,
                'password' =&gt; $config-&gt;password,
                'dbname'   =&gt; $config-&gt;name,
            ]
        );
    }
);
</code></pre>

<p>您还可以访问其他 DI 服务使用 <code>get()</code> 方法：</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Config;
use Phalcon\Db\Adapter\Pdo\Mysql as PdoMysql;

$di-&gt;set(
    'config',
    function () {
        return new Config(
            [
                'host'     =&gt; '127.0.0.1',
                'username' =&gt; 'user',
                'password' =&gt; 'pass',
                'dbname'   =&gt; 'my_database',
            ]
        );
    }
);

// Using the 'config' service from the DI
$di-&gt;set(
    'db',
    function () {
        $config = $this-&gt;get('config');

        return new PdoMysql(
            [
                'host'     =&gt; $config-&gt;host,
                'username' =&gt; $config-&gt;username,
                'password' =&gt; $config-&gt;password,
                'dbname'   =&gt; $config-&gt;name,
            ]
        );
    }
);
</code></pre>

<p><a name="complex-registration"></a></p>

<h3 id="复杂的注册">复杂的注册</h3>

<p>如果需要更改服务的定义，而无需实例化解析服务，然后，我们需要定义使用数组语法的服务。 定义了一个服务使用数组定义可以更详细：</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Logger\Adapter\File as LoggerFile;

// Register a service 'logger' with a class name and its parameters
$di-&gt;set(
    'logger',
    [
        'className' =&gt; 'Phalcon\Logger\Adapter\File',
        'arguments' =&gt; [
            [
                'type'  =&gt; 'parameter',
                'value' =&gt; '../apps/logs/error.log',
            ]
        ]
    ]
);

// Using an anonymous function
$di-&gt;set(
    'logger',
    function () {
        return new LoggerFile('../apps/logs/error.log');
    }
);
</code></pre>

<p>Both service registrations above produce the same result. The array definition however, allows for alteration of the service parameters if needed:</p>

<pre><code class="language-php">&lt;?php

// Change the service class name
$di
    -&gt;getService('logger')
    -&gt;setClassName('MyCustomLogger');

// Change the first parameter without instantiating the logger
$di
    -&gt;getService('logger')
    -&gt;setParameter(
        0,
        [
            'type'  =&gt; 'parameter',
            'value' =&gt; '../apps/logs/error.log',
        ]
    );
</code></pre>

<p>另外通过使用数组语法你可以使用三种类型的依赖注入：</p>

<p><a name="constructor-injection"></a></p>

<h4 id="构造函数注入">构造函数注入</h4>

<p>This injection type passes the dependencies/arguments to the class constructor. Let’s pretend we have the following component:</p>

<pre><code class="language-php">&lt;?php

namespace SomeApp;

use Phalcon\Http\Response;

class SomeComponent
{
    /**
     * @var Response
     */
    protected $response;

    protected $someFlag;



    public function __construct(Response $response, $someFlag)
    {
        $this-&gt;response = $response;
        $this-&gt;someFlag = $someFlag;
    }
}
</code></pre>

<p>这种方式，可以注册服务：</p>

<pre><code class="language-php">&lt;?php

$di-&gt;set(
    'response',
    [
        'className' =&gt; 'Phalcon\Http\Response'
    ]
);

$di-&gt;set(
    'someComponent',
    [
        'className' =&gt; 'SomeApp\SomeComponent',
        'arguments' =&gt; [
            [
                'type' =&gt; 'service',
                'name' =&gt; 'response',
            ],
            [
                'type'  =&gt; 'parameter',
                'value' =&gt; true,
            ],
        ]
    ]
);
</code></pre>

<p>The service ‘response’ (<a href="api/Phalcon_Http_Response">Phalcon\Http\Response</a>) is resolved to be passed as the first argument of the constructor, while the second is a boolean value (true) that is passed as it is.</p>

<p><a name="setter-injection"></a></p>

<h4 id="设置注入">设置注入</h4>

<p>类可能有设置器注入可选依赖项，我们的前一个类可以改变接受依赖与设置:</p>

<pre><code class="language-php">&lt;?php

namespace SomeApp;

use Phalcon\Http\Response;

class SomeComponent
{
    /**
     * @var Response
     */
    protected $response;

    protected $someFlag;



    public function setResponse(Response $response)
    {
        $this-&gt;response = $response;
    }

    public function setFlag($someFlag)
    {
        $this-&gt;someFlag = $someFlag;
    }
}
</code></pre>

<p>Setter 注入可以被注册的服务，如下所示：</p>

<pre><code class="language-php">&lt;?php

$di-&gt;set(
    'response',
    [
        'className' =&gt; 'Phalcon\Http\Response',
    ]
);

$di-&gt;set(
    'someComponent',
    [
        'className' =&gt; 'SomeApp\SomeComponent',
        'calls'     =&gt; [
            [
                'method'    =&gt; 'setResponse',
                'arguments' =&gt; [
                    [
                        'type' =&gt; 'service',
                        'name' =&gt; 'response',
                    ]
                ]
            ],
            [
                'method'    =&gt; 'setFlag',
                'arguments' =&gt; [
                    [
                        'type'  =&gt; 'parameter',
                        'value' =&gt; true,
                    ]
                ]
            ]
        ]
    ]
);
</code></pre>

<p><a name="properties-injection"></a></p>

<h4 id="属性注入">属性注入</h4>

<p>一个不太常见的策略是依赖关系或参数直接注入的类的公共属性：</p>

<pre><code class="language-php">&lt;?php

namespace SomeApp;

use Phalcon\Http\Response;

class SomeComponent
{
    /**
     * @var Response
     */
    public $response;

    public $someFlag;
}
</code></pre>

<p>Setter 注入可以被注册的服务，如下所示：</p>

<pre><code class="language-php">&lt;?php

$di-&gt;set(
    'response',
    [
        'className' =&gt; 'Phalcon\Http\Response',
    ]
);

$di-&gt;set(
    'someComponent',
    [
        'className'  =&gt; 'SomeApp\SomeComponent',
        'properties' =&gt; [
            [
                'name'  =&gt; 'response',
                'value' =&gt; [
                    'type' =&gt; 'service',
                    'name' =&gt; 'response',
                ],
            ],
            [
                'name'  =&gt; 'someFlag',
                'value' =&gt; [
                    'type'  =&gt; 'parameter',
                    'value' =&gt; true,
                ],
            ]
        ]
    ]
);
</code></pre>

<p>支持的参数类型包括以下内容：</p>

<table>
  <tr>
    <th>
      类型
    </th>
    
    <th>
      描述
    </th>
    
    <th>
      示例
    </th>
  </tr>
  
  <tr>
    <td>
      参数
    </td>
    
    <td>
      表示要作为参数传递的文本值
    </td>
    
    <td>
      <pre><code>php['type' =&gt; 'parameter', 'value' =&gt; 1234]</code></pre>
    </td>
  </tr>
  
  <tr>
    <td>
      service
    </td>
    
    <td>
      表示在服务容器中的另一个服务
    </td>
    
    <td>
      <pre><code>php['type' =&gt; 'service', 'name' =&gt; 'request']</code></pre>
    </td>
  </tr>
  
  <tr>
    <td>
      instance
    </td>
    
    <td>
      表示必须动态构建的对象
    </td>
    
    <td>
      <pre><code>php['type' =&gt; 'instance', 'className' =&gt; 'DateTime', 'arguments' =&gt; ['now']]</code></pre>
    </td>
  </tr>
</table>

<p>Resolving a service whose definition is complex may be slightly slower than simple definitions seen previously. However, these provide a more robust approach to define and inject services.</p>

<p>混合使用不同类型的定义，允许，每个人都可以决定什么是最适当的方法来注册服务根据应用的需要。</p>

<p><a name="array-syntax"></a></p>

<h3 id="数组语法">数组语法</h3>

<p>数组语法也可以获取已经注册的服务：</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Di;
use Phalcon\Http\Request;

// 创建一个依赖注入容器
$di = new Di();

// 通过类名注册
$di['request'] = 'Phalcon\Http\Request';

// 使用匿名函数，该实例将被延迟加载
$di['request'] = function () {
    return new Request();
};

// 直接注册实例
$di['request'] = new Request();

// 使用数组定义
$di['request'] = [
    'className' =&gt; 'Phalcon\Http\Request',
];
</code></pre>

<p>在上面的例子中，当框架需要访问请求数据，它会要求输入标识作为 ‘request’ 在容器中的服务。 容器反过来将返回所需的服务的一个实例。 他/她需要的时候，开发人员可能最终替换元件。</p>

<p>每个方法 （如上面的例子所示） 用于set/register(设置/注册) 服务有优点和缺点。 它是由开发人员和将指定使用哪一个的特定要求。</p>

<p>将服务设置为一个字符串是简单，但缺乏灵活性。 设置服务使用数组提供了更多的灵活性，但使得代码更复杂。 Lambda 函数是一个好的平衡这两者之间，但可能会导致更多的维护比人们想象。</p>

<p><a href="api/Phalcon_Di">Phalcon\Di</a> offers lazy loading for every service it stores. 除非开发人员选择直接实例化一个对象并将其存储在容器中，任何对象 （通过数组、 字符串等） 存储在它将懒加载即实例化只在请求时。</p>

<p><a name="loading-from-yaml"></a></p>

<h3 id="从-yaml-文件加载服务">从 YAML 文件加载服务</h3>

<p>This feature will let you set your services in <code>yaml</code> files or just in plain php. For example you can load services using a <code>yaml</code> file like this:</p>

<pre><code class="language-yaml">config:
  className: \Phalcon\Config
  shared: true
</code></pre>

<pre><code class="language-php">&lt;?php

use Phalcon\Di;

$di = new Di();
$di-&gt;loadFromYaml('services.yml');
$di-&gt;get('config'); // will properly return config service
</code></pre>

<div class="alert alert-danger">
    <p>
        This approach requires that the module Yaml be installed. Please refer to <a href="http://php.net/manual/book.yaml.php">this</a> for more information.
    </p>
</div>

<p><a name="resolving-services"></a></p>

<h2 id="解析服务">解析服务</h2>

<p>Obtaining a service from the container is a matter of simply calling the ‘get’ method. A new instance of the service will be returned:</p>

<pre><code class="language-php">$request = $di-&gt;get('request');
</code></pre>

<p>或通过魔术方法调用：</p>

<pre><code class="language-php">$request = $di-&gt;getRequest();
</code></pre>

<p>或使用数组访问语法：</p>

<pre><code class="language-php">$request = $di['request'];
</code></pre>

<p>通过将一个数组参数添加到 get 方法，可以给构造函数传递参数：</p>

<pre><code class="language-php">&lt;?php

// new MyComponent('some-parameter', 'other')
$component = $di-&gt;get(
    'MyComponent',
    [
        'some-parameter',
        'other',
    ]
);
</code></pre>

<p><a name="envents"></a></p>

<h3 id="事件">事件</h3>

<p><a href="api/Phalcon_Di">Phalcon\Di</a> is able to send events to an <a href="/3.4/en/events">EventsManager</a> if it is present. 事件被触发使用类型 ‘di’。 一些事件可以停止操作，当返回布尔值 false 时。 支持以下事件：</p>

<table>
  <thead>
    <tr>
      <th>事件名称</th>
      <th>触发器</th>
      <th style="text-align: center">可以停止操作吗？</th>
      <th style="text-align: center">触发条件</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>beforeServiceResolve</td>
      <td>Triggered before resolve service. Listeners receive the service name and the parameters passed to it.</td>
      <td style="text-align: center">No</td>
      <td style="text-align: center">Listeners</td>
    </tr>
    <tr>
      <td>afterServiceResolve</td>
      <td>Triggered after resolve service. Listeners receive the service name, instance, and the parameters passed to it.</td>
      <td style="text-align: center">No</td>
      <td style="text-align: center">Listeners</td>
    </tr>
  </tbody>
</table>

<p><a name="shared-services"></a></p>

<h2 id="共享的服务">共享的服务</h2>

<p>Services can be registered as ‘shared’ services this means that they always will act as <a href="http://en.wikipedia.org/wiki/Singleton_pattern">singletons</a>. Once the service is resolved for the first time the same instance of it is returned every time a consumer retrieve the service from the container:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Session\Adapter\Files as SessionFiles;

// Register the session service as 'always shared'
$di-&gt;setShared(
    'session',
    function () {
        $session = new SessionFiles();

        $session-&gt;start();

        return $session;
    }
);

// Locates the service for the first time
$session = $di-&gt;get('session');

// Returns the first instantiated object
$session = $di-&gt;getSession();
</code></pre>

<p>An alternative way to register shared services is to pass ‘true’ as third parameter of ‘set’:</p>

<pre><code class="language-php">&lt;?php

// Register the session service as 'always shared'
$di-&gt;set(
    'session',
    function () {
        // ...
    },
    true
);
</code></pre>

<p>If a service isn’t registered as shared and you want to be sure that a shared instance will be accessed every time the service is obtained from the DI, you can use the ‘getShared’ method:</p>

<pre><code class="language-php">$request = $di-&gt;getShared('request');
</code></pre>

<p><a name="manipulating-services-individually"></a></p>

<h2 id="单独操纵服务">单独操纵服务</h2>

<p>Once a service is registered in the service container, you can retrieve it to manipulate it individually:</p>

<pre><code class="language-php">    &lt;?php

    use Phalcon\Http\Request;

    // Register the 'request' service
    $di-&gt;set('request', 'Phalcon\Http\Request');

    // Get the service
    $requestService = $di-&gt;getService('request');

    // Change its definition
    $requestService-&gt;setDefinition(
        function () {
            return new Request();
        }
    );

    // Change it to shared
    $requestService-&gt;setShared(true);

    // Resolve the service (return a Phalcon\Http\Request instance)
    $request = $requestService-&gt;resolve();
</code></pre>

<p><a name="instantiating-classes-service-container"></a></p>

<h2 id="通过服务容器实例化类">通过服务容器实例化类</h2>

<p>When you request a service to the service container, if it can’t find out a service with the same name it’ll try to load a class with the same name. With this behavior we can replace any class by another simply by registering a service with its name:</p>

<pre><code class="language-php">&lt;?php

// Register a controller as a service
$di-&gt;set(
    'IndexController',
    function () {
        $component = new Component();

        return $component;
    },
    true
);

// Register a controller as a service
$di-&gt;set(
    'MyOtherComponent',
    function () {
        // Actually returns another component
        $component = new AnotherComponent();

        return $component;
    }
);

// Create an instance via the service container
$myComponent = $di-&gt;get('MyOtherComponent');
</code></pre>

<p>You can take advantage of this, always instantiating your classes via the service container (even if they aren’t registered as services). The DI will fallback to a valid autoloader to finally load the class. By doing this, you can easily replace any class in the future by implementing a definition for it.</p>

<p><a name="automatic-injecting-di-itself"></a></p>

<h2 id="automatic-injecting-of-the-di-itself">Automatic Injecting of the DI itself</h2>

<p>If a class or component requires the DI itself to locate services, the DI can automatically inject itself to the instances it creates, to do this, you need to implement the <a href="api/Phalcon_Di_InjectionAwareInterface">Phalcon\Di\InjectionAwareInterface</a> in your classes:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\DiInterface;
use Phalcon\Di\InjectionAwareInterface;

class MyClass implements InjectionAwareInterface
{
    /**
     * @var DiInterface
     */
    protected $di;


    public function setDi(DiInterface $di)
    {
        $this-&gt;di = $di;
    }

    public function getDi()
    {
        return $this-&gt;di;
    }
}
</code></pre>

<p>Then once the service is resolved, the <code>$di</code> will be passed to <code>setDi()</code> automatically:</p>

<pre><code class="language-php">&lt;?php

// Register the service
$di-&gt;set('myClass', 'MyClass');

// Resolve the service (NOTE: $myClass-&gt;setDi($di) is automatically called)
$myClass = $di-&gt;get('myClass');
</code></pre>

<p><a name="organizing-services-files"></a></p>

<h2 id="在文件中组织服务">在文件中组织服务</h2>

<p>You can better organize your application by moving the service registration to individual files instead of doing everything in the application’s bootstrap:</p>

<pre><code class="language-php">&lt;?php

$di-&gt;set(
    'router',
    function () {
        return include '../app/config/routes.php';
    }
);
</code></pre>

<p>Then in the file (<code>'../app/config/routes.php'</code>) return the object resolved:</p>

<pre><code class="language-php">&lt;?php

$router = new MyRouter();

$router-&gt;post('/login');

return $router;
</code></pre>

<p><a name="accessing-di-static-way"></a></p>

<h2 id="以静态的方式访问di">以静态的方式访问DI</h2>

<p>If needed you can access the latest DI created in a static function in the following way:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Di;

class SomeComponent
{
    public static function someMethod()
    {
        // Get the session service
        $session = Di::getDefault()-&gt;getSession();
    }
}
</code></pre>

<p><a name="service-providers"></a></p>

<h2 id="服务提供商">服务提供商</h2>

<p>Using the <code>ServiceProviderInterface</code> you now register services by context. You can move all your <code>$di-&gt;set()</code> calls to classes like this:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Di\ServiceProviderInterface;
use Phalcon\DiInterface;
use Phalcon\Di;
use Phalcon\Config\Adapter\Ini;

class SomeServiceProvider implements ServiceProviderInterface
{
    public function register(DiInterface $di)
    {
        $di-&gt;set(
            'config', 
            function () {
                return new Ini('config.ini');
            }
        );
    }
}

$di = new Di();
$di-&gt;register(new SomeServiceProvider());
var_dump($di-&gt;get('config')); // will return properly our config
</code></pre>

<p><a name="factory-default-di"></a></p>

<h2 id="默认的di注入器">默认的Di注入器</h2>

<p>Although the decoupled character of Phalcon offers us great freedom and flexibility, maybe we just simply want to use it as a full-stack framework. To achieve this, the framework provides a variant of <a href="api/Phalcon_Di">Phalcon\Di</a> called <a href="api/Phalcon_Di_FactoryDefault">Phalcon\Di\FactoryDefault</a>. This class automatically registers the appropriate services bundled with the framework to act as full-stack.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Di\FactoryDefault;

$di = new FactoryDefault();
</code></pre>

<p><a name="service-name-conventions"></a></p>

<h2 id="服务名称约定">服务名称约定</h2>

<p>Although you can register services with the names you want, Phalcon has a several naming conventions that allow it to get the the correct (built-in) service when you need it.</p>

<table>
  <thead>
    <tr>
      <th>服务名称</th>
      <th>描述</th>
      <th>默认</th>
      <th style="text-align: center">是否共享</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>assets</td>
      <td>资源管理器</td>
      <td><a href="api/Phalcon_Assets_Manager">Phalcon\Assets\Manager</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td>annotations</td>
      <td>注释语法分析器</td>
      <td><a href="api/Phalcon_Annotations_Adapter_Memory">Phalcon\Annotations\Adapter\Memory</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td>cookies</td>
      <td>HTTP Cookie 管理服务</td>
      <td><a href="api/Phalcon_Http_Response_Cookies">Phalcon\Http\Response\Cookies</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td>crypt</td>
      <td>加密解密数据</td>
      <td><a href="api/Phalcon_Crypt">Phalcon\Crypt</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td>db</td>
      <td>低级数据库连接服务</td>
      <td><a href="api/Phalcon_Db">Phalcon\Db</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td>dispatcher</td>
      <td>调度服务控制器</td>
      <td><a href="api/Phalcon_Mvc_Dispatcher">Phalcon\Mvc\Dispatcher</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td>eventsManager</td>
      <td>事件管理服务</td>
      <td><a href="api/Phalcon_Events_Manager">Phalcon\Events\Manager</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td>escaper</td>
      <td>内容的过滤筛选</td>
      <td><a href="api/Phalcon_Escaper">Phalcon\Escaper</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td>flash</td>
      <td>闪存的消息传递服务</td>
      <td><a href="api/Phalcon_Flash_Direct">Phalcon\Flash\Direct</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td>flashSession</td>
      <td>Flash 会话消息服务</td>
      <td><a href="api/Phalcon_Flash_Session">Phalcon\Flash\Session</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td>filter</td>
      <td>输入过滤服务</td>
      <td><a href="api/Phalcon_Filter">Phalcon\Filter</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td>modelsCache</td>
      <td>模型缓存的缓存后端</td>
      <td>无</td>
      <td style="text-align: center">No</td>
    </tr>
    <tr>
      <td>modelsManager</td>
      <td>模型管理服务</td>
      <td><a href="api/Phalcon_Mvc_Model_Manager">Phalcon\Mvc\Model\Manager</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td>modelsMetadata</td>
      <td>模型元数据服务</td>
      <td><a href="api/Phalcon_Mvc_Model_MetaData_Memory">Phalcon\Mvc\Model\MetaData\Memory</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td>request</td>
      <td>HTTP 请求环境服务</td>
      <td><a href="api/Phalcon_Http_Request">Phalcon\Http\Request</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td>response</td>
      <td>HTTP 响应环境服务</td>
      <td><a href="api/Phalcon_Http_Response">Phalcon\Http\Response</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td>router</td>
      <td>路由服务</td>
      <td><a href="api/Phalcon_Mvc_Router">Phalcon\Mvc\Router</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td>security</td>
      <td>安全助手</td>
      <td><a href="api/Phalcon_Security">Phalcon\Security</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td>session</td>
      <td>会话服务</td>
      <td><a href="api/Phalcon_Session_Adapter_Files">Phalcon\Session\Adapter\Files</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td>sessionBag</td>
      <td>会话包服务</td>
      <td><a href="api/Phalcon_Session_Bag">Phalcon\Session\Bag</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td>tag</td>
      <td>生成的 HTML 助手</td>
      <td><a href="api/Phalcon_Tag">Phalcon\Tag</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td>transactionManager</td>
      <td>模型事务管理器服务</td>
      <td><a href="api/Phalcon_Mvc_Model_Transaction_Manager">Phalcon\Mvc\Model\Transaction\Manager</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td>url</td>
      <td>URL 生成器服务</td>
      <td><a href="api/Phalcon_Mvc_Url">Phalcon\Mvc\Url</a></td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td>viewsCache</td>
      <td>视图片段缓存后端</td>
      <td>无</td>
      <td style="text-align: center">No</td>
    </tr>
  </tbody>
</table>

<p><a name="implementing-your-own-di"></a></p>

<h2 id="实现你自己的di">实现你自己的DI</h2>

<p>The <a href="api/Phalcon_DiInterface">Phalcon\DiInterface</a> interface must be implemented to create your own DI replacing the one provided by Phalcon or extend the current one.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>

<footer>
    <div class="container">
        <div class="footer-wrapper clearfix">

            <div class="footer-link-container">
                <a class="footer-link" href="/">
                    <img class="footer-logo-img" src="/assets/images/footer_logo.svg" alt="logo">
                </a>
                <a class="footer-link" href="https://phalcon.link/about" target="_blank">
                    About
                </a>
                <a class="footer-link" href="https://phalcon.link/sponsors" target="_blank">
                    Sponsors
                </a>
                <a class="footer-link" href="https://phalcon.link/fund" target="_blank">
                    Support Us
                </a>
                <a class="footer-link" href="https://phalcon.link/download" target="_blank">
                    Download
                </a>
                <a class="footer-link" href="https://license.phalconphp.com/" target="_blank">
                    License New BSD
                </a>
            </div>

            <div class="footer-copyright">
                <a href="https://odva.pro/" target="_blank" class="o2-link">
                    <span>Development by</span> <img src="/assets/images/logo-o2.svg" alt="logo o2">
                </a>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript" src="/assets/js/main.min.js?v1547319779866581049"></script>
<script type="text/javascript" src="/assets/js/highlight/highlight.pack.js?v1547319779866581049"></script>
<script type="application/javascript">hljs.initHighlightingOnLoad();</script>
<script type="application/javascript">hljs.initHighlightingOnLoad();</script>
</body>
</html>
