<!doctype html>
<!--[if IE 8]>
<html lang="zh-cn" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="zh-cn" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="zh-cn" class="no-js">
<!--<![endif]-->








    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <script type="text/javascript" src="/assets/js/viewport-min-width.js?v1547266080100021829"></script>
        <meta name="description"
              content="Official Phalcon Documentation">
        <meta name="keywords" content="php, phalcon, phalcon php, php framework, faster php framework, php extension, next generation framework, docs, documentation">
        <meta name="author" href="/humans.txt">
        <meta name="generator" content="Phalcon Team - Jekyll - Netlify">

        <link href="https://phalcon-docs4.netlify.com/3.4/zh-cn/db-layer.html" rel="canonical">
        <title>Phalcon Framework Documentation</title>

        <!-- Twitter -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@zephirlang">
        <meta name="twitter:creator" content="@zephirlang">
        <meta name="twitter:title" content="Phalcon Framework Documentation">
        <meta name="twitter:description" content="Official Phalcon Documentation">
        <meta name="twitter:image" content="https://assets.phalconphp.com/phalcon/logo.png">

        <!-- Facebook -->
        <meta property="og:url" content="https://phalcon-docs4.netlify.com">
        <meta property="og:title" content="Phalcon Framework Documentation">
        <meta property="og:description" content="Official Phalcon Documentation">
        <meta property="og:type" content="website">
        <meta property="og:image" content="https://assets.phalconphp.com/phalcon/logo.png">

        <meta name="msapplication-TileColor" content="#FFFFFF">
        <meta name="msapplication-square70x70logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-70x70.png">
        <meta name="msapplication-TileImage"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-144x144.png">
        <meta name="msapplication-square150x150logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-150x150.png">
        <meta name="msapplication-wide310x150logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-310x150.png">
        <meta name="msapplication-square310x310logo"
              content="https://assets.phalconphp.com/phalcon/icons/mstile-310x310.png">

        <link rel="apple-touch-icon"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon.png">

        <link rel="apple-touch-icon-precomposed"
              sizes="57x57"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-57x57.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="60x60"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-60x60.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="72x72"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="76x76"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-76x76.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="114x114"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-114x114.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="120x120"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-120x120.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="144x144"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-144x144.png">
        <link rel="apple-touch-icon-precomposed"
              sizes="152x152"
              href="https://assets.phalconphp.com/phalcon/icons/apple-touch-icon-152x152.png">

        <link rel="icon"
              type="image/png"
              sizes="16x16"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-16x16.png">
        <link rel="icon"
              type="image/png"
              sizes="32x32"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-32x32.png">
        <link rel="icon"
              type="image/png"
              sizes="96x96"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-96x96.png">
        <link rel="icon"
              type="image/png"
              sizes="128x128"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-128x128.png">
        <link rel="icon"
              type="image/png"
              sizes="196x196"
              href="https://assets.phalconphp.com/phalcon/icons/favicon-196x196.png">
        <link rel="shortcut icon"
              type="image/png"
              href="https://assets.phalconphp.com/phalcon/favicon.ico"/>

        <link rel="alternate"
              type="application/rss+xml"
              title=" - "
              href="https://phalcon-docs4.netlify.com/feed.xml">

        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css"
              integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE="
              crossorigin="anonymous" />
        <link rel="stylesheet" href="/assets/css/monokai.css?v1547266080100021829" />
        <link rel="stylesheet" href="/assets/css/style.css?v1547266080100021829" />

        <script defer src="https://use.fontawesome.com/releases/v5.6.1/js/all.js"
                integrity="sha384-R5JkiUweZpJjELPWqttAYmYM1P3SNEJRM6ecTQF05pFFtxmCO+Y1CiUhvuDzgSVZ"
                crossorigin="anonymous"></script>
        
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90300500-6"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-90300500-6');
    </script>

    </head>


<body onclick="o2.allNavSlideUp()">
    <header class="header-image-doc">
        <div class="container">
            <div class="header-wrapper">
                <div class="clearfix">
                    <div class="row">
                        <div class="col-md-2 col-sm-3  col-xs-8">
                            <div class="header-image__logo-wrapper">
                                <a href="/3.4/zh-cn">
                                    <img class="logo-img" src="/assets/images/header_logo.svg" alt="logo">
                                </a>
                            </div>
                        </div>
                        <div class="col-md-10 col-sm-9 top-menu">

                            <div class="nav-icon" onclick="o2.showMobileMenu();">
                                <div class="nav-line"></div>
                                <div class="nav-line"></div>
                                <div class="nav-line"></div>
                            </div>
                            <nav class="header-nav">
                                <ul>
                                    <li class="nav-item" onclick="o2.toggleState(this, event);">
                                        <div class="nav-item_selected">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                                 alt="">
                                            <span class="caret"></span>
                                        </div>
                                        <div class="nav-item__list" onclick="event.stopPropagation();">
                                            
                                                <a href="/3.4/en/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                         alt="English (US)">
                                                    English (US)
                                                </a>
                                            
                                                <a href="/3.4/cs-cz/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/cs.png"
                                                         alt="Czech">
                                                    Czech
                                                </a>
                                            
                                                <a href="/3.4/de-de/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/de.png"
                                                         alt="German">
                                                    German
                                                </a>
                                            
                                                <a href="/3.4/es-es/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                         alt="Spanish">
                                                    Spanish
                                                </a>
                                            
                                                <a href="/3.4/fa-ir/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fa.png"
                                                         alt="Persian">
                                                    Persian
                                                </a>
                                            
                                                <a href="/3.4/fr-fr/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fr.png"
                                                         alt="French">
                                                    French
                                                </a>
                                            
                                                <a href="/3.4/id-id/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/id.png"
                                                         alt="Indonesian">
                                                    Indonesian
                                                </a>
                                            
                                                <a href="/3.4/it-it/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/it.png"
                                                         alt="Italian">
                                                    Italian
                                                </a>
                                            
                                                <a href="/3.4/ja-jp/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ja.png"
                                                         alt="Japanese">
                                                    Japanese
                                                </a>
                                            
                                                <a href="/3.4/pl-pl/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/pl.png"
                                                         alt="Polish">
                                                    Polish
                                                </a>
                                            
                                                <a href="/3.4/ru-ru/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ru.png"
                                                         alt="Russian">
                                                    Russian
                                                </a>
                                            
                                                <a href="/3.4/tr-tr/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/tr.png"
                                                         alt="Turkish">
                                                    Turkish
                                                </a>
                                            
                                                <a href="/3.4/uk-ua/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/uk.png"
                                                         alt="Ukrainian">
                                                    Ukrainian
                                                </a>
                                            
                                                <a href="/3.4/zh-cn/db-layer" class="custom-select__list-item">
                                                    <img class="lang-image"
                                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                                         alt="Chinese Simplified">
                                                    Chinese Simplified
                                                </a>
                                            
                                        </div>
                                    </li>

                                        <li class="nav-item" onclick="o2.toggleState(this, event);">
                                            <div class="nav-item__selected custom-select__version">
                                                 3.4
                                                <span class="caret"></span>
                                            </div>
                                            <div class="nav-item__list" onclick="event.stopPropagation();">
                                                
                                                <a href="/3.4/zh-cn/db-layer" class="custom-select__list-item">
                                                    <span>3.4</span>
                                                </a>
                                                
                                                <a href="/3.3/zh-cn/db-layer" class="custom-select__list-item">
                                                    <span>3.3</span>
                                                </a>
                                                
                                                <a href="/3.2/zh-cn/db-layer" class="custom-select__list-item">
                                                    <span>3.2</span>
                                                </a>
                                                
                                                <a href="/3.1/zh-cn/db-layer" class="custom-select__list-item">
                                                    <span>3.1</span>
                                                </a>
                                                
                                                <a href="/4.0/zh-cn/db-layer" class="custom-select__list-item">
                                                    <span>4.0</span>
                                                </a>
                                                
                                            </div>
                                        </li>

                                    <li class="nav-item" onclick="o2.toggleState(this, event);">
                                        <div class="nav-item_selected">
                                            
                                            <span class="caret"></span>
                                        </div>
                                        <div class="nav-item__list">
                                            <a href="https://phalcon.link/forum" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/blog" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/resources" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <div class="nav-item__divider"></div>
                                            <a href="https://phalcon.link/f" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/t" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                            <a href="https://phalcon.link/gab" class="custom-select__list-item" target="_blank">
                                                
                                            </a>
                                        </div>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/about">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/sponsors">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/fund">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://phalcon.link/download">
                                            
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>

                        <div class="header-nav-mobile">
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this, event)">
                                    <img class="lang-image"
                                         src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                         alt="">
                                    <span class="caret"></span>
                                </div>

                                <ul style="display:none;" class="clearfix" onclick="event.stopPropagation();">
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/en/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/en-US.png"
                                                 alt="English (US)">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/cs-cz/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/cs.png"
                                                 alt="Czech">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/de-de/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/de.png"
                                                 alt="German">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/es-es/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/es-ES.png"
                                                 alt="Spanish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/fa-ir/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fa.png"
                                                 alt="Persian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/fr-fr/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/fr.png"
                                                 alt="French">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/id-id/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/id.png"
                                                 alt="Indonesian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/it-it/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/it.png"
                                                 alt="Italian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/ja-jp/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ja.png"
                                                 alt="Japanese">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/pl-pl/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/pl.png"
                                                 alt="Polish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/ru-ru/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/ru.png"
                                                 alt="Russian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/tr-tr/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/tr.png"
                                                 alt="Turkish">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/uk-ua/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/uk.png"
                                                 alt="Ukrainian">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-sm-3 col-xs-6">
                                        <a href="/3.4/zh-cn/db-layer">
                                            <img class="lang-image"
                                                 src="https://d2srrzh48sp2nh.cloudfront.net/31cd209e/images/flags/zh-CN.png"
                                                 alt="Chinese Simplified">
                                            <span></span>
                                        </a>
                                    </li>
                                    
                                </ul>

                            </div>
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this,event)">
                                     3.4
                                    <span class="caret"></span>
                                </div>

                                <ul style="display:none;" class="clearfix" onclick="event.stopPropagation();">
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.4/zh-cn/db-layer">
                                            <span>3.4</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.3/zh-cn/db-layer">
                                            <span>3.3</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.2/zh-cn/db-layer">
                                            <span>3.2</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/3.1/zh-cn/db-layer">
                                            <span>3.1</span>
                                        </a>
                                    </li>
                                    
                                    <li class="nav-item nav-item-li col-xs-12">
                                        <a href="/4.0/zh-cn/db-layer">
                                            <span>4.0</span>
                                        </a>
                                    </li>
                                    
                                </ul>

                            </div>
                            <div>
                                <div class="nav-item nav-item-accordion" onclick="o2.topicsAccordion(this, event)">
                                    
                                    <span class="caret"></span>
                                </div>
                                <ul style="display:none;">
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/forum" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/blog" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/resources" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/f" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/t" target="_blank">
                                            
                                        </a>
                                    </li>
                                    <li class="nav-item nav-item-li">
                                        <a href="https://phalcon.link/gab" target="_blank">
                                            
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/about">
                                    
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/sponsors">
                                    
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/fund">
                                    
                                </a>
                            </div>
                            <div class="nav-item">
                                <a href="https://phalcon.link/download">
                                    
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>


    <div class="container-fluid article-page-wrap">
        <div class="row">
            <div>
                <div class="col-md-2 sidebar hidden-xs">
                    <div class="sidebar--spacer">&nbsp;</div>
                </div>
                <div class="m-t-md m-b-lg" id="articles">
                    <div class="article-content">
                        







                        <section class="documentation-section">
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-md-8 col-lg-9 parse-content">
                                        <div>
                                            <a class="article-content-edit-link pull-right"
                                               href="https://crowdin.com/project/phalcon-documentation/zh-cn">
                                                
                                            </a>
                                            <br>
                                        </div>
                                        <p><a name="overview"></a></p>

<h1 id="数据库抽象层">数据库抽象层</h1>

<p><a href="api/Phalcon_Db">Phalcon\Db</a> is the component behind <a href="api/Phalcon_Mvc_Model">Phalcon\Mvc\Model</a> that powers the model layer in the framework. 它是由数据库系统完全用 C 编写的一个独立的高级别抽象层</p>

<p>此组件允许比使用传统模式更低的级别的数据库操作。</p>

<p><a name="adapters"></a></p>

<h2 id="数据库适配器">数据库适配器</h2>

<p>This component makes use of adapters to encapsulate specific database system details. Phalcon uses PDO to connect to databases. The following database engines are supported:</p>

<table>
  <thead>
    <tr>
      <th>类</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="api/Phalcon_Db_Adapter_Pdo_Mysql">Phalcon\Db\Adapter\Pdo\Mysql</a></td>
      <td>是世界上使用最多的关系数据库管理系统 (RDBMS)，作为提供多用户访问数量的数据库服务器运行</td>
    </tr>
    <tr>
      <td><a href="api/Phalcon_Db_Adapter_Pdo_Postgresql">Phalcon\Db\Adapter\Pdo\Mysql</a></td>
      <td>PostgreSQL 是一个功能强大的开源关系型数据库系统。 它有超过 15 年的积极发展和行之有效的体系结构，它赢得了良好声誉的可靠性、 数据完整性和正确性。</td>
    </tr>
    <tr>
      <td><a href="api/Phalcon_Db_Adapter_Pdo_Sqlite">Phalcon\Db\Adapter\Pdo\Sqlite</a></td>
      <td>SQLite 是一个软件库，实现了一个自包含、 无服务器、 零配置、 事务性的 SQL 数据库引擎</td>
    </tr>
  </tbody>
</table>

<p><a name="adapters-factory"></a></p>

<h3 id="factory">Factory</h3>

<p><a name="factory"></a></p>

<p>Loads PDO Adapter class using <code>adapter</code> option. For example:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Db\Adapter\Pdo\Factory;

$options = [
    'host'     =&gt; 'localhost',
    'dbname'   =&gt; 'blog',
    'port'     =&gt; 3306,
    'username' =&gt; 'sigma',
    'password' =&gt; 'secret',
    'adapter'  =&gt; 'mysql',
];

$db = Factory::load($options);
</code></pre>

<p><a name="adapters-custom"></a></p>

<h3 id="实现自己的适配器">实现自己的适配器</h3>

<p>The <a href="api/Phalcon_Db_AdapterInterface">Phalcon\Db\AdapterInterface</a> interface must be implemented in order to create your own database adapters or extend the existing ones.</p>

<p><a name="dialects"></a></p>

<h2 id="数据库语言">数据库语言</h2>

<p>Phalcon encapsulates the specific details of each database engine in dialects. Those provide common functions and SQL generator to the adapters.</p>

<table>
  <thead>
    <tr>
      <th>类</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="api/Phalcon_Db_Dialect_Mysql">Phalcon\Db\Dialect\Mysql</a></td>
      <td>SQL 特定方言为 MySQL 数据库系统的</td>
    </tr>
    <tr>
      <td><a href="api/Phalcon_Db_Dialect_Postgresql">Phalcon\Db\Dialect\Postgresql</a></td>
      <td>SQL 特定方言 PostgreSQL 数据库系统</td>
    </tr>
    <tr>
      <td><a href="api/Phalcon_Db_Dialect_Sqlite">Phalcon\Db\Dialect\Sqlite</a></td>
      <td>SQLite 数据库系统的 SQL 特定方言</td>
    </tr>
  </tbody>
</table>

<p><a name="dialects-custom"></a></p>

<h3 id="implementing-your-own-dialects">Implementing your own dialects</h3>

<p>The <a href="api/Phalcon_Db_DialectInterface">Phalcon\Db\DialectInterface</a> interface must be implemented in order to create your own database dialects or extend the existing ones. 您还可以通过添加 PHQL 将了解的更多命令/方法来增强当前语言。</p>

<p>For instance when using the MySQL adapter, you might want to allow PHQL to recognize the <code>MATCH ... AGAINST ...</code> syntax. We associate that syntax with <code>MATCH_AGAINST</code></p>

<p>我们实例化方言。 我们添加自定义函数, 以便 PHQL 了解在分析过程中找到它时应执行的操作。 在下面的示例中, 我们注册了一个名为 ` MATCH_AGAINST ` 的新自定义函数。 之后, 我们要做的就是添加自定义的语言解析器对象到我们的连接。</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Db\Dialect\MySQL as SqlDialect;
use Phalcon\Db\Adapter\Pdo\MySQL as Connection;

$dialect = new SqlDialect();

$dialect-&gt;registerCustomFunction(
    'MATCH_AGAINST',
    function($dialect, $expression) {
        $arguments = $expression['arguments'];
        return sprintf(
            " MATCH (%s) AGAINST (%)",
            $dialect-&gt;getSqlExpression($arguments[0]),
            $dialect-&gt;getSqlExpression($arguments[1])
         );
    }
);

$connection = new Connection(
    [
        "host"          =&gt; "localhost",
        "username"      =&gt; "root",
        "password"      =&gt; "",
        "dbname"        =&gt; "test",
        "dialectClass"  =&gt; $dialect
    ]
);
</code></pre>

<p>我们现在可以在PHQL中使用这个新函数，而后者又将其转换为正确的SQL语法：</p>

<pre><code class="language-php">$phql = "
  SELECT *
  FROM   Posts
  WHERE  MATCH_AGAINST(title, :pattern:)";

$posts = $modelsManager-&gt;executeQuery($phql, ['pattern' =&gt; $pattern]);
</code></pre>

<p><a name="connection"></a></p>

<h2 id="连接到数据库">连接到数据库</h2>

<p>要创建连接，必须实例化适配器类。 它只需要一个连接参数的数组。 下面的示例演示如何创建连接传递必需和可选的参数：</p>

<h5 id="mysql-必须的参数">MySQL 必须的参数</h5>

<pre><code class="language-php">&lt;?php

$config = [
    'host'     =&gt; '127.0.0.1',
    'username' =&gt; 'mike',
    'password' =&gt; 'sigma',
    'dbname'   =&gt; 'test_db',
];
</code></pre>

<h5 id="mysql-参数">MySQL 参数</h5>

<pre><code class="language-php">$config['persistent'] = false;
</code></pre>

<h5 id="创建一个mysql-连接">创建一个MySQL 连接</h5>

<pre><code class="language-php">$connection = new \Phalcon\Db\Adapter\Pdo\Mysql($config);
</code></pre>

<h5 id="postgresql-必须的参数">PostgreSQL 必须的参数</h5>

<pre><code class="language-php">&lt;?php

$config = [
    'host'     =&gt; 'localhost',
    'username' =&gt; 'postgres',
    'password' =&gt; 'secret1',
    'dbname'   =&gt; 'template',
];
</code></pre>

<h5 id="postgresql-参数">PostgreSQL 参数</h5>

<pre><code class="language-php">$config['schema'] = 'public';
</code></pre>

<h5 id="创建一个postgresql-连接">创建一个PostgreSQL 连接</h5>

<pre><code class="language-php">$connection = new \Phalcon\Db\Adapter\Pdo\Postgresql($config);
</code></pre>

<h5 id="sqlite-必须的参数">SQLite 必须的参数</h5>

<pre><code class="language-php">&lt;?php

$config = [
    'dbname' =&gt; '/path/to/database.db',
];
</code></pre>

<h5 id="创建一个sqlite-连接">创建一个SQLite 连接</h5>

<pre><code class="language-php">$connection = new \Phalcon\Db\Adapter\Pdo\Sqlite($config);
</code></pre>

<p><a name="options"></a></p>

<h2 id="pdo-的附加选项设置">PDO 的附加选项设置</h2>

<p>通过传递参数 <code>options</code>，可以设置在连接时的 PDO 选项：</p>

<pre><code class="language-php">&lt;?php

$connection = new \Phalcon\Db\Adapter\Pdo\Mysql(
    [
        'host'     =&gt; 'localhost',
        'username' =&gt; 'root',
        'password' =&gt; 'sigma',
        'dbname'   =&gt; 'test_db',
        'options'  =&gt; [
            PDO::MYSQL_ATTR_INIT_COMMAND =&gt; "SET NAMES 'UTF8'",
            PDO::ATTR_CASE               =&gt; PDO::CASE_LOWER,
        ]
    ]
);
</code></pre>

<p><a name="connection-factory"></a></p>

<h2 id="connecting-using-factory">Connecting using Factory</h2>

<p>You can also use a simple <code>ini</code> file to configure/connect your <code>db</code> service to your database.</p>

<pre><code class="language-ini">[database]
host = TEST_DB_MYSQL_HOST
username = TEST_DB_MYSQL_USER
password = TEST_DB_MYSQL_PASSWD
dbname = TEST_DB_MYSQL_NAME
port = TEST_DB_MYSQL_PORT
charset = TEST_DB_MYSQL_CHARSET
adapter = mysql
</code></pre>

<pre><code class="language-php">&lt;?php

use Phalcon\Config\Adapter\Ini;
use Phalcon\Di;
use Phalcon\Db\Adapter\Pdo\Factory;

$di = new Di();
$config = new Ini('config.ini');

$di-&gt;set('config', $config);

$di-&gt;set(
    'db', 
    function () {
        return Factory::load($this-&gt;config-&gt;database);
    }
);
</code></pre>

<p>The above will return the correct database instance and also has the advantage that you can change the connection credentials or even the database adapter without changing a single line of code in your application.</p>

<p><a name="finding-rows"></a></p>

<h2 id="finding-rows">Finding Rows</h2>

<p><a href="api/Phalcon_Db">Phalcon\Db</a> provides several methods to query rows from tables. The specific SQL syntax of the target database engine is required in this case:</p>

<pre><code class="language-php">&lt;?php

$sql = 'SELECT id, name FROM robots ORDER BY name';

// Send a SQL statement to the database system
$result = $connection-&gt;query($sql);

// Print each robot name
while ($robot = $result-&gt;fetch()) {
   echo $robot['name'];
}

// Get all rows in an array
$robots = $connection-&gt;fetchAll($sql);
foreach ($robots as $robot) {
   echo $robot['name'];
}

// Get only the first row
$robot = $connection-&gt;fetchOne($sql);
</code></pre>

<p>By default these calls create arrays with both associative and numeric indexes. 通过使用 <code>Phalcon\Db\Result::setFetchMode()</code>，您可以更改此行为。 此方法接收一个常数，确定哪种类型的索引所需。</p>

<table>
  <thead>
    <tr>
      <th>常量：</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Phalcon\Db::FETCH_NUM</code></td>
      <td>返回一个数字索引的数组</td>
    </tr>
    <tr>
      <td><code>Phalcon\Db::FETCH_ASSOC</code></td>
      <td>返回一个数组具有关联的索引</td>
    </tr>
    <tr>
      <td><code>Phalcon\Db::FETCH_BOTH</code></td>
      <td>返回与关联和数字索引数组</td>
    </tr>
    <tr>
      <td><code>Phalcon\Db::FETCH_OBJ</code></td>
      <td>返回一个对象而不是数组</td>
    </tr>
  </tbody>
</table>

<pre><code class="language-php">&lt;?php

$sql = 'SELECT id, name FROM robots ORDER BY name';
$result = $connection-&gt;query($sql);

$result-&gt;setFetchMode(Phalcon\Db::FETCH_NUM);
while ($robot = $result-&gt;fetch()) {
   echo $robot[0];
}
</code></pre>

<p>The <code>Phalcon\Db::query()</code> returns an instance of <a href="api/Phalcon_Db_Result_Pdo">Phalcon\Db\Result\Pdo</a>. 这些对象封装了所有与返回的结果集有关的功能函数，例如遍历、查找特定记录、计数等等。</p>

<pre><code class="language-php">&lt;?php

$sql = 'SELECT id, name FROM robots';
$result = $connection-&gt;query($sql);

// Traverse the resultset
while ($robot = $result-&gt;fetch()) {
   echo $robot['name'];
}

// Seek to the third row
$result-&gt;seek(2);
$robot = $result-&gt;fetch();

// Count the resultset
echo $result-&gt;numRows();
</code></pre>

<p><a name="binding-parameters"></a></p>

<h2 id="binding-parameters">Binding Parameters</h2>

<p>Bound parameters is also supported in <a href="api/Phalcon_Db">Phalcon\Db</a>. 虽然通过使用绑定的参数的最小的性能影响，你被鼓励使用此方法，以消除您的代码受到 SQL 注入式攻击的可能性。 支持字符串和位置的占位符。 绑定参数可以简单地实现，如下所示：</p>

<pre><code class="language-php">&lt;?php

// Binding with numeric placeholders
$sql    = 'SELECT * FROM robots WHERE name = ? ORDER BY name';
$result = $connection-&gt;query(
    $sql,
    [
        'Wall-E',
    ]
);

// Binding with named placeholders
$sql     = 'INSERT INTO `robots`(name`, year) VALUES (:name, :year)';
$success = $connection-&gt;query(
    $sql,
    [
        'name' =&gt; 'Astro Boy',
        'year' =&gt; 1952,
    ]
);
</code></pre>

<p>当使用数字占位符，您将需要将它们定义为即 1 或 2 的整数。 在这种情况下 ‘1’ 或 ‘2’ 是字符串而不是数字，所以该占位符不能被成功替换。 与任何适配器数据自动转义使用 <a href="http://www.php.net/manual/en/pdo.quote.php">PDO Quota</a>。</p>

<p>此函数还考虑连接字符集，它建议要在连接参数中或在您的数据库服务器配置，作为错误的字符集中定义正确的字符集将产生意外的影响，在存储或检索数据时。</p>

<p>Also, you can pass your parameters directly to the <code>execute</code> or <code>query</code> methods. In this case bound parameters are directly passed to PDO:</p>

<pre><code class="language-php">&lt;?php

// Binding with PDO placeholders
$sql    = 'SELECT * FROM robots WHERE name = ? ORDER BY name';
$result = $connection-&gt;query(
    $sql,
    [
        1 =&gt; 'Wall-E',
    ]
);
</code></pre>

<p><a name="typed-placeholders"></a></p>

<h2 id="typed-placeholders">Typed placeholders</h2>

<p>Placeholders allowed you to bind parameters to avoid SQL injections:</p>

<pre><code class="language-php">&lt;?php

$phql = "SELECT * FROM Store\Robots WHERE id &gt; :id:";

$robots = $this-&gt;modelsManager-&gt;executeQuery($phql, ['id' =&gt; 100]);
</code></pre>

<p>However, some database systems require additional actions when using placeholders such as specifying the type of the bound parameter:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Db\Column;

// ...

$phql = "SELECT * FROM Store\Robots LIMIT :number:";
$robots = $this-&gt;modelsManager-&gt;executeQuery(
    $phql,
    ['number' =&gt; 10],
    Column::BIND_PARAM_INT
);
</code></pre>

<p>You can use typed placeholders in your parameters, instead of specifying the bind type in <code>executeQuery()</code>:</p>

<pre><code class="language-php">&lt;?php

$phql = "SELECT * FROM Store\Robots LIMIT {number:int}";
$robots = $this-&gt;modelsManager-&gt;executeQuery(
    $phql,
    ['number' =&gt; 10]
);

$phql = "SELECT * FROM Store\Robots WHERE name &lt;&gt; {name:str}";
$robots = $this-&gt;modelsManager-&gt;executeQuery(
    $phql,
    ['name' =&gt; $name]
);
</code></pre>

<p>You can also omit the type if you don’t need to specify it:</p>

<pre><code class="language-php">&lt;?php

$phql = "SELECT * FROM Store\Robots WHERE name &lt;&gt; {name}";
$robots = $this-&gt;modelsManager-&gt;executeQuery(
    $phql,
    ['name' =&gt; $name]
);
</code></pre>

<p>Typed placeholders are also more powerful, since we can now bind a static array without having to pass each element independently as a placeholder:</p>

<pre><code class="language-php">&lt;?php

$phql = "SELECT * FROM Store\Robots WHERE id IN ({ids:array})";
$robots = $this-&gt;modelsManager-&gt;executeQuery(
    $phql,
    ['ids' =&gt; [1, 2, 3, 4]]
);
</code></pre>

<p>The following types are available:</p>

<table>
  <thead>
    <tr>
      <th>Bind Type</th>
      <th>Bind Type Constant</th>
      <th>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>str</td>
      <td><code>Column::BIND_PARAM_STR</code></td>
      <td><code>{name:str}</code></td>
    </tr>
    <tr>
      <td>int</td>
      <td><code>Column::BIND_PARAM_INT</code></td>
      <td><code>{number:int}</code></td>
    </tr>
    <tr>
      <td>double</td>
      <td><code>Column::BIND_PARAM_DECIMAL</code></td>
      <td><code>{price:double}</code></td>
    </tr>
    <tr>
      <td>bool</td>
      <td><code>Column::BIND_PARAM_BOOL</code></td>
      <td><code>{enabled:bool}</code></td>
    </tr>
    <tr>
      <td>blob</td>
      <td><code>Column::BIND_PARAM_BLOB</code></td>
      <td><code>{image:blob}</code></td>
    </tr>
    <tr>
      <td>null</td>
      <td><code>Column::BIND_PARAM_NULL</code></td>
      <td><code>{exists:null}</code></td>
    </tr>
    <tr>
      <td>array</td>
      <td>Array of <code>Column::BIND_PARAM_STR</code></td>
      <td><code>{codes:array}</code></td>
    </tr>
    <tr>
      <td>array-str</td>
      <td>Array of <code>Column::BIND_PARAM_STR</code></td>
      <td><code>{names:array-str}</code></td>
    </tr>
    <tr>
      <td>array-int</td>
      <td>Array of <code>Column::BIND_PARAM_INT</code></td>
      <td><code>{flags:array-int}</code></td>
    </tr>
  </tbody>
</table>

<p><a name="cast-bound-parameter-values"></a></p>

<h2 id="cast-bound-parameters-values">Cast bound parameters values</h2>

<p>By default, bound parameters aren’t casted in the PHP userland to the specified bind types, this option allows you to make Phalcon cast values before bind them with PDO. A classic situation when this problem raises is passing a string in a <code>LIMIT</code>/<code>OFFSET</code> placeholder:</p>

<pre><code class="language-php">&lt;?php

$number = '100';
$robots = $modelsManager-&gt;executeQuery(
    'SELECT * FROM Some\Robots LIMIT {number:int}',
    ['number' =&gt; $number]
);
</code></pre>

<p>This causes the following exception:</p>

<pre><code>Fatal error: Uncaught exception 'PDOException' with message 'SQLSTATE[42000]:
Syntax error or access violation: 1064 You have an error in your SQL syntax;
check the manual that corresponds to your MySQL server version for the right
syntax to use near ''100'' at line 1' in /Users/scott/demo.php:78
</code></pre>

<p>This happens because 100 is a string variable. It is easily fixable by casting the value to integer first:</p>

<pre><code class="language-php">&lt;?php

$number = '100';
$robots = $modelsManager-&gt;executeQuery(
    'SELECT * FROM Some\Robots LIMIT {number:int}',
    ['number' =&gt; (int) $number]
);
</code></pre>

<p>However this solution requires that the developer pays special attention about how bound parameters are passed and their types. To make this task easier and avoid unexpected exceptions you can instruct Phalcon to do this casting for you:</p>

<pre><code class="language-php">&lt;?php

\Phalcon\Db::setup(['forceCasting' =&gt; true]);
</code></pre>

<p>The following actions are performed according to the bind type specified:</p>

<table>
  <thead>
    <tr>
      <th>Bind Type</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Column::BIND_PARAM_STR</td>
      <td>Cast the value as a native PHP string</td>
    </tr>
    <tr>
      <td>Column::BIND_PARAM_INT</td>
      <td>Cast the value as a native PHP integer</td>
    </tr>
    <tr>
      <td>Column::BIND_PARAM_BOOL</td>
      <td>Cast the value as a native PHP boolean</td>
    </tr>
    <tr>
      <td>Column::BIND_PARAM_DECIMAL</td>
      <td>Cast the value as a native PHP double</td>
    </tr>
  </tbody>
</table>

<p><a name="cast-on-hydrate"></a></p>

<h2 id="cast-on-hydrate">Cast on Hydrate</h2>

<p>Values returned from the database system are always represented as string values by PDO, no matter if the value belongs to a numerical or boolean type column. This happens because some column types cannot be represented with its corresponding PHP native types due to their size limitations. For instance, a <code>BIGINT</code> in MySQL can store large integer numbers that cannot be represented as a 32bit integer in PHP. Because of that, PDO and the ORM by default, make the safe decision of leaving all values as strings.</p>

<p>You can set up the ORM to automatically cast those types considered safe to their corresponding PHP native types:</p>

<pre><code class="language-php">&lt;?php

\Phalcon\Mvc\Model::setup(['castOnHydrate' =&gt; true]);
</code></pre>

<p>This way you can use strict operators or make assumptions about the type of variables:</p>

<pre><code class="language-php">&lt;?php

$robot = Robots::findFirst();
if (11 === $robot-&gt;id) {
    echo $robot-&gt;name;
}
</code></pre>

<p><a name="crud"></a></p>

<h2 id="插入更新删除行">插入/更新/删除行</h2>

<p>插入、 更新或删除行的你可以使用原始 SQL 或使用类所提供的预设的函数：</p>

<pre><code class="language-php">&lt;?php

// Inserting data with a raw SQL statement
$sql     = 'INSERT INTO `robots`(`name`, `year`) VALUES ('Astro Boy', 1952)';
$success = $connection-&gt;execute($sql);

// With placeholders
$sql     = 'INSERT INTO `robots`(`name`, `year`) VALUES (?, ?)';
$success = $connection-&gt;execute(
    $sql,
    [
        'Astro Boy',
        1952,
    ]
);

// Generating dynamically the necessary SQL
$success = $connection-&gt;insert(
    'robots',
    [
        'Astro Boy',
        1952,
    ],
    [
        'name',
        'year',
    ],
);

// Generating dynamically the necessary SQL (another syntax)
$success = $connection-&gt;insertAsDict(
    'robots',
    [
        'name' =&gt; 'Astro Boy',
        'year' =&gt; 1952,
    ]
);

// Updating data with a raw SQL statement
$sql     = 'UPDATE `robots` SET `name` = 'Astro boy' WHERE `id` = 101';
$success = $connection-&gt;execute($sql);

// With placeholders
$sql     = 'UPDATE `robots` SET `name` = ? WHERE `id` = ?';
$success = $connection-&gt;execute(
    $sql,
    [
        'Astro Boy',
        101,
    ]
);

// Generating dynamically the necessary SQL
$success = $connection-&gt;update(
    'robots',
    [
        'name',
    ],
    [
        'New Astro Boy',
    ],
    'id = 101' // Warning! In this case values are not escaped
);

// Generating dynamically the necessary SQL (another syntax)
$success = $connection-&gt;updateAsDict(
    'robots',
    [
        'name' =&gt; 'New Astro Boy',
    ],
    'id = 101' // Warning! In this case values are not escaped
);

// With escaping conditions
$success = $connection-&gt;update(
    'robots',
    [
        'name',
    ],
    [
        'New Astro Boy',
    ],
    [
        'conditions' =&gt; 'id = ?',
        'bind'       =&gt; [101],
        'bindTypes'  =&gt; [PDO::PARAM_INT], // Optional parameter
    ]
);
$success = $connection-&gt;updateAsDict(
    'robots',
    [
        'name' =&gt; 'New Astro Boy',
    ],
    [
        'conditions' =&gt; 'id = ?',
        'bind'       =&gt; [101],
        'bindTypes'  =&gt; [PDO::PARAM_INT], // Optional parameter
    ]
);

// Deleting data with a raw SQL statement
$sql     = 'DELETE `robots` WHERE `id` = 101';
$success = $connection-&gt;execute($sql);

// With placeholders
$sql     = 'DELETE `robots` WHERE `id` = ?';
$success = $connection-&gt;execute($sql, [101]);

// Generating dynamically the necessary SQL
$success = $connection-&gt;delete(
    'robots',
    'id = ?',
    [
        101,
    ]
);
</code></pre>

<p><a name="transactions"></a></p>

<h2 id="事务和嵌套的事务">事务和嵌套的事务</h2>

<p>Working with transactions is supported as it is with PDO. Perform data manipulation inside transactions often increase the performance on most database systems:</p>

<pre><code class="language-php">&lt;?php

try {
    // Start a transaction
    $connection-&gt;begin();

    // Execute some SQL statements
    $connection-&gt;execute('DELETE `robots` WHERE `id` = 101');
    $connection-&gt;execute('DELETE `robots` WHERE `id` = 102');
    $connection-&gt;execute('DELETE `robots` WHERE `id` = 103');

    // Commit if everything goes well
    $connection-&gt;commit();
} catch (Exception $e) {
    // An exception has occurred rollback the transaction
    $connection-&gt;rollback();
}
</code></pre>

<p>In addition to standard transactions, <a href="api/Phalcon_Db">Phalcon\Db</a> provides built-in support for <a href="http://en.wikipedia.org/wiki/Nested_transaction">nested transactions</a> (if the database system used supports them). 当第二次调用链表你嵌套的事务创建：</p>

<pre><code class="language-php">&lt;?php

try {
    // Start a transaction
    $connection-&gt;begin();

    // Execute some SQL statements
    $connection-&gt;execute('DELETE `robots` WHERE `id` = 101');

    try {
        // Start a nested transaction
        $connection-&gt;begin();

        // Execute these SQL statements into the nested transaction
        $connection-&gt;execute('DELETE `robots` WHERE `id` = 102');
        $connection-&gt;execute('DELETE `robots` WHERE `id` = 103');

        // Create a save point
        $connection-&gt;commit();
    } catch (Exception $e) {
        // An error has occurred, release the nested transaction
        $connection-&gt;rollback();
    }

    // Continue, executing more SQL statements
    $connection-&gt;execute('DELETE `robots` WHERE `id` = 104');

    // Commit if everything goes well
    $connection-&gt;commit();
} catch (Exception $e) {
    // An exception has occurred rollback the transaction
    $connection-&gt;rollback();
}
</code></pre>

<p><a name="events"></a></p>

<h2 id="数据库事件">数据库事件</h2>

<p><a href="api/Phalcon_Db">Phalcon\Db</a> is able to send events to a <a href="/3.4/en/events">EventsManager</a> if it’s present. 一些事件可以通过返回false来停止当前操作。 The following events are supported:</p>

<table>
  <thead>
    <tr>
      <th>事件名称</th>
      <th>Triggered</th>
      <th style="text-align: center">是否能停止操作吗？</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>afterConnect</code></td>
      <td>成功连接到数据库系统后</td>
      <td style="text-align: center">No</td>
    </tr>
    <tr>
      <td><code>beforeQuery</code></td>
      <td>之前将 SQL 语句发送到数据库系统</td>
      <td style="text-align: center">Yes</td>
    </tr>
    <tr>
      <td><code>afterQuery</code></td>
      <td>后将 SQL 语句发送到数据库系统</td>
      <td style="text-align: center">No</td>
    </tr>
    <tr>
      <td><code>beforeDisconnect</code></td>
      <td>关闭时态数据库连接之前</td>
      <td style="text-align: center">No</td>
    </tr>
    <tr>
      <td><code>beginTransaction</code></td>
      <td>启动事务之前</td>
      <td style="text-align: center">No</td>
    </tr>
    <tr>
      <td><code>rollbackTransaction</code></td>
      <td>在事务回滚之前</td>
      <td style="text-align: center">No</td>
    </tr>
    <tr>
      <td><code>commitTransaction</code></td>
      <td>在一个事务被提交之前</td>
      <td style="text-align: center">No</td>
    </tr>
  </tbody>
</table>

<p>Bind an EventsManager to a connection is simple, <a href="api/Phalcon_Db">Phalcon\Db</a> will trigger the events with the type <code>db</code>:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Events\Manager as EventsManager;
use Phalcon\Db\Adapter\Pdo\Mysql as Connection;

$eventsManager = new EventsManager();

// Listen all the database events
$eventsManager-&gt;attach('db', $dbListener);

$connection = new Connection(
    [
        'host'     =&gt; 'localhost',
        'username' =&gt; 'root',
        'password' =&gt; 'secret',
        'dbname'   =&gt; 'invo',
    ]
);

// Assign the eventsManager to the db adapter instance
$connection-&gt;setEventsManager($eventsManager);
</code></pre>

<p>Stop SQL operations are very useful if for example you want to implement some last-resource SQL injector checker:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Events\Event;

$eventsManager-&gt;attach(
    'db:beforeQuery',
    function (Event $event, $connection) {
        $sql = $connection-&gt;getSQLStatement();

        // Check for malicious words in SQL statements
        if (preg_match('/DROP|ALTER/i', $sql)) {
            // DROP/ALTER operations aren't allowed in the application,
            // this must be a SQL injection!
            return false;
        }

        // It's OK
        return true;
    }
);
</code></pre>

<p><a name="profiling"></a></p>

<h2 id="分析-sql-语句">分析 SQL 语句</h2>

<p><a href="api/Phalcon_Db">Phalcon\Db</a> includes a profiling component called <a href="api/Phalcon_Db_Profiler">Phalcon\Db\Profiler</a>, that is used to analyze the performance of database operations so as to diagnose performance problems and discover bottlenecks.</p>

<p>Database profiling is really easy With <a href="api/Phalcon_Db_Profiler">Phalcon\Db\Profiler</a>:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Events\Event;
use Phalcon\Events\Manager as EventsManager;
use Phalcon\Db\Profiler as DbProfiler;

$eventsManager = new EventsManager();

$profiler = new DbProfiler();

// Listen all the database events
$eventsManager-&gt;attach(
    'db',
    function (Event $event, $connection) use ($profiler) {
        if ($event-&gt;getType() === 'beforeQuery') {
            $sql = $connection-&gt;getSQLStatement();

            // Start a profile with the active connection
            $profiler-&gt;startProfile($sql);
        }

        if ($event-&gt;getType() === 'afterQuery') {
            // Stop the active profile
            $profiler-&gt;stopProfile();
        }
    }
);

// Assign the events manager to the connection
$connection-&gt;setEventsManager($eventsManager);

$sql = 'SELECT buyer_name, quantity, product_name '
     . 'FROM buyers '
     . 'LEFT JOIN products ON buyers.pid = products.id';

// Execute a SQL statement
$connection-&gt;query($sql);

// Get the last profile in the profiler
$profile = $profiler-&gt;getLastProfile();

echo 'SQL Statement: ', $profile-&gt;getSQLStatement(), "\n";
echo 'Start Time: ', $profile-&gt;getInitialTime(), "\n";
echo 'Final Time: ', $profile-&gt;getFinalTime(), "\n";
echo 'Total Elapsed Time: ', $profile-&gt;getTotalElapsedSeconds(), "\n";
</code></pre>

<p>You can also create your own profile class based on <a href="api/Phalcon_Db_Profiler">Phalcon\Db\Profiler</a> to record real time statistics of the statements sent to the database system:</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Events\Manager as EventsManager;
use Phalcon\Db\Profiler as Profiler;
use Phalcon\Db\Profiler\Item as Item;

class DbProfiler extends Profiler
{
    /**
     * Executed before the SQL statement will sent to the db server
     */
    public function beforeStartProfile(Item $profile)
    {
        echo $profile-&gt;getSQLStatement();
    }

    /**
     * Executed after the SQL statement was sent to the db server
     */
    public function afterEndProfile(Item $profile)
    {
        echo $profile-&gt;getTotalElapsedSeconds();
    }
}

// Create an Events Manager
$eventsManager = new EventsManager();

// Create a listener
$dbProfiler = new DbProfiler();

// Attach the listener listening for all database events
$eventsManager-&gt;attach('db', $dbProfiler);
</code></pre>

<p><a name="logging-statements"></a></p>

<h2 id="日志记录的-sql-语句">日志记录的 SQL 语句</h2>

<p>Using high-level abstraction components such as <a href="api/Phalcon_Db">Phalcon\Db</a> to access a database, it is difficult to understand which statements are sent to the database system. <a href="api/Phalcon_Logger">Phalcon\Logger</a> interacts with <a href="api/Phalcon_Db">Phalcon\Db</a>, providing logging capabilities on the database abstraction layer.</p>

<pre><code class="language-php">&lt;?php

use Phalcon\Logger;
use Phalcon\Events\Event;
use Phalcon\Events\Manager as EventsManager;
use Phalcon\Logger\Adapter\File as FileLogger;

$eventsManager = new EventsManager();

$logger = new FileLogger('app/logs/db.log');

$eventsManager-&gt;attach(
    'db:beforeQuery',
    function (Event $event, $connection) use ($logger) {
        $sql = $connection-&gt;getSQLStatement();

        $logger-&gt;log($sql, Logger::INFO);
    }
);

// Assign the eventsManager to the db adapter instance
$connection-&gt;setEventsManager($eventsManager);

// Execute some SQL statement
$connection-&gt;insert(
    'products',
    [
        'Hot pepper',
        3.50,
    ],
    [
        'name',
        'price',
    ]
);
</code></pre>

<p>如上所述，<code>app/logs/db.log</code> 文件将包含这样的事情：</p>

<pre><code class="language-bash">[Sun, 29 Apr 12 22:35:26 -0500][DEBUG][Resource Id #77] INSERT INTO products
(name, price) VALUES ('Hot pepper', 3.50)
</code></pre>

<p><a name="logger-custom"></a></p>

<h2 id="执行您自己的记录器">执行您自己的记录器</h2>

<p>You can implement your own logger class for database queries, by creating a class that implements a single method called <code>log</code>. The method needs to accept a string as the first argument. You can then pass your logging object to <code>Phalcon\Db::setLogger()</code>, and from then on any SQL statement executed will call that method to log the results.</p>

<p><a name="describing-tables"></a></p>

<h2 id="描述-表视图">描述 表/视图</h2>

<p><a href="api/Phalcon_Db">Phalcon\Db</a> also provides methods to retrieve detailed information about tables and views:</p>

<pre><code class="language-php">&lt;?php

// Get tables on the test_db database
$tables = $connection-&gt;listTables('test_db');

// Is there a table 'robots' in the database?
$exists = $connection-&gt;tableExists('robots');

// Get name, data types and special features of 'robots' fields
$fields = $connection-&gt;describeColumns('robots');
foreach ($fields as $field) {
    echo 'Column Type: ', $field['Type'];
}

// Get indexes on the 'robots' table
$indexes = $connection-&gt;describeIndexes('robots');
foreach ($indexes as $index) {
    print_r(
        $index-&gt;getColumns()
    );
}

// Get foreign keys on the 'robots' table
$references = $connection-&gt;describeReferences('robots');
foreach ($references as $reference) {
    // Print referenced columns
    print_r(
        $reference-&gt;getReferencedColumns()
    );
}
</code></pre>

<p>A table description is very similar to the MySQL <code>DESCRIBE</code> command, it contains the following information:</p>

<table>
  <thead>
    <tr>
      <th>字段</th>
      <th>类型</th>
      <th>关键字</th>
      <th>Null</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>字段名称</td>
      <td>列类型</td>
      <td>是的主键或索引的列部分吗？</td>
      <td>该列是否允许空值？</td>
    </tr>
  </tbody>
</table>

<p>Methods to get information about views are also implemented for every supported database system:</p>

<pre><code class="language-php">&lt;?php

// Get views on the test_db database
$tables = $connection-&gt;listViews('test_db');

// Is there a view 'robots' in the database?
$exists = $connection-&gt;viewExists('robots');
</code></pre>

<p><a name="tables"></a></p>

<h2 id="创建更改删除表">[创建/更改/删除]表</h2>

<p>Different database systems (MySQL, Postgresql etc.) offer the ability to create, alter or drop tables with the use of commands such as <code>CREATE</code>, <code>ALTER</code> or <code>DROP</code>. The SQL syntax differs based on which database system is used. <code>Phalcon\Db</code> 提供了一个统一的接口来更改表, 而无需根据目标存储系统区分 sql 语法。</p>

<p><a name="tables-create"></a></p>

<h3 id="创建表">创建表</h3>

<p>The following example shows how to create a table:</p>

<pre><code class="language-php">&lt;?php

use \Phalcon\Db\Column as Column;

$connection-&gt;createTable(
    'robots',
    null,
    [
       'columns' =&gt; [
            new Column(
                'id',
                [
                    'type'          =&gt; Column::TYPE_INTEGER,
                    'size'          =&gt; 10,
                    'notNull'       =&gt; true,
                    'autoIncrement' =&gt; true,
                    'primary'       =&gt; true,
                ]
            ),
            new Column(
                'name',
                [
                    'type'    =&gt; Column::TYPE_VARCHAR,
                    'size'    =&gt; 70,
                    'notNull' =&gt; true,
                ]
            ),
            new Column(
                'year',
                [
                    'type'    =&gt; Column::TYPE_INTEGER,
                    'size'    =&gt; 11,
                    'notNull' =&gt; true,
                ]
            ),
        ]
    ]
);
</code></pre>

<p><code>Phalcon\Db::createTable()</code> accepts an associative array describing the table. Columns are defined with the class <a href="api/Phalcon_Db_Column">Phalcon\Db\Column</a>. The table below shows the options available to define a column:</p>

<p>| Option     | Description                                                                                                                        |                                                                     可选                                                                     |
| ———- | ———————————————————————————————————————————- |:——————————————————————————————————————————————:|
| <code>type</code>     | Column type. Must be a <a href="api/Phalcon_Db_Column">Phalcon\Db\Column</a> constant (see below for a list)                                |                                                                     No                                                                     |
| <code>primary</code>  | True if the column is part of the table’s primary key                                                                              |                                                                    Yes                                                                     |
| <code>size</code>     | Some type of columns like <code>VARCHAR</code> or <code>INTEGER</code> may have a specific size                                                          |                                                                    Yes                                                                     |
| <code>scale</code>    | <code>DECIMAL</code> 或 <code>NUMBER</code> 列可能有位数来指定应存储多少位小数                                                                                             |                                                                    Yes                                                                     |
| <code>unsigned</code> | <code>INTEGER</code> columns may be signed or unsigned. This option does not apply to other types of columns                                  |                                                                    Yes                                                                     |
| <code>notNull</code>  | 列可以存储 null 值吗？                                                                                                                     |                                                                    Yes                                                                     |
| <code>default</code>  | 默认值(使用`‘notNull’ =&gt; truer &lt;/0 &gt;)。&lt;/td&gt;</p>
<td align="center">Yes</td>
<p>&lt;/tr&gt;</p>
<tr>
  <td><code>自动增量` | With this attribute column will filled automatically with an auto-increment integer. Only one column in the table can have this attribute. | Yes |
| `bind`     | One of the `BIND_TYPE_*` constants telling how the column must be bound before save it                                             |                                                                    Yes                                                                     |
| `first`    | 列必须放置在第一个位置中的列顺序                                                                                                                   |                                                                    Yes                                                                     |
| `after`    | Column must be placed after indicated column                                                                                       |                                                                    Yes                                                                     |

[Phalcon\Db](api/Phalcon_Db) supports the following database column types:

* `Phalcon\Db\Column::TYPE_INTEGER`
* `Phalcon\Db\Column::TYPE_DATE`
* `Phalcon\Db\Column::TYPE_VARCHAR`
* `Phalcon\Db\Column::TYPE_DECIMAL`
* `Phalcon\Db\Column::TYPE_DATETIME`
* `Phalcon\Db\Column::TYPE_CHAR`
* `Phalcon\Db\Column::TYPE_TEXT`

The associative array passed in `Phalcon\Db::createTable()` can have the possible keys:

| 索引           | Description                                                                                                                            | 可选  |
| ------------ | -------------------------------------------------------------------------------------------------------------------------------------- |:---:|
| `columns`    | An array with a set of table columns defined with [Phalcon\Db\Column](api/Phalcon_Db_Column)                                         | No  |
| `indexes`    | An array with a set of table indexes defined with [Phalcon\Db\Index](api/Phalcon_Db_Index)                                           | Yes |
| `references` | An array with a set of table references (foreign keys) defined with [Phalcon\Db\Reference](api/Phalcon_Db_Reference)                 | Yes |
| `options`    | An array with a set of table creation options. These options often relate to the database system in which the migration was generated. | Yes |

<a name="tables-altering"></a>

### 变更表

As your application grows, you might need to alter your database, as part of a refactoring or adding new features. Not all database systems allow to modify existing columns or add columns between two existing ones. [Phalcon\Db](api/Phalcon_Db) is limited by these constraints.

```php
&lt;?php

use Phalcon\Db\Column as Column;

// Adding a new column
$connection-&gt;addColumn(
    'robots',
    null,
    new Column(
        'robot_type',
        [
            'type'    =&gt; Column::TYPE_VARCHAR,
            'size'    =&gt; 32,
            'notNull' =&gt; true,
            'after'   =&gt; 'name',
        ]
    )
);

// Modifying an existing column
$connection-&gt;modifyColumn(
    'robots',
    null,
    new Column(
        'name',
        [
            'type'    =&gt; Column::TYPE_VARCHAR,
            'size'    =&gt; 40,
            'notNull' =&gt; true,
        ]
    )
);

// Deleting the column 'name'
$connection-&gt;dropColumn(
    'robots',
    null,
    'name'
);
```

<a name="tables-dropping"></a>

### 删除表

To drop an existing table from the current database, use the `dropTable` method. To drop an table from custom database, use second parameter describes database name. 在删除表的例子：

```php
&lt;?php

// Drop table 'robots' from active database
$connection-&gt;dropTable('robots');

// Drop table 'robots' from database 'machines'
$connection-&gt;dropTable('robots', 'machines');
```
</code></td></tr>

                                    </div>
                                    <div class="col-md-4 col-lg-3 col-sm-12 support-column-margin">
                                        <div class="topic-search">
    <form class="bd-search d-flex align-items-center">
        <input type="search"
               class="form-control"
               id="docs-search"
               placeholder=""
               aria-label=""
               autocomplete="off"
               data-siteurl="https://phalcon-docs4.netlify.com"
               data-docs-version="3.4">
        <button class="btn btn-link bd-search-docs-toggle d-md-none p-0 ml-3"
                type="button"
                data-toggle="collapse"
                data-target="#bd-docs-nav"
                aria-controls="bd-docs-nav"
                aria-expanded="false"
                aria-label="Toggle docs navigation">
            <svg xmlns="http://www.w3.org/2000/svg"
                 viewbox="0 0 30 30"
                 width="30"
                 height="30"
                 focusable="false">
                <title>Menu</title>
                <path stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-miterlimit="10"
                      d="M4 7h22M4 15h22M4 23h22"></path>
            </svg>
        </button>
    </form>
</div>
                                        <div class="topic-categories">
    
</div>

                                        <div class="article-menu">
    <ul>
        
        
    </ul>
</div>
                                    </div>
                                </div>
                            </div>
                        </section>

                    </div>
                </div>
            </div>
        </div>
    </div>

<footer>
    <div class="container">
        <div class="footer-wrapper clearfix">

            <div class="footer-link-container">
                <a class="footer-link" href="/">
                    <img class="footer-logo-img" src="/assets/images/footer_logo.svg" alt="logo">
                </a>
                <a class="footer-link" href="https://phalcon.link/about" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://phalcon.link/sponsors" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://phalcon.link/fund" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://phalcon.link/download" target="_blank">
                    
                </a>
                <a class="footer-link" href="https://license.phalconphp.com/" target="_blank">
                     New BSD
                </a>
            </div>

            <div class="footer-copyright">
                <a href="https://odva.pro/" target="_blank" class="o2-link">
                    <span></span> <img src="/assets/images/logo-o2.svg" alt="logo o2">
                </a>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript" src="/assets/js/main.min.js?v1547266080100021829"></script>
<script type="text/javascript" src="/assets/js/highlight/highlight.pack.js?v1547266080100021829"></script>
<script type="application/javascript">hljs.initHighlightingOnLoad();</script>
<script type="application/javascript">hljs.initHighlightingOnLoad();</script>
</body>
</html>
